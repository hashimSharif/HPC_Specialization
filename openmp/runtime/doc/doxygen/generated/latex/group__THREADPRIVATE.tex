\hypertarget{group__THREADPRIVATE}{\section{Thread private data support}
\label{group__THREADPRIVATE}\index{Thread private data support@{Thread private data support}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__THREADPRIVATE_ga1453eca6136fd77e5de88ea0e78cc7a4}{\-\_\-\-\_\-kmpc\-\_\-copyprivate} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 gtid, size\-\_\-t cpy\-\_\-size, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$cpy\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$cpy\-\_\-func)(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$), kmp\-\_\-int32 didit)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__THREADPRIVATE_ga120efa08eb51f45664477d30eff31916}{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$\hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}, \hyperlink{group__THREADPRIVATE_ga0c2f8074a8474eee42bc96a4bdc7679a}{kmpc\-\_\-ctor} ctor, \hyperlink{group__THREADPRIVATE_gab6148c019e88c8853596bf5f516373b4}{kmpc\-\_\-cctor} cctor, \hyperlink{group__THREADPRIVATE_gad8268ac7d007fa1c3351da682c487c0f}{kmpc\-\_\-dtor} dtor)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$ \hyperlink{group__THREADPRIVATE_gab4aa3dff2b1b55b1abb002ef69c7efe7}{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$\hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}, size\-\_\-t \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size}, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$$\ast$$\ast$cache)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__THREADPRIVATE_gaec6e88892a1b0b62287df5173a7f0336}{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$\hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}, \hyperlink{group__THREADPRIVATE_gac1f868aef7d531d34b91eaa57e339f21}{kmpc\-\_\-ctor\-\_\-vec} ctor, \hyperlink{group__THREADPRIVATE_gaf9503cacabf6cf90ed34f2727fc480bc}{kmpc\-\_\-cctor\-\_\-vec} cctor, \hyperlink{group__THREADPRIVATE_gab7035b42d465074b31195534efb37e3b}{kmpc\-\_\-dtor\-\_\-vec} dtor, size\-\_\-t vector\-\_\-length)
\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$($\ast$ \hyperlink{group__THREADPRIVATE_ga0c2f8074a8474eee42bc96a4bdc7679a}{kmpc\-\_\-ctor} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$)
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$ \hyperlink{group__THREADPRIVATE_gad8268ac7d007fa1c3351da682c487c0f}{kmpc\-\_\-dtor} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$)
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$($\ast$ \hyperlink{group__THREADPRIVATE_gab6148c019e88c8853596bf5f516373b4}{kmpc\-\_\-cctor} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$)
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$($\ast$ \hyperlink{group__THREADPRIVATE_gac1f868aef7d531d34b91eaa57e339f21}{kmpc\-\_\-ctor\-\_\-vec} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, size\-\_\-t)
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$ \hyperlink{group__THREADPRIVATE_gab7035b42d465074b31195534efb37e3b}{kmpc\-\_\-dtor\-\_\-vec} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, size\-\_\-t)
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$($\ast$ \hyperlink{group__THREADPRIVATE_gaf9503cacabf6cf90ed34f2727fc480bc}{kmpc\-\_\-cctor\-\_\-vec} )(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$, size\-\_\-t)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
These functions support copyin/out and thread private data. 

\subsection{Typedef Documentation}
\hypertarget{group__THREADPRIVATE_gab6148c019e88c8853596bf5f516373b4}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-cctor@{kmpc\-\_\-cctor}}
\index{kmpc\-\_\-cctor@{kmpc\-\_\-cctor}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-cctor}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}$\ast$($\ast$ kmpc\-\_\-cctor)({\bf void} $\ast$, {\bf void} $\ast$)}}\label{group__THREADPRIVATE_gab6148c019e88c8853596bf5f516373b4}
Pointer to an alternate constructor. The first argument is the {\ttfamily this} pointer. 

Definition at line 1440 of file kmp.\-h.

\hypertarget{group__THREADPRIVATE_gaf9503cacabf6cf90ed34f2727fc480bc}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-cctor\-\_\-vec@{kmpc\-\_\-cctor\-\_\-vec}}
\index{kmpc\-\_\-cctor\-\_\-vec@{kmpc\-\_\-cctor\-\_\-vec}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-cctor\-\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}$\ast$($\ast$ kmpc\-\_\-cctor\-\_\-vec)({\bf void} $\ast$, {\bf void} $\ast$, size\-\_\-t)}}\label{group__THREADPRIVATE_gaf9503cacabf6cf90ed34f2727fc480bc}
Array constructor. First argument is the {\ttfamily this} pointer Third argument the number of array elements. 

Definition at line 1462 of file kmp.\-h.

\hypertarget{group__THREADPRIVATE_ga0c2f8074a8474eee42bc96a4bdc7679a}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-ctor@{kmpc\-\_\-ctor}}
\index{kmpc\-\_\-ctor@{kmpc\-\_\-ctor}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-ctor}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}$\ast$($\ast$ kmpc\-\_\-ctor)({\bf void} $\ast$)}}\label{group__THREADPRIVATE_ga0c2f8074a8474eee42bc96a4bdc7679a}
Pointer to the constructor function. The first argument is the {\ttfamily this} pointer 

Definition at line 1429 of file kmp.\-h.

\hypertarget{group__THREADPRIVATE_gac1f868aef7d531d34b91eaa57e339f21}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-ctor\-\_\-vec@{kmpc\-\_\-ctor\-\_\-vec}}
\index{kmpc\-\_\-ctor\-\_\-vec@{kmpc\-\_\-ctor\-\_\-vec}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-ctor\-\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}$\ast$($\ast$ kmpc\-\_\-ctor\-\_\-vec)({\bf void} $\ast$, size\-\_\-t)}}\label{group__THREADPRIVATE_gac1f868aef7d531d34b91eaa57e339f21}
Array constructor. First argument is the {\ttfamily this} pointer Second argument the number of array elements. 

Definition at line 1450 of file kmp.\-h.

\hypertarget{group__THREADPRIVATE_gad8268ac7d007fa1c3351da682c487c0f}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-dtor@{kmpc\-\_\-dtor}}
\index{kmpc\-\_\-dtor@{kmpc\-\_\-dtor}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-dtor}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}($\ast$ kmpc\-\_\-dtor)({\bf void} $\ast$)}}\label{group__THREADPRIVATE_gad8268ac7d007fa1c3351da682c487c0f}
Pointer to the destructor function. The first argument is the {\ttfamily this} pointer 

Definition at line 1435 of file kmp.\-h.

\hypertarget{group__THREADPRIVATE_gab7035b42d465074b31195534efb37e3b}{\index{Thread private data support@{Thread private data support}!kmpc\-\_\-dtor\-\_\-vec@{kmpc\-\_\-dtor\-\_\-vec}}
\index{kmpc\-\_\-dtor\-\_\-vec@{kmpc\-\_\-dtor\-\_\-vec}!Thread private data support@{Thread private data support}}
\subsubsection[{kmpc\-\_\-dtor\-\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}($\ast$ kmpc\-\_\-dtor\-\_\-vec)({\bf void} $\ast$, size\-\_\-t)}}\label{group__THREADPRIVATE_gab7035b42d465074b31195534efb37e3b}
Pointer to the array destructor function. The first argument is the {\ttfamily this} pointer Second argument the number of array elements. 

Definition at line 1456 of file kmp.\-h.



\subsection{Function Documentation}
\hypertarget{group__THREADPRIVATE_ga1453eca6136fd77e5de88ea0e78cc7a4}{\index{Thread private data support@{Thread private data support}!\-\_\-\-\_\-kmpc\-\_\-copyprivate@{\-\_\-\-\_\-kmpc\-\_\-copyprivate}}
\index{\-\_\-\-\_\-kmpc\-\_\-copyprivate@{\-\_\-\-\_\-kmpc\-\_\-copyprivate}!Thread private data support@{Thread private data support}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-copyprivate}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-copyprivate (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{gtid, }
\item[{size\-\_\-t}]{cpy\-\_\-size, }
\item[{{\bf void} $\ast$}]{cpy\-\_\-data, }
\item[{{\bf void}($\ast$)({\bf void} $\ast$, {\bf void} $\ast$)}]{cpy\-\_\-func, }
\item[{kmp\-\_\-int32}]{didit}
\end{DoxyParamCaption}
)}}\label{group__THREADPRIVATE_ga1453eca6136fd77e5de88ea0e78cc7a4}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em gtid} & global thread number \\
\hline
{\em cpy\-\_\-size} & size of the cpy\-\_\-data buffer \\
\hline
{\em cpy\-\_\-data} & pointer to data to be copied \\
\hline
{\em cpy\-\_\-func} & helper function to call for copying data \\
\hline
{\em didit} & flag variable\-: 1=single thread; 0=not single thread\\
\hline
\end{DoxyParams}
\-\_\-\-\_\-kmpc\-\_\-copyprivate implements the interface for the private data broadcast needed for the copyprivate clause associated with a single region in an Open\-M\-P$^{\mbox{$\ast$}}$  program (both C and Fortran). All threads participating in the parallel region call this routine. One of the threads (called the single thread) should have the {\ttfamily didit} variable set to 1 and all other threads should have that variable set to 0. All threads pass a pointer to a data buffer (cpy\-\_\-data) that they have built.

The Open\-M\-P specification forbids the use of nowait on the single region when a copyprivate clause is present. However, \hyperlink{group__THREADPRIVATE_ga1453eca6136fd77e5de88ea0e78cc7a4}{\-\_\-\-\_\-kmpc\-\_\-copyprivate} implements a barrier internally to avoid race conditions, so the code generation for the single region should avoid generating a barrier after the call to \hyperlink{group__THREADPRIVATE_ga1453eca6136fd77e5de88ea0e78cc7a4}{\-\_\-\-\_\-kmpc\-\_\-copyprivate}.

The {\ttfamily gtid} parameter is the global thread id for the current thread. The {\ttfamily loc} parameter is a pointer to source location information.

Internal implementation\-: The single thread will first copy its descriptor address (cpy\-\_\-data) to a team-\/private location, then the other threads will each call the function pointed to by the parameter cpy\-\_\-func, which carries out the copy by copying the data using the cpy\-\_\-data buffer.

The cpy\-\_\-func routine used for the copy and the contents of the data area defined by cpy\-\_\-data and cpy\-\_\-size may be built in any fashion that will allow the copy to be done. For instance, the cpy\-\_\-data buffer can hold the actual data to be copied or it may hold a list of pointers to the data. The cpy\-\_\-func routine must interpret the cpy\-\_\-data buffer appropriately.

The interface to cpy\-\_\-func is as follows\-: 
\begin{DoxyCode}
\textcolor{keywordtype}{void} cpy\_func( \textcolor{keywordtype}{void} *destination, \textcolor{keywordtype}{void} *source )
\end{DoxyCode}
 where void $\ast$destination is the cpy\-\_\-data pointer for the thread being copied to and void $\ast$source is the cpy\-\_\-data pointer for the thread being copied from. 

Definition at line 1764 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
1765 \{
1766     \textcolor{keywordtype}{void} **data\_ptr;
1767 
1768     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_copyprivate: called T#%d\(\backslash\)n"}, gtid ));
1769 
1770     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1771 
1772     data\_ptr = & \hyperlink{kmp_8h_a44712b8a86bcc5e3bd49981e5bb3ce6c}{\_\_kmp\_team\_from\_gtid}( gtid )->t.t\_copypriv\_data;
1773 
1774     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
1775         \textcolor{keywordflow}{if} ( loc == 0 ) \{
1776             \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ConstructIdentInvalid );
1777         \}
1778     \}
1779 
1780     \textcolor{comment}{/* ToDo: Optimize the following two barriers into some kind of split barrier */}
1781 
1782     \textcolor{keywordflow}{if} (didit) *data\_ptr = cpy\_data;
1783 
1784     \textcolor{comment}{/* This barrier is not a barrier region boundary */}
1785 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
1786 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_ident = loc;
1787 \textcolor{preprocessor}{#endif}
1788 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, gtid, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} , 0, NULL, NULL );
1789 
1790     \textcolor{keywordflow}{if} (! didit) (*cpy\_func)( cpy\_data, *data\_ptr );
1791 
1792     \textcolor{comment}{/* Consider next barrier the user-visible barrier for barrier region boundaries */}
1793     \textcolor{comment}{/* Nesting checks are already handled by the single construct checks */}
1794 
1795 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
1796 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_ident = loc; \textcolor{comment}{// TODO: check if it is needed (e.g. tasks can
       overwrite the location)}
1797 \textcolor{preprocessor}{#endif}
1798 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, gtid, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} , 0, NULL, NULL );
1799 \}
\end{DoxyCode}
\hypertarget{group__THREADPRIVATE_gab4aa3dff2b1b55b1abb002ef69c7efe7}{\index{Thread private data support@{Thread private data support}!\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached}}
\index{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached}!Thread private data support@{Thread private data support}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void}$\ast$ \-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-cached (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{{\bf void} $\ast$}]{data, }
\item[{size\-\_\-t}]{size, }
\item[{{\bf void} $\ast$$\ast$$\ast$}]{cache}
\end{DoxyParamCaption}
)}}\label{group__THREADPRIVATE_gab4aa3dff2b1b55b1abb002ef69c7efe7}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number \\
\hline
{\em data} & pointer to data to privatize \\
\hline
{\em size} & size of data to privatize \\
\hline
{\em cache} & pointer to cache \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
pointer to private storage
\end{DoxyReturn}
Allocate private storage for threadprivate data. 

Definition at line 630 of file kmp\-\_\-threadprivate.\-c.


\begin{DoxyCode}
636   \{
637     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_threadprivate\_cached: T#%d called with cache: %p, address: %p, size: %"}
638                    KMP\_SIZE\_T\_SPEC \textcolor{stringliteral}{"\(\backslash\)n"},
639                    global\_tid, *cache, \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}, \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size} ) );
640 
641     \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(*cache) == 0) \{
642         \hyperlink{kmp__lock_8h_a0eb3c836f2c88a4b8cad9535b53bafe0}{\_\_kmp\_acquire\_lock}( & \hyperlink{kmp_8h_a56af8af84b1717817c3abe69ecc8cc18}{\_\_kmp\_global\_lock}, global\_tid );
643 
644         \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(*cache) == 0) \{
645             \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}(&
      \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock});
646             \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached} = 1;
647             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}(&
      \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock});
648             \textcolor{keywordtype}{void} ** my\_cache;
649             \hyperlink{kmp__itt_8h_a2461143f5948ba03b833429dded525bd}{KMP\_ITT\_IGNORE}(
650             my\_cache = (\textcolor{keywordtype}{void}**)
651                 \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(\textcolor{keyword}{sizeof}( \textcolor{keywordtype}{void} * ) * 
      \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity} + \textcolor{keyword}{sizeof} ( \hyperlink{structkmp__cached__addr}{kmp\_cached\_addr\_t} ));
652                            );
653             \textcolor{comment}{// No need to zero the allocated memory; \_\_kmp\_allocate does that.}
654             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 50, (\textcolor{stringliteral}{"\_\_kmpc\_threadprivate\_cached: T#%d allocated cache at address %p\(\backslash\)n"},
655                            global\_tid, my\_cache ) );
656             
657             \textcolor{comment}{/* TODO: free all this memory in \_\_kmp\_common\_destroy using \_\_kmp\_threadpriv\_cache\_list */}
658             \textcolor{comment}{/* Add address of mycache to linked list for cleanup later  */}
659             \hyperlink{structkmp__cached__addr}{kmp\_cached\_addr\_t} *tp\_cache\_addr;
660 
661             tp\_cache\_addr = (\hyperlink{structkmp__cached__addr}{kmp\_cached\_addr\_t} *) & my\_cache[
      \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity}];
662             tp\_cache\_addr -> \hyperlink{ittnotify__static_8h_a7e21c61c16fffcc27199a9d66ff39ab8}{addr} = my\_cache;
663             tp\_cache\_addr -> next = \hyperlink{kmp_8h_a4ffa887cdb59674790ac14ee4a8228e9}{\_\_kmp\_threadpriv\_cache\_list};
664             \hyperlink{kmp_8h_a4ffa887cdb59674790ac14ee4a8228e9}{\_\_kmp\_threadpriv\_cache\_list} = tp\_cache\_addr;
665 
666             \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
667 
668             \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}( *cache, my\_cache);
669 
670             \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
671         \}
672 
673         \hyperlink{kmp__lock_8h_ab32472fcbb6de6d99adb9fbbdaf5a39a}{\_\_kmp\_release\_lock}( & \hyperlink{kmp_8h_a56af8af84b1717817c3abe69ecc8cc18}{\_\_kmp\_global\_lock}, global\_tid );
674     \}
675 
676     \textcolor{keywordtype}{void} *ret;
677     \textcolor{keywordflow}{if} ((ret = \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}((*cache)[ global\_tid ])) == 0) \{
678         ret = \hyperlink{kmp__threadprivate_8c_a5af8bf0a1816291e561251e5b9ba0581}{\_\_kmpc\_threadprivate}( loc, global\_tid, \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}, (\textcolor{keywordtype}{size\_t}) 
      \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size});
679 
680         \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}( (*cache)[ global\_tid ], ret);
681     \}
682     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_threadprivate\_cached: T#%d exiting; return value = %p\(\backslash\)n"},
683                    global\_tid, ret ) );
684 
685     \textcolor{keywordflow}{return} ret;
686 \}
\end{DoxyCode}
\hypertarget{group__THREADPRIVATE_ga120efa08eb51f45664477d30eff31916}{\index{Thread private data support@{Thread private data support}!\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register}}
\index{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register}!Thread private data support@{Thread private data support}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{{\bf void} $\ast$}]{data, }
\item[{{\bf kmpc\-\_\-ctor}}]{ctor, }
\item[{{\bf kmpc\-\_\-cctor}}]{cctor, }
\item[{{\bf kmpc\-\_\-dtor}}]{dtor}
\end{DoxyParamCaption}
)}}\label{group__THREADPRIVATE_ga120efa08eb51f45664477d30eff31916}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em data} & pointer to data being privatized \\
\hline
{\em ctor} & pointer to constructor function for data \\
\hline
{\em cctor} & pointer to copy constructor function for data \\
\hline
{\em dtor} & pointer to destructor function for data\\
\hline
\end{DoxyParams}
Register constructors and destructors for thread private data. This function is called when executing in parallel, when we know the thread id. 

Definition at line 532 of file kmp\-\_\-threadprivate.\-c.


\begin{DoxyCode}
533 \{
534     \textcolor{keyword}{struct }\hyperlink{structshared__common}{shared\_common} *d\_tn, **lnk\_tn;
535 
536     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_threadprivate\_register: called\(\backslash\)n"} ) );
537 
538 \textcolor{preprocessor}{#ifdef USE\_CHECKS\_COMMON}
539 \textcolor{preprocessor}{}    \textcolor{comment}{/* copy constructor must be zero for current code gen (Nov 2002 - jph) */}
540     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{structshared__common_a66f5f4ebb70f7db1a21310d31a387377}{cctor} == 0);
541 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_CHECKS\_COMMON */}\textcolor{preprocessor}{}
542 \textcolor{preprocessor}{}
543     \textcolor{comment}{/* Only the global data table exists. */}
544     d\_tn = \hyperlink{kmp__threadprivate_8c_a89f3380531af4850006d1b7a6d381df3}{\_\_kmp\_find\_shared\_task\_common}( &
      \hyperlink{kmp__threadprivate_8c_ac5d665dbab9923a586d0069f809fb1b0}{\_\_kmp\_threadprivate\_d\_table}, -1, \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data} );
545 
546     \textcolor{keywordflow}{if} (d\_tn == 0) \{
547         d\_tn = (\textcolor{keyword}{struct }\hyperlink{structshared__common}{shared\_common} *) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}( \textcolor{keyword}{struct} 
      \hyperlink{structshared__common}{shared\_common} ) );
548         d\_tn->\hyperlink{structshared__common_abfaf275dda5ac5223f6e0f0aa333b52b}{gbl\_addr} = \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data};
549 
550         d\_tn->\hyperlink{structshared__common_ac98f8d219b58bb8cb289d896c2328e21}{ct}.\hyperlink{structshared__common_a26bff742774584fe18d5bca4b432b1ed}{ctor} = \hyperlink{structshared__common_a26bff742774584fe18d5bca4b432b1ed}{ctor};
551         d\_tn->\hyperlink{structshared__common_a3292a73e5a3070dfdb448f7b205f68a5}{cct}.\hyperlink{structshared__common_a66f5f4ebb70f7db1a21310d31a387377}{cctor} = \hyperlink{structshared__common_a66f5f4ebb70f7db1a21310d31a387377}{cctor};
552         d\_tn->\hyperlink{structshared__common_ae1c3740671335275599c29df1f6d71d1}{dt}.\hyperlink{structshared__common_a127171cc49794904b593bee96f1b7d04}{dtor} = \hyperlink{structshared__common_a127171cc49794904b593bee96f1b7d04}{dtor};
553 \textcolor{comment}{/*}
554 \textcolor{comment}{        d\_tn->is\_vec = FALSE;  // AC: commented out because \_\_kmp\_allocate zeroes the memory}
555 \textcolor{comment}{        d\_tn->vec\_len = 0L;}
556 \textcolor{comment}{        d\_tn->obj\_init = 0;}
557 \textcolor{comment}{        d\_tn->pod\_init = 0;}
558 \textcolor{comment}{*/}
559         lnk\_tn = &(\hyperlink{kmp__threadprivate_8c_ac5d665dbab9923a586d0069f809fb1b0}{\_\_kmp\_threadprivate\_d\_table}.\hyperlink{structshared__table_acbe02cd3db1cddd2f658db7e64c2bfc5}{data}[ 
      \hyperlink{kmp_8h_a81fe0625f28faf8ec00b8cf7820e103b}{KMP\_HASH}(\hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}) ]);
560 
561         d\_tn->\hyperlink{structshared__common_aa54da923f39ba340f472b4a62205b967}{next} = *lnk\_tn;
562         *lnk\_tn = d\_tn;
563     \}
564 \}
\end{DoxyCode}
\hypertarget{group__THREADPRIVATE_gaec6e88892a1b0b62287df5173a7f0336}{\index{Thread private data support@{Thread private data support}!\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec}}
\index{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec@{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec}!Thread private data support@{Thread private data support}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-threadprivate\-\_\-register\-\_\-vec (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{{\bf void} $\ast$}]{data, }
\item[{{\bf kmpc\-\_\-ctor\-\_\-vec}}]{ctor, }
\item[{{\bf kmpc\-\_\-cctor\-\_\-vec}}]{cctor, }
\item[{{\bf kmpc\-\_\-dtor\-\_\-vec}}]{dtor, }
\item[{size\-\_\-t}]{vector\-\_\-length}
\end{DoxyParamCaption}
)}}\label{group__THREADPRIVATE_gaec6e88892a1b0b62287df5173a7f0336}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em data} & pointer to data being privatized \\
\hline
{\em ctor} & pointer to constructor function for data \\
\hline
{\em cctor} & pointer to copy constructor function for data \\
\hline
{\em dtor} & pointer to destructor function for data \\
\hline
{\em vector\-\_\-length} & length of the vector (bytes or elements?) Register vector constructors and destructors for thread private data. \\
\hline
\end{DoxyParams}


Definition at line 699 of file kmp\-\_\-threadprivate.\-c.


\begin{DoxyCode}
702 \{
703     \textcolor{keyword}{struct }\hyperlink{structshared__common}{shared\_common} *d\_tn, **lnk\_tn;
704 
705     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_threadprivate\_register\_vec: called\(\backslash\)n"} ) );
706 
707 \textcolor{preprocessor}{#ifdef USE\_CHECKS\_COMMON}
708 \textcolor{preprocessor}{}    \textcolor{comment}{/* copy constructor must be zero for current code gen (Nov 2002 - jph) */}
709     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{structshared__common_a66f5f4ebb70f7db1a21310d31a387377}{cctor} == 0);
710 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_CHECKS\_COMMON */}\textcolor{preprocessor}{}
711 \textcolor{preprocessor}{}
712     d\_tn = \hyperlink{kmp__threadprivate_8c_a89f3380531af4850006d1b7a6d381df3}{\_\_kmp\_find\_shared\_task\_common}( &
      \hyperlink{kmp__threadprivate_8c_ac5d665dbab9923a586d0069f809fb1b0}{\_\_kmp\_threadprivate\_d\_table},
713                                           -1, \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data} );        \textcolor{comment}{/* Only the global data table exists. */}
714 
715     \textcolor{keywordflow}{if} (d\_tn == 0) \{
716         d\_tn = (\textcolor{keyword}{struct }\hyperlink{structshared__common}{shared\_common} *) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}( \textcolor{keyword}{struct} 
      \hyperlink{structshared__common}{shared\_common} ) );
717         d\_tn->\hyperlink{structshared__common_abfaf275dda5ac5223f6e0f0aa333b52b}{gbl\_addr} = \hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data};
718 
719         d\_tn->\hyperlink{structshared__common_ac98f8d219b58bb8cb289d896c2328e21}{ct}.\hyperlink{structshared__common_aa82b661dba8988acd64a0d185851efce}{ctorv} = \hyperlink{structshared__common_a26bff742774584fe18d5bca4b432b1ed}{ctor};
720         d\_tn->\hyperlink{structshared__common_a3292a73e5a3070dfdb448f7b205f68a5}{cct}.\hyperlink{structshared__common_a149cfcc7e7cadd6231c21339d9adabea}{cctorv} = \hyperlink{structshared__common_a66f5f4ebb70f7db1a21310d31a387377}{cctor};
721         d\_tn->\hyperlink{structshared__common_ae1c3740671335275599c29df1f6d71d1}{dt}.\hyperlink{structshared__common_a010d4cfee51a4eef6f53edb1dd7be918}{dtorv} = \hyperlink{structshared__common_a127171cc49794904b593bee96f1b7d04}{dtor};
722         d\_tn->\hyperlink{structshared__common_affe99e67b32f42b3bae07c95c59d8f24}{is\_vec} = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
723         d\_tn->\hyperlink{structshared__common_ae2761da4a704f4f2f377854538ba153c}{vec\_len} = (size\_t) vector\_length;
724 \textcolor{comment}{/*}
725 \textcolor{comment}{        d\_tn->obj\_init = 0;  // AC: commented out because \_\_kmp\_allocate zeroes the memory}
726 \textcolor{comment}{        d\_tn->pod\_init = 0;}
727 \textcolor{comment}{*/}
728         lnk\_tn = &(\hyperlink{kmp__threadprivate_8c_ac5d665dbab9923a586d0069f809fb1b0}{\_\_kmp\_threadprivate\_d\_table}.\hyperlink{structshared__table_acbe02cd3db1cddd2f658db7e64c2bfc5}{data}[ 
      \hyperlink{kmp_8h_a81fe0625f28faf8ec00b8cf7820e103b}{KMP\_HASH}(\hyperlink{ittnotify__static_8h_ae4b7aa9cddc8e1ade7c67ed7e338b18f}{data}) ]);
729 
730         d\_tn->\hyperlink{structshared__common_aa54da923f39ba340f472b4a62205b967}{next} = *lnk\_tn;
731         *lnk\_tn = d\_tn;
732     \}
733 \}
\end{DoxyCode}
