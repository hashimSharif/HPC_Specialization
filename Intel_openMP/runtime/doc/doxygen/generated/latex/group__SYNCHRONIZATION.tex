\hypertarget{group__SYNCHRONIZATION}{\section{Synchronization}
\label{group__SYNCHRONIZATION}\index{Synchronization@{Synchronization}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__SYNCHRONIZATION_ga90f0e4bf417a06cff2a4f895daa4ff37}{\-\_\-\-\_\-kmpc\-\_\-flush} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__SYNCHRONIZATION_ga84b2ebeef737395dddd8ef446c071760}{\-\_\-\-\_\-kmpc\-\_\-barrier} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
kmp\-\_\-int32 \hyperlink{group__SYNCHRONIZATION_gacea2959cabb92c4a941087e524c5f3d5}{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__SYNCHRONIZATION_ga35415691dad1e3430caa78c9d4b34cb3}{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
kmp\-\_\-int32 \hyperlink{group__SYNCHRONIZATION_ga5a51fa2c8f61d807895e377d6c732b16}{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
kmp\-\_\-int32 \hyperlink{group__SYNCHRONIZATION_gafc5438d4c4f01dcd347d9bfde27f68e1}{\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, kmp\-\_\-int32 num\-\_\-vars, size\-\_\-t reduce\-\_\-size, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$reduce\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$reduce\-\_\-func)(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$lhs\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$rhs\-\_\-data), \hyperlink{kmp_8h_ac3fc9c92929f696709b178ffe0854839}{kmp\-\_\-critical\-\_\-name} $\ast$lck)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__SYNCHRONIZATION_ga5c40184c6babbe35c50d43a47573c5c5}{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, \hyperlink{kmp_8h_ac3fc9c92929f696709b178ffe0854839}{kmp\-\_\-critical\-\_\-name} $\ast$lck)
\item 
kmp\-\_\-int32 \hyperlink{group__SYNCHRONIZATION_ga6a08af1c559012315e7e5be69f7fe608}{\-\_\-\-\_\-kmpc\-\_\-reduce} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, kmp\-\_\-int32 num\-\_\-vars, size\-\_\-t reduce\-\_\-size, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$reduce\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$reduce\-\_\-func)(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$lhs\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$rhs\-\_\-data), \hyperlink{kmp_8h_ac3fc9c92929f696709b178ffe0854839}{kmp\-\_\-critical\-\_\-name} $\ast$lck)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__SYNCHRONIZATION_ga2ead7ca8fe9886581c216ca8006ae3c9}{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, \hyperlink{kmp_8h_ac3fc9c92929f696709b178ffe0854839}{kmp\-\_\-critical\-\_\-name} $\ast$lck)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
These functions are used for implementing barriers. 

\subsection{Function Documentation}
\hypertarget{group__SYNCHRONIZATION_ga84b2ebeef737395dddd8ef446c071760}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-barrier@{\-\_\-\-\_\-kmpc\-\_\-barrier}}
\index{\-\_\-\-\_\-kmpc\-\_\-barrier@{\-\_\-\-\_\-kmpc\-\_\-barrier}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-barrier}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-barrier (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga84b2ebeef737395dddd8ef446c071760}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & thread id.\\
\hline
\end{DoxyParams}
Execute a barrier. 

Definition at line 697 of file kmp\-\_\-csupport.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-cancel\-\_\-barrier(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-B\-A\-R\-R\-I\-E\-R().


\begin{DoxyCode}
698 \{
699     \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(OMP\_BARRIER);
700     \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_barrier);
701     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_barrier: called T#%d\(\backslash\)n"}, global\_tid ) );
702 
703     \textcolor{keywordflow}{if} (! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}))
704         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
705 
706     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
707         \textcolor{keywordflow}{if} ( loc == 0 ) \{
708             \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ConstructIdentInvalid ); \textcolor{comment}{// ??? What does it mean for the user?}
709         \}; \textcolor{comment}{// if}
710 
711         \hyperlink{kmp__error_8c_abb3f10ea6dadb00a31da4ee423370b51}{\_\_kmp\_check\_barrier}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315ad94538ba658a409b239d438839b0652d}{ct\_barrier}, loc );
712     \}
713 
714     \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ global\_tid ]->th.th\_ident = loc;
715     \textcolor{comment}{// TODO: explicit barrier\_wait\_id:}
716     \textcolor{comment}{//   this function is called when 'barrier' directive is present or}
717     \textcolor{comment}{//   implicit barrier at the end of a worksharing construct.}
718     \textcolor{comment}{// 1) better to add a per-thread barrier counter to a thread data structure}
719     \textcolor{comment}{// 2) set to 0 when a new team is created}
720     \textcolor{comment}{// 4) no sync is required}
721 
722     \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, 0, NULL, NULL );
723 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_gacea2959cabb92c4a941087e524c5f3d5}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master@{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master}}
\index{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master@{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master}]{\setlength{\rightskip}{0pt plus 5cm}kmp\-\_\-int32 \-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_gacea2959cabb92c4a941087e524c5f3d5}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & thread id. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
one if the thread should execute the master block, zero otherwise
\end{DoxyReturn}
Start execution of a combined barrier and master. The barrier is executed inside this function. 

Definition at line 1377 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
1378 \{
1379     \textcolor{keywordtype}{int} \hyperlink{kmp__i18n_8c_a43c2a109a79fef7e46a0836cdac679ff}{status};
1380 
1381     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_barrier\_master: called T#%d\(\backslash\)n"}, global\_tid ) );
1382 
1383     \textcolor{keywordflow}{if} (! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}))
1384         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
1385 
1386     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
1387         \hyperlink{kmp__error_8c_abb3f10ea6dadb00a31da4ee423370b51}{\_\_kmp\_check\_barrier}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315ad94538ba658a409b239d438839b0652d}{ct\_barrier}, loc );
1388 
1389 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
1390 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
1391 \textcolor{preprocessor}{#endif}
1392 \textcolor{preprocessor}{}    status = \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, 0, NULL, NULL );
1393 
1394     \textcolor{keywordflow}{return} (status != 0) ? 0 : 1;
1395 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga5a51fa2c8f61d807895e377d6c732b16}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait}}
\index{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait}]{\setlength{\rightskip}{0pt plus 5cm}kmp\-\_\-int32 \-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga5a51fa2c8f61d807895e377d6c732b16}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & thread id. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
one if the thread should execute the master block, zero otherwise
\end{DoxyReturn}
Start execution of a combined barrier and master(nowait) construct. The barrier is executed inside this function. There is no equivalent \char`\"{}end\char`\"{} function, since the 

Definition at line 1425 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
1426 \{
1427     kmp\_int32 ret;
1428 
1429     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_barrier\_master\_nowait: called T#%d\(\backslash\)n"}, global\_tid ));
1430 
1431     \textcolor{keywordflow}{if} (! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}))
1432         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
1433 
1434     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
1435         \textcolor{keywordflow}{if} ( loc == 0 ) \{
1436             \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ConstructIdentInvalid ); \textcolor{comment}{// ??? What does it mean for the user?}
1437         \}
1438         \hyperlink{kmp__error_8c_abb3f10ea6dadb00a31da4ee423370b51}{\_\_kmp\_check\_barrier}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315ad94538ba658a409b239d438839b0652d}{ct\_barrier}, loc );
1439     \}
1440 
1441 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
1442 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
1443 \textcolor{preprocessor}{#endif}
1444 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, 0, NULL, NULL );
1445 
1446     ret = \hyperlink{group__WORK__SHARING_ga721f06c8017479ccc6cb46ae0552b597}{\_\_kmpc\_master} (loc, global\_tid);
1447 
1448     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
1449         \textcolor{comment}{/*  there's no \_\_kmpc\_end\_master called; so the (stats) */}
1450         \textcolor{comment}{/*  actions of \_\_kmpc\_end\_master are done here          */}
1451 
1452         \textcolor{keywordflow}{if} ( global\_tid < 0 ) \{
1453             \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ThreadIdentInvalid );
1454         \}
1455         \textcolor{keywordflow}{if} (ret) \{
1456             \textcolor{comment}{/* only one thread should do the pop since only */}
1457             \textcolor{comment}{/* one did the push (see \_\_kmpc\_master())       */}
1458 
1459             \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315abbe9a0bdd5b77c93738f62c52bae513f}{ct\_master}, loc );
1460         \}
1461     \}
1462 
1463     \textcolor{keywordflow}{return} (ret);
1464 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga35415691dad1e3430caa78c9d4b34cb3}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master}}
\index{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-end\-\_\-barrier\-\_\-master (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga35415691dad1e3430caa78c9d4b34cb3}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & thread id.\\
\hline
\end{DoxyParams}
Complete the execution of a combined barrier and master. This function should only be called at the completion of the {\ttfamily master} code. Other threads will still be waiting at the barrier and this call releases them. 

Definition at line 1407 of file kmp\-\_\-csupport.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-enqueue\-\_\-task().


\begin{DoxyCode}
1408 \{
1409     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_end\_barrier\_master: called T#%d\(\backslash\)n"}, global\_tid ));
1410 
1411     \hyperlink{kmp_8h_a792560d2e886584b5e616ee68d1c5f8a}{\_\_kmp\_end\_split\_barrier} ( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid );
1412 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga2ead7ca8fe9886581c216ca8006ae3c9}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce}}
\index{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{{\bf kmp\-\_\-critical\-\_\-name} $\ast$}]{lck}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga2ead7ca8fe9886581c216ca8006ae3c9}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread id. \\
\hline
{\em lck} & pointer to the unique lock data structure\\
\hline
\end{DoxyParams}
Finish the execution of a blocking reduce. The {\ttfamily lck} pointer must be the same as that used in the corresponding start function. 

Definition at line 2947 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
2947                                                                                 \{
2948 
2949     \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} packed\_reduction\_method;
2950 
2951     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_reduce() enter: called T#%d\(\backslash\)n"}, global\_tid ) );
2952 
2953     packed\_reduction\_method = \hyperlink{kmp__csupport_8c_a1f238c550ed76a4c6ce263adba8c3524}{\_\_KMP\_GET\_REDUCTION\_METHOD}( global\_tid );
2954 
2955     \textcolor{comment}{// this barrier should be visible to a customer and to the threading profile tool}
2956     \textcolor{comment}{//              (it's a terminating barrier on constructs if NOWAIT not specified)}
2957 
2958     \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block} ) \{
2959 
2960         \hyperlink{kmp__csupport_8c_a601983b17f27442206a77b8781579708}{\_\_kmp\_end\_critical\_section\_reduce\_block}( loc, global\_tid, 
      lck );
2961 
2962         \textcolor{comment}{// TODO: implicit barrier: should be exposed}
2963 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2964 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
2965 \textcolor{preprocessor}{#endif}
2966 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, 0, NULL, NULL );
2967 
2968     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a28cf3671c5c01e773c7040204b6e8bb5}{empty\_reduce\_block} ) \{
2969 
2970         \textcolor{comment}{// usage: if team size == 1, no synchronization is required ( Intel platforms only )}
2971 
2972         \textcolor{comment}{// TODO: implicit barrier: should be exposed}
2973 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2974 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
2975 \textcolor{preprocessor}{#endif}
2976 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, 0, NULL, NULL );
2977 
2978     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block} ) \{
2979 
2980         \textcolor{comment}{// TODO: implicit barrier: should be exposed}
2981 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2982 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
2983 \textcolor{preprocessor}{#endif}
2984 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}, global\_tid, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, 0, NULL, NULL );
2985 
2986     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8e31af7b50c35efd630502d8cbe89cd3}{TEST\_REDUCTION\_METHOD}( packed\_reduction\_method, 
      \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a7e21547b06d81d12a9b3293f3059b973}{tree\_reduce\_block} ) ) \{
2987 
2988         \textcolor{comment}{// only master executes here (master releases all other workers)}
2989         \hyperlink{kmp_8h_a792560d2e886584b5e616ee68d1c5f8a}{\_\_kmp\_end\_split\_barrier}( \hyperlink{kmp_8h_a1ccb73b52bdd6146311ed40707c69b9a}{UNPACK\_REDUCTION\_BARRIER}( 
      packed\_reduction\_method ), global\_tid );
2990 
2991     \} \textcolor{keywordflow}{else} \{
2992 
2993         \textcolor{comment}{// should never reach this block}
2994         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 ); \textcolor{comment}{// "unexpected method"}
2995 
2996     \}
2997 
2998     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2999         \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc );
3000 
3001     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_reduce() exit: called T#%d: method %08x\(\backslash\)n"}, global\_tid, 
      packed\_reduction\_method ) );
3002 
3003     \textcolor{keywordflow}{return};
3004 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga5c40184c6babbe35c50d43a47573c5c5}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait}}
\index{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-end\-\_\-reduce\-\_\-nowait (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{{\bf kmp\-\_\-critical\-\_\-name} $\ast$}]{lck}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga5c40184c6babbe35c50d43a47573c5c5}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread id. \\
\hline
{\em lck} & pointer to the unique lock data structure\\
\hline
\end{DoxyParams}
Finish the execution of a reduce nowait. 

Definition at line 2802 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
2802                                                                                        \{
2803 
2804     \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} packed\_reduction\_method;
2805 
2806     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_reduce\_nowait() enter: called T#%d\(\backslash\)n"}, global\_tid ) );
2807 
2808     packed\_reduction\_method = \hyperlink{kmp__csupport_8c_a1f238c550ed76a4c6ce263adba8c3524}{\_\_KMP\_GET\_REDUCTION\_METHOD}( global\_tid );
2809 
2810     \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block} ) \{
2811 
2812         \hyperlink{kmp__csupport_8c_a601983b17f27442206a77b8781579708}{\_\_kmp\_end\_critical\_section\_reduce\_block}( loc, global\_tid, 
      lck );
2813 
2814     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a28cf3671c5c01e773c7040204b6e8bb5}{empty\_reduce\_block} ) \{
2815 
2816         \textcolor{comment}{// usage: if team size == 1, no synchronization is required ( on Intel platforms only )}
2817 
2818     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block} ) \{
2819 
2820         \textcolor{comment}{// neither master nor other workers should get here}
2821         \textcolor{comment}{//     (code gen does not generate this call in case 2: atomic reduce block)}
2822         \textcolor{comment}{// actually it's better to remove this elseif at all;}
2823         \textcolor{comment}{// after removal this value will checked by the 'else' and will assert}
2824 
2825     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8e31af7b50c35efd630502d8cbe89cd3}{TEST\_REDUCTION\_METHOD}( packed\_reduction\_method, 
      \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a7e21547b06d81d12a9b3293f3059b973}{tree\_reduce\_block} ) ) \{
2826 
2827         \textcolor{comment}{// only master gets here}
2828 
2829     \} \textcolor{keywordflow}{else} \{
2830 
2831         \textcolor{comment}{// should never reach this block}
2832         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 ); \textcolor{comment}{// "unexpected method"}
2833 
2834     \}
2835 
2836     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2837         \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc );
2838 
2839     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_reduce\_nowait() exit: called T#%d: method %08x\(\backslash\)n"}, global\_tid, 
      packed\_reduction\_method ) );
2840 
2841     \textcolor{keywordflow}{return};
2842 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga90f0e4bf417a06cff2a4f895daa4ff37}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-flush@{\-\_\-\-\_\-kmpc\-\_\-flush}}
\index{\-\_\-\-\_\-kmpc\-\_\-flush@{\-\_\-\-\_\-kmpc\-\_\-flush}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-flush}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-flush (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga90f0e4bf417a06cff2a4f895daa4ff37}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information.\\
\hline
\end{DoxyParams}
Execute {\ttfamily flush}. This is implemented as a full memory fence. (Though depending on the memory ordering convention obeyed by the compiler even that may not be necessary). 

Definition at line 631 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
632 \{
633     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_flush: called\(\backslash\)n"} ) );
634 
635     \textcolor{comment}{/* need explicit \_\_mf() here since use volatile instead in library */}
636     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
637 
638 \textcolor{preprocessor}{    #if ( KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 )}
639 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #if KMP\_MIC}
640 \textcolor{preprocessor}{}            \textcolor{comment}{// fence-style instructions do not exist, but lock; xaddl $0,(%rsp) can be used.}
641             \textcolor{comment}{// We shouldn't need it, though, since the ABI rules require that}
642             \textcolor{comment}{// * If the compiler generates NGO stores it also generates the fence}
643             \textcolor{comment}{// * If users hand-code NGO stores they should insert the fence}
644             \textcolor{comment}{// therefore no incomplete unordered stores should be visible.}
645 \textcolor{preprocessor}{        #else}
646 \textcolor{preprocessor}{}            \textcolor{comment}{// C74404}
647             \textcolor{comment}{// This is to address non-temporal store instructions (sfence needed).}
648             \textcolor{comment}{// The clflush instruction is addressed either (mfence needed).}
649             \textcolor{comment}{// Probably the non-temporal load monvtdqa instruction should also be addressed.}
650             \textcolor{comment}{// mfence is a SSE2 instruction. Do not execute it if CPU is not SSE2.}
651             \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_a9f43d4488c8be0593700cc5b778726b9}{\_\_kmp\_cpuinfo}.\hyperlink{structkmp__cpuinfo_a340553795a3c12f5f72d3333027dc1ef}{initialized} ) \{
652                 \_\_kmp\_query\_cpuid( & \hyperlink{kmp_8h_a9f43d4488c8be0593700cc5b778726b9}{\_\_kmp\_cpuinfo} );
653             \}; \textcolor{comment}{// if}
654             \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_a9f43d4488c8be0593700cc5b778726b9}{\_\_kmp\_cpuinfo}.\hyperlink{structkmp__cpuinfo_a06952924c8236563056c13d3158c70dc}{sse2} ) \{
655                 \textcolor{comment}{// CPU cannot execute SSE2 instructions.}
656             \} \textcolor{keywordflow}{else} \{
657 \textcolor{preprocessor}{                #if KMP\_COMPILER\_ICC || KMP\_COMPILER\_MSVC}
658 \textcolor{preprocessor}{}                \_mm\_mfence();
659 \textcolor{preprocessor}{                #else}
660 \textcolor{preprocessor}{}                \_\_sync\_synchronize();
661 \textcolor{preprocessor}{                #endif // KMP\_COMPILER\_ICC}
662 \textcolor{preprocessor}{}            \}; \textcolor{comment}{// if}
663 \textcolor{preprocessor}{        #endif // KMP\_MIC}
664 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #elif (KMP\_ARCH\_ARM || KMP\_ARCH\_AARCH64)}
665 \textcolor{preprocessor}{}        \textcolor{comment}{// Nothing to see here move along}
666 \textcolor{preprocessor}{    #elif KMP\_ARCH\_PPC64}
667 \textcolor{preprocessor}{}        \textcolor{comment}{// Nothing needed here (we have a real MB above).}
668 \textcolor{preprocessor}{        #if KMP\_OS\_CNK}
669 \textcolor{preprocessor}{}        \textcolor{comment}{// The flushing thread needs to yield here; this prevents a}
670        \textcolor{comment}{// busy-waiting thread from saturating the pipeline. flush is}
671           \textcolor{comment}{// often used in loops like this:}
672            \textcolor{comment}{// while (!flag) \{}
673            \textcolor{comment}{//   #pragma omp flush(flag)}
674            \textcolor{comment}{// \}}
675        \textcolor{comment}{// and adding the yield here is good for at least a 10x speedup}
676           \textcolor{comment}{// when running >2 threads per core (on the NAS LU benchmark).}
677             \hyperlink{kmp_8h_a699f282bc4bbcf04222893192f568e91}{\_\_kmp\_yield}(\hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
678 \textcolor{preprocessor}{        #endif}
679 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #else}
680 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #error Unknown or unsupported architecture}
681 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif}
682 \textcolor{preprocessor}{}
683 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_ga6a08af1c559012315e7e5be69f7fe608}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-reduce@{\-\_\-\-\_\-kmpc\-\_\-reduce}}
\index{\-\_\-\-\_\-kmpc\-\_\-reduce@{\-\_\-\-\_\-kmpc\-\_\-reduce}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-reduce}]{\setlength{\rightskip}{0pt plus 5cm}kmp\-\_\-int32 \-\_\-\-\_\-kmpc\-\_\-reduce (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{kmp\-\_\-int32}]{num\-\_\-vars, }
\item[{size\-\_\-t}]{reduce\-\_\-size, }
\item[{{\bf void} $\ast$}]{reduce\-\_\-data, }
\item[{{\bf void}($\ast$)({\bf void} $\ast$lhs\-\_\-data, {\bf void} $\ast$rhs\-\_\-data)}]{reduce\-\_\-func, }
\item[{{\bf kmp\-\_\-critical\-\_\-name} $\ast$}]{lck}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_ga6a08af1c559012315e7e5be69f7fe608}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number \\
\hline
{\em num\-\_\-vars} & number of items (variables) to be reduced \\
\hline
{\em reduce\-\_\-size} & size of data in bytes to be reduced \\
\hline
{\em reduce\-\_\-data} & pointer to data to be reduced \\
\hline
{\em reduce\-\_\-func} & callback function providing reduction operation on two operands and returning result of reduction in lhs\-\_\-data \\
\hline
{\em lck} & pointer to the unique lock data structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 for the master thread, 0 for all other team threads, 2 for all team threads if atomic reduction needed
\end{DoxyReturn}
A blocking reduce that includes an implicit barrier. 

Definition at line 2860 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
2865 \{
2866     \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(REDUCE\_wait);
2867     \textcolor{keywordtype}{int} retval = 0;
2868     \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} packed\_reduction\_method;
2869 
2870     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_reduce() enter: called T#%d\(\backslash\)n"}, global\_tid ) );
2871 
2872     \textcolor{comment}{// why do we need this initialization here at all?}
2873     \textcolor{comment}{// Reduction clause can not be a stand-alone directive.}
2874 
2875     \textcolor{comment}{// do not call \_\_kmp\_serial\_initialize(), it will be called by \_\_kmp\_parallel\_initialize() if needed}
2876     \textcolor{comment}{// possible detection of false-positive race by the threadchecker ???}
2877     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel} ) )
2878         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
2879 
2880     \textcolor{comment}{// check correctness of reduce block nesting}
2881 \textcolor{preprocessor}{#if KMP\_USE\_DYNAMIC\_LOCK}
2882 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2883         \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc, NULL, 0 );
2884 \textcolor{preprocessor}{#else}
2885 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2886         \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc, NULL );
2887 \textcolor{preprocessor}{#endif}
2888 \textcolor{preprocessor}{}
2889     packed\_reduction\_method = \hyperlink{kmp_8h_a7735d7d58a02a05dbfebda565f97c80c}{\_\_kmp\_determine\_reduction\_method}( loc, 
      global\_tid, num\_vars, reduce\_size, reduce\_data, reduce\_func, lck );
2890     \hyperlink{kmp__csupport_8c_a7a13f1fc7eb548d763de215bd7cdcf51}{\_\_KMP\_SET\_REDUCTION\_METHOD}( global\_tid, packed\_reduction\_method );
2891 
2892     \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block} ) \{
2893 
2894         \hyperlink{kmp__csupport_8c_ad97140748ff9336db068d58f950a4850}{\_\_kmp\_enter\_critical\_section\_reduce\_block}( loc, global\_tid
      , lck );
2895         retval = 1;
2896 
2897     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a28cf3671c5c01e773c7040204b6e8bb5}{empty\_reduce\_block} ) \{
2898 
2899         \textcolor{comment}{// usage: if team size == 1, no synchronization is required ( Intel platforms only )}
2900         retval = 1;
2901 
2902     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block} ) \{
2903 
2904         retval = 2;
2905 
2906     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8e31af7b50c35efd630502d8cbe89cd3}{TEST\_REDUCTION\_METHOD}( packed\_reduction\_method, 
      \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a7e21547b06d81d12a9b3293f3059b973}{tree\_reduce\_block} ) ) \{
2907 
2908         \textcolor{comment}{//case tree\_reduce\_block:}
2909         \textcolor{comment}{// this barrier should be visible to a customer and to the threading profile tool}
2910         \textcolor{comment}{//              (it's a terminating barrier on constructs if NOWAIT not specified)}
2911 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2912 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc; \textcolor{comment}{// needed for correct notification of
       frames}
2913 \textcolor{preprocessor}{#endif}
2914 \textcolor{preprocessor}{}        retval = \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_a1ccb73b52bdd6146311ed40707c69b9a}{UNPACK\_REDUCTION\_BARRIER}( 
      packed\_reduction\_method ), global\_tid, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, reduce\_size, reduce\_data, reduce\_func );
2915         retval = ( retval != 0 ) ? ( 0 ) : ( 1 );
2916 
2917         \textcolor{comment}{// all other workers except master should do this pop here}
2918         \textcolor{comment}{//     ( none of other workers except master will enter \_\_kmpc\_end\_reduce() )}
2919         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
2920             \textcolor{keywordflow}{if}( retval == 0 ) \{ \textcolor{comment}{// 0: all other workers; 1: master}
2921                 \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc );
2922             \}
2923         \}
2924 
2925     \} \textcolor{keywordflow}{else} \{
2926 
2927         \textcolor{comment}{// should never reach this block}
2928         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 ); \textcolor{comment}{// "unexpected method"}
2929 
2930     \}
2931 
2932     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_reduce() exit: called T#%d: method %08x, returns %08x\(\backslash\)n"}, global\_tid, 
      packed\_reduction\_method, retval ) );
2933 
2934     \textcolor{keywordflow}{return} retval;
2935 \}
\end{DoxyCode}
\hypertarget{group__SYNCHRONIZATION_gafc5438d4c4f01dcd347d9bfde27f68e1}{\index{Synchronization@{Synchronization}!\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait}}
\index{\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait@{\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait}!Synchronization@{Synchronization}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait}]{\setlength{\rightskip}{0pt plus 5cm}kmp\-\_\-int32 \-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{kmp\-\_\-int32}]{num\-\_\-vars, }
\item[{size\-\_\-t}]{reduce\-\_\-size, }
\item[{{\bf void} $\ast$}]{reduce\-\_\-data, }
\item[{{\bf void}($\ast$)({\bf void} $\ast$lhs\-\_\-data, {\bf void} $\ast$rhs\-\_\-data)}]{reduce\-\_\-func, }
\item[{{\bf kmp\-\_\-critical\-\_\-name} $\ast$}]{lck}
\end{DoxyParamCaption}
)}}\label{group__SYNCHRONIZATION_gafc5438d4c4f01dcd347d9bfde27f68e1}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number \\
\hline
{\em num\-\_\-vars} & number of items (variables) to be reduced \\
\hline
{\em reduce\-\_\-size} & size of data in bytes to be reduced \\
\hline
{\em reduce\-\_\-data} & pointer to data to be reduced \\
\hline
{\em reduce\-\_\-func} & callback function providing reduction operation on two operands and returning result of reduction in lhs\-\_\-data \\
\hline
{\em lck} & pointer to the unique lock data structure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 for the master thread, 0 for all other team threads, 2 for all team threads if atomic reduction needed
\end{DoxyReturn}
The nowait version is used for a reduce clause with the nowait argument. 

Definition at line 2663 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
2666                              \{
2667 
2668     \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(REDUCE\_nowait);
2669     \textcolor{keywordtype}{int} retval = 0;
2670     \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} packed\_reduction\_method;
2671 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2672 \textcolor{preprocessor}{}    \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
2673     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *th;
2674     \textcolor{keywordtype}{int} teams\_swapped = 0, task\_state;
2675 \textcolor{preprocessor}{#endif}
2676 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_reduce\_nowait() enter: called T#%d\(\backslash\)n"}, global\_tid ) );
2677 
2678     \textcolor{comment}{// why do we need this initialization here at all?}
2679     \textcolor{comment}{// Reduction clause can not be used as a stand-alone directive.}
2680 
2681     \textcolor{comment}{// do not call \_\_kmp\_serial\_initialize(), it will be called by \_\_kmp\_parallel\_initialize() if needed}
2682     \textcolor{comment}{// possible detection of false-positive race by the threadchecker ???}
2683     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel} ) )
2684         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
2685 
2686     \textcolor{comment}{// check correctness of reduce block nesting}
2687 \textcolor{preprocessor}{#if KMP\_USE\_DYNAMIC\_LOCK}
2688 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2689         \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc, NULL, 0 );
2690 \textcolor{preprocessor}{#else}
2691 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2692         \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc, NULL );
2693 \textcolor{preprocessor}{#endif}
2694 \textcolor{preprocessor}{}
2695 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2696 \textcolor{preprocessor}{}    th = \hyperlink{kmp_8h_a1626e286e4eb82742a397442009721e6}{\_\_kmp\_thread\_from\_gtid}(global\_tid);
2697     \textcolor{keywordflow}{if}( th->th.th\_teams\_microtask ) \{   \textcolor{comment}{// AC: check if we are inside the teams construct?}
2698         team = th->th.th\_team;
2699         \textcolor{keywordflow}{if}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level == th->th.th\_teams\_level ) \{
2700             \textcolor{comment}{// this is reduction at teams construct}
2701             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(!th->th.th\_info.ds.ds\_tid);  \textcolor{comment}{// AC: check that tid == 0}
2702             \textcolor{comment}{// Let's swap teams temporarily for the reduction barrier}
2703             teams\_swapped = 1;
2704             th->th.th\_info.ds.ds\_tid = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid;
2705             th->th.th\_team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2706             th->th.th\_team\_nproc = th->th.th\_team->t.t\_nproc;
2707             th->th.th\_task\_team = th->th.th\_team->t.t\_task\_team[0];
2708             task\_state = th->th.th\_task\_state;
2709             th->th.th\_task\_state = 0;
2710         \}
2711     \}
2712 \textcolor{preprocessor}{#endif // OMP\_40\_ENABLED}
2713 \textcolor{preprocessor}{}
2714     \textcolor{comment}{// packed\_reduction\_method value will be reused by \_\_kmp\_end\_reduce* function, the value should be kept
       in a variable}
2715     \textcolor{comment}{// the variable should be either a construct-specific or thread-specific property, not a team specific
       property}
2716     \textcolor{comment}{//     (a thread can reach the next reduce block on the next construct, reduce method may differ on the
       next construct)}
2717     \textcolor{comment}{// an ident\_t "loc" parameter could be used as a construct-specific property (what if loc == 0?)}
2718     \textcolor{comment}{//     (if both construct-specific and team-specific variables were shared, then unness extra syncs
       should be needed)}
2719     \textcolor{comment}{// a thread-specific variable is better regarding two issues above (next construct and extra syncs)}
2720     \textcolor{comment}{// a thread-specific "th\_local.reduction\_method" variable is used currently}
2721     \textcolor{comment}{// each thread executes 'determine' and 'set' lines (no need to execute by one thread, to avoid unness
       extra syncs)}
2722 
2723     packed\_reduction\_method = \hyperlink{kmp_8h_a7735d7d58a02a05dbfebda565f97c80c}{\_\_kmp\_determine\_reduction\_method}( loc, 
      global\_tid, num\_vars, reduce\_size, reduce\_data, reduce\_func, lck );
2724     \hyperlink{kmp__csupport_8c_a7a13f1fc7eb548d763de215bd7cdcf51}{\_\_KMP\_SET\_REDUCTION\_METHOD}( global\_tid, packed\_reduction\_method );
2725 
2726     \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block} ) \{
2727 
2728         \hyperlink{kmp__csupport_8c_ad97140748ff9336db068d58f950a4850}{\_\_kmp\_enter\_critical\_section\_reduce\_block}( loc, global\_tid
      , lck );
2729         retval = 1;
2730 
2731     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a28cf3671c5c01e773c7040204b6e8bb5}{empty\_reduce\_block} ) \{
2732 
2733         \textcolor{comment}{// usage: if team size == 1, no synchronization is required ( Intel platforms only )}
2734         retval = 1;
2735 
2736     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( packed\_reduction\_method == \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block} ) \{
2737 
2738         retval = 2;
2739 
2740         \textcolor{comment}{// all threads should do this pop here (because \_\_kmpc\_end\_reduce\_nowait() won't be called by the
       code gen)}
2741         \textcolor{comment}{//     (it's not quite good, because the checking block has been closed by this 'pop',}
2742         \textcolor{comment}{//      but atomic operation has not been executed yet, will be executed slightly later, literally
       on next instruction)}
2743         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
2744             \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc );
2745 
2746     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8e31af7b50c35efd630502d8cbe89cd3}{TEST\_REDUCTION\_METHOD}( packed\_reduction\_method, 
      \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a7e21547b06d81d12a9b3293f3059b973}{tree\_reduce\_block} ) ) \{
2747 
2748         \textcolor{comment}{//AT: performance issue: a real barrier here}
2749         \textcolor{comment}{//AT:     (if master goes slow, other threads are blocked here waiting for the master to come and
       release them)}
2750         \textcolor{comment}{//AT:     (it's not what a customer might expect specifying NOWAIT clause)}
2751         \textcolor{comment}{//AT:     (specifying NOWAIT won't result in improvement of performance, it'll be confusing to a
       customer)}
2752         \textcolor{comment}{//AT: another implementation of *barrier\_gather*nowait() (or some other design) might go faster}
2753         \textcolor{comment}{//        and be more in line with sense of NOWAIT}
2754         \textcolor{comment}{//AT: TO DO: do epcc test and compare times}
2755 
2756         \textcolor{comment}{// this barrier should be invisible to a customer and to the threading profile tool}
2757         \textcolor{comment}{//              (it's neither a terminating barrier nor customer's code, it's used for an internal
       purpose)}
2758 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2759 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[global\_tid]->th.th\_ident = loc;
2760 \textcolor{preprocessor}{#endif}
2761 \textcolor{preprocessor}{}        retval = \hyperlink{kmp_8h_a2db240b744f3af1eb8413df50dbe6118}{\_\_kmp\_barrier}( \hyperlink{kmp_8h_a1ccb73b52bdd6146311ed40707c69b9a}{UNPACK\_REDUCTION\_BARRIER}( 
      packed\_reduction\_method ), global\_tid, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, reduce\_size, reduce\_data, reduce\_func );
2762         retval = ( retval != 0 ) ? ( 0 ) : ( 1 );
2763 
2764         \textcolor{comment}{// all other workers except master should do this pop here}
2765         \textcolor{comment}{//     ( none of other workers will get to \_\_kmpc\_end\_reduce\_nowait() )}
2766         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
2767             \textcolor{keywordflow}{if}( retval == 0 ) \{
2768                 \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( global\_tid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a69ad53348e0bb90d6e3adee6345553ca}{ct\_reduce}, loc );
2769             \}
2770         \}
2771 
2772     \} \textcolor{keywordflow}{else} \{
2773 
2774         \textcolor{comment}{// should never reach this block}
2775         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 ); \textcolor{comment}{// "unexpected method"}
2776 
2777     \}
2778 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2779 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( teams\_swapped ) \{
2780         \textcolor{comment}{// Restore thread structure}
2781         th->th.th\_info.ds.ds\_tid = 0;
2782         th->th.th\_team = team;
2783         th->th.th\_team\_nproc = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
2784         th->th.th\_task\_team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[task\_state];
2785         th->th.th\_task\_state = task\_state;
2786     \}
2787 \textcolor{preprocessor}{#endif}
2788 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_reduce\_nowait() exit: called T#%d: method %08x, returns %08x\(\backslash\)n"}, 
      global\_tid, packed\_reduction\_method, retval ) );
2789 
2790     \textcolor{keywordflow}{return} retval;
2791 \}
\end{DoxyCode}
