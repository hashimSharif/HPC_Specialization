\hypertarget{kmp__runtime_8c}{\section{kmp\-\_\-runtime.\-c File Reference}
\label{kmp__runtime_8c}\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}}
}
{\ttfamily \#include \char`\"{}kmp.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-atomic.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-wrapper\-\_\-getpid.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-environment.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-itt.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-str.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-settings.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-i18n.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-io.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-error.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-stats.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kmp\-\_\-wait\-\_\-release.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{kmp__runtime_8c_a3b1fe06461dee8a9bdf4422a7c14b972}{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L}~0
\item 
\#define \hyperlink{kmp__runtime_8c_a61c4bc9a84ea78dfc34bab9dd89f3e7a}{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C}~0
\item 
\#define \hyperlink{kmp__runtime_8c_a635727f200be45c0c7cdc13c991284bf}{K\-M\-P\-\_\-\-M\-I\-N}(\hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x}, y)~( (\hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x}) $<$ (y) ? (\hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x}) \-: (y) )
\item 
\#define \hyperlink{kmp__runtime_8c_a8cea0c1cc1fc60a52e79998580bbf1a7}{M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E}~512
\item 
\#define \hyperlink{kmp__runtime_8c_a1fe9d72aca3be52b82f7ddba504a6def}{propagate\-F\-P\-Control}(\hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x})~((\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})0)
\item 
\#define \hyperlink{kmp__runtime_8c_a6ae754850170a17b0f3e266e802051ab}{update\-H\-W\-F\-P\-Control}(\hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x})~((\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})0)
\item 
\#define \hyperlink{kmp__runtime_8c_ad647847304011ec4d724df6fa3304009}{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb}~((\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int})1)
\item 
\#define \hyperlink{kmp__runtime_8c_a3e7f640f37c63871b76fd8a9838ab45f}{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb}~((\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int})1)
\item 
\#define \hyperlink{kmp__runtime_8c_a865f8badcfb2a1cc1324e83d73a84fcd}{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat}~\hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aad01aaab58a5ceeebbf8f9d5a170afa33}{bp\-\_\-hyper\-\_\-bar}
\item 
\#define \hyperlink{kmp__runtime_8c_ab7e4cdfdc594b3e230b9fbb1896980e7}{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat}~\hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aad01aaab58a5ceeebbf8f9d5a170afa33}{bp\-\_\-hyper\-\_\-bar}
\item 
\#define \hyperlink{kmp__runtime_8c_a6b1fe521d023b646aa4cd9fd55a2ab6f}{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}~( ( loc-\/$>$flags \& ( \hyperlink{group__BASIC__TYPES_gaf2f9e5d03f9f38651a3b8d5ef8635d44}{K\-M\-P\-\_\-\-I\-D\-E\-N\-T\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-R\-E\-D\-U\-C\-E} ) ) == ( \hyperlink{group__BASIC__TYPES_gaf2f9e5d03f9f38651a3b8d5ef8635d44}{K\-M\-P\-\_\-\-I\-D\-E\-N\-T\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-R\-E\-D\-U\-C\-E} ) )
\item 
\#define \hyperlink{kmp__runtime_8c_a92ac7fe90ec3149f4131e9fb6672d8ef}{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}~( ( reduce\-\_\-data ) \&\& ( reduce\-\_\-func ) )
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_afb0978e7a9bd0e5f91d089c4571e618f}{\-\_\-\-\_\-kmp\-\_\-cleanup} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} tid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} new\-\_\-nproc, \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$new\-\_\-icvs, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}{\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_aea1108b093169cef205a6766bdfa5a40}{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} tid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a5e8f7c63d5e652f73e8998922edf14a4}{\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3cb36a9e9ab38ef825b47442b4f78bc7}{\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} new\-\_\-nproc, \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$new\-\_\-icvs, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc)
\item 
static \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a393e842afa40d6cd0bd01d36e27e40c9}{\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} n\-Wish, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} n\-Need)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a9d810421d1895c17ac6e8774f0f0bd39}{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a8dcaceda5809cef836f90d78710e7bed}{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thread, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} is\-\_\-root)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_ae3cca5d62ca05d4a4e9179aae9ecf949}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id} ()
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_aede2ee8759dd6b89fdfbe674dbf6bb23}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg} ()
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a4b63532f97caf46394cec269eb671900}{\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$th)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}{\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$p1, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$p2, size\-\_\-t \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size}, char const $\ast$format,...)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a051615c6f879f3ce422ba7d55bb60f46}{\-\_\-\-\_\-kmp\-\_\-warn} (char const $\ast$format,...)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ac7e5d659bb9c1aee34debaf40d197e1c}{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process} ()
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3af0772074c6291cf8d346cef0e22c75}{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ab34d7ba2a604c6ca0bf177e8e88148a1}{\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thr, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ae66c7ec463ab127171b5ff69c6709d94}{\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map} (const char $\ast$header, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} team\-\_\-id, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} num\-\_\-thr)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a0b1c80696ad8f5e7f3cf131fd8e9eeed}{\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator} ()
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a08510dec818bea07a313d1c0b0534da5}{\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator} ()
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}{\-\_\-\-\_\-kmp\-\_\-change\-\_\-library} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__i18n_8c_a43c2a109a79fef7e46a0836cdac679ff}{status})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a93417722a11d683f9bab68d1fc0a315b}{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} $\ast$gtid\-\_\-ref, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} $\ast$cid\-\_\-ref, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc\-\_\-ref)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a5364b46d12144725799b06d5c3e5d31a}{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} $\ast$gtid\-\_\-ref, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} $\ast$cid\-\_\-ref, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc\-\_\-ref)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a7c462a6cf8fc9d4a238c3b21234754ea}{\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$id\-\_\-ref, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} push\-\_\-ws)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a4af443dc64419c7436b8d1bb1da2147c}{\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
static \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_adbe354e826a5327d1f0a7cb6cac7c6ba}{\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$parent\-\_\-team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} master\-\_\-tid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} set\-\_\-nthreads, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} enter\-\_\-teams)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ab0c2c80f414c50972ef61b8a0c2edc1e}{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$master\-\_\-th, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} master\-\_\-gtid)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} argc, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} realloc)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ae1639202a88bd6e0f3b55e7150e5450b}{\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a2c67bc63fbc37afe564202b2cdc7d5ba}{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, enum \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0}{fork\-\_\-context\-\_\-e} call\-\_\-context, kmp\-\_\-int32 argc, \hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\-\_\-t} microtask, \hyperlink{kmp_8h_a850b6d220ac7bc7284cfe27996d78e98}{launch\-\_\-t} invoker, va\-\_\-list ap)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a7f7de8f765a397ab1b076555bdee9504}{\-\_\-\-\_\-kmp\-\_\-join\-\_\-call} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} exit\-\_\-teams)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thread)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a7120d169a8fbd79e5140bfa0b2d93a3b}{\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} new\-\_\-nth, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3a7126ad63b8b98e9bc45447f87f716e}{\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} max\-\_\-active\-\_\-levels)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a2ee7c4d1122f1adcfe84e9744d1ed45f}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a06b2a0a58f3c86172b40ee9144b698c8}{\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_a781573148b50d6afafb6f332d9477eef}{kmp\-\_\-sched\-\_\-t} kind, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} chunk)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ac565b833e04ae8d41f17d7b6d97d5b09}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_a781573148b50d6afafb6f332d9477eef}{kmp\-\_\-sched\-\_\-t} $\ast$kind, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} $\ast$chunk)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a82039234188b257e6943ece1824ebbdf}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} level)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a4baac334ea2302a23b0ddfed6bfee3db}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} level)
\item 
\hyperlink{kmp_8h_a71396c1b9a5e1f45d20c0617948ce646}{kmp\-\_\-r\-\_\-sched\-\_\-t} \hyperlink{kmp__runtime_8c_a939a55f9e1a1b31d54915926998f2bae}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global} ()
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a4bd75779a9760d87a4ee0a439f55192b}{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} max\-\_\-nth)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a50220bcdbf9d2bd78cf51373757a97e1}{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ad94006b7baff285b913102630774d4a5}{\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} max\-\_\-nth)
\item 
static \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} \hyperlink{kmp__runtime_8c_a9ad37994c0b2b9e6c900768047c82362}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} \hyperlink{kmp__runtime_8c_a5f124655ad8830498b4dbfd1f5ee8ae1}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs} (const \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a50a4b71438f212672e584f38bb68d745}{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root)
\item 
unsigned short \hyperlink{kmp__runtime_8c_a35a3fb5fe916330a8e3f844603bb6a09}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-random} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thread)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a60fcea18938e34651a2bf9f5d15d95fa}{\-\_\-\-\_\-kmp\-\_\-init\-\_\-random} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thread)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a35f021c58bf7593d6c096cea30edbcc0}{\-\_\-\-\_\-kmp\-\_\-register\-\_\-root} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} initial\-\_\-thread)
\item 
static \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a81d484eadddec5aa9fb9e84cac63ca72}{\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a87754754d79922faa89637e40ef50579}{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$ \hyperlink{kmp__runtime_8c_aa26d2dfa84cff79bae57f1141c5d4d80}{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} new\-\_\-tid)
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team, \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$new\-\_\-icvs, \hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc)
\item 
\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$ \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} new\-\_\-nproc, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} max\-\_\-nproc, \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\-\_\-proc\-\_\-bind\-\_\-t} new\-\_\-proc\-\_\-bind, \hyperlink{kmp_8h_aeee976c9503b72fe3e38d18d88b305cf}{kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$new\-\_\-icvs, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} argc \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{U\-S\-E\-\_\-\-N\-E\-S\-T\-E\-D\-\_\-\-H\-O\-T\-\_\-\-A\-R\-G}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$master))
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team} (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\-\_\-root\-\_\-t} $\ast$root, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{U\-S\-E\-\_\-\-N\-E\-S\-T\-E\-D\-\_\-\-H\-O\-T\-\_\-\-A\-R\-G}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$master))
\item 
\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$ \hyperlink{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team} (\hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}{\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$this\-\_\-th)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$ \hyperlink{kmp__runtime_8c_a3fbd0f646b0562ab5164a520888b0ac1}{\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread} (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$this\-\_\-thr)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a6cff683557975c0b72ecd87bef7985de}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$specific\-\_\-gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3cb9d65a5473297ec40988b57ab4db11}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3739a3b19edccc322e6dc17b0260cac9}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_aac19f436c6f29b33591829da3e2bb626}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid\-\_\-req)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a75a86276e70967f171eae5df8dc2215c}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid\-\_\-req)
\item 
static char $\ast$ \hyperlink{kmp__runtime_8c_a02c91cce4fb3b2bd2b7b7d08eeb6b0a8}{\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name} ()
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ac0ef7f6136fa82420b38e14ae9daacc0}{\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_adc4261d970464abd5acafefe3a030132}{\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
static \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a4d6565c9ee276582946d645c8c67986e}{\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a86759bf6b8380906f716603052f60fc9}{\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a2b2e7087eea1ede7973094294abaac82}{\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} tid, \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$this\-\_\-thr, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a99118650304b0dbf1c8fc131d3a60d5f}{\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} tid, \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$this\-\_\-thr, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_ac3c18dacc189c300ca06e4ab033fc211}{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_ad176caa723133097e5ef49b4db44ea31}{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a68747f6af5ebfc6c26c14b0820fe2082}{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$\hyperlink{ittnotify__static_8h_a9ebeaf6e841ab2e3ed2f92a8850e0c3d}{id}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} num\-\_\-threads)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a4b8c42f74758d5b28a257f941ca5e5bb}{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$\hyperlink{ittnotify__static_8h_a9ebeaf6e841ab2e3ed2f92a8850e0c3d}{id}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} num\-\_\-teams, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} num\-\_\-threads)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a3f9064973202dcd6602376f53f7df6ce}{\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$\hyperlink{ittnotify__static_8h_a9ebeaf6e841ab2e3ed2f92a8850e0c3d}{id}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\-\_\-proc\-\_\-bind\-\_\-t} proc\-\_\-bind)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_aa733ff3ae9a095e5dd24907ca3adf92e}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$\hyperlink{ittnotify__static_8h_a9ebeaf6e841ab2e3ed2f92a8850e0c3d}{id}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a7f0781abf1c47553c64f9ddddaf17c66}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$\hyperlink{ittnotify__static_8h_a9ebeaf6e841ab2e3ed2f92a8850e0c3d}{id}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} gtid, \hyperlink{kmp_8h_a95f7a64bda9b774add6c27c4a7b2a143}{kmp\-\_\-team\-\_\-t} $\ast$team)
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_a9f825530c4d005a17b222607db3db40f}{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{kmp__runtime_8c_af5c4899a5713f6d8c209fc1bfb57d07b}{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_ae46804a9f563aa89ebb2c15a412d9f82}{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a6a533c08740e41e820de3564c7f72029}{\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library} (enum \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599d}{library\-\_\-type} arg)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_aa73b3aab19c0682debc4fb436f19c233}{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize} (size\-\_\-t arg)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a322e39ae06914545d6ef1532da1df903}{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library} (enum \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599d}{library\-\_\-type} arg)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_aff85f87b246c4b825005df4d1ba0bb5c}{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime} (\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} arg, \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$thread, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} tid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{kmp__runtime_8c_a191f7bdba5a1490b964492e96f16a7c9}{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults} (char const $\ast$\hyperlink{kmp__ftn__os_8h_a8269f97b2652fc717949a982d7b4f02a}{str}, \hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int} \hyperlink{ittnotify__static_8h_a607b6bb4c1ebd6e828c6a54ec9bd1411}{len})
\item 
\hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{P\-A\-C\-K\-E\-D\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-T} \hyperlink{kmp__runtime_8c_a7735d7d58a02a05dbfebda565f97c80c}{\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, kmp\-\_\-int32 num\-\_\-vars, size\-\_\-t reduce\-\_\-size, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$reduce\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$reduce\-\_\-func)(\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$lhs\-\_\-data, \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} $\ast$rhs\-\_\-data), \hyperlink{kmp_8h_ac3fc9c92929f696709b178ffe0854839}{kmp\-\_\-critical\-\_\-name} $\ast$lck)
\item 
kmp\-\_\-int32 \hyperlink{kmp__runtime_8c_af7da2e6709bcf9f6c9ad3ca6eb6808e9}{\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method} (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
char const \hyperlink{kmp__runtime_8c_a9f29a3c30ec5aea75f571d33682a5d5a}{\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api} \mbox{[}$\,$\mbox{]}
\item 
\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} \hyperlink{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}{\-\_\-\-\_\-kmp\-\_\-monitor}
\item 
static \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\-\_\-info\-\_\-t} $\ast$ \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt} = N\-U\-L\-L
\item 
static const unsigned \hyperlink{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}{\-\_\-\-\_\-kmp\-\_\-primes} \mbox{[}$\,$\mbox{]}
\item 
static long \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag} = 0
\item 
static char $\ast$ \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str} = N\-U\-L\-L
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{kmp__runtime_8c_a6b1fe521d023b646aa4cd9fd55a2ab6f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D@{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}}
\index{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D@{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D~( ( loc-\/$>$flags \& ( {\bf K\-M\-P\-\_\-\-I\-D\-E\-N\-T\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-R\-E\-D\-U\-C\-E} ) ) == ( {\bf K\-M\-P\-\_\-\-I\-D\-E\-N\-T\-\_\-\-A\-T\-O\-M\-I\-C\-\_\-\-R\-E\-D\-U\-C\-E} ) )}}\label{kmp__runtime_8c_a6b1fe521d023b646aa4cd9fd55a2ab6f}


Referenced by \-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method().

\hypertarget{kmp__runtime_8c_a92ac7fe90ec3149f4131e9fb6672d8ef}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D@{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}}
\index{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D@{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-A\-S\-T\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-T\-R\-E\-E\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-G\-E\-N\-E\-R\-A\-T\-E\-D~( ( reduce\-\_\-data ) \&\& ( reduce\-\_\-func ) )}}\label{kmp__runtime_8c_a92ac7fe90ec3149f4131e9fb6672d8ef}


Referenced by \-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method().

\hypertarget{kmp__runtime_8c_a635727f200be45c0c7cdc13c991284bf}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!K\-M\-P\-\_\-\-M\-I\-N@{K\-M\-P\-\_\-\-M\-I\-N}}
\index{K\-M\-P\-\_\-\-M\-I\-N@{K\-M\-P\-\_\-\-M\-I\-N}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{K\-M\-P\-\_\-\-M\-I\-N}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-M\-P\-\_\-\-M\-I\-N(
\begin{DoxyParamCaption}
\item[{}]{{\bf x}, }
\item[{}]{y}
\end{DoxyParamCaption}
)~( ({\bf x}) $<$ (y) ? ({\bf x}) \-: (y) )}}\label{kmp__runtime_8c_a635727f200be45c0c7cdc13c991284bf}


Definition at line 57 of file kmp\-\_\-runtime.\-c.

\hypertarget{kmp__runtime_8c_ad647847304011ec4d724df6fa3304009}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb@{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb}}
\index{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb@{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb}]{\setlength{\rightskip}{0pt plus 5cm}\#define kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-bb~(({\bf int})1)}}\label{kmp__runtime_8c_ad647847304011ec4d724df6fa3304009}


Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().

\hypertarget{kmp__runtime_8c_a865f8badcfb2a1cc1324e83d73a84fcd}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat@{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat}}
\index{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat@{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat}]{\setlength{\rightskip}{0pt plus 5cm}\#define kmp\-\_\-reduction\-\_\-barrier\-\_\-gather\-\_\-pat~{\bf bp\-\_\-hyper\-\_\-bar}}}\label{kmp__runtime_8c_a865f8badcfb2a1cc1324e83d73a84fcd}


Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().

\hypertarget{kmp__runtime_8c_a3e7f640f37c63871b76fd8a9838ab45f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb@{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb}}
\index{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb@{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb}]{\setlength{\rightskip}{0pt plus 5cm}\#define kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-bb~(({\bf int})1)}}\label{kmp__runtime_8c_a3e7f640f37c63871b76fd8a9838ab45f}


Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().

\hypertarget{kmp__runtime_8c_ab7e4cdfdc594b3e230b9fbb1896980e7}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat@{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat}}
\index{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat@{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat}]{\setlength{\rightskip}{0pt plus 5cm}\#define kmp\-\_\-reduction\-\_\-barrier\-\_\-release\-\_\-pat~{\bf bp\-\_\-hyper\-\_\-bar}}}\label{kmp__runtime_8c_ab7e4cdfdc594b3e230b9fbb1896980e7}


Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().

\hypertarget{kmp__runtime_8c_a61c4bc9a84ea78dfc34bab9dd89f3e7a}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C@{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C}}
\index{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C@{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-O\-O\-L\-E\-D\-\_\-\-A\-L\-L\-O\-C~0}}\label{kmp__runtime_8c_a61c4bc9a84ea78dfc34bab9dd89f3e7a}


Definition at line 35 of file kmp\-\_\-runtime.\-c.

\hypertarget{kmp__runtime_8c_a3b1fe06461dee8a9bdf4422a7c14b972}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L@{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L}}
\index{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L@{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-M\-P\-\_\-\-U\-S\-E\-\_\-\-P\-R\-C\-T\-L~0}}\label{kmp__runtime_8c_a3b1fe06461dee8a9bdf4422a7c14b972}


Definition at line 34 of file kmp\-\_\-runtime.\-c.

\hypertarget{kmp__runtime_8c_a8cea0c1cc1fc60a52e79998580bbf1a7}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E@{M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E}}
\index{M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E@{M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\-A\-X\-\_\-\-M\-E\-S\-S\-A\-G\-E~512}}\label{kmp__runtime_8c_a8cea0c1cc1fc60a52e79998580bbf1a7}


Definition at line 325 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid(), and \-\_\-\-\_\-kmp\-\_\-warn().

\hypertarget{kmp__runtime_8c_a1fe9d72aca3be52b82f7ddba504a6def}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!propagate\-F\-P\-Control@{propagate\-F\-P\-Control}}
\index{propagate\-F\-P\-Control@{propagate\-F\-P\-Control}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{propagate\-F\-P\-Control}]{\setlength{\rightskip}{0pt plus 5cm}\#define propagate\-F\-P\-Control(
\begin{DoxyParamCaption}
\item[{}]{{\bf x}}
\end{DoxyParamCaption}
)~(({\bf void})0)}}\label{kmp__runtime_8c_a1fe9d72aca3be52b82f7ddba504a6def}


Definition at line 1201 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call(), and \-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel().

\hypertarget{kmp__runtime_8c_a6ae754850170a17b0f3e266e802051ab}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!update\-H\-W\-F\-P\-Control@{update\-H\-W\-F\-P\-Control}}
\index{update\-H\-W\-F\-P\-Control@{update\-H\-W\-F\-P\-Control}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{update\-H\-W\-F\-P\-Control}]{\setlength{\rightskip}{0pt plus 5cm}\#define update\-H\-W\-F\-P\-Control(
\begin{DoxyParamCaption}
\item[{}]{{\bf x}}
\end{DoxyParamCaption}
)~(({\bf void})0)}}\label{kmp__runtime_8c_a6ae754850170a17b0f3e266e802051ab}


Definition at line 1202 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-join\-\_\-call(), and \-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread().



\subsection{Function Documentation}
\hypertarget{kmp__runtime_8c_ac7e5d659bb9c1aee34debaf40d197e1c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process@{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process}}
\index{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process@{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-process}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-abort\-\_\-process (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ac7e5d659bb9c1aee34debaf40d197e1c}


Definition at line 405 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-msg().


\begin{DoxyCode}
406 \{
407 
408     \textcolor{comment}{// Later threads may stall here, but that's ok because abort() will kill them.}
409     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & \hyperlink{kmp_8h_a883c44544832e75b58d897fc0c690142}{\_\_kmp\_exit\_lock} );
410 
411     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a34cced9aee5b6e711fe55d15363aa6d4}{\_\_kmp\_debug\_buf} ) \{
412         \hyperlink{kmp__debug_8c_a051d40c547de052d7beccac6cc20479a}{\_\_kmp\_dump\_debug\_buffer}();
413     \}; \textcolor{comment}{// if}
414 
415     \textcolor{keywordflow}{if} ( \hyperlink{kmp__platform_8h_a2f83e9196e077cc3cf8ec514a0996cdd}{KMP\_OS\_WINDOWS} ) \{
416         \textcolor{comment}{// Let other threads know of abnormal termination and prevent deadlock}
417         \textcolor{comment}{// if abort happened during library initialization or shutdown}
418         \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort = SIGABRT;
419 
420         \textcolor{comment}{/*}
421 \textcolor{comment}{            On Windows* OS by default abort() causes pop-up error box, which stalls nightly testing.}
422 \textcolor{comment}{            Unfortunately, we cannot reliably suppress pop-up error boxes. \_set\_abort\_behavior()}
423 \textcolor{comment}{            works well, but this function is not available in VS7 (this is not problem for DLL, but}
424 \textcolor{comment}{            it is a problem for static OpenMP RTL). SetErrorMode (and so, timelimit utility) does}
425 \textcolor{comment}{            not help, at least in some versions of MS C RTL.}
426 \textcolor{comment}{}
427 \textcolor{comment}{            It seems following sequence is the only way to simulate abort() and avoid pop-up error}
428 \textcolor{comment}{            box.}
429 \textcolor{comment}{        */}
430         \textcolor{keyword}{raise}( SIGABRT );
431         \_exit( 3 );    \textcolor{comment}{// Just in case, if signal ignored, exit anyway.}
432     \} \textcolor{keywordflow}{else} \{
433         abort();
434     \}; \textcolor{comment}{// if}
435 
436     \hyperlink{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}{\_\_kmp\_infinite\_loop}();
437     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & \hyperlink{kmp_8h_a883c44544832e75b58d897fc0c690142}{\_\_kmp\_exit\_lock} );
438 
439 \} \textcolor{comment}{// \_\_kmp\_abort\_process}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3af0772074c6291cf8d346cef0e22c75}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3af0772074c6291cf8d346cef0e22c75}


Definition at line 442 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-tasking\-\_\-barrier(), and \-\_\-\-\_\-kmp\-\_\-wait\-\_\-template().


\begin{DoxyCode}
443 \{
444     \textcolor{comment}{// TODO: Eliminate g\_abort global variable and this function.}
445     \textcolor{comment}{// In case of abort just call abort(), it will kill all the threads.}
446     \hyperlink{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}{\_\_kmp\_infinite\_loop}();
447 \} \textcolor{comment}{// \_\_kmp\_abort\_thread}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries@{\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries}}
\index{\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries@{\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{argc, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{realloc}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}


Definition at line 2965 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), and \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
2966 \{
2967 
2968     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
2969     \textcolor{keywordflow}{if}( !realloc || argc > team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc ) \{
2970 
2971         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 100, ( \textcolor{stringliteral}{"\_\_kmp\_alloc\_argv\_entries: team %d: needed entries=%d, current entries=%d
      \(\backslash\)n"},
2972                          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, argc, ( realloc ) ? team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc : 0 ));
2973         \textcolor{comment}{/* if previously allocated heap space for args, free them */}
2974         \textcolor{keywordflow}{if} ( realloc && team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv != &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_inline\_argv[0] )
2975             \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( (\textcolor{keywordtype}{void} *) team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv );
2976 
2977         \textcolor{keywordflow}{if} ( argc <= \hyperlink{kmp_8h_ad7c5e393cb16fe8c2db3e08a0ce11393}{KMP\_INLINE\_ARGV\_ENTRIES} ) \{
2978             \textcolor{comment}{/* use unused space in the cache line for arguments */}
2979             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc = \hyperlink{kmp_8h_ad7c5e393cb16fe8c2db3e08a0ce11393}{KMP\_INLINE\_ARGV\_ENTRIES};
2980             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 100, ( \textcolor{stringliteral}{"\_\_kmp\_alloc\_argv\_entries: team %d: inline allocate %d argv entries\(\backslash\)n"}
      ,
2981                              team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc ));
2982             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv = &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_inline\_argv[0];
2983             \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
2984                 \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_inline\_argv[0],
2985                                          &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_inline\_argv[
      \hyperlink{kmp_8h_ad7c5e393cb16fe8c2db3e08a0ce11393}{KMP\_INLINE\_ARGV\_ENTRIES}],
2986                                          (\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void} *) * 
      \hyperlink{kmp_8h_ad7c5e393cb16fe8c2db3e08a0ce11393}{KMP\_INLINE\_ARGV\_ENTRIES}),
2987                                          \textcolor{stringliteral}{"team\_%d.t\_inline\_argv"},
2988                                          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id );
2989             \}
2990         \} \textcolor{keywordflow}{else} \{
2991             \textcolor{comment}{/* allocate space for arguments in the heap */}
2992             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc = ( argc <= (KMP\_MIN\_MALLOC\_ARGV\_ENTRIES >> 1 )) ?
2993                                      \hyperlink{kmp_8h_a97f74bad875ae8bb4665896872054be7}{KMP\_MIN\_MALLOC\_ARGV\_ENTRIES} : 2 * argc;
2994             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 100, ( \textcolor{stringliteral}{"\_\_kmp\_alloc\_argv\_entries: team %d: dynamic allocate %d argv entries\(\backslash\)n
      "},
2995                              team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc ));
2996             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv     = (\textcolor{keywordtype}{void}**) \hyperlink{kmp_8h_adda81522db1e004871a917862d56a11b}{\_\_kmp\_page\_allocate}( \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}*) * team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc );
2997             \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
2998                 \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv[0], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv[team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc],
2999                                          \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void} *) * team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_argc, \textcolor{stringliteral}{"team\_%d.t\_argv"},
3000                                          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id );
3001             \}
3002         \}
3003     \}
3004 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team}}
\index{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-team\-\_\-t}$\ast$ \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root, }
\item[{{\bf int}}]{new\-\_\-nproc, }
\item[{{\bf int}}]{max\-\_\-nproc, }
\item[{{\bf kmp\-\_\-proc\-\_\-bind\-\_\-t}}]{new\-\_\-proc\-\_\-bind, }
\item[{{\bf kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$}]{new\-\_\-icvs, }
\item[{{\bf int} argc }]{U\-S\-E\-\_\-\-N\-E\-S\-T\-E\-D\-\_\-\-H\-O\-T\-\_\-\-A\-R\-Gkmp\-\_\-info\-\_\-t $\ast$master}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}


Definition at line 4800 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root(), \-\_\-\-\_\-kmp\-\_\-register\-\_\-root(), and \-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel().


\begin{DoxyCode}
4809 \{
4810     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_allocate\_team);
4811     \textcolor{keywordtype}{int} f;
4812     \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
4813     \textcolor{keywordtype}{int} use\_hot\_team = ! root->r.r\_active;
4814     \textcolor{keywordtype}{int} level = 0;
4815 
4816     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: called\(\backslash\)n"}));
4817     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_nproc >=1 && argc >=0 );
4818     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( max\_nproc >= new\_nproc );
4819     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4820 
4821 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
4822 \textcolor{preprocessor}{}    kmp\_hot\_team\_ptr\_t *hot\_teams;
4823     \textcolor{keywordflow}{if}( master ) \{
4824         team = master->th.th\_team;
4825         level = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level;
4826         \textcolor{keywordflow}{if}( master->th.th\_teams\_microtask ) \{                         \textcolor{comment}{// in teams construct?}
4827             \textcolor{keywordflow}{if}( master->th.th\_teams\_size.nteams > 1 && (             \textcolor{comment}{// #teams > 1}
4828                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn == (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} || \textcolor{comment}{// inner
       fork of the teams}
4829                 master->th.th\_teams\_level < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level ) ) \{    \textcolor{comment}{// or nested parallel inside the
       teams}
4830                 ++level; \textcolor{comment}{// not increment if #teams==1, or for outer fork of the teams; increment otherwise}
4831             \}
4832         \}
4833         hot\_teams = master->th.th\_hot\_teams;
4834         \textcolor{keywordflow}{if}( level < \_\_kmp\_hot\_teams\_max\_level && hot\_teams && hot\_teams[level].hot\_team )
4835         \{   \textcolor{comment}{// hot team has already been allocated for given level}
4836             use\_hot\_team = 1;
4837         \} \textcolor{keywordflow}{else} \{
4838             use\_hot\_team = 0;
4839         \}
4840     \}
4841 \textcolor{preprocessor}{#endif}
4842 \textcolor{preprocessor}{}    \textcolor{comment}{// Optimization to use a "hot" team}
4843     \textcolor{keywordflow}{if}( use\_hot\_team && new\_nproc > 1 ) \{
4844         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_nproc == max\_nproc );
4845 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
4846 \textcolor{preprocessor}{}        team = hot\_teams[level].hot\_team;
4847 \textcolor{preprocessor}{#else}
4848 \textcolor{preprocessor}{}        team =  root->r.r\_hot\_team;
4849 \textcolor{preprocessor}{#endif}
4850 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_DEBUG}
4851 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
4852             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: hot team task\_team[0] = %p task\_team[1] = %p
       before reinit\(\backslash\)n"},
4853                            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0], team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1] ));
4854         \}
4855 \textcolor{preprocessor}{#endif}
4856 \textcolor{preprocessor}{}
4857         \textcolor{comment}{// Has the number of threads changed?}
4858         \textcolor{comment}{/* Let's assume the most common case is that the number of threads is unchanged, and}
4859 \textcolor{comment}{           put that case first. */}
4860         \textcolor{keywordflow}{if} (team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc == new\_nproc) \{ \textcolor{comment}{// Check changes in number of threads}
4861             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: reusing hot team\(\backslash\)n"} ));
4862             \textcolor{comment}{// This case can mean that omp\_set\_num\_threads() was called and the hot team size}
4863             \textcolor{comment}{// was already reduced, so we check the special flag}
4864             \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed == -1 ) \{
4865                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = 1;
4866             \} \textcolor{keywordflow}{else} \{
4867                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = 0;
4868             \}
4869 
4870             \textcolor{comment}{// TODO???: team->t.t\_max\_active\_levels = new\_max\_active\_levels;}
4871             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched =  new\_icvs->\hyperlink{structkmp__internal__control_a39684c4ec5986537da3c14792fd003fb}{sched};
4872 
4873             \hyperlink{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\_\_kmp\_reinitialize\_team}( team, new\_icvs, root->r.r\_uber\_thread->th.
      th\_ident );
4874 
4875             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team2: T#%d, this\_thread=%p team=%p\(\backslash\)n"},
4876                            0, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team ) );
4877             \hyperlink{kmp_8h_acbb44e4a3167875a9a9d4b5eca8fb3d8}{\_\_kmp\_push\_current\_task\_to\_thread}( team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ 0 ], team, 0 );
4878 
4879 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
4880 \textcolor{preprocessor}{}\textcolor{preprocessor}{# if KMP\_AFFINITY\_SUPPORTED}
4881 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} ( ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed == 0 )
4882               && ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind == new\_proc\_bind ) ) \{
4883                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 200, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: reusing hot team #%d bindings: proc\_bind =
       %d, partition = [%d,%d]\(\backslash\)n"},
4884                   team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, new\_proc\_bind, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_first\_place,
4885                   team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_last\_place ) );
4886             \}
4887             \textcolor{keywordflow}{else} \{
4888                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
4889                 \_\_kmp\_partition\_places( team );
4890             \}
4891 \textcolor{preprocessor}{# else}
4892 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind != new\_proc\_bind ) \{
4893                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
4894             \}
4895 \textcolor{preprocessor}{# endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
4896 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
4897 \textcolor{preprocessor}{}        \}
4898         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc > new\_nproc ) \{
4899             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: decreasing hot team thread count to %d\(\backslash\)n"}, 
      new\_nproc ));
4900 
4901             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = 1;
4902 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
4903 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if}( \_\_kmp\_hot\_teams\_mode == 0 ) \{
4904                 \textcolor{comment}{// AC: saved number of threads should correspond to team's value in this mode,}
4905                 \textcolor{comment}{// can be bigger in mode 1, when hot team has some threads in reserve}
4906                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(hot\_teams[level].hot\_team\_nth == team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc);
4907                 hot\_teams[level].hot\_team\_nth = new\_nproc;
4908 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
4909 \textcolor{preprocessor}{}                \textcolor{comment}{/* release the extra threads we don't need any more */}
4910                 \textcolor{keywordflow}{for}( f = new\_nproc  ;  f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc  ;  f++ ) \{
4911                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ] );
4912                     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != 
      \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
4913                         \textcolor{comment}{// When decreasing team size, threads no longer in the team should unref task team.}
4914                         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_task\_team = NULL;
4915                     \}
4916                     \hyperlink{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}{\_\_kmp\_free\_thread}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ] );
4917                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ] = NULL;
4918                 \}
4919 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
4920 \textcolor{preprocessor}{}            \} \textcolor{comment}{// (\_\_kmp\_hot\_teams\_mode == 0)}
4921 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
4922 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc =  new\_nproc;
4923             \textcolor{comment}{// TODO???: team->t.t\_max\_active\_levels = new\_max\_active\_levels;}
4924             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched =  new\_icvs->\hyperlink{structkmp__internal__control_a39684c4ec5986537da3c14792fd003fb}{sched};
4925             \hyperlink{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\_\_kmp\_reinitialize\_team}( team, new\_icvs, root->r.r\_uber\_thread->th.
      th\_ident );
4926 
4927             \textcolor{comment}{/* update the remaining threads */}
4928             \textcolor{keywordflow}{for}(f = 0; f < new\_nproc; ++f) \{
4929                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_team\_nproc = new\_nproc;
4930             \}
4931             \textcolor{comment}{// restore the current task state of the master thread: should be the implicit task}
4932             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: T#%d, this\_thread=%p team=%p\(\backslash\)n"},
4933                        0, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team ) );
4934 
4935             \hyperlink{kmp_8h_acbb44e4a3167875a9a9d4b5eca8fb3d8}{\_\_kmp\_push\_current\_task\_to\_thread}( team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ 0 ], team, 0 );
4936 
4937 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
4938 \textcolor{preprocessor}{}            \textcolor{keywordflow}{for} ( f = 0; f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; f++ ) \{
4939                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] &&
4940                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_team\_nproc == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc );
4941             \}
4942 \textcolor{preprocessor}{#endif}
4943 \textcolor{preprocessor}{}
4944 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
4945 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
4946 \textcolor{preprocessor}{# if KMP\_AFFINITY\_SUPPORTED}
4947 \textcolor{preprocessor}{}            \_\_kmp\_partition\_places( team );
4948 \textcolor{preprocessor}{# endif}
4949 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
4950 \textcolor{preprocessor}{}        \}
4951         \textcolor{keywordflow}{else} \{ \textcolor{comment}{// team->t.t\_nproc < new\_nproc}
4952 \textcolor{preprocessor}{#if KMP\_OS\_LINUX && KMP\_AFFINITY\_SUPPORTED}
4953 \textcolor{preprocessor}{}            kmp\_affin\_mask\_t *old\_mask;
4954             \textcolor{keywordflow}{if} ( KMP\_AFFINITY\_CAPABLE() ) \{
4955                 KMP\_CPU\_ALLOC(old\_mask);
4956             \}
4957 \textcolor{preprocessor}{#endif}
4958 \textcolor{preprocessor}{}
4959             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: increasing hot team thread count to %d\(\backslash\)n"}, 
      new\_nproc ));
4960 
4961             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = 1;
4962 
4963 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
4964 \textcolor{preprocessor}{}            \textcolor{keywordtype}{int} avail\_threads = hot\_teams[level].hot\_team\_nth;
4965             \textcolor{keywordflow}{if}( new\_nproc < avail\_threads )
4966                 avail\_threads = new\_nproc;
4967             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **other\_threads = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
4968             \textcolor{keywordflow}{for} ( f = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; f < avail\_threads; ++f ) \{
4969                 \textcolor{comment}{// Adjust barrier data of reserved threads (if any) of the team}
4970                 \textcolor{comment}{// Other data will be set in \_\_kmp\_initialize\_info() below.}
4971                 \textcolor{keywordtype}{int} b;
4972                 \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = other\_threads[f]->th.th\_bar;
4973                 \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
4974                     balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[b].b\_arrived;
4975                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[b].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
4976 \textcolor{preprocessor}{#if USE\_DEBUGGER}
4977 \textcolor{preprocessor}{}                    balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_worker\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[b].b\_team\_arrived;
4978 \textcolor{preprocessor}{#endif}
4979 \textcolor{preprocessor}{}                \}
4980             \}
4981             \textcolor{keywordflow}{if}( hot\_teams[level].hot\_team\_nth >= new\_nproc ) \{
4982                 \textcolor{comment}{// we have all needed threads in reserve, no need to allocate any}
4983                 \textcolor{comment}{// this only possible in mode 1, cannot have reserved threads in mode 0}
4984                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(\_\_kmp\_hot\_teams\_mode == 1);
4985                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = new\_nproc;                     \textcolor{comment}{// just get reserved threads involved}
4986             \} \textcolor{keywordflow}{else} \{
4987                 \textcolor{comment}{// we may have some threads in reserve, but not enough}
4988                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = hot\_teams[level].hot\_team\_nth; \textcolor{comment}{// get reserved threads involved if any}
4989                 hot\_teams[level].hot\_team\_nth = new\_nproc;       \textcolor{comment}{// adjust hot team max size}
4990 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
4991 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc < new\_nproc) \{
4992                 \textcolor{comment}{/* reallocate larger arrays */}
4993                 \hyperlink{kmp__runtime_8c_ad94006b7baff285b913102630774d4a5}{\_\_kmp\_reallocate\_team\_arrays}(team, new\_nproc);
4994                 \hyperlink{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\_\_kmp\_reinitialize\_team}( team, new\_icvs, NULL );
4995             \}
4996 
4997 \textcolor{preprocessor}{#if KMP\_OS\_LINUX && KMP\_AFFINITY\_SUPPORTED}
4998 \textcolor{preprocessor}{}            \textcolor{comment}{/* Temporarily set full mask for master thread before}
4999 \textcolor{comment}{               creation of workers. The reason is that workers inherit}
5000 \textcolor{comment}{               the affinity from master, so if a lot of workers are}
5001 \textcolor{comment}{               created on the single core quickly, they don't get}
5002 \textcolor{comment}{               a chance to set their own affinity for a long time.}
5003 \textcolor{comment}{            */}
5004             \_\_kmp\_set\_thread\_affinity\_mask\_full\_tmp( old\_mask );
5005 \textcolor{preprocessor}{#endif}
5006 \textcolor{preprocessor}{}
5007             \textcolor{comment}{/* allocate new threads for the hot team */}
5008             \textcolor{keywordflow}{for}( f = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc  ;  f < new\_nproc  ;  f++ ) \{
5009                 \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} * new\_worker = \hyperlink{kmp__runtime_8c_aa26d2dfa84cff79bae57f1141c5d4d80}{\_\_kmp\_allocate\_thread}( root, team,
       f );
5010                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_worker );
5011                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ] = new\_worker;
5012 
5013                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: team %d init T#%d arrived: join=%llu,
       plain=%llu\(\backslash\)n"},
5014                                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}( f, team ), team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, f,
5015                                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}].b\_arrived,
5016                                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}].b\_arrived ) );
5017 
5018                 \{ \textcolor{comment}{// Initialize barrier data for new threads.}
5019                     \textcolor{keywordtype}{int} b;
5020                     \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = new\_worker->th.th\_bar;
5021                     \textcolor{keywordflow}{for}( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
5022                         balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_arrived        = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived;
5023                         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[b].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
5024 \textcolor{preprocessor}{#if USE\_DEBUGGER}
5025 \textcolor{preprocessor}{}                        balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_worker\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived;
5026 \textcolor{preprocessor}{#endif}
5027 \textcolor{preprocessor}{}                    \}
5028                 \}
5029             \}
5030 
5031 \textcolor{preprocessor}{#if KMP\_OS\_LINUX && KMP\_AFFINITY\_SUPPORTED}
5032 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} ( KMP\_AFFINITY\_CAPABLE() ) \{
5033                 \textcolor{comment}{/* Restore initial master thread's affinity mask */}
5034                 \hyperlink{z__Windows__NT__util_8c_ab057268fc36c87b493138b5a107ad3e1}{\_\_kmp\_set\_system\_affinity}( old\_mask, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
5035                 KMP\_CPU\_FREE(old\_mask);
5036             \}
5037 \textcolor{preprocessor}{#endif}
5038 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
5039 \textcolor{preprocessor}{}            \} \textcolor{comment}{// end of check of t\_nproc vs. new\_nproc vs. hot\_team\_nth}
5040 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
5041 \textcolor{preprocessor}{}            \textcolor{comment}{/* make sure everyone is syncronized */}
5042             \textcolor{keywordtype}{int} old\_nproc = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; \textcolor{comment}{// save old value and use to update only new threads below}
5043             \hyperlink{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}{\_\_kmp\_initialize\_team}( team, new\_nproc, new\_icvs, root->r.r\_uber\_thread->
      th.th\_ident );
5044 
5045             \textcolor{comment}{/* reinitialize the threads */}
5046             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc == new\_nproc);
5047             \textcolor{keywordflow}{for} (f=0;  f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++f)
5048                 \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\_\_kmp\_initialize\_info}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ], team, f, 
      \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}( f, team ) );
5049             \textcolor{keywordflow}{if} (level) \{ \textcolor{comment}{// set th\_task\_state for new threads in nested hot team}
5050                 \textcolor{comment}{// \_\_kmp\_initialize\_info() no longer zeroes th\_task\_state, so we should only need to set
       the}
5051                 \textcolor{comment}{// th\_task\_state for the new threads. th\_task\_state for master thread will not be accurate
       until}
5052                 \textcolor{comment}{// after this in \_\_kmp\_fork\_call(), so we look to the master's memo\_stack to get the
       correct value.}
5053                 \textcolor{keywordflow}{for} (f=old\_nproc; f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++f)
5054                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_task\_state = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]->th.
      th\_task\_state\_memo\_stack[level];
5055             \}
5056             \textcolor{keywordflow}{else} \{ \textcolor{comment}{// set th\_task\_state for new threads in non-nested hot team}
5057                 \textcolor{keywordtype}{int} old\_state = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]->th.th\_task\_state; \textcolor{comment}{// copy master's state}
5058                 \textcolor{keywordflow}{for} (f=old\_nproc; f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++f)
5059                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_task\_state = old\_state;
5060             \}
5061 
5062 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
5063 \textcolor{preprocessor}{}            \textcolor{keywordflow}{for} ( f = 0; f < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++ f ) \{
5064                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] &&
5065                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_team\_nproc == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc );
5066             \}
5067 \textcolor{preprocessor}{#endif}
5068 \textcolor{preprocessor}{}
5069 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
5070 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
5071 \textcolor{preprocessor}{# if KMP\_AFFINITY\_SUPPORTED}
5072 \textcolor{preprocessor}{}            \_\_kmp\_partition\_places( team );
5073 \textcolor{preprocessor}{# endif}
5074 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
5075 \textcolor{preprocessor}{}        \} \textcolor{comment}{// Check changes in number of threads}
5076 
5077 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
5078 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *master = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0];
5079         \textcolor{keywordflow}{if}( master->th.th\_teams\_microtask ) \{
5080             \textcolor{keywordflow}{for}( f = 1; f < new\_nproc; ++f ) \{
5081                 \textcolor{comment}{// propagate teams construct specific info to workers}
5082                 \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f];
5083                 thr->th.th\_teams\_microtask = master->th.th\_teams\_microtask;
5084                 thr->th.th\_teams\_level     = master->th.th\_teams\_level;
5085                 thr->th.th\_teams\_size      = master->th.th\_teams\_size;
5086             \}
5087         \}
5088 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
5089 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
5090 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if}( level ) \{
5091             \textcolor{comment}{// Sync barrier state for nested hot teams, not needed for outermost hot team.}
5092             \textcolor{keywordflow}{for}( f = 1; f < new\_nproc; ++f ) \{
5093                 \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f];
5094                 \textcolor{keywordtype}{int} b;
5095                 \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = thr->th.th\_bar;
5096                 \textcolor{keywordflow}{for}( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
5097                     balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_arrived        = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived;
5098                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[b].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
5099 \textcolor{preprocessor}{#if USE\_DEBUGGER}
5100 \textcolor{preprocessor}{}                    balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_worker\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived;
5101 \textcolor{preprocessor}{#endif}
5102 \textcolor{preprocessor}{}                \}
5103             \}
5104         \}
5105 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
5106 \textcolor{preprocessor}{}
5107         \textcolor{comment}{/* reallocate space for arguments if necessary */}
5108         \hyperlink{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\_\_kmp\_alloc\_argv\_entries}( argc, team, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
5109         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc     = argc;
5110         \textcolor{comment}{//}
5111         \textcolor{comment}{// The hot team re-uses the previous task team,}
5112         \textcolor{comment}{// if untouched during the previous release->gather phase.}
5113         \textcolor{comment}{//}
5114 
5115         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{" hot\_team = %p\(\backslash\)n"}, team ) );
5116 
5117 \textcolor{preprocessor}{#if KMP\_DEBUG}
5118 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
5119             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: hot team task\_team[0] = %p task\_team[1] = %p after
       reinit\(\backslash\)n"},
5120                            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0], team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1] ));
5121         \}
5122 \textcolor{preprocessor}{#endif}
5123 \textcolor{preprocessor}{}
5124 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5125 \textcolor{preprocessor}{}        \hyperlink{ompt-specific_8c_a42b74b829cdbf17b033acb9f5e2cdd2b}{\_\_ompt\_team\_assign\_id}(team, ompt\_parallel\_id);
5126 \textcolor{preprocessor}{#endif}
5127 \textcolor{preprocessor}{}
5128         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5129 
5130         \textcolor{keywordflow}{return} team;
5131     \}
5132 
5133     \textcolor{comment}{/* next, let's try to take one from the team pool */}
5134     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5135     \textcolor{keywordflow}{for}( team = (\hyperlink{unionkmp__team}{kmp\_team\_t}*) \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool} ; (team) ; )
5136     \{
5137         \textcolor{comment}{/* TODO: consider resizing undersized teams instead of reaping them, now that we have a resizing
       mechanism */}
5138         \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc >= max\_nproc ) \{
5139             \textcolor{comment}{/* take this team from the team pool */}
5140             \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool} = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_next\_pool;
5141 
5142             \textcolor{comment}{/* setup the team for fresh use */}
5143             \hyperlink{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}{\_\_kmp\_initialize\_team}( team, new\_nproc, new\_icvs, NULL );
5144 
5145             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_allocate\_team: setting task\_team[0] %p and task\_team[1] %p to
       NULL\(\backslash\)n"},
5146                             &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1]) );
5147             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0] = NULL;
5148             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1] = NULL;
5149 
5150             \textcolor{comment}{/* reallocate space for arguments if necessary */}
5151             \hyperlink{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\_\_kmp\_alloc\_argv\_entries}( argc, team, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
5152             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc     = argc;
5153 
5154             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: team %d init arrived: join=%u, plain=%u\(\backslash\)n"},
5155                             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE}, 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} ));
5156             \{ \textcolor{comment}{// Initialize barrier data.}
5157                 \textcolor{keywordtype}{int} b;
5158                 \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b) \{
5159                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived        = 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE};
5160 \textcolor{preprocessor}{#if USE\_DEBUGGER}
5161 \textcolor{preprocessor}{}                    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_master\_arrived = 0;
5162                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived   = 0;
5163 \textcolor{preprocessor}{#endif}
5164 \textcolor{preprocessor}{}                \}
5165             \}
5166 
5167 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
5168 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
5169 \textcolor{preprocessor}{#endif}
5170 \textcolor{preprocessor}{}
5171             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: using team from pool %d.\(\backslash\)n"}, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id ));
5172 
5173 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5174 \textcolor{preprocessor}{}            \hyperlink{ompt-specific_8c_a42b74b829cdbf17b033acb9f5e2cdd2b}{\_\_ompt\_team\_assign\_id}(team, ompt\_parallel\_id);
5175 \textcolor{preprocessor}{#endif}
5176 \textcolor{preprocessor}{}
5177             \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5178 
5179             \textcolor{keywordflow}{return} team;
5180         \}
5181 
5182         \textcolor{comment}{/* reap team if it is too small, then loop back and check the next one */}
5183         \textcolor{comment}{/* not sure if this is wise, but, will be redone during the hot-teams rewrite. */}
5184         \textcolor{comment}{/* TODO: Use technique to find the right size hot-team, don't reap them */}
5185         team =  \hyperlink{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}{\_\_kmp\_reap\_team}( team );
5186         \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool} = team;
5187     \}
5188 
5189     \textcolor{comment}{/* nothing available in the pool, no matter, make a new team! */}
5190     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5191     team = (\hyperlink{unionkmp__team}{kmp\_team\_t}*) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}( 
      \hyperlink{unionkmp__team}{kmp\_team\_t} ) );
5192 
5193     \textcolor{comment}{/* and set it up */}
5194     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc   = max\_nproc;
5195     \textcolor{comment}{/* NOTE well, for some reason allocating one big buffer and dividing it}
5196 \textcolor{comment}{     * up seems to really hurt performance a lot on the P4, so, let's not use}
5197 \textcolor{comment}{     * this... */}
5198     \hyperlink{kmp__runtime_8c_a4bd75779a9760d87a4ee0a439f55192b}{\_\_kmp\_allocate\_team\_arrays}( team, max\_nproc );
5199 
5200     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_allocate\_team: making a new team\(\backslash\)n"} ) );
5201     \hyperlink{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}{\_\_kmp\_initialize\_team}( team, new\_nproc, new\_icvs, NULL );
5202 
5203     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_allocate\_team: setting task\_team[0] %p and task\_team[1] %p to NULL\(\backslash\)n"},
5204                     &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1] ) );
5205     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[0] = NULL;    \textcolor{comment}{// to be removed, as \_\_kmp\_allocate zeroes memory, no need to
       duplicate}
5206     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[1] = NULL;    \textcolor{comment}{// to be removed, as \_\_kmp\_allocate zeroes memory, no need to
       duplicate}
5207 
5208     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
5209         \hyperlink{kmp__runtime_8c_ae66c7ec463ab127171b5ff69c6709d94}{\_\_kmp\_print\_team\_storage\_map}( \textcolor{stringliteral}{"team"}, team, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, new\_nproc );
5210     \}
5211 
5212     \textcolor{comment}{/* allocate space for arguments */}
5213     \hyperlink{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\_\_kmp\_alloc\_argv\_entries}( argc, team, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} );
5214     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc        = argc;
5215 
5216     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: team %d init arrived: join=%u, plain=%u\(\backslash\)n"},
5217                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE}, 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} ));
5218     \{ \textcolor{comment}{// Initialize barrier data.}
5219         \textcolor{keywordtype}{int} b;
5220         \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
5221             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived        = \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE};
5222 \textcolor{preprocessor}{#if USE\_DEBUGGER}
5223 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_master\_arrived = 0;
5224             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived   = 0;
5225 \textcolor{preprocessor}{#endif}
5226 \textcolor{preprocessor}{}        \}
5227     \}
5228 
5229 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
5230 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind = new\_proc\_bind;
5231 \textcolor{preprocessor}{#endif}
5232 \textcolor{preprocessor}{}
5233 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5234 \textcolor{preprocessor}{}    \hyperlink{ompt-specific_8c_a42b74b829cdbf17b033acb9f5e2cdd2b}{\_\_ompt\_team\_assign\_id}(team, ompt\_parallel\_id);
5235     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_serialized\_team\_info = NULL;
5236 \textcolor{preprocessor}{#endif}
5237 \textcolor{preprocessor}{}
5238     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5239 
5240     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_team: done creating a new team %d.\(\backslash\)n"}, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id ));
5241 
5242     \textcolor{keywordflow}{return} team;
5243 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4bd75779a9760d87a4ee0a439f55192b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays}}
\index{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team\-\_\-arrays (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{max\-\_\-nth}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a4bd75779a9760d87a4ee0a439f55192b}


Definition at line 3007 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), and \-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays().


\begin{DoxyCode}
3008 \{
3009     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
3010     \textcolor{keywordtype}{int} num\_disp\_buff = max\_nth > 1 ? \hyperlink{kmp_8h_a7d5c6777861c49affd8d4ff04cde845a}{KMP\_MAX\_DISP\_BUF} : 2;
3011 \textcolor{preprocessor}{#if KMP\_USE\_POOLED\_ALLOC}
3012 \textcolor{preprocessor}{}    \textcolor{comment}{// AC: TODO: fix bug here: size of t\_disp\_buffer should not be multiplied by max\_nth!}
3013     \textcolor{keywordtype}{char} *ptr = \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(max\_nth *
3014                             ( \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) + \textcolor{keyword}{sizeof}(
      \hyperlink{structdispatch__shared__info}{dispatch\_shared\_info\_t})*num\_disp\_buf
3015                                + \textcolor{keyword}{sizeof}(\hyperlink{structkmp__disp}{kmp\_disp\_t}) + \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})*6
3016                                \textcolor{comment}{//+ sizeof(int)}
3017                                + \textcolor{keyword}{sizeof}(\hyperlink{structkmp__r__sched}{kmp\_r\_sched\_t})
3018                                + \textcolor{keyword}{sizeof}(\hyperlink{structkmp__taskdata}{kmp\_taskdata\_t}) ) );
3019 
3020     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads          = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}**) ptr; ptr += \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) * max\_nth;
3021     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer      = (\hyperlink{structdispatch__shared__info}{dispatch\_shared\_info\_t}*) ptr;
3022                                    ptr += \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a77f9babc5a9999a105d305f27cf46d70}{dispatch\_shared\_info\_t}) * 
      num\_disp\_buff;
3023     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch         = (\hyperlink{structkmp__disp}{kmp\_disp\_t}*) ptr; ptr += \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a125b055d611c51e55aa0b0819c1a5f33}{kmp\_disp\_t}) * max\_nth;
3024     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_nproc        = (\textcolor{keywordtype}{int}*) ptr; ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3025     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_dynamic      = (\textcolor{keywordtype}{int}*) ptr; ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3026     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_nested       = (\textcolor{keywordtype}{int}*) ptr; ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3027     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_blocktime    = (\textcolor{keywordtype}{int}*) ptr; ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3028     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_bt\_intervals = (\textcolor{keywordtype}{int}*) ptr; ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3029     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_bt\_set       = (\textcolor{keywordtype}{int}*) ptr;
3030     ptr += \textcolor{keyword}{sizeof}(\hyperlink{ittnotify__static_8h_a8b8dcd723308a8cb5d84277c7a3fff70}{int}) * max\_nth;
3031     \textcolor{comment}{//team->t.t\_set\_max\_active\_levels = (int*) ptr; ptr += sizeof(int) * max\_nth;}
3032     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_set\_sched        = (\hyperlink{structkmp__r__sched}{kmp\_r\_sched\_t}*) ptr;
3033     ptr += \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a71396c1b9a5e1f45d20c0617948ce646}{kmp\_r\_sched\_t}) * max\_nth;
3034     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata = (\hyperlink{structkmp__taskdata}{kmp\_taskdata\_t}*) ptr;
3035     ptr += \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_af73aa077ec760ca83750f8144a5e65fb}{kmp\_taskdata\_t}) * max\_nth;
3036 \textcolor{preprocessor}{#else}
3037 \textcolor{preprocessor}{}
3038     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}**) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) * max\_nth );
3039     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer = (\hyperlink{structdispatch__shared__info}{dispatch\_shared\_info\_t}*)
3040         \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(\hyperlink{structdispatch__shared__info}{dispatch\_shared\_info\_t}) * num\_disp\_buff 
      );
3041     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch = (\hyperlink{structkmp__disp}{kmp\_disp\_t}*) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(
      \hyperlink{structkmp__disp}{kmp\_disp\_t}) * max\_nth );
3042     \textcolor{comment}{//team->t.t\_set\_max\_active\_levels = (int*) \_\_kmp\_allocate( sizeof(int) * max\_nth );}
3043     \textcolor{comment}{//team->t.t\_set\_sched = (kmp\_r\_sched\_t*) \_\_kmp\_allocate( sizeof(kmp\_r\_sched\_t) * max\_nth );}
3044     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata = (\hyperlink{structkmp__taskdata}{kmp\_taskdata\_t}*) 
      \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(\hyperlink{structkmp__taskdata}{kmp\_taskdata\_t}) * max\_nth );
3045 \textcolor{preprocessor}{#endif}
3046 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc = max\_nth;
3047 
3048     \textcolor{comment}{/* setup dispatch buffers */}
3049     \textcolor{keywordflow}{for}(i = 0 ; i < num\_disp\_buff; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \{
3050         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}].buffer\_index = \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
3051 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
3052 \textcolor{preprocessor}{}        team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}].doacross\_buf\_idx = \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
3053 \textcolor{preprocessor}{#endif}
3054 \textcolor{preprocessor}{}    \}
3055 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aa26d2dfa84cff79bae57f1141c5d4d80}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-info\-\_\-t}$\ast$ \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{new\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aa26d2dfa84cff79bae57f1141c5d4d80}


Definition at line 4177 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), and \-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads().


\begin{DoxyCode}
4178 \{
4179     \hyperlink{unionkmp__team}{kmp\_team\_t}  *serial\_team;
4180     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}  *new\_thr;
4181     \textcolor{keywordtype}{int}          new\_gtid;
4182 
4183     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: T#%d\(\backslash\)n"}, \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}() ));
4184     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root && team );
4185 \textcolor{preprocessor}{#if !KMP\_NESTED\_HOT\_TEAMS}
4186 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a996fe75425730b06ff88477bf72b8134}{KMP\_MASTER\_GTID}( 
      \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}() ));
4187 \textcolor{preprocessor}{#endif}
4188 \textcolor{preprocessor}{}    \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4189 
4190     \textcolor{comment}{/* first, try to get one from the thread pool */}
4191     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} ) \{
4192 
4193         new\_thr = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*)\hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool};
4194         \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} = (\textcolor{keyword}{volatile} \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *) new\_thr->th.th\_next\_pool;
4195         if ( new\_thr == \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} ) \{
4196             \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} = NULL;
4197         \}
4198         \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(new\_thr->th.th\_in\_pool, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
4199         \textcolor{comment}{//}
4200         \textcolor{comment}{// Don't touch th\_active\_in\_pool or th\_active.}
4201         \textcolor{comment}{// The worker thread adjusts those flags as it sleeps/awakens.}
4202         \textcolor{comment}{//}
4203         \hyperlink{kmp_8h_ab77f7a31d04d2d654e78546530b71ab9}{\_\_kmp\_thread\_pool\_nth}--;
4204 
4205         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: T#%d using thread T#%d\(\backslash\)n"},
4206                     \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), new\_thr->th.th\_info.ds.ds\_gtid ));
4207         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(       ! new\_thr->th.th\_team );
4208         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} < 
      \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} );
4209         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_ab77f7a31d04d2d654e78546530b71ab9}{\_\_kmp\_thread\_pool\_nth} >= 0 );
4210 
4211         \textcolor{comment}{/* setup the thread structure */}
4212         \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\_\_kmp\_initialize\_info}( new\_thr, team, new\_tid, new\_thr->th.th\_info.ds.ds\_gtid 
      );
4213         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_thr->th.th\_serial\_team );
4214 
4215         \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}, \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + 1);
4216 
4217         new\_thr->th.th\_task\_state = 0;
4218         new\_thr->th.th\_task\_state\_top = 0;
4219         new\_thr->th.th\_task\_state\_stack\_sz = 4;
4220 
4221 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
4222 \textcolor{preprocessor}{}        \textcolor{comment}{/* Adjust blocktime back to zero if necessar      y */}
4223         \textcolor{comment}{/* Middle initialization might not have occurred yet */}
4224         \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
4225             \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} > \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
4226                 \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
4227             \}
4228         \}
4229 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
4230 \textcolor{preprocessor}{}
4231 \textcolor{preprocessor}{#if KMP\_DEBUG}
4232 \textcolor{preprocessor}{}        \textcolor{comment}{// If thread entered pool via \_\_kmp\_free\_thread, wait\_flag should != KMP\_BARRIER\_PARENT\_FLAG.}
4233         \textcolor{keywordtype}{int} b;
4234         \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = new\_thr->th.th\_bar;
4235         \textcolor{keywordflow}{for}( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b )
4236             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[b].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
4237 \textcolor{preprocessor}{#endif}
4238 \textcolor{preprocessor}{}
4239         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: T#%d using thread %p T#%d\(\backslash\)n"},
4240                     \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), new\_thr, new\_thr->th.th\_info.ds.ds\_gtid ));
4241 
4242         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4243         \textcolor{keywordflow}{return} new\_thr;
4244     \}
4245 
4246 
4247     \textcolor{comment}{/* no, well fork a new one */}
4248     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}    == \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} );
4249     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} );
4250 
4251     \textcolor{comment}{//}
4252     \textcolor{comment}{// If this is the first worker thread the RTL is creating, then also}
4253     \textcolor{comment}{// launch the monitor thread.  We try to do this as early as possible.}
4254     \textcolor{comment}{//}
4255     \textcolor{keywordflow}{if} ( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor} ) ) \{
4256         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
4257         \textcolor{keywordflow}{if} ( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor} ) ) \{
4258             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"before \_\_kmp\_create\_monitor\(\backslash\)n"} ) );
4259             \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor}, 1 );
4260             \hyperlink{kmp_8h_a54a5fa38300ab3405a01195544ae4609}{\_\_kmp\_create\_monitor}( & \hyperlink{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}{\_\_kmp\_monitor} );
4261             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"after \_\_kmp\_create\_monitor\(\backslash\)n"} ) );
4262 \textcolor{preprocessor}{            #if KMP\_OS\_WINDOWS}
4263 \textcolor{preprocessor}{}                \textcolor{comment}{// AC: wait until monitor has started. This is a fix for CQ232808.}
4264                 \textcolor{comment}{//     The reason is that if the library is loaded/unloaded in a loop with small (parallel)}
4265                 \textcolor{comment}{//     work in between, then there is high probability that monitor thread started after}
4266                 \textcolor{comment}{//     the library shutdown. At shutdown it is too late to cope with the problem, because}
4267                 \textcolor{comment}{//     when the master is in DllMain (process detach) the monitor has no chances to start}
4268                 \textcolor{comment}{//     (it is blocked), and master has no means to inform the monitor that the library has
       gone,}
4269                 \textcolor{comment}{//     because all the memory which the monitor can access is going to be released/reset.}
4270                 \textcolor{keywordflow}{while} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor}) < 2 ) \{
4271                     \hyperlink{kmp_8h_a9f0d88d1970adda4ad38d272e65d7844}{KMP\_YIELD}( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
4272                 \}
4273                 \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"after monitor thread has started\(\backslash\)n"} ) );
4274 \textcolor{preprocessor}{            #endif}
4275 \textcolor{preprocessor}{}        \}
4276         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
4277     \}
4278 
4279     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4280     \textcolor{keywordflow}{for}( new\_gtid=1 ; \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[new\_gtid]) != NULL; ++new\_gtid ) \{
4281         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_gtid < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} );
4282     \}
4283 
4284     \textcolor{comment}{/* allocate space for it. */}
4285     new\_thr = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}) );
4286 
4287     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[new\_gtid], new\_thr);
4288 
4289     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
4290         \hyperlink{kmp__runtime_8c_ab34d7ba2a604c6ca0bf177e8e88148a1}{\_\_kmp\_print\_thread\_storage\_map}( new\_thr, new\_gtid );
4291     \}
4292 
4293     \textcolor{comment}{/* add the reserve serialized team, initialized from the team's master thread */}
4294     \{
4295     \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} r\_icvs = 
      \hyperlink{kmp__runtime_8c_a5f124655ad8830498b4dbfd1f5ee8ae1}{\_\_kmp\_get\_x\_global\_icvs}( team );
4296     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: before th\_serial/serial\_team\(\backslash\)n"} ) );
4297 
4298     new\_thr->th.th\_serial\_team = serial\_team =
4299         (\hyperlink{unionkmp__team}{kmp\_team\_t}*) \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}( root, 1, 1,
4300 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
4301                                            0, \textcolor{comment}{// root parallel id}
4302 #endif
4303 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
4304                                            \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default},
4305 #endif
4306                                            &r\_icvs,
4307                                            0 \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
4308     \}
4309     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT} ( serial\_team );
4310     serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized = 0;   \textcolor{comment}{// AC: the team created in reserve, not for execution (it is unused
       for now).}
4311     serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0] = new\_thr;
4312     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: after th\_serial/serial\_team : new\_thr=%p\(\backslash\)n"},
4313       new\_thr ) );
4314 
4315     \textcolor{comment}{/* setup the thread structures */}
4316     \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\_\_kmp\_initialize\_info}( new\_thr, team, new\_tid, new\_gtid );
4317 
4318 \textcolor{preprocessor}{    #if USE\_FAST\_MEMORY}
4319 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a69fe87136a9efb3f397250ae7838f470}{\_\_kmp\_initialize\_fast\_memory}( new\_thr );
4320 \textcolor{preprocessor}{    #endif }\textcolor{comment}{/* USE\_FAST\_MEMORY */}\textcolor{preprocessor}{}
4321 \textcolor{preprocessor}{}
4322 \textcolor{preprocessor}{    #if KMP\_USE\_BGET}
4323 \textcolor{preprocessor}{}        \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_thr->th.th\_local.bget\_data == NULL );
4324         \hyperlink{kmp_8h_adf0ede820c2a58e37d06987be170dde4}{\_\_kmp\_initialize\_bget}( new\_thr );
4325 \textcolor{preprocessor}{    #endif}
4326 \textcolor{preprocessor}{}
4327     \hyperlink{kmp__runtime_8c_a60fcea18938e34651a2bf9f5d15d95fa}{\_\_kmp\_init\_random}( new\_thr );  \textcolor{comment}{// Initialize random number generator}
4328 
4329     \textcolor{comment}{/* Initialize these only once when thread is grabbed for a team allocation */}
4330     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: T#%d init go fork=%u, plain=%u\(\backslash\)n"},
4331                     \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE}, 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} ));
4332 
4333     \textcolor{keywordtype}{int} b;
4334     \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = new\_thr->th.th\_bar;
4335     \textcolor{keywordflow}{for}(b=0; b<\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++b) \{
4336         balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_go = \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE};
4337         balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.team = NULL;
4338         balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.wait\_flag = \hyperlink{kmp_8h_ac784262f4d5effc56b1cf3a205a7c8c1}{KMP\_BARRIER\_NOT\_WAITING};
4339         balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.use\_oncore\_barrier = 0;
4340     \}
4341 
4342     new\_thr->th.th\_spin\_here = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
4343     new\_thr->th.th\_next\_waiting = 0;
4344 
4345 \textcolor{preprocessor}{#if OMP\_40\_ENABLED && KMP\_AFFINITY\_SUPPORTED}
4346 \textcolor{preprocessor}{}    new\_thr->th.th\_current\_place = KMP\_PLACE\_UNDEFINED;
4347     new\_thr->th.th\_new\_place = KMP\_PLACE\_UNDEFINED;
4348     new\_thr->th.th\_first\_place = KMP\_PLACE\_UNDEFINED;
4349     new\_thr->th.th\_last\_place = KMP\_PLACE\_UNDEFINED;
4350 \textcolor{preprocessor}{#endif}
4351 \textcolor{preprocessor}{}
4352     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(new\_thr->th.th\_in\_pool, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
4353     new\_thr->th.th\_active\_in\_pool = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
4354     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(new\_thr->th.th\_active, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
4355 
4356     \textcolor{comment}{/* adjust the global counters */}
4357     \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} ++;
4358     \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} ++;
4359 
4360     \textcolor{comment}{//}
4361     \textcolor{comment}{// if \_\_kmp\_adjust\_gtid\_mode is set, then we use method #1 (sp search)}
4362     \textcolor{comment}{// for low numbers of procs, and method #2 (keyed API call) for higher}
4363     \textcolor{comment}{// numbers of procs.}
4364     \textcolor{comment}{//}
4365     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a5c671e87df31e6aad0b217b0d4ab2bad}{\_\_kmp\_adjust\_gtid\_mode} ) \{
4366         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} >= \hyperlink{kmp_8h_afce1a0df7f7512062fd0494459776dae}{\_\_kmp\_tls\_gtid\_min} ) \{
4367             \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) != 2) \{
4368                 \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}, 2);
4369             \}
4370         \}
4371         \textcolor{keywordflow}{else} \{
4372             \textcolor{keywordflow}{if} (\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) != 1 ) \{
4373                 \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}, 1);
4374             \}
4375         \}
4376     \}
4377 
4378 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
4379 \textcolor{preprocessor}{}    \textcolor{comment}{/* Adjust blocktime back to zero if necessary       */}
4380     \textcolor{comment}{/* Middle initialization might not have occurred yet */}
4381     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
4382         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} > \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
4383             \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
4384         \}
4385     \}
4386 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
4387 \textcolor{preprocessor}{}
4388     \textcolor{comment}{/* actually fork it and create the new worker thread */}
4389     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: before \_\_kmp\_create\_worker: %p\(\backslash\)n"}, new\_thr ));
4390     \hyperlink{kmp_8h_aa0827020920859540910bfb0f89e2584}{\_\_kmp\_create\_worker}( new\_gtid, new\_thr, \hyperlink{kmp_8h_a4524fc3a41e208a6cf6d7cad17f028c7}{\_\_kmp\_stksize} );
4391     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: after \_\_kmp\_create\_worker: %p\(\backslash\)n"}, new\_thr ));
4392 
4393     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_allocate\_thread: T#%d forked T#%d\(\backslash\)n"}, 
      \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), new\_gtid ));
4394     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4395     \textcolor{keywordflow}{return} new\_thr;
4396 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aff85f87b246c4b825005df4d1ba0bb5c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime}}
\index{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{arg, }
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thread, }
\item[{{\bf int}}]{tid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aff85f87b246c4b825005df4d1ba0bb5c}


Definition at line 7485 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-B\-L\-O\-C\-K\-T\-I\-M\-E(), and kmpc\-\_\-set\-\_\-blocktime().


\begin{DoxyCode}
7486 \{
7487     \textcolor{keywordtype}{int} blocktime = arg;        \textcolor{comment}{/* argument is in milliseconds */}
7488     \textcolor{keywordtype}{int} bt\_intervals;
7489     \textcolor{keywordtype}{int} bt\_set;
7490 
7491     \hyperlink{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\_\_kmp\_save\_internal\_controls}( thread );
7492 
7493     \textcolor{comment}{/* Normalize and set blocktime for the teams */}
7494     \textcolor{keywordflow}{if} (blocktime < \hyperlink{kmp_8h_ae98afbaa2e3fc89ff8db0194bbbba120}{KMP\_MIN\_BLOCKTIME})
7495         blocktime = \hyperlink{kmp_8h_ae98afbaa2e3fc89ff8db0194bbbba120}{KMP\_MIN\_BLOCKTIME};
7496     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (blocktime > \hyperlink{kmp_8h_a1ca6c6ce04115f143dc5df627de57958}{KMP\_MAX\_BLOCKTIME})
7497         blocktime = \hyperlink{kmp_8h_a1ca6c6ce04115f143dc5df627de57958}{KMP\_MAX\_BLOCKTIME};
7498 
7499     \hyperlink{kmp_8h_aa620bd2dfc70f332a5c4a282220ece00}{set\_\_blocktime\_team}( thread->th.th\_team, tid, blocktime );
7500     \hyperlink{kmp_8h_aa620bd2dfc70f332a5c4a282220ece00}{set\_\_blocktime\_team}( thread->th.th\_serial\_team, 0, blocktime );
7501 
7502     \textcolor{comment}{/* Calculate and set blocktime intervals for the teams */}
7503     bt\_intervals = \hyperlink{kmp_8h_aa921a5e9487d76bf909f643dfac692c0}{KMP\_INTERVALS\_FROM\_BLOCKTIME}(blocktime, 
      \hyperlink{kmp_8h_a1171057a79f5a42e26d0bd84f6cd707b}{\_\_kmp\_monitor\_wakeups});
7504 
7505     \hyperlink{kmp_8h_a0b6b11b677ec0dd7b7053c5ea279d512}{set\_\_bt\_intervals\_team}( thread->th.th\_team, tid, bt\_intervals );
7506     \hyperlink{kmp_8h_a0b6b11b677ec0dd7b7053c5ea279d512}{set\_\_bt\_intervals\_team}( thread->th.th\_serial\_team, 0, bt\_intervals );
7507 
7508     \textcolor{comment}{/* Set whether blocktime has been set to "TRUE" */}
7509     bt\_set = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
7510 
7511     \hyperlink{kmp_8h_ac2350c72c44a9be1bcc624e4df603418}{set\_\_bt\_set\_team}( thread->th.th\_team, tid, bt\_set );
7512     \hyperlink{kmp_8h_ac2350c72c44a9be1bcc624e4df603418}{set\_\_bt\_set\_team}( thread->th.th\_serial\_team, 0, bt\_set );
7513     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, ( \textcolor{stringliteral}{"kmp\_set\_blocktime: T#%d(%d:%d), blocktime=%d, bt\_intervals=%d,
       monitor\_updates=%d\(\backslash\)n"},
7514                   \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}(tid, thread->th.th\_team),
7515                   thread->th.th\_team->t.t\_id, tid, blocktime, bt\_intervals, 
      \hyperlink{kmp_8h_a1171057a79f5a42e26d0bd84f6cd707b}{\_\_kmp\_monitor\_wakeups} ) );
7516 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a191f7bdba5a1490b964492e96f16a7c9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults}}
\index{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults (
\begin{DoxyParamCaption}
\item[{char const $\ast$}]{str, }
\item[{{\bf int}}]{len}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a191f7bdba5a1490b964492e96f16a7c9}


Definition at line 7519 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-D\-E\-F\-A\-U\-L\-T\-S(), and kmpc\-\_\-set\-\_\-defaults().


\begin{DoxyCode}
7522   \{
7523     \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
7524         \hyperlink{kmp__runtime_8c_adc4261d970464abd5acafefe3a030132}{\_\_kmp\_serial\_initialize}();
7525     \};
7526     \hyperlink{kmp__settings_8c_a7168e645bc1a505e4e1a9df0fd539378}{\_\_kmp\_env\_initialize}( \hyperlink{kmp__ftn__os_8h_a8269f97b2652fc717949a982d7b4f02a}{str} );
7527 
7528     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_aacc3bb748c0b09ecc54f0793eeafdd3c}{\_\_kmp\_settings}
7529 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
7530         || \hyperlink{kmp_8h_a61d0f3a9162659dc28619166a276a00a}{\_\_kmp\_display\_env} || \hyperlink{kmp_8h_a109eb986c34030a5eb186e88abd5b9ea}{\_\_kmp\_display\_env\_verbose}
7531 #endif \textcolor{comment}{// OMP\_40\_ENABLED}
7532         ) \{
7533         \hyperlink{kmp__settings_8c_afd77af5dd5f2224ab1a538751ea43a01}{\_\_kmp\_env\_print}();
7534     \}
7535 \} \textcolor{comment}{// \_\_kmp\_aux\_set\_defaults}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a322e39ae06914545d6ef1532da1df903}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library}}
\index{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library (
\begin{DoxyParamCaption}
\item[{enum {\bf library\-\_\-type}}]{arg}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a322e39ae06914545d6ef1532da1df903}


Definition at line 7459 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-stg\-\_\-parse\-\_\-wait\-\_\-policy(), and \-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library().


\begin{DoxyCode}
7460 \{
7461     \hyperlink{kmp_8h_aa8f77de14d1515a05937d68622e74d61}{\_\_kmp\_library} = arg;
7462 
7463     \textcolor{keywordflow}{switch} ( \hyperlink{kmp_8h_aa8f77de14d1515a05937d68622e74d61}{\_\_kmp\_library} ) \{
7464     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599dab9408e6f6c86c0912aea425b98e37d5a}{library\_serial} :
7465         \{
7466             \hyperlink{kmp__i18n_8h_a2147780dd5e68f541b11db421fe79e4c}{KMP\_INFORM}( LibraryIsSerial );
7467             (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}) \hyperlink{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}{\_\_kmp\_change\_library}( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
7468         \}
7469         \textcolor{keywordflow}{break};
7470     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599daa9ed1bfecb34570e64bff6167eb99f44}{library\_turnaround} :
7471         (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}) \hyperlink{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}{\_\_kmp\_change\_library}( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
7472         \textcolor{keywordflow}{break};
7473     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599daadaa2a9ce75fbdb96025b8f6e9c2a4d7}{library\_throughput} :
7474         (\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}) \hyperlink{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}{\_\_kmp\_change\_library}( \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} );
7475         \textcolor{keywordflow}{break};
7476     \textcolor{keywordflow}{default}:
7477         \hyperlink{kmp__i18n_8h_aaa06fec585285ef7883baea41bfd948f}{KMP\_FATAL}( UnknownLibraryType, arg );
7478     \}
7479 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aa73b3aab19c0682debc4fb436f19c233}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize}}
\index{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize@{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{arg}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aa73b3aab19c0682debc4fb436f19c233}


Definition at line 7425 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-S\-T\-A\-C\-K\-S\-I\-Z\-E(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-S\-T\-A\-C\-K\-S\-I\-Z\-E\-\_\-\-S(), kmpc\-\_\-set\-\_\-stacksize(), and kmpc\-\_\-set\-\_\-stacksize\-\_\-s().


\begin{DoxyCode}
7426 \{
7427     \textcolor{keywordflow}{if} (! \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial})
7428         \hyperlink{kmp__runtime_8c_adc4261d970464abd5acafefe3a030132}{\_\_kmp\_serial\_initialize}();
7429 
7430 \textcolor{preprocessor}{#if KMP\_OS\_DARWIN}
7431 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (arg & (0x1000 - 1)) \{
7432         arg &= ~(0x1000 - 1);
7433         \textcolor{keywordflow}{if}(arg + 0x1000) \textcolor{comment}{/* check for overflow if we round up */}
7434             arg += 0x1000;
7435     \}
7436 \textcolor{preprocessor}{#endif}
7437 \textcolor{preprocessor}{}    \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
7438 
7439     \textcolor{comment}{/* only change the default stacksize before the first parallel region */}
7440     \textcolor{keywordflow}{if} (! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel})) \{
7441         \textcolor{keywordtype}{size\_t} value = arg;       \textcolor{comment}{/* argument is in bytes */}
7442 
7443         \textcolor{keywordflow}{if} (value < \hyperlink{kmp_8h_ac11734b715f1e9aec17fc0eda9cba87c}{\_\_kmp\_sys\_min\_stksize} )
7444             value = \hyperlink{kmp_8h_ac11734b715f1e9aec17fc0eda9cba87c}{\_\_kmp\_sys\_min\_stksize} ;
7445         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (value > \hyperlink{kmp_8h_a0f439bcfd1eaa9b1853f39766a1f1e80}{KMP\_MAX\_STKSIZE})
7446             value = \hyperlink{kmp_8h_a0f439bcfd1eaa9b1853f39766a1f1e80}{KMP\_MAX\_STKSIZE};
7447 
7448         \hyperlink{kmp_8h_a4524fc3a41e208a6cf6d7cad17f028c7}{\_\_kmp\_stksize} = value;
7449 
7450         \hyperlink{kmp_8h_afa33d0664a4c46cd1affefab89548901}{\_\_kmp\_env\_stksize} = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};    \textcolor{comment}{/* was KMP\_STACKSIZE specified? */}
7451     \}
7452 
7453     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
7454 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-change\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-change\-\_\-library}}
\index{\-\_\-\-\_\-kmp\-\_\-change\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-change\-\_\-library}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-change\-\_\-library}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-change\-\_\-library (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{status}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a14f7f272dc31e04c2664f58e4afc89a5}


Definition at line 690 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-library().


\begin{DoxyCode}
691 \{
692     \textcolor{keywordtype}{int} old\_status;
693 
694     old\_status = \hyperlink{kmp_8h_a94701cc75584d33909a7fff0a10ab4ec}{\_\_kmp\_yield\_init} & 1;  \textcolor{comment}{// check whether KMP\_LIBRARY=throughput (even init
       count)}
695 
696     \textcolor{keywordflow}{if} (\hyperlink{kmp__i18n_8c_a43c2a109a79fef7e46a0836cdac679ff}{status}) \{
697         \hyperlink{kmp_8h_a94701cc75584d33909a7fff0a10ab4ec}{\_\_kmp\_yield\_init} |= 1;  \textcolor{comment}{// throughput => turnaround (odd init count)}
698     \}
699     \textcolor{keywordflow}{else} \{
700         \hyperlink{kmp_8h_a94701cc75584d33909a7fff0a10ab4ec}{\_\_kmp\_yield\_init} &= ~1; \textcolor{comment}{// turnaround => throughput (even init count)}
701     \}
702 
703     \textcolor{keywordflow}{return} old\_status;  \textcolor{comment}{// return previous setting of whether KMP\_LIBRARY=throughput}
704 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4b63532f97caf46394cec269eb671900}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap@{\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap}}
\index{\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap@{\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{th}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a4b63532f97caf46394cec269eb671900}


Definition at line 250 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-create\-\_\-worker(), \-\_\-\-\_\-kmp\-\_\-launch\-\_\-monitor(), and \-\_\-\-\_\-kmp\-\_\-launch\-\_\-worker().


\begin{DoxyCode}
251 \{
252     \textcolor{keywordtype}{int} f;
253     \textcolor{keywordtype}{char} *stack\_beg = NULL;
254     \textcolor{keywordtype}{char} *stack\_end = NULL;
255     \textcolor{keywordtype}{int} gtid;
256 
257     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10,(\textcolor{stringliteral}{"\_\_kmp\_check\_stack\_overlap: called\(\backslash\)n"}));
258     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
259         stack\_end = (\textcolor{keywordtype}{char} *) th->th.th\_info.ds.ds\_stackbase;
260         stack\_beg = stack\_end - th->th.th\_info.ds.ds\_stacksize;
261 
262         gtid = \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( th );
263 
264         \textcolor{keywordflow}{if} (gtid == \hyperlink{kmp_8h_a5eb958603bc237a3484be5bd2b0de39a}{KMP\_GTID\_MONITOR}) \{
265             \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, stack\_beg, stack\_end, th->th.
      th\_info.ds.ds\_stacksize,
266                                      \textcolor{stringliteral}{"th\_%s stack (%s)"}, \textcolor{stringliteral}{"mon"},
267                                      ( th->th.th\_info.ds.ds\_stackgrow ) ? \textcolor{stringliteral}{"initial"} : \textcolor{stringliteral}{"actual"} );
268         \} \textcolor{keywordflow}{else} \{
269             \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, stack\_beg, stack\_end, th->th.
      th\_info.ds.ds\_stacksize,
270                                      \textcolor{stringliteral}{"th\_%d stack (%s)"}, gtid,
271                                      ( th->th.th\_info.ds.ds\_stackgrow ) ? \textcolor{stringliteral}{"initial"} : \textcolor{stringliteral}{"actual"} );
272         \}
273     \}
274 
275     \textcolor{comment}{/* No point in checking ubermaster threads since they use refinement and cannot overlap */}
276     gtid = \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( th );
277     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a45cb359b55a6b7cbd66e26f4983195f2}{\_\_kmp\_env\_checks} == \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} && !\hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}(gtid))
278     \{
279         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10,(\textcolor{stringliteral}{"\_\_kmp\_check\_stack\_overlap: performing extensive checking\(\backslash\)n"}));
280         \textcolor{keywordflow}{if} ( stack\_beg == NULL ) \{
281             stack\_end = (\textcolor{keywordtype}{char} *) th->th.th\_info.ds.ds\_stackbase;
282             stack\_beg = stack\_end - th->th.th\_info.ds.ds\_stacksize;
283         \}
284 
285         \textcolor{keywordflow}{for}( f=0 ; f < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} ; f++ ) \{
286             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *f\_th = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *)\hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}(
      \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[f]);
287 
288             \textcolor{keywordflow}{if}( f\_th && f\_th != th ) \{
289                 \textcolor{keywordtype}{char} *other\_stack\_end = (\textcolor{keywordtype}{char} *)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(f\_th->th.th\_info.ds.ds\_stackbase);
290                 \textcolor{keywordtype}{char} *other\_stack\_beg = other\_stack\_end -
291                                         (size\_t)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(f\_th->th.th\_info.ds.ds\_stacksize);
292                 \textcolor{keywordflow}{if}((stack\_beg > other\_stack\_beg && stack\_beg < other\_stack\_end) ||
293                    (stack\_end > other\_stack\_beg && stack\_end < other\_stack\_end)) \{
294 
295                     \textcolor{comment}{/* Print the other stack values before the abort */}
296                     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} )
297                         \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, other\_stack\_beg, 
      other\_stack\_end,
298                             (\textcolor{keywordtype}{size\_t})\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(f\_th->th.th\_info.ds.ds\_stacksize),
299                             \textcolor{stringliteral}{"th\_%d stack (overlapped)"},
300                                                  \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( f\_th ) );
301 
302                     \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}( \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060aac29006d355ede42e04f48ccd9c23f98}{kmp\_ms\_fatal}, \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( StackOverlap ), 
      \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( ChangeStackLimit ), \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null} );
303                 \}
304             \}
305         \}
306     \}
307     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10,(\textcolor{stringliteral}{"\_\_kmp\_check\_stack\_overlap: returning\(\backslash\)n"}));
308 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_afb0978e7a9bd0e5f91d089c4571e618f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-cleanup@{\-\_\-\-\_\-kmp\-\_\-cleanup}}
\index{\-\_\-\-\_\-kmp\-\_\-cleanup@{\-\_\-\-\_\-kmp\-\_\-cleanup}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-cleanup}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-cleanup (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_afb0978e7a9bd0e5f91d089c4571e618f}


Definition at line 7255 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end(), and \-\_\-\-\_\-kmp\-\_\-launch\-\_\-monitor().


\begin{DoxyCode}
7256 \{
7257     \textcolor{keywordtype}{int} f;
7258 
7259     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_cleanup: enter\(\backslash\)n"} ) );
7260 
7261     \textcolor{keywordflow}{if} (\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel})) \{
7262 \textcolor{preprocessor}{#if KMP\_HANDLE\_SIGNALS}
7263 \textcolor{preprocessor}{}        \_\_kmp\_remove\_signals();
7264 \textcolor{preprocessor}{#endif}
7265 \textcolor{preprocessor}{}        \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
7266     \}
7267 
7268     \textcolor{keywordflow}{if} (\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle})) \{
7269 \textcolor{preprocessor}{#if KMP\_AFFINITY\_SUPPORTED}
7270 \textcolor{preprocessor}{}        \_\_kmp\_affinity\_uninitialize();
7271 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
7272 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_ae1270304d33ab083a416e67cab92dafc}{\_\_kmp\_cleanup\_hierarchy}();
7273         \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle}, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
7274     \}
7275 
7276     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_cleanup: go serial cleanup\(\backslash\)n"} ) );
7277 
7278     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial}) \{
7279         \hyperlink{kmp_8h_ab5834eff1e783726ba2a6a32133617cc}{\_\_kmp\_runtime\_destroy}();
7280         \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
7281     \}
7282 
7283     \textcolor{keywordflow}{for} ( f = 0; f < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; f++ ) \{
7284         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[ f ] != NULL ) \{
7285             \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[ f ] );
7286             \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[ f ] = NULL;
7287         \}
7288     \}
7289     \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} );
7290     \textcolor{comment}{// \_\_kmp\_threads and \_\_kmp\_root were allocated at once, as single block, so there is no need in}
7291     \textcolor{comment}{// freeing \_\_kmp\_root.}
7292     \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} = NULL;
7293     \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}    = NULL;
7294     \_\_kmp\_threads\_capacity = 0;
7295 
7296 \textcolor{preprocessor}{#if KMP\_USE\_DYNAMIC\_LOCK}
7297 \textcolor{preprocessor}{}    \_\_kmp\_cleanup\_indirect\_user\_locks();
7298 \textcolor{preprocessor}{#else}
7299 \textcolor{preprocessor}{}    \hyperlink{kmp__lock_8cpp_ab6344f2921c6935ec0e25e8e26719ea9}{\_\_kmp\_cleanup\_user\_locks}();
7300 \textcolor{preprocessor}{#endif}
7301 \textcolor{preprocessor}{}
7302 \textcolor{preprocessor}{    #if KMP\_AFFINITY\_SUPPORTED}
7303 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( (\textcolor{keywordtype}{void} *) \_\_kmp\_cpuinfo\_file );
7304         \_\_kmp\_cpuinfo\_file = NULL;
7305 \textcolor{preprocessor}{    #endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
7306 \textcolor{preprocessor}{}
7307 \textcolor{preprocessor}{   #if KMP\_USE\_ADAPTIVE\_LOCKS}
7308 \textcolor{preprocessor}{}\textcolor{preprocessor}{   #if KMP\_DEBUG\_ADAPTIVE\_LOCKS}
7309 \textcolor{preprocessor}{}       \_\_kmp\_print\_speculative\_stats();
7310 \textcolor{preprocessor}{   #endif}
7311 \textcolor{preprocessor}{}\textcolor{preprocessor}{   #endif}
7312 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth} );
7313     \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth} = NULL;
7314     \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_adee4be6710fdc135bda1098d9f61458e}{size} = 0;
7315     \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} = 0;
7316 
7317     \hyperlink{kmp__i18n_8h_ada981a9811dd5a47f2b11405f2b9ea79}{\_\_kmp\_i18n\_catclose}();
7318 
7319 \textcolor{preprocessor}{#if KMP\_STATS\_ENABLED}
7320 \textcolor{preprocessor}{}    \hyperlink{kmp__stats_8cpp_abf4b218473f9d0bf9e4bade280e20a57}{\_\_kmp\_accumulate\_stats\_at\_exit}();
7321     \hyperlink{kmp__global_8c_a4ce412fd3335747984f4b5d8fa62cb98}{\_\_kmp\_stats\_list}.\hyperlink{classkmp__stats__list_a0e847043a942149b86455a21d30d3719}{deallocate}();
7322 \textcolor{preprocessor}{#endif}
7323 \textcolor{preprocessor}{}
7324     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_cleanup: exit\(\backslash\)n"} ) );
7325 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7735d7d58a02a05dbfebda565f97c80c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method@{\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method}}
\index{\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method@{\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method}]{\setlength{\rightskip}{0pt plus 5cm}{\bf P\-A\-C\-K\-E\-D\-\_\-\-R\-E\-D\-U\-C\-T\-I\-O\-N\-\_\-\-M\-E\-T\-H\-O\-D\-\_\-\-T} \-\_\-\-\_\-kmp\-\_\-determine\-\_\-reduction\-\_\-method (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{kmp\-\_\-int32}]{num\-\_\-vars, }
\item[{size\-\_\-t}]{reduce\-\_\-size, }
\item[{{\bf void} $\ast$}]{reduce\-\_\-data, }
\item[{{\bf void}($\ast$)({\bf void} $\ast$lhs\-\_\-data, {\bf void} $\ast$rhs\-\_\-data)}]{reduce\-\_\-func, }
\item[{{\bf kmp\-\_\-critical\-\_\-name} $\ast$}]{lck}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a7735d7d58a02a05dbfebda565f97c80c}


Definition at line 7544 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-reduce(), and \-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait().


\begin{DoxyCode}
7547 \{
7548 
7549     \textcolor{comment}{// Default reduction method: critical construct ( lck != NULL, like in current PAROPT )}
7550     \textcolor{comment}{// If ( reduce\_data!=NULL && reduce\_func!=NULL ): the tree-reduction method can be selected by RTL}
7551     \textcolor{comment}{// If loc->flags contains KMP\_IDENT\_ATOMIC\_REDUCE, the atomic reduce method can be selected by RTL}
7552     \textcolor{comment}{// Finally, it's up to OpenMP RTL to make a decision on which method to select among generated by
       PAROPT.}
7553 
7554     \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} retval;
7555 
7556     \textcolor{keywordtype}{int} team\_size;
7557 
7558     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( loc );    \textcolor{comment}{// it would be nice to test ( loc != 0 )}
7559     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( lck );    \textcolor{comment}{// it would be nice to test ( lck != 0 )}
7560 
7561 \textcolor{preprocessor}{    #define FAST\_REDUCTION\_ATOMIC\_METHOD\_GENERATED ( ( loc->flags & ( KMP\_IDENT\_ATOMIC\_REDUCE ) ) == (
       KMP\_IDENT\_ATOMIC\_REDUCE ) )}
7562 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #define FAST\_REDUCTION\_TREE\_METHOD\_GENERATED   ( ( reduce\_data ) && ( reduce\_func ) )}
7563 \textcolor{preprocessor}{}
7564     retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block};
7565 
7566     team\_size = \hyperlink{kmp_8h_a97973244db64dfa53270b1e706580711}{\_\_kmp\_get\_team\_num\_threads}( global\_tid ); \textcolor{comment}{// another choice of
       getting a team size ( with 1 dynamic deference ) is slower}
7567 
7568     \textcolor{keywordflow}{if}( team\_size == 1 ) \{
7569 
7570         retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a28cf3671c5c01e773c7040204b6e8bb5}{empty\_reduce\_block};
7571 
7572     \} \textcolor{keywordflow}{else} \{
7573 
7574         \textcolor{keywordtype}{int} atomic\_available = \hyperlink{kmp__runtime_8c_a6b1fe521d023b646aa4cd9fd55a2ab6f}{FAST\_REDUCTION\_ATOMIC\_METHOD\_GENERATED}
      ;
7575         \textcolor{keywordtype}{int} tree\_available   = \hyperlink{kmp__runtime_8c_a92ac7fe90ec3149f4131e9fb6672d8ef}{FAST\_REDUCTION\_TREE\_METHOD\_GENERATED};
7576 
7577 \textcolor{preprocessor}{        #if KMP\_ARCH\_X86\_64 || KMP\_ARCH\_PPC64 || KMP\_ARCH\_AARCH64}
7578 \textcolor{preprocessor}{}
7579 \textcolor{preprocessor}{            #if KMP\_OS\_LINUX || KMP\_OS\_FREEBSD || KMP\_OS\_NETBSD || KMP\_OS\_WINDOWS || KMP\_OS\_DARWIN}
7580 \textcolor{preprocessor}{}
7581             \textcolor{keywordtype}{int} teamsize\_cutoff = 4;
7582 
7583 \textcolor{preprocessor}{#if KMP\_ARCH\_X86\_64 && (KMP\_OS\_LINUX || KMP\_OS\_WINDOWS)}
7584 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if}( \_\_kmp\_mic\_type != non\_mic ) \{
7585                     teamsize\_cutoff = 8;
7586                 \}
7587 \textcolor{preprocessor}{#endif}
7588 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if}( tree\_available ) \{
7589                     \textcolor{keywordflow}{if}( team\_size <= teamsize\_cutoff ) \{
7590                         \textcolor{keywordflow}{if} ( atomic\_available ) \{
7591                             retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block};
7592                         \}
7593                     \} \textcolor{keywordflow}{else} \{
7594                         retval = \hyperlink{kmp_8h_ade1af53a659efba445adeefc65965756}{TREE\_REDUCE\_BLOCK\_WITH\_REDUCTION\_BARRIER}
      ;
7595                     \}
7596                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( atomic\_available ) \{
7597                     retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block};
7598                 \}
7599 \textcolor{preprocessor}{            #else}
7600 \textcolor{preprocessor}{}\textcolor{preprocessor}{                #error "Unknown or unsupported OS"}
7601 \textcolor{preprocessor}{}\textcolor{preprocessor}{            #endif // KMP\_OS\_LINUX || KMP\_OS\_FREEBSD || KMP\_OS\_NETBSD || KMP\_OS\_WINDOWS || KMP\_OS\_DARWIN}
7602 \textcolor{preprocessor}{}
7603 \textcolor{preprocessor}{        #elif KMP\_ARCH\_X86 || KMP\_ARCH\_ARM || KMP\_ARCH\_AARCH}
7604 \textcolor{preprocessor}{}
7605 \textcolor{preprocessor}{            #if KMP\_OS\_LINUX || KMP\_OS\_WINDOWS}
7606 \textcolor{preprocessor}{}
7607                 \textcolor{comment}{// basic tuning}
7608 
7609                 \textcolor{keywordflow}{if}( atomic\_available ) \{
7610                     \textcolor{keywordflow}{if}( num\_vars <= 2 ) \{ \textcolor{comment}{// && ( team\_size <= 8 ) due to false-sharing ???}
7611                         retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block};
7612                     \}
7613                 \} \textcolor{comment}{// otherwise: use critical section}
7614 
7615 \textcolor{preprocessor}{            #elif KMP\_OS\_DARWIN}
7616 \textcolor{preprocessor}{}
7617                 \textcolor{keywordflow}{if}( atomic\_available && ( num\_vars <= 3 ) ) \{
7618                         retval = \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block};
7619                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( tree\_available ) \{
7620                     \textcolor{keywordflow}{if}( ( reduce\_size > ( 9 * \textcolor{keyword}{sizeof}( \hyperlink{kmp__os_8h_ae84e3ce68452993c40826056c50a7f7c}{kmp\_real64} ) ) ) && ( reduce\_size < ( 2000 
      * \textcolor{keyword}{sizeof}( \hyperlink{kmp__os_8h_ae84e3ce68452993c40826056c50a7f7c}{kmp\_real64} ) ) ) ) \{
7621                         retval = \hyperlink{kmp_8h_a116533dc64ba7c76a42ef6f192568002}{TREE\_REDUCE\_BLOCK\_WITH\_PLAIN\_BARRIER};
7622                     \}
7623                 \} \textcolor{comment}{// otherwise: use critical section}
7624 
7625 \textcolor{preprocessor}{            #else}
7626 \textcolor{preprocessor}{}\textcolor{preprocessor}{                #error "Unknown or unsupported OS"}
7627 \textcolor{preprocessor}{}\textcolor{preprocessor}{            #endif}
7628 \textcolor{preprocessor}{}
7629 \textcolor{preprocessor}{        #else}
7630 \textcolor{preprocessor}{}\textcolor{preprocessor}{            #error "Unknown or unsupported architecture"}
7631 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #endif}
7632 \textcolor{preprocessor}{}
7633     \}
7634 
7635     \textcolor{comment}{// KMP\_FORCE\_REDUCTION}
7636 
7637     \textcolor{comment}{// If the team is serialized (team\_size == 1), ignore the forced reduction}
7638     \textcolor{comment}{// method and stay with the unsynchronized method (empty\_reduce\_block)}
7639     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_adace11dc9ef1b5659751c0a61c6c19df}{\_\_kmp\_force\_reduction\_method} != 
      \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306adc8ac26b122d8da0aee453f08def59fc}{reduction\_method\_not\_defined} && team\_size != 1) \{
7640 
7641         \hyperlink{kmp_8h_a79cdcd03cc0f2498719630411d56ef84}{PACKED\_REDUCTION\_METHOD\_T} forced\_retval;
7642 
7643         \textcolor{keywordtype}{int} atomic\_available, tree\_available;
7644 
7645         \textcolor{keywordflow}{switch}( ( forced\_retval = \hyperlink{kmp_8h_adace11dc9ef1b5659751c0a61c6c19df}{\_\_kmp\_force\_reduction\_method} ) )
7646         \{
7647             \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a2c5ad9d5d2b242bce894255d63ee550e}{critical\_reduce\_block}:
7648                 \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( lck );              \textcolor{comment}{// lck should be != 0}
7649                 \textcolor{keywordflow}{break};
7650 
7651             \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306ae4e1bd6637deb8f7d8098584a432aa0b}{atomic\_reduce\_block}:
7652                 atomic\_available = \hyperlink{kmp__runtime_8c_a6b1fe521d023b646aa4cd9fd55a2ab6f}{FAST\_REDUCTION\_ATOMIC\_METHOD\_GENERATED}
      ;
7653                 \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( atomic\_available ); \textcolor{comment}{// atomic\_available should be != 0}
7654                 \textcolor{keywordflow}{break};
7655 
7656             \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aef090e4cbee673db380b81f6deb8e306a7e21547b06d81d12a9b3293f3059b973}{tree\_reduce\_block}:
7657                 tree\_available = \hyperlink{kmp__runtime_8c_a92ac7fe90ec3149f4131e9fb6672d8ef}{FAST\_REDUCTION\_TREE\_METHOD\_GENERATED};
7658                 \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( tree\_available );   \textcolor{comment}{// tree\_available should be != 0}
7659 \textcolor{preprocessor}{                #if KMP\_FAST\_REDUCTION\_BARRIER}
7660 \textcolor{preprocessor}{}                forced\_retval = \hyperlink{kmp_8h_ade1af53a659efba445adeefc65965756}{TREE\_REDUCE\_BLOCK\_WITH\_REDUCTION\_BARRIER}
      ;
7661 \textcolor{preprocessor}{                #endif}
7662 \textcolor{preprocessor}{}                \textcolor{keywordflow}{break};
7663 
7664             \textcolor{keywordflow}{default}:
7665                 \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 ); \textcolor{comment}{// "unsupported method specified"}
7666         \}
7667 
7668         retval = forced\_retval;
7669     \}
7670 
7671     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, ( \textcolor{stringliteral}{"reduction method selected=%08x\(\backslash\)n"}, retval ) );
7672 
7673 \textcolor{preprocessor}{    #undef FAST\_REDUCTION\_TREE\_METHOD\_GENERATED}
7674 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #undef FAST\_REDUCTION\_ATOMIC\_METHOD\_GENERATED}
7675 \textcolor{preprocessor}{}
7676     \textcolor{keywordflow}{return} ( retval );
7677 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4d6565c9ee276582946d645c8c67986e}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize}}
\index{\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a4d6565c9ee276582946d645c8c67986e}


Definition at line 6607 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize(), and \-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize().


\begin{DoxyCode}
6608 \{
6609     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}, j;
6610     \textcolor{keywordtype}{int} prev\_dflt\_team\_nth;
6611 
6612     \textcolor{keywordflow}{if}( !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
6613         \hyperlink{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}{\_\_kmp\_do\_serial\_initialize}();
6614     \}
6615 
6616     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_middle\_initialize: enter\(\backslash\)n"} ) );
6617 
6618     \textcolor{comment}{//}
6619     \textcolor{comment}{// Save the previous value for the \_\_kmp\_dflt\_team\_nth so that}
6620     \textcolor{comment}{// we can avoid some reinitialization if it hasn't changed.}
6621     \textcolor{comment}{//}
6622     prev\_dflt\_team\_nth = \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth};
6623 
6624 \textcolor{preprocessor}{#if KMP\_AFFINITY\_SUPPORTED}
6625 \textcolor{preprocessor}{}    \textcolor{comment}{//}
6626     \textcolor{comment}{// \_\_kmp\_affinity\_initialize() will try to set \_\_kmp\_ncores to the}
6627     \textcolor{comment}{// number of cores on the machine.}
6628     \textcolor{comment}{//}
6629     \_\_kmp\_affinity\_initialize();
6630 
6631     \textcolor{comment}{//}
6632     \textcolor{comment}{// Run through the \_\_kmp\_threads array and set the affinity mask}
6633     \textcolor{comment}{// for each root thread that is currently registered with the RTL.}
6634     \textcolor{comment}{//}
6635     \textcolor{keywordflow}{for} ( i = 0; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; i++ ) \{
6636         \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ i ] ) != NULL ) \{
6637             \_\_kmp\_affinity\_set\_init\_mask( i, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
6638         \}
6639     \}
6640 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
6641 \textcolor{preprocessor}{}
6642     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a3469a7dffedccf219ec6b8a0e4ec8ed2}{\_\_kmp\_xproc} > 0 );
6643     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} == 0 ) \{
6644         \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} = \hyperlink{kmp_8h_a3469a7dffedccf219ec6b8a0e4ec8ed2}{\_\_kmp\_xproc};
6645     \}
6646 
6647     \textcolor{comment}{// If there were empty places in num\_threads list (OMP\_NUM\_THREADS=,,2,3), correct them now}
6648     j = 0;
6649     \textcolor{keywordflow}{while} ( ( j < \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} ) && ! 
      \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[ j ] ) \{
6650         \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[ j ] = \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} = 
      \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} = \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc};
6651         j++;
6652     \}
6653 
6654     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} == 0 ) \{
6655 \textcolor{preprocessor}{#ifdef KMP\_DFLT\_NTH\_CORES}
6656 \textcolor{preprocessor}{}        \textcolor{comment}{//}
6657         \textcolor{comment}{// Default #threads = #cores}
6658         \textcolor{comment}{//}
6659         \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} = \_\_kmp\_ncores;
6660         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_middle\_initialize: setting \_\_kmp\_dflt\_team\_nth = \_\_kmp\_ncores (%d)\(\backslash\)n"}
      ,
6661           \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} ) );
6662 \textcolor{preprocessor}{#else}
6663 \textcolor{preprocessor}{}        \textcolor{comment}{//}
6664         \textcolor{comment}{// Default #threads = #available OS procs}
6665         \textcolor{comment}{//}
6666         \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} = \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc};
6667         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_middle\_initialize: setting \_\_kmp\_dflt\_team\_nth = \_\_kmp\_avail\_proc(%d)
      \(\backslash\)n"},
6668           \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} ) );
6669 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DFLT\_NTH\_CORES */}\textcolor{preprocessor}{}
6670 \textcolor{preprocessor}{}    \}
6671 
6672     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} < \hyperlink{kmp_8h_a563723425e68875cb8cc1428fcbac483}{KMP\_MIN\_NTH} ) \{
6673         \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} = \hyperlink{kmp_8h_a563723425e68875cb8cc1428fcbac483}{KMP\_MIN\_NTH};
6674     \}
6675     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} > \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth} ) \{
6676         \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} = \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth};
6677     \}
6678 
6679     \textcolor{comment}{//}
6680     \textcolor{comment}{// There's no harm in continuing if the following check fails,}
6681     \textcolor{comment}{// but it indicates an error in the previous logic.}
6682     \textcolor{comment}{//}
6683     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} <= 
      \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} );
6684 
6685     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} != prev\_dflt\_team\_nth ) \{
6686         \textcolor{comment}{//}
6687         \textcolor{comment}{// Run through the \_\_kmp\_threads array and set the num threads icv}
6688         \textcolor{comment}{// for each root thread that is currently registered with the RTL}
6689         \textcolor{comment}{// (which has not already explicitly set its nthreads-var with a}
6690         \textcolor{comment}{// call to omp\_set\_num\_threads()).}
6691         \textcolor{comment}{//}
6692         \textcolor{keywordflow}{for} ( i = 0; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; i++ ) \{
6693             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ];
6694             \textcolor{keywordflow}{if} ( thread == NULL ) \textcolor{keywordflow}{continue};
6695             \textcolor{keywordflow}{if} ( thread->th.th\_current\_task->td\_icvs.nproc != 0 ) \textcolor{keywordflow}{continue};
6696 
6697             \hyperlink{kmp_8h_a528ef662aebf927aa7e586d2ea70bb04}{set\_\_nproc}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ i ], 
      \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} );
6698         \}
6699     \}
6700     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_middle\_initialize: final value for \_\_kmp\_dflt\_team\_nth = %d\(\backslash\)n"},
6701       \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth}) );
6702 
6703 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
6704 \textcolor{preprocessor}{}    \textcolor{comment}{/* Adjust blocktime to zero if necessary */}
6705     \textcolor{comment}{/* now that \_\_kmp\_avail\_proc is set      */}
6706     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
6707         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 );
6708         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} > \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
6709             \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
6710         \}
6711     \}
6712 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
6713 \textcolor{preprocessor}{}
6714     \textcolor{comment}{/* we have finished middle initialization */}
6715     \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle}, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
6716 
6717     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_do\_middle\_initialize: exit\(\backslash\)n"} ) );
6718 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize}}
\index{\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}


Definition at line 6326 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-middle\-\_\-initialize(), \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg(), and \-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize().


\begin{DoxyCode}
6327 \{
6328     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}, gtid;
6329     \textcolor{keywordtype}{int} \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size};
6330 
6331     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_do\_serial\_initialize: enter\(\backslash\)n"} ) );
6332 
6333     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \textcolor{keyword}{sizeof}( kmp\_int32 ) == 4 );
6334     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \textcolor{keyword}{sizeof}( kmp\_uint32 ) == 4 );
6335     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \textcolor{keyword}{sizeof}( kmp\_int64 ) == 8 );
6336     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \textcolor{keyword}{sizeof}( kmp\_uint64 ) == 8 );
6337     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \textcolor{keyword}{sizeof}( \hyperlink{kmp__os_8h_a43fe09095a192381a5e7c93d20a3a2f9}{kmp\_intptr\_t} ) == \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{void} * ) );
6338 
6339 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
6340 \textcolor{preprocessor}{}    \hyperlink{ompt-general_8c_a904f6e7feaaf4bcaf951027c2378c056}{ompt\_pre\_init}();
6341 \textcolor{preprocessor}{#endif}
6342 \textcolor{preprocessor}{}
6343     \hyperlink{kmp__lock_8cpp_acc540f5f662d26296dd6b57ad5fbe198}{\_\_kmp\_validate\_locks}();
6344 
6345     \textcolor{comment}{/* Initialize internal memory allocator */}
6346     \hyperlink{kmp__runtime_8c_a0b1c80696ad8f5e7f3cf131fd8e9eeed}{\_\_kmp\_init\_allocator}();
6347 
6348     \textcolor{comment}{/* Register the library startup via an environment variable}
6349 \textcolor{comment}{       and check to see whether another copy of the library is already}
6350 \textcolor{comment}{       registered. */}
6351 
6352     \hyperlink{kmp__runtime_8c_ac0ef7f6136fa82420b38e14ae9daacc0}{\_\_kmp\_register\_library\_startup}( );
6353 
6354     \textcolor{comment}{/* TODO reinitialization of library */}
6355     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) ) \{
6356        \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_do\_serial\_initialize: reinitialization of library\(\backslash\)n"} ) );
6357     \}
6358 
6359     \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort = 0;
6360     \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
6361 
6362     \textcolor{comment}{/* initialize the locks */}
6363 \textcolor{preprocessor}{#if KMP\_USE\_ADAPTIVE\_LOCKS}
6364 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_DEBUG\_ADAPTIVE\_LOCKS}
6365 \textcolor{preprocessor}{}    \_\_kmp\_init\_speculative\_stats();
6366 \textcolor{preprocessor}{#endif}
6367 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
6368 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_STATS\_ENABLED}
6369 \textcolor{preprocessor}{}    \hyperlink{kmp__lock_8cpp_a6910bddf07333ffb43a964b0c1024cc9}{\_\_kmp\_init\_tas\_lock}( & \hyperlink{kmp__global_8c_a42262d8acf08f12f7bea6affc1673068}{\_\_kmp\_stats\_lock} );
6370 \textcolor{preprocessor}{#endif}
6371 \textcolor{preprocessor}{}    \hyperlink{kmp__lock_8h_a44d857bfef49fda9213da11d71aae54e}{\_\_kmp\_init\_lock}( & \hyperlink{kmp_8h_a56af8af84b1717817c3abe69ecc8cc18}{\_\_kmp\_global\_lock}     );
6372     \hyperlink{kmp__lock_8cpp_a0869739ab886c0aca60907b410b6d3c3}{\_\_kmp\_init\_queuing\_lock}( & \hyperlink{kmp_8h_aa37969d4f501219d1233a226240cd33e}{\_\_kmp\_dispatch\_lock} );
6373     \hyperlink{kmp__lock_8h_a44d857bfef49fda9213da11d71aae54e}{\_\_kmp\_init\_lock}( & \hyperlink{kmp_8h_a1dab06350e4637b725288d9bb536724f}{\_\_kmp\_debug\_lock}      );
6374     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a917d5d190ec8786b54a79e041d2f916a}{\_\_kmp\_atomic\_lock}     );
6375     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_ae4cf18076c9b8b70e3e6234631724655}{\_\_kmp\_atomic\_lock\_1i}  );
6376     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a3e226fc78daba995532675879fc06823}{\_\_kmp\_atomic\_lock\_2i}  );
6377     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a08fdf7dcf239a33099145c76187dd830}{\_\_kmp\_atomic\_lock\_4i}  );
6378     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_afee5fb9d3bd10056ce526896d3ef126e}{\_\_kmp\_atomic\_lock\_4r}  );
6379     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a6cf3b5db5e0375de58b9baf9819ba409}{\_\_kmp\_atomic\_lock\_8i}  );
6380     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a071de2fc37a113ca2c3fd81fee089bb0}{\_\_kmp\_atomic\_lock\_8r}  );
6381     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a00f00ea2df061e8c3bb4b79f48e8f699}{\_\_kmp\_atomic\_lock\_8c}  );
6382     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_abff0e9cfd79dc18171406798536bf543}{\_\_kmp\_atomic\_lock\_10r} );
6383     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_ae5df7c96c9bfb02f6aa16691618a2125}{\_\_kmp\_atomic\_lock\_16r} );
6384     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a2df19c6e1555ce5d33d4f8cb77d5b512}{\_\_kmp\_atomic\_lock\_16c} );
6385     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a217fcb3cacae498df8f49d7e9279405d}{\_\_kmp\_atomic\_lock\_20c} );
6386     \hyperlink{kmp__atomic_8h_ae2b14e109e90b5960f602d02634735b3}{\_\_kmp\_init\_atomic\_lock}( & \hyperlink{kmp__atomic_8c_a6941912d51b6039c512f706674a2fcef}{\_\_kmp\_atomic\_lock\_32c} );
6387     \hyperlink{kmp__lock_8h_ad0724dc0da849eb1ed970306cbf96e7b}{\_\_kmp\_init\_bootstrap\_lock}( & \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock}  );
6388     \hyperlink{kmp__lock_8h_ad0724dc0da849eb1ed970306cbf96e7b}{\_\_kmp\_init\_bootstrap\_lock}( & \hyperlink{kmp_8h_a883c44544832e75b58d897fc0c690142}{\_\_kmp\_exit\_lock}      );
6389     \hyperlink{kmp__lock_8h_ad0724dc0da849eb1ed970306cbf96e7b}{\_\_kmp\_init\_bootstrap\_lock}( & \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock}   );
6390     \hyperlink{kmp__lock_8h_ad0724dc0da849eb1ed970306cbf96e7b}{\_\_kmp\_init\_bootstrap\_lock}( & \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock} );
6391 
6392     \textcolor{comment}{/* conduct initialization and initial setup of configuration */}
6393 
6394     \hyperlink{kmp_8h_ad0680d5e6d1872f505775e7bf61c91f6}{\_\_kmp\_runtime\_initialize}();
6395 
6396 \textcolor{preprocessor}{#if KMP\_ARCH\_X86\_64 && (KMP\_OS\_LINUX || KMP\_OS\_WINDOWS)}
6397 \textcolor{preprocessor}{}    \_\_kmp\_check\_mic\_type();
6398 \textcolor{preprocessor}{#endif}
6399 \textcolor{preprocessor}{}
6400     \textcolor{comment}{// Some global variable initialization moved here from kmp\_env\_initialize()}
6401 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
6402 \textcolor{preprocessor}{}    kmp\_diag = 0;
6403 \textcolor{preprocessor}{#endif}
6404 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a09a41e3c9214c88c4a08c0a12ef022d8}{\_\_kmp\_abort\_delay} = 0;
6405 
6406     \textcolor{comment}{// From \_\_kmp\_init\_dflt\_team\_nth()}
6407     \textcolor{comment}{/* assume the entire machine will be used */}
6408     \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} = \hyperlink{kmp_8h_a3469a7dffedccf219ec6b8a0e4ec8ed2}{\_\_kmp\_xproc};
6409     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} < \hyperlink{kmp_8h_a563723425e68875cb8cc1428fcbac483}{KMP\_MIN\_NTH} ) \{
6410         \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} = \hyperlink{kmp_8h_a563723425e68875cb8cc1428fcbac483}{KMP\_MIN\_NTH};
6411     \}
6412     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} > \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth} ) \{
6413         \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} = \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth};
6414     \}
6415     \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} = \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth};
6416 
6417     \textcolor{comment}{// Three vars below moved here from \_\_kmp\_env\_initialize() "KMP\_BLOCKTIME" part}
6418     \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime} = \hyperlink{kmp_8h_aa5e42269dea39eadc7ce509a5d343aa7}{KMP\_DEFAULT\_BLOCKTIME};
6419     \hyperlink{kmp_8h_a1171057a79f5a42e26d0bd84f6cd707b}{\_\_kmp\_monitor\_wakeups} = \hyperlink{kmp_8h_a7fe5c227b0ff7f4375c26587599da19e}{KMP\_WAKEUPS\_FROM\_BLOCKTIME}( 
      \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime}, \hyperlink{kmp_8h_a1171057a79f5a42e26d0bd84f6cd707b}{\_\_kmp\_monitor\_wakeups} );
6420     \hyperlink{kmp_8h_a317b8269abca72565ca88f1784dee86b}{\_\_kmp\_bt\_intervals} = \hyperlink{kmp_8h_aa921a5e9487d76bf909f643dfac692c0}{KMP\_INTERVALS\_FROM\_BLOCKTIME}( 
      \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime}, \hyperlink{kmp_8h_a1171057a79f5a42e26d0bd84f6cd707b}{\_\_kmp\_monitor\_wakeups} );
6421     \textcolor{comment}{// From "KMP\_LIBRARY" part of \_\_kmp\_env\_initialize()}
6422     \hyperlink{kmp_8h_aa8f77de14d1515a05937d68622e74d61}{\_\_kmp\_library} = \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599daadaa2a9ce75fbdb96025b8f6e9c2a4d7}{library\_throughput};
6423     \textcolor{comment}{// From KMP\_SCHEDULE initialization}
6424     \hyperlink{kmp_8h_a7520297e68a11d20d86df78cf53442c1}{\_\_kmp\_static} = \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea5869a7f3c202fef826c9368fa155dcdb}{kmp\_sch\_static\_balanced};
6425     \textcolor{comment}{// AC: do not use analytical here, because it is non-monotonous}
6426     \textcolor{comment}{//\_\_kmp\_guided = kmp\_sch\_guided\_iterative\_chunked;}
6427     \textcolor{comment}{//\_\_kmp\_auto = kmp\_sch\_guided\_analytical\_chunked; // AC: it is the default, no need to repeate
       assignment}
6428     \textcolor{comment}{// Barrier initialization. Moved here from \_\_kmp\_env\_initialize() Barrier branch bit control and
       barrier method}
6429     \textcolor{comment}{// control parts}
6430 \textcolor{preprocessor}{    #if KMP\_FAST\_REDUCTION\_BARRIER}
6431 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #define kmp\_reduction\_barrier\_gather\_bb ((int)1)}
6432 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #define kmp\_reduction\_barrier\_release\_bb ((int)1)}
6433 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #define kmp\_reduction\_barrier\_gather\_pat bp\_hyper\_bar}
6434 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #define kmp\_reduction\_barrier\_release\_pat bp\_hyper\_bar}
6435 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif // KMP\_FAST\_REDUCTION\_BARRIER}
6436 \textcolor{preprocessor}{}    \textcolor{keywordflow}{for} ( i=\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}; i<\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; i++ ) \{
6437         \hyperlink{kmp_8h_ac686c46b38f93904467b30f15ec1c15e}{\_\_kmp\_barrier\_gather\_branch\_bits} [ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp_8h_a90e02ca424e161330968a57a4a32aac3}{\_\_kmp\_barrier\_gather\_bb\_dflt};
6438         \hyperlink{kmp_8h_a80498c680499eb06d890901bada7c2ca}{\_\_kmp\_barrier\_release\_branch\_bits}[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp_8h_a91e1f9349fc66c9d57c42dac864c2b3e}{\_\_kmp\_barrier\_release\_bb\_dflt};
6439         \hyperlink{kmp_8h_a3919081570d178345aff3877da7dbd8a}{\_\_kmp\_barrier\_gather\_pattern} [ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp_8h_a357649c60bc8891ff3620bc4ae3ebb7a}{\_\_kmp\_barrier\_gather\_pat\_dflt};
6440         \hyperlink{kmp_8h_af980683a0ac054a7630c0a49fddd9202}{\_\_kmp\_barrier\_release\_pattern}[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp_8h_a056af5d363fdcd03f1dc329e6c13ab6e}{\_\_kmp\_barrier\_release\_pat\_dflt};
6441 \textcolor{preprocessor}{        #if KMP\_FAST\_REDUCTION\_BARRIER}
6442 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if}( i == \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier} ) \{ \textcolor{comment}{// tested and confirmed on ALTIX only (
       lin\_64 ): hyper,1}
6443             \hyperlink{kmp_8h_ac686c46b38f93904467b30f15ec1c15e}{\_\_kmp\_barrier\_gather\_branch\_bits} [ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp__runtime_8c_ad647847304011ec4d724df6fa3304009}{kmp\_reduction\_barrier\_gather\_bb};
6444             \hyperlink{kmp_8h_a80498c680499eb06d890901bada7c2ca}{\_\_kmp\_barrier\_release\_branch\_bits}[ 
      \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = \hyperlink{kmp__runtime_8c_a3e7f640f37c63871b76fd8a9838ab45f}{kmp\_reduction\_barrier\_release\_bb};
6445             \hyperlink{kmp_8h_a3919081570d178345aff3877da7dbd8a}{\_\_kmp\_barrier\_gather\_pattern} [ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp__runtime_8c_a865f8badcfb2a1cc1324e83d73a84fcd}{kmp\_reduction\_barrier\_gather\_pat};
6446             \hyperlink{kmp_8h_af980683a0ac054a7630c0a49fddd9202}{\_\_kmp\_barrier\_release\_pattern}[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = 
      \hyperlink{kmp__runtime_8c_ab7e4cdfdc594b3e230b9fbb1896980e7}{kmp\_reduction\_barrier\_release\_pat};
6447         \}
6448 \textcolor{preprocessor}{        #endif // KMP\_FAST\_REDUCTION\_BARRIER}
6449 \textcolor{preprocessor}{}    \}
6450 \textcolor{preprocessor}{    #if KMP\_FAST\_REDUCTION\_BARRIER}
6451 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #undef kmp\_reduction\_barrier\_release\_pat}
6452 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #undef kmp\_reduction\_barrier\_gather\_pat}
6453 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #undef kmp\_reduction\_barrier\_release\_bb}
6454 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #undef kmp\_reduction\_barrier\_gather\_bb}
6455 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif // KMP\_FAST\_REDUCTION\_BARRIER}
6456 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_ARCH\_X86\_64 && (KMP\_OS\_LINUX || KMP\_OS\_WINDOWS)}
6457 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\_\_kmp\_mic\_type == mic2) \{ \textcolor{comment}{// KNC}
6458         \textcolor{comment}{// AC: plane=3,2, forkjoin=2,1 are optimal for 240 threads on KNC}
6459         \hyperlink{kmp_8h_ac686c46b38f93904467b30f15ec1c15e}{\_\_kmp\_barrier\_gather\_branch\_bits} [ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier} ] = 3;  \textcolor{comment}{// plain gather}
6460         \hyperlink{kmp_8h_a80498c680499eb06d890901bada7c2ca}{\_\_kmp\_barrier\_release\_branch\_bits}[ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ] = 1;  \textcolor{comment}{// forkjoin release}
6461         \hyperlink{kmp_8h_a3919081570d178345aff3877da7dbd8a}{\_\_kmp\_barrier\_gather\_pattern} [ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ] = \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar};
6462         \hyperlink{kmp_8h_af980683a0ac054a7630c0a49fddd9202}{\_\_kmp\_barrier\_release\_pattern}[ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ] = \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar};
6463     \}
6464 \textcolor{preprocessor}{#if KMP\_FAST\_REDUCTION\_BARRIER}
6465 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\_\_kmp\_mic\_type == mic2) \{ \textcolor{comment}{// KNC}
6466         \hyperlink{kmp_8h_a3919081570d178345aff3877da7dbd8a}{\_\_kmp\_barrier\_gather\_pattern} [ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier} ] = \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar};
6467         \hyperlink{kmp_8h_af980683a0ac054a7630c0a49fddd9202}{\_\_kmp\_barrier\_release\_pattern}[ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier} ] = \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar};
6468     \}
6469 \textcolor{preprocessor}{#endif}
6470 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
6471 \textcolor{preprocessor}{}
6472     \textcolor{comment}{// From KMP\_CHECKS initialization}
6473 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
6474 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a45cb359b55a6b7cbd66e26f4983195f2}{\_\_kmp\_env\_checks} = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};   \textcolor{comment}{/* development versions have the extra checks */}
6475 \textcolor{preprocessor}{#else}
6476 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a45cb359b55a6b7cbd66e26f4983195f2}{\_\_kmp\_env\_checks} = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};  \textcolor{comment}{/* port versions do not have the extra checks */}
6477 \textcolor{preprocessor}{#endif}
6478 \textcolor{preprocessor}{}
6479     \textcolor{comment}{// From "KMP\_FOREIGN\_THREADS\_THREADPRIVATE" initialization}
6480     \hyperlink{kmp_8h_accf8ef4eee3a81c4bd08d1cd90893aee}{\_\_kmp\_foreign\_tp} = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
6481 
6482     \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
6483     \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode = \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853ae523db459efe51f06654eccdfcba8d4a}{dynamic\_default};
6484 
6485     \hyperlink{kmp__settings_8c_a7168e645bc1a505e4e1a9df0fd539378}{\_\_kmp\_env\_initialize}( NULL );
6486 
6487     \textcolor{comment}{// Print all messages in message catalog for testing purposes.}
6488 \textcolor{preprocessor}{    #ifdef KMP\_DEBUG}
6489 \textcolor{preprocessor}{}        \textcolor{keywordtype}{char} \textcolor{keyword}{const} * val = \hyperlink{kmp__environment_8c_a8ca0c26acad07b836fc8d8013979e8cd}{\_\_kmp\_env\_get}( \textcolor{stringliteral}{"KMP\_DUMP\_CATALOG"} );
6490         \textcolor{keywordflow}{if} ( \hyperlink{kmp__str_8c_a8cd4e13706553ea42292e282a0ced826}{\_\_kmp\_str\_match\_true}( val ) ) \{
6491             \hyperlink{structkmp__str__buf}{kmp\_str\_buf\_t} buffer;
6492             \hyperlink{kmp__str_8h_adc2dc512433519833eefb364af257250}{\_\_kmp\_str\_buf\_init}( & buffer );
6493             \hyperlink{kmp__i18n_8c_aee0fa140ec335078a95a2f94c3afefa3}{\_\_kmp\_i18n\_dump\_catalog}( & buffer );
6494             \hyperlink{kmp__io_8c_ac0b96ed999ee9819c544e6f24057da91}{\_\_kmp\_printf}( \textcolor{stringliteral}{"%s"}, buffer.\hyperlink{structkmp__str__buf_ac87d13b209cb66e1747bf327dddad2bf}{str} );
6495             \hyperlink{kmp__str_8c_a683399047568b106a23ef86647b9b586}{\_\_kmp\_str\_buf\_free}( & buffer );
6496         \}; \textcolor{comment}{// if}
6497         \hyperlink{kmp__environment_8c_a0ba2f8c7661ee48940e90124d415b1cf}{\_\_kmp\_env\_free}( & val );
6498 \textcolor{preprocessor}{    #endif}
6499 \textcolor{preprocessor}{}
6500     \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} = 
      \hyperlink{kmp__settings_8c_a4238f72a9b58c865937a1212bbd0bf35}{\_\_kmp\_initial\_threads\_capacity}( 
      \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} );
6501     \textcolor{comment}{// Moved here from \_\_kmp\_env\_initialize() "KMP\_ALL\_THREADPRIVATE" part}
6502     \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity} = \hyperlink{kmp__settings_8c_a3457f4a2d238d582b4ffe13934aed60d}{\_\_kmp\_default\_tp\_capacity}(
      \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub}, \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth}, 
      \hyperlink{kmp_8h_a751b027998c243606344ae8d5360e69f}{\_\_kmp\_allThreadsSpecified});
6503 
6504     \textcolor{comment}{// If the library is shut down properly, both pools must be NULL. Just in case, set them}
6505     \textcolor{comment}{// to NULL -- some memory may leak, but subsequent code will work even if pools are not freed.}
6506     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} == NULL );
6507     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} == NULL );
6508     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool}   == NULL );
6509     \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} = NULL;
6510     \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} = NULL;
6511     \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool}   = NULL;
6512 
6513     \textcolor{comment}{/* Allocate all of the variable sized records */}
6514     \textcolor{comment}{/* NOTE: \_\_kmp\_threads\_capacity entries are allocated, but the arrays are expandable */}
6515     \textcolor{comment}{/* Since allocation is cache-aligned, just add extra padding at the end */}
6516     size = (\textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) + \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}*))*
      \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} + \hyperlink{kmp__os_8h_a86194c659a2d795e5f5949d293ae4661}{CACHE\_LINE};
6517     \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}**) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( size );
6518     \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}    = (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}**) ((\textcolor{keywordtype}{char}*)\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} + \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) * \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} );
6519 
6520     \textcolor{comment}{/* init thread counts */}
6521     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} == 0 ); \textcolor{comment}{// Asserts fail if the library is
       reinitializing and}
6522     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} == 0 );     \textcolor{comment}{// something was wrong in termination.}
6523     \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} = 0;
6524     \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}     = 0;
6525 
6526     \textcolor{comment}{/* setup the uber master thread and hierarchy */}
6527     gtid = \hyperlink{kmp__runtime_8c_a35f021c58bf7593d6c096cea30edbcc0}{\_\_kmp\_register\_root}( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
6528     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_do\_serial\_initialize  T#%d\(\backslash\)n"}, gtid ));
6529     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid ) );
6530     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a75fb7fe9255d6fe6a9cb61bec1738666}{KMP\_INITIAL\_GTID}( gtid ) );
6531 
6532     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
6533 
6534     \hyperlink{kmp_8h_a17cf47cca5a54cf10174b36475d16e3c}{\_\_kmp\_common\_initialize}();
6535 
6536 \textcolor{preprocessor}{    #if KMP\_OS\_UNIX}
6537 \textcolor{preprocessor}{}        \textcolor{comment}{/* invoke the child fork handler */}
6538         \hyperlink{z__Linux__util_8c_af7249dd2326a4f4c91810e8e6d7b9544}{\_\_kmp\_register\_atfork}();
6539 \textcolor{preprocessor}{    #endif}
6540 \textcolor{preprocessor}{}
6541 \textcolor{preprocessor}{    #if ! defined KMP\_DYNAMIC\_LIB}
6542 \textcolor{preprocessor}{}        \{
6543             \textcolor{comment}{/* Invoke the exit handler when the program finishes, only for static library.}
6544 \textcolor{comment}{               For dynamic library, we already have \_fini and DllMain.}
6545 \textcolor{comment}{             */}
6546             \textcolor{keywordtype}{int} rc = atexit( \hyperlink{kmp__runtime_8c_a3cb9d65a5473297ec40988b57ab4db11}{\_\_kmp\_internal\_end\_atexit} );
6547             \textcolor{keywordflow}{if} ( rc != 0 ) \{
6548                 \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}( \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060aac29006d355ede42e04f48ccd9c23f98}{kmp\_ms\_fatal}, \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( FunctionError, \textcolor{stringliteral}{"atexit()"} ), 
      \hyperlink{kmp__i18n_8h_afcd232d6d16e604027d95243c6211e95}{KMP\_ERR}( rc ), \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null} );
6549             \}; \textcolor{comment}{// if}
6550         \}
6551 \textcolor{preprocessor}{    #endif}
6552 \textcolor{preprocessor}{}
6553 \textcolor{preprocessor}{    #if KMP\_HANDLE\_SIGNALS}
6554 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #if KMP\_OS\_UNIX}
6555 \textcolor{preprocessor}{}            \textcolor{comment}{/* NOTE: make sure that this is called before the user installs}
6556 \textcolor{comment}{             *          their own signal handlers so that the user handlers}
6557 \textcolor{comment}{             *          are called first.  this way they can return false,}
6558 \textcolor{comment}{             *          not call our handler, avoid terminating the library,}
6559 \textcolor{comment}{             *          and continue execution where they left off. */}
6560             \_\_kmp\_install\_signals( \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} );
6561 \textcolor{preprocessor}{        #endif }\textcolor{comment}{/* KMP\_OS\_UNIX */}\textcolor{preprocessor}{}
6562 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #if KMP\_OS\_WINDOWS}
6563 \textcolor{preprocessor}{}            \_\_kmp\_install\_signals( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
6564 \textcolor{preprocessor}{        #endif }\textcolor{comment}{/* KMP\_OS\_WINDOWS */}\textcolor{preprocessor}{}
6565 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif}
6566 \textcolor{preprocessor}{}
6567     \textcolor{comment}{/* we have finished the serial initialization */}
6568     \hyperlink{kmp_8h_aa28d33ebc755e1adc54173c659eebbea}{\_\_kmp\_init\_counter} ++;
6569 
6570     \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
6571 
6572     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_aacc3bb748c0b09ecc54f0793eeafdd3c}{\_\_kmp\_settings}) \{
6573         \hyperlink{kmp__settings_8c_afd77af5dd5f2224ab1a538751ea43a01}{\_\_kmp\_env\_print}();
6574     \}
6575 
6576 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
6577 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a61d0f3a9162659dc28619166a276a00a}{\_\_kmp\_display\_env} || \hyperlink{kmp_8h_a109eb986c34030a5eb186e88abd5b9ea}{\_\_kmp\_display\_env\_verbose}) \{
6578         \hyperlink{kmp__settings_8c_a097fbf21ce503930a1b2af9e3e2840c3}{\_\_kmp\_env\_print\_2}();
6579     \}
6580 \textcolor{preprocessor}{#endif // OMP\_40\_ENABLED}
6581 \textcolor{preprocessor}{}
6582 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
6583 \textcolor{preprocessor}{}    \hyperlink{ompt-general_8c_aec05138d98afc56af2b9c69358777937}{ompt\_post\_init}();
6584 \textcolor{preprocessor}{#endif}
6585 \textcolor{preprocessor}{}
6586     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
6587 
6588     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_do\_serial\_initialize: exit\(\backslash\)n"} ) );
6589 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7c462a6cf8fc9d4a238c3b21234754ea}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single@{\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single}}
\index{\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single@{\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-enter\-\_\-single}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-enter\-\_\-single (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf ident\-\_\-t} $\ast$}]{id\-\_\-ref, }
\item[{{\bf int}}]{push\-\_\-ws}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a7c462a6cf8fc9d4a238c3b21234754ea}


Definition at line 786 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-single(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-S\-I\-N\-G\-L\-E\-\_\-\-C\-O\-P\-Y\-\_\-\-S\-T\-A\-R\-T(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-S\-I\-N\-G\-L\-E\-\_\-\-S\-T\-A\-R\-T().


\begin{DoxyCode}
787 \{
788     \textcolor{keywordtype}{int} \hyperlink{kmp__i18n_8c_a43c2a109a79fef7e46a0836cdac679ff}{status};
789     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *th;
790     \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
791 
792     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}) )
793         \hyperlink{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
794 
795     th   = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
796     team = th->th.th\_team;
797     status = 0;
798 
799     th->th.th\_ident = id\_ref;
800 
801     \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) \{
802         status = 1;
803     \} \textcolor{keywordflow}{else} \{
804         kmp\_int32 old\_this = th->th.th\_local.this\_construct;
805 
806         ++th->th.th\_local.this\_construct;
807         \textcolor{comment}{/* try to set team count to thread count--success means thread got the}
808 \textcolor{comment}{           single block}
809 \textcolor{comment}{        */}
810         \textcolor{comment}{/* TODO: Should this be acquire or release? */}
811         status = \hyperlink{kmp__os_8h_ae2107985ffcede8039b92405b7153954}{KMP\_COMPARE\_AND\_STORE\_ACQ32}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_construct, old\_this,
812                                              th->th.th\_local.this\_construct);
813 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
814 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \_\_itt\_metadata\_add\_ptr && \_\_kmp\_forkjoin\_frames\_mode == 3 && 
      \hyperlink{kmp_8h_a996fe75425730b06ff88477bf72b8134}{KMP\_MASTER\_GTID}(gtid) &&
815 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
816             th->th.th\_teams\_microtask == NULL &&
817 #endif
818             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level == 1 )
819         \{   \textcolor{comment}{// Only report metadata by master of active team at level 1}
820             \_\_kmp\_itt\_metadata\_single( id\_ref );
821         \}
822 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
823 \textcolor{preprocessor}{}    \}
824 
825     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
826         \textcolor{keywordflow}{if} (status && push\_ws) \{
827             \hyperlink{kmp__error_8c_a66a32e32866271e32187760f4a9d4e3e}{\_\_kmp\_push\_workshare}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a142f0f52bf00b56c570623b68fcd0c19}{ct\_psingle}, id\_ref );
828         \} \textcolor{keywordflow}{else} \{
829             \hyperlink{kmp__error_8c_a464ed6bb20c9a38ab90bb491babe68ad}{\_\_kmp\_check\_workshare}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a142f0f52bf00b56c570623b68fcd0c19}{ct\_psingle}, id\_ref );
830         \}
831     \}
832 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
833 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( status ) \{
834         \_\_kmp\_itt\_single\_start( gtid );
835     \}
836 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
837 \textcolor{preprocessor}{}    \textcolor{keywordflow}{return} \hyperlink{kmp__i18n_8c_a43c2a109a79fef7e46a0836cdac679ff}{status};
838 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4af443dc64419c7436b8d1bb1da2147c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single@{\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single}}
\index{\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single@{\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-exit\-\_\-single}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-exit\-\_\-single (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a4af443dc64419c7436b8d1bb1da2147c}


Definition at line 841 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-end\-\_\-single().


\begin{DoxyCode}
842 \{
843 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
844 \textcolor{preprocessor}{}    \_\_kmp\_itt\_single\_end( gtid );
845 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
846 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
847         \hyperlink{kmp__error_8c_a93d9c89e2629352b4db28263a95b80f4}{\_\_kmp\_pop\_workshare}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315a142f0f52bf00b56c570623b68fcd0c19}{ct\_psingle}, NULL );
848 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a393e842afa40d6cd0bd01d36e27e40c9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads}}
\index{\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf int} \-\_\-\-\_\-kmp\-\_\-expand\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{n\-Wish, }
\item[{{\bf int}}]{n\-Need}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a393e842afa40d6cd0bd01d36e27e40c9}


Definition at line 3531 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-register\-\_\-root(), and \-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads().


\begin{DoxyCode}
3531                                            \{
3532     \textcolor{keywordtype}{int} added = 0;
3533     \textcolor{keywordtype}{int} old\_tp\_cached;
3534     \textcolor{keywordtype}{int} \_\_kmp\_actual\_max\_nth;
3535 
3536     \textcolor{keywordflow}{if}(nNeed > nWish) \textcolor{comment}{/* normalize the arguments */}
3537         nWish = nNeed;
3538 \textcolor{preprocessor}{#if KMP\_OS\_WINDOWS && !defined KMP\_DYNAMIC\_LIB}
3539 \textcolor{preprocessor}{}\textcolor{comment}{/* only for Windows static library */}
3540     \textcolor{comment}{/* reclaim array entries for root threads that are already dead */}
3541     added = \_\_kmp\_reclaim\_dead\_roots();
3542 
3543     \textcolor{keywordflow}{if}(nNeed) \{
3544         nNeed -= added;
3545         \textcolor{keywordflow}{if}(nNeed < 0)
3546             nNeed = 0;
3547     \}
3548     \textcolor{keywordflow}{if}(nWish) \{
3549         nWish -= added;
3550         \textcolor{keywordflow}{if}(nWish < 0)
3551             nWish = 0;
3552     \}
3553 \textcolor{preprocessor}{#endif}
3554 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}(nWish <= 0)
3555         \textcolor{keywordflow}{return} added;
3556 
3557     \textcolor{keywordflow}{while}(1) \{
3558         \textcolor{keywordtype}{int} nTarget;
3559         \textcolor{keywordtype}{int} minimumRequiredCapacity;
3560         \textcolor{keywordtype}{int} newCapacity;
3561         \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **newThreads;
3562         \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} **newRoot;
3563 
3564         \textcolor{comment}{//}
3565         \textcolor{comment}{// Note that \_\_kmp\_threads\_capacity is not bounded by \_\_kmp\_max\_nth.}
3566         \textcolor{comment}{// If \_\_kmp\_max\_nth is set to some value less than \_\_kmp\_sys\_max\_nth}
3567         \textcolor{comment}{// by the user via OMP\_THREAD\_LIMIT, then \_\_kmp\_threads\_capacity may}
3568         \textcolor{comment}{// become > \_\_kmp\_max\_nth in one of two ways:}
3569         \textcolor{comment}{//}
3570         \textcolor{comment}{// 1) The initialization thread (gtid = 0) exits.  \_\_kmp\_threads[0]}
3571         \textcolor{comment}{//    may not be resused by another thread, so we may need to increase}
3572         \textcolor{comment}{//    \_\_kmp\_threads\_capacity to \_\_kmp\_max\_threads + 1.}
3573         \textcolor{comment}{//}
3574         \textcolor{comment}{// 2) New foreign root(s) are encountered.  We always register new}
3575         \textcolor{comment}{//    foreign roots.  This may cause a smaller # of threads to be}
3576         \textcolor{comment}{//    allocated at subsequent parallel regions, but the worker threads}
3577         \textcolor{comment}{//    hang around (and eventually go to sleep) and need slots in the}
3578         \textcolor{comment}{//    \_\_kmp\_threads[] array.}
3579         \textcolor{comment}{//}
3580         \textcolor{comment}{// Anyway, that is the reason for moving the check to see if}
3581         \textcolor{comment}{// \_\_kmp\_max\_threads was exceeded into \_\_kmp\_reseerve\_threads()}
3582         \textcolor{comment}{// instead of having it performed here. -BB}
3583         \textcolor{comment}{//}
3584         old\_tp\_cached = \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached};
3585         \_\_kmp\_actual\_max\_nth = old\_tp\_cached ? \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity} : 
      \hyperlink{kmp_8h_aa34f380bb9845773e26d2f6f894cfd26}{\_\_kmp\_sys\_max\_nth};
3586         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(\_\_kmp\_actual\_max\_nth >= 
      \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity});
3587 
3588         \textcolor{comment}{/* compute expansion headroom to check if we can expand and whether to aim for nWish or nNeed */}
3589         nTarget = nWish;
3590         \textcolor{keywordflow}{if}(\_\_kmp\_actual\_max\_nth - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} < nTarget) \{
3591             \textcolor{comment}{/* can't fulfil nWish, so try nNeed */}
3592             \textcolor{keywordflow}{if}(nNeed) \{
3593                 nTarget = nNeed;
3594                 \textcolor{keywordflow}{if}(\_\_kmp\_actual\_max\_nth - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} < nTarget) \{
3595                     \textcolor{comment}{/* possible expansion too small -- give up */}
3596                     \textcolor{keywordflow}{break};
3597                 \}
3598             \} \textcolor{keywordflow}{else} \{
3599                 \textcolor{comment}{/* best-effort */}
3600                 nTarget = \_\_kmp\_actual\_max\_nth - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity};
3601                 \textcolor{keywordflow}{if}(!nTarget) \{
3602                     \textcolor{comment}{/* can expand at all -- give up */}
3603                     \textcolor{keywordflow}{break};
3604                 \}
3605             \}
3606         \}
3607         minimumRequiredCapacity = \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} + nTarget;
3608 
3609         newCapacity = \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity};
3610         \textcolor{keywordflow}{do}\{
3611             newCapacity =
3612                 newCapacity <= (\_\_kmp\_actual\_max\_nth >> 1) ?
3613                 (newCapacity << 1) :
3614                 \_\_kmp\_actual\_max\_nth;
3615         \} \textcolor{keywordflow}{while}(newCapacity < minimumRequiredCapacity);
3616         newThreads = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}**) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}((\textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) + \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}*)) * newCapacity + 
      \hyperlink{kmp__os_8h_a86194c659a2d795e5f5949d293ae4661}{CACHE\_LINE});
3617         newRoot = (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}**) ((\textcolor{keywordtype}{char}*)newThreads + \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) * newCapacity );
3618         \hyperlink{kmp__safe__c__api_8h_ab63a75e8bb537bb3ae55c05d0a3b7ca0}{KMP\_MEMCPY}(newThreads, \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}, 
      \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} * \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*));
3619         \hyperlink{kmp__safe__c__api_8h_ab63a75e8bb537bb3ae55c05d0a3b7ca0}{KMP\_MEMCPY}(newRoot, \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}, 
      \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} * \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}*));
3620         memset(newThreads + \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}, 0,
3621                (newCapacity - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}) * \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*));
3622         memset(newRoot + \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}, 0,
3623                (newCapacity - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}) * \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}*));
3624 
3625         \textcolor{keywordflow}{if}(!old\_tp\_cached && \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached} && newCapacity > 
      \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity}) \{
3626             \textcolor{comment}{/* \_\_kmp\_tp\_cached has changed, i.e. \_\_kmpc\_threadprivate\_cached has allocated a threadprivate
       cache}
3627 \textcolor{comment}{               while we were allocating the expanded array, and our new capacity is larger than the
       threadprivate}
3628 \textcolor{comment}{               cache capacity, so we should deallocate the expanded arrays and try again.  This is the
       first check}
3629 \textcolor{comment}{               of a double-check pair.}
3630 \textcolor{comment}{            */}
3631             \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(newThreads);
3632             \textcolor{keywordflow}{continue}; \textcolor{comment}{/* start over and try again */}
3633         \}
3634         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}(&
      \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock});
3635         \textcolor{keywordflow}{if}(!old\_tp\_cached && \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached} && newCapacity > 
      \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity}) \{
3636             \textcolor{comment}{/* Same check as above, but this time with the lock so we can be sure if we can succeed. */}
3637             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}(&
      \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock});
3638             \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(newThreads);
3639             \textcolor{keywordflow}{continue}; \textcolor{comment}{/* start over and try again */}
3640         \} \textcolor{keywordflow}{else} \{
3641             \textcolor{comment}{/* success */}
3642             \textcolor{comment}{// \_\_kmp\_free( \_\_kmp\_threads ); // ATT: It leads to crash. Need to be investigated.}
3643             \textcolor{comment}{//}
3644             *(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}**\textcolor{keyword}{volatile}*)&\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} = newThreads;
3645             *(\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}**\textcolor{keyword}{volatile}*)&\hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root} = newRoot;
3646             added += newCapacity - \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity};
3647             *(\textcolor{keyword}{volatile} \textcolor{keywordtype}{int}*)&\_\_kmp\_threads\_capacity = newCapacity;
3648             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}(&
      \hyperlink{kmp_8h_a2105d949d5809163eef882ebdb896be0}{\_\_kmp\_tp\_cached\_lock});
3649             \textcolor{keywordflow}{break}; \textcolor{comment}{/* succeeded, so we can exit the loop */}
3650         \}
3651     \}
3652     \textcolor{keywordflow}{return} added;
3653 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a08510dec818bea07a313d1c0b0534da5}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator@{\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator}}
\index{\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator@{\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-fini\-\_\-allocator (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a08510dec818bea07a313d1c0b0534da5}


Definition at line 557 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library().


\begin{DoxyCode}
557 \{\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aea1108b093169cef205a6766bdfa5a40}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier}}
\index{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-fork\-\_\-barrier (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{tid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aea1108b093169cef205a6766bdfa5a40}


Definition at line 1541 of file kmp\-\_\-barrier.\-cpp.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork(), and \-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread().


\begin{DoxyCode}
1542 \{
1543     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_fork\_barrier);
1544     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
1545     \hyperlink{unionkmp__team}{kmp\_team\_t} *team = (tid == 0) ? this\_thr->th.th\_team : NULL;
1546 #\textcolor{keywordflow}{if} USE\_ITT\_BUILD
1547     \textcolor{keywordtype}{void} * itt\_sync\_obj = NULL;
1548 #endif \textcolor{comment}{/* USE\_ITT\_BUILD */}
1549 
1550     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d(%d:%d) has arrived\(\backslash\)n"},
1551                   gtid, (team != NULL) ? team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id : -1, tid));
1552 
1553     \textcolor{comment}{// th\_team pointer only valid for master thread here}
1554     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{
1555 \textcolor{preprocessor}{#if USE\_ITT\_BUILD && USE\_ITT\_NOTIFY}
1556 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG) \{
1557             \textcolor{comment}{// Create itt barrier object}
1558             itt\_sync\_obj  = \_\_kmp\_itt\_barrier\_object(gtid, \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}, 1);
1559             \_\_kmp\_itt\_barrier\_middle(gtid, itt\_sync\_obj);  \textcolor{comment}{// Call acquired/releasing}
1560         \}
1561 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD && USE\_ITT\_NOTIFY */}\textcolor{preprocessor}{}
1562 \textcolor{preprocessor}{}
1563 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
1564 \textcolor{preprocessor}{}        \textcolor{keyword}{register} \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **other\_threads = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
1565         \textcolor{keyword}{register} \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
1566 
1567         \textcolor{comment}{// Verify state}
1568         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1569 
1570         \textcolor{keywordflow}{for}(i=1; i<team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \{
1571             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(500, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d(%d:0) checking T#%d(%d:%d) fork go == %u.\(\backslash\)n"},
1572                            gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, other\_threads[i]->th.th\_info.ds.ds\_gtid,
1573                            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, other\_threads[i]->th.th\_info.ds.ds\_tid,
1574                            other\_threads[i]->th.th\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}].bb.b\_go));
1575             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}((\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(other\_threads[i]->th.th\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}].bb.b\_go)
1576                               & ~(\hyperlink{kmp_8h_a5aea6667969b3c0ec527b73b22aa71e2}{KMP\_BARRIER\_SLEEP\_STATE}))
1577                              == \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE});
1578             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(other\_threads[i]->th.th\_team == team);
1579         \}
1580 \textcolor{preprocessor}{#endif}
1581 \textcolor{preprocessor}{}
1582         \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
1583             \hyperlink{kmp_8h_af98fb3c3ffb814bf6a38fc90dbe07fcc}{\_\_kmp\_task\_team\_setup}(this\_thr, team, 0);  \textcolor{comment}{// 0 indicates setup current
       task team if nthreads > 1}
1584         \}
1585 
1586         \textcolor{comment}{//hash: what is block time? why is the code below performance critical. Is it relevant?}
1587 
1588         \textcolor{comment}{/* The master thread may have changed its blocktime between the join barrier and the}
1589 \textcolor{comment}{           fork barrier. Copy the blocktime info to the thread, where \_\_kmp\_wait\_template() can}
1590 \textcolor{comment}{           access it when the team struct is not guaranteed to exist. */}
1591         \textcolor{comment}{// See note about the corresponding code in \_\_kmp\_join\_barrier() being performance-critical}
1592         \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime} != \hyperlink{kmp_8h_a1ca6c6ce04115f143dc5df627de57958}{KMP\_MAX\_BLOCKTIME}) \{
1593             this\_thr->th.th\_team\_bt\_intervals = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].td\_icvs.bt\_intervals
      ;
1594             this\_thr->th.th\_team\_bt\_set = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].td\_icvs.bt\_set;
1595         \}
1596     \} \textcolor{comment}{// master}
1597 
1598     \textcolor{keywordflow}{switch} (\hyperlink{kmp_8h_af980683a0ac054a7630c0a49fddd9202}{\_\_kmp\_barrier\_release\_pattern}[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}]) \{
1599     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aad01aaab58a5ceeebbf8f9d5a170afa33}{bp\_hyper\_bar}: \{
1600         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(\hyperlink{kmp_8h_a80498c680499eb06d890901bada7c2ca}{\_\_kmp\_barrier\_release\_branch\_bits}[
      bs\_forkjoin\_barrier]);
1601         \hyperlink{kmp__barrier_8cpp_a9bfd86466cb84b77a7bff00f0f1015b6}{\_\_kmp\_hyper\_barrier\_release}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}
1602                                     \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1603         \textcolor{keywordflow}{break};
1604     \}
1605     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar}: \{
1606         \hyperlink{kmp__barrier_8cpp_acdc8b64228a7351beeac26310c0316d6}{\_\_kmp\_hierarchical\_barrier\_release}(bs\_forkjoin\_barrier, this\_thr,
       gtid, tid, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}
1607                                            \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1608         \textcolor{keywordflow}{break};
1609     \}
1610     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aa64f2941fea2d51b943240075d1db0d64}{bp\_tree\_bar}: \{
1611         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(\hyperlink{kmp_8h_a80498c680499eb06d890901bada7c2ca}{\_\_kmp\_barrier\_release\_branch\_bits}[
      bs\_forkjoin\_barrier]);
1612         \hyperlink{kmp__barrier_8cpp_a077185278bc81fb20a160dbeb7419e8c}{\_\_kmp\_tree\_barrier\_release}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}
1613                                    \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1614         \textcolor{keywordflow}{break};
1615     \}
1616     \textcolor{keywordflow}{default}: \{
1617         \hyperlink{kmp__barrier_8cpp_afccbeffe4e07fbe7ccf6b622b5bea2f4}{\_\_kmp\_linear\_barrier\_release}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}
1618                                      \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1619     \}
1620     \}
1621 
1622     \textcolor{comment}{// Early exit for reaping threads releasing forkjoin barrier}
1623     \textcolor{keywordflow}{if} (\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done)) \{
1624         this\_thr->th.th\_task\_team = NULL;
1625 
1626 \textcolor{preprocessor}{#if USE\_ITT\_BUILD && USE\_ITT\_NOTIFY}
1627 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG) \{
1628             \textcolor{keywordflow}{if} (!\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{
1629                 itt\_sync\_obj = \_\_kmp\_itt\_barrier\_object(gtid, bs\_forkjoin\_barrier);
1630                 \textcolor{keywordflow}{if} (itt\_sync\_obj)
1631                     \_\_kmp\_itt\_barrier\_finished(gtid, itt\_sync\_obj);
1632             \}
1633         \}
1634 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD && USE\_ITT\_NOTIFY */}\textcolor{preprocessor}{}
1635 \textcolor{preprocessor}{}        \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d is leaving early\(\backslash\)n"}, gtid));
1636         \textcolor{keywordflow}{return};
1637     \}
1638 
1639     \textcolor{comment}{// hash: is barrier release just passing of the team strucutre from the master to the worker threads.
       Cant be: called per thread created}
1640 
1641     \textcolor{comment}{/* We can now assume that a valid team structure has been allocated by the master and}
1642 \textcolor{comment}{       propagated to all worker threads. The current thread, however, may not be part of the}
1643 \textcolor{comment}{       team, so we can't blindly assume that the team pointer is non-null.  */}
1644     team = (\hyperlink{unionkmp__team}{kmp\_team\_t} *)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(this\_thr->th.th\_team);
1645     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(team != NULL);
1646     tid = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}(gtid);
1647 
1648 
1649 \textcolor{preprocessor}{#if KMP\_BARRIER\_ICV\_PULL}
1650 \textcolor{preprocessor}{}    \textcolor{comment}{/* Master thread's copy of the ICVs was set up on the implicit taskdata in}
1651 \textcolor{comment}{       \_\_kmp\_reinitialize\_team. \_\_kmp\_fork\_call() assumes the master thread's implicit task has}
1652 \textcolor{comment}{       this data before this function is called. We cannot modify \_\_kmp\_fork\_call() to look at}
1653 \textcolor{comment}{       the fixed ICVs in the master's thread struct, because it is not always the case that the}
1654 \textcolor{comment}{       threads arrays have been allocated when \_\_kmp\_fork\_call() is executed. */}
1655     \{
1656         \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(USER\_icv\_copy);
1657         \textcolor{keywordflow}{if} (!\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{  \textcolor{comment}{// master thread already has ICVs}
1658             \textcolor{comment}{// Copy the initial ICVs from the master's thread struct to the implicit task for this tid.}
1659             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d(%d) is PULLing ICVs\(\backslash\)n"}, gtid, tid));
1660             \hyperlink{kmp_8h_a8387c1b95f3b497a14fc3916515ad4c3}{\_\_kmp\_init\_implicit\_task}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[tid], team, tid, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1661             \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].td\_icvs,
1662                       &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]->th.th\_bar[bs\_forkjoin\_barrier].bb.th\_fixed\_icvs);
1663         \}
1664     \}
1665 \textcolor{preprocessor}{#endif // KMP\_BARRIER\_ICV\_PULL}
1666 \textcolor{preprocessor}{}
1667     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
1668         \hyperlink{kmp_8h_a2c905b30d1208bb65979ea579f9b64f1}{\_\_kmp\_task\_team\_sync}(this\_thr, team);
1669     \}
1670 
1671 \textcolor{preprocessor}{#if OMP\_40\_ENABLED && KMP\_AFFINITY\_SUPPORTED}
1672 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\_proc\_bind\_t} proc\_bind = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_proc\_bind;
1673     \textcolor{keywordflow}{if} (proc\_bind == \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a7f6ed2a956308322c1e76ba19ebf2a75}{proc\_bind\_intel}) \{
1674 \textcolor{preprocessor}{#endif}
1675 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_AFFINITY\_SUPPORTED}
1676 \textcolor{preprocessor}{}        \textcolor{comment}{// Call dynamic affinity settings}
1677         \textcolor{keywordflow}{if}(\_\_kmp\_affinity\_type == affinity\_balanced && team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed) \{
1678             \_\_kmp\_balanced\_affinity(tid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc);
1679         \}
1680 \textcolor{preprocessor}{#endif // KMP\_AFFINITY\_SUPPORTED}
1681 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if OMP\_40\_ENABLED && KMP\_AFFINITY\_SUPPORTED}
1682 \textcolor{preprocessor}{}    \}
1683     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (proc\_bind != \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a26efad2e13ae31e934f83c4d9a6ceb99}{proc\_bind\_false}) \{
1684         \textcolor{keywordflow}{if} (this\_thr->th.th\_new\_place == this\_thr->th.th\_current\_place) \{
1685             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(100, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d already in correct place %d\(\backslash\)n"},
1686                            \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}(this\_thr), this\_thr->th.
      th\_current\_place));
1687         \}
1688         \textcolor{keywordflow}{else} \{
1689             \_\_kmp\_affinity\_set\_place(gtid);
1690         \}
1691     \}
1692 \textcolor{preprocessor}{#endif}
1693 \textcolor{preprocessor}{}
1694 \textcolor{preprocessor}{#if USE\_ITT\_BUILD && USE\_ITT\_NOTIFY}
1695 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG) \{
1696         \textcolor{keywordflow}{if} (!\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{
1697             \textcolor{comment}{// Get correct barrier object}
1698             itt\_sync\_obj = \_\_kmp\_itt\_barrier\_object(gtid, bs\_forkjoin\_barrier);
1699             \_\_kmp\_itt\_barrier\_finished(gtid, itt\_sync\_obj);  \textcolor{comment}{// Workers call acquired}
1700         \} \textcolor{comment}{// (prepare called inside barrier\_release)}
1701     \}
1702 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD && USE\_ITT\_NOTIFY */}\textcolor{preprocessor}{}
1703 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_fork\_barrier: T#%d(%d:%d) is leaving\(\backslash\)n"}, gtid, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, tid));
1704 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a2c67bc63fbc37afe564202b2cdc7d5ba}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call}}
\index{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{{\bf int}}]{gtid, }
\item[{enum {\bf fork\-\_\-context\-\_\-e}}]{call\-\_\-context, }
\item[{kmp\-\_\-int32}]{argc, }
\item[{{\bf microtask\-\_\-t}}]{microtask, }
\item[{{\bf launch\-\_\-t}}]{invoker, }
\item[{va\-\_\-list}]{ap}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a2c67bc63fbc37afe564202b2cdc7d5ba}


Definition at line 1436 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-\-G\-O\-M\-P\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-teams\-\_\-master(), \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call(), and \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams().


\begin{DoxyCode}
1453 \{
1454     \textcolor{keywordtype}{void}          **argv;
1455     \textcolor{keywordtype}{int}             \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
1456     \textcolor{keywordtype}{int}             master\_tid;
1457     \textcolor{keywordtype}{int}             master\_this\_cons;
1458     \hyperlink{unionkmp__team}{kmp\_team\_t}     *team;
1459     \hyperlink{unionkmp__team}{kmp\_team\_t}     *parent\_team;
1460     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}     *master\_th;
1461     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}     *root;
1462     \textcolor{keywordtype}{int}             nthreads;
1463     \textcolor{keywordtype}{int}             master\_active;
1464     \textcolor{keywordtype}{int}             master\_set\_numthreads;
1465     \textcolor{keywordtype}{int}             level;
1466 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1467 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int}             active\_level;
1468     \textcolor{keywordtype}{int}             teams\_level;
1469 \textcolor{preprocessor}{#endif}
1470 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
1471 \textcolor{preprocessor}{}    kmp\_hot\_team\_ptr\_t **p\_hot\_teams;
1472 \textcolor{preprocessor}{#endif}
1473 \textcolor{preprocessor}{}    \{ \textcolor{comment}{// KMP\_TIME\_BLOCK}
1474     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_fork\_call);
1475     \hyperlink{group__STATS__GATHERING_ga7691000a7864b475046ae62fcf0536ac}{KMP\_COUNT\_VALUE}(OMP\_PARALLEL\_args, argc);
1476 
1477     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: enter T#%d\(\backslash\)n"}, gtid ));
1478     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ae050c01c40fb4f54e398dc3a81947198}{\_\_kmp\_stkpadding} > 0 &&  \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid] != NULL ) \{
1479         \textcolor{comment}{/* Some systems prefer the stack for the root thread(s) to start with */}
1480         \textcolor{comment}{/* some gap from the parent stack to prevent false sharing. */}
1481         \textcolor{keywordtype}{void} *dummy = \hyperlink{kmp__safe__c__api_8h_a2280690d07037589e6ac2faf9e9a2b28}{KMP\_ALLOCA}(\hyperlink{kmp_8h_ae050c01c40fb4f54e398dc3a81947198}{\_\_kmp\_stkpadding});
1482         \textcolor{comment}{/* These 2 lines below are so this does not get optimized out */}
1483         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ae050c01c40fb4f54e398dc3a81947198}{\_\_kmp\_stkpadding} > \hyperlink{kmp_8h_a107bb04edf0de61c0349c70d261500dc}{KMP\_MAX\_STKPADDING} )
1484             \hyperlink{kmp_8h_ae050c01c40fb4f54e398dc3a81947198}{\_\_kmp\_stkpadding} += (short)((kmp\_int64)dummy);
1485     \}
1486 
1487     \textcolor{comment}{/* initialize if needed */}
1488     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ); \textcolor{comment}{// AC: potentially unsafe, not
       in sync with shutdown}
1489     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}) )
1490         \hyperlink{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
1491 
1492     \textcolor{comment}{/* setup current data */}
1493     master\_th     = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ]; \textcolor{comment}{// AC: potentially unsafe, not in sync with
       shutdown}
1494     parent\_team   = master\_th->th.th\_team;
1495     master\_tid    = master\_th->th.th\_info.ds.ds\_tid;
1496     master\_this\_cons = master\_th->th.th\_local.this\_construct;
1497     root          = master\_th->th.th\_root;
1498     master\_active = root->r.r\_active;
1499     master\_set\_numthreads = master\_th->th.th\_set\_nproc;
1500 
1501 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1502 \textcolor{preprocessor}{}    ompt\_parallel\_id\_t ompt\_parallel\_id;
1503     ompt\_task\_id\_t ompt\_task\_id;
1504     ompt\_frame\_t *ompt\_frame;
1505     ompt\_task\_id\_t my\_task\_id;
1506     ompt\_parallel\_id\_t my\_parallel\_id;
1507 
1508     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1509         ompt\_parallel\_id = \hyperlink{ompt-specific_8c_a541d97d3f1e1d09a459326dd60c630ce}{\_\_ompt\_parallel\_id\_new}(gtid);
1510         ompt\_task\_id = \hyperlink{ompt-specific_8c_a18b0095c57b9a12664adf9ac87a52062}{\_\_ompt\_get\_task\_id\_internal}(0);
1511         ompt\_frame = \hyperlink{ompt-specific_8c_af8e9ca4aa0c4492074f01f5c67f6da51}{\_\_ompt\_get\_task\_frame\_internal}(0);
1512     \}
1513 \textcolor{preprocessor}{#endif}
1514 \textcolor{preprocessor}{}
1515     \textcolor{comment}{// Nested level will be an index in the nested nthreads array}
1516     level         = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level;
1517 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1518 \textcolor{preprocessor}{}    active\_level  = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level; \textcolor{comment}{// is used to launch non-serial teams even if nested is
       not allowed}
1519     teams\_level    = master\_th->th.th\_teams\_level; \textcolor{comment}{// needed to check nesting inside the teams}
1520 \textcolor{preprocessor}{#endif}
1521 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
1522 \textcolor{preprocessor}{}    p\_hot\_teams   = &master\_th->th.th\_hot\_teams;
1523     \textcolor{keywordflow}{if}( *p\_hot\_teams == NULL && \_\_kmp\_hot\_teams\_max\_level > 0 ) \{
1524         *p\_hot\_teams = (kmp\_hot\_team\_ptr\_t*)\hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(
1525                 \textcolor{keyword}{sizeof}(kmp\_hot\_team\_ptr\_t) * \_\_kmp\_hot\_teams\_max\_level);
1526         (*p\_hot\_teams)[0].hot\_team = root->r.r\_hot\_team;
1527         (*p\_hot\_teams)[0].hot\_team\_nth = 1; \textcolor{comment}{// it is either actual or not needed (when active\_level > 0)}
1528     \}
1529 \textcolor{preprocessor}{#endif}
1530 \textcolor{preprocessor}{}
1531 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1532 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
1533         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_begin)) \{
1534         \textcolor{keywordtype}{int} team\_size = master\_set\_numthreads;
1535 
1536         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_begin)(
1537             ompt\_task\_id, ompt\_frame, ompt\_parallel\_id,
1538             team\_size, unwrapped\_task, \hyperlink{ompt-internal_8h_a0afe14fdda6f1478f12e6dd2e754e3af}{OMPT\_INVOKER}(call\_context));
1539     \}
1540 \textcolor{preprocessor}{#endif}
1541 \textcolor{preprocessor}{}
1542     master\_th->th.th\_ident = loc;
1543 
1544 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1545 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( master\_th->th.th\_teams\_microtask &&
1546          ap && microtask != (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} && level == 
      teams\_level ) \{
1547         \textcolor{comment}{// AC: This is start of parallel that is nested inside teams construct.}
1548         \textcolor{comment}{//     The team is actual (hot), all workers are ready at the fork barrier.}
1549         \textcolor{comment}{//     No lock needed to initialize the team a bit, then free workers.}
1550         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident = loc;
1551         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc  = argc;
1552         argv = (\textcolor{keywordtype}{void}**)parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv;
1553         \textcolor{keywordflow}{for}( i=argc-1; i >= 0; --i )
1554 \textcolor{comment}{/* TODO: revert workaround for Intel(R) 64 tracker #96 */}
1555 \textcolor{preprocessor}{#if (KMP\_ARCH\_X86\_64 || KMP\_ARCH\_ARM || KMP\_ARCH\_AARCH64) && KMP\_OS\_LINUX}
1556 \textcolor{preprocessor}{}            *argv++ = va\_arg( *ap, \textcolor{keywordtype}{void} * );
1557 \textcolor{preprocessor}{#else}
1558 \textcolor{preprocessor}{}            *argv++ = va\_arg( ap, \textcolor{keywordtype}{void} * );
1559 \textcolor{preprocessor}{#endif}
1560 \textcolor{preprocessor}{}        \textcolor{comment}{/* Increment our nested depth levels, but not increase the serialization */}
1561         \textcolor{keywordflow}{if} ( parent\_team == master\_th->th.th\_serial\_team ) \{
1562             \textcolor{comment}{// AC: we are in serialized parallel}
1563             \hyperlink{group__PARALLEL_ga7b1ba1cc8d9d2fea8654bbb1e59f079e}{\_\_kmpc\_serialized\_parallel}(loc, gtid);
1564             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized > 1 );
1565             parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized--; \textcolor{comment}{// AC: need this in order enquiry functions}
1566                                            \textcolor{comment}{//     work correctly, will restore at join time}
1567 
1568 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1569 \textcolor{preprocessor}{}            \textcolor{keywordtype}{void} *dummy;
1570             \textcolor{keywordtype}{void} **exit\_runtime\_p;
1571 
1572             \hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t} lw\_taskteam;
1573 
1574             \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1575                 \hyperlink{ompt-specific_8c_aa3b1a660dbaf7d2a72732e1eebc4d3db}{\_\_ompt\_lw\_taskteam\_init}(&lw\_taskteam, master\_th, gtid,
1576                     unwrapped\_task, ompt\_parallel\_id);
1577                 lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 
      \hyperlink{ompt-specific_8c_a00dc76b44da40dee97e27a16c472e0ca}{\_\_ompt\_task\_id\_new}(gtid);
1578                 exit\_runtime\_p = &(lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.
      \hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame);
1579 
1580                 \hyperlink{ompt-specific_8c_a3272fe5fad9706e746997b6c6aa55458}{\_\_ompt\_lw\_taskteam\_link}(&lw\_taskteam, master\_th);
1581 
1582 \textcolor{preprocessor}{#if OMPT\_TRACE}
1583 \textcolor{preprocessor}{}                \textcolor{comment}{/* OMPT implicit task begin */}
1584                 my\_task\_id = lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id};
1585                 my\_parallel\_id = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.parallel\_id;
1586                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)) \{
1587                     \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)(
1588                         my\_parallel\_id, my\_task\_id);
1589                 \}
1590 \textcolor{preprocessor}{#endif}
1591 \textcolor{preprocessor}{}
1592                 \textcolor{comment}{/* OMPT state */}
1593                 master\_th->th.ompt\_thread\_info.state = ompt\_state\_work\_parallel;
1594             \} \textcolor{keywordflow}{else} \{
1595                 exit\_runtime\_p = &dummy;
1596             \}
1597 \textcolor{preprocessor}{#endif}
1598 \textcolor{preprocessor}{}
1599             \{
1600                 \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
1601                 \hyperlink{kmp_8h_af1b91ebb601311b9b29a6d1d8db93243}{\_\_kmp\_invoke\_microtask}( microtask, gtid, 0, argc, parent\_team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv
1602 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
1603                                         , exit\_runtime\_p
1604 #endif
1605                                         );
1606             \}
1607 
1608 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1609 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1610 \textcolor{preprocessor}{#if OMPT\_TRACE}
1611 \textcolor{preprocessor}{}                lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
1612 
1613                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)) \{
1614                     \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)(
1615                         ompt\_parallel\_id, ompt\_task\_id);
1616                 \}
1617 
1618                 \hyperlink{ompt-specific_8c_a08e5e3e94237b2bf04a271d942936eef}{\_\_ompt\_lw\_taskteam\_unlink}(master\_th);
1619                 \textcolor{comment}{// reset clear the task id only after unlinking the task}
1620                 lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = ompt\_task\_id\_none;
1621 \textcolor{preprocessor}{#endif}
1622 \textcolor{preprocessor}{}
1623                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)) \{
1624                     \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)(
1625                         ompt\_parallel\_id, ompt\_task\_id,
1626                         \hyperlink{ompt-internal_8h_a0afe14fdda6f1478f12e6dd2e754e3af}{OMPT\_INVOKER}(call\_context));
1627                 \}
1628                 master\_th->th.ompt\_thread\_info.state = ompt\_state\_overhead;
1629             \}
1630 \textcolor{preprocessor}{#endif}
1631 \textcolor{preprocessor}{}            \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1632         \}
1633 
1634         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn  = microtask;
1635 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1636 \textcolor{preprocessor}{}        parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.microtask = unwrapped\_task;
1637 \textcolor{preprocessor}{#endif}
1638 \textcolor{preprocessor}{}        parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke = invoker;
1639         \hyperlink{kmp__os_8h_a201982f51ff23ad84ae6781ad4265e3a}{KMP\_TEST\_THEN\_INC32}( (kmp\_int32*) &root->r.r\_in\_parallel );
1640         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level ++;
1641         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level ++;
1642 
1643         \textcolor{comment}{/* Change number of threads in the team if requested */}
1644         \textcolor{keywordflow}{if} ( master\_set\_numthreads ) \{   \textcolor{comment}{// The parallel has num\_threads clause}
1645             \textcolor{keywordflow}{if} ( master\_set\_numthreads < master\_th->th.th\_teams\_size.nth ) \{
1646                 \textcolor{comment}{// AC: only can reduce the number of threads dynamically, cannot increase}
1647                 \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **other\_threads = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
1648                 parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = master\_set\_numthreads;
1649                 \textcolor{keywordflow}{for} ( i = 0; i < master\_set\_numthreads; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
1650                     other\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}]->th.th\_team\_nproc = master\_set\_numthreads;
1651                 \}
1652                 \textcolor{comment}{// Keep extra threads hot in the team for possible next parallels}
1653             \}
1654             master\_th->th.th\_set\_nproc = 0;
1655         \}
1656 
1657 \textcolor{preprocessor}{#if USE\_DEBUGGER}
1658 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_kmp\_debugging ) \{    \textcolor{comment}{// Let debugger override number of threads.}
1659         \textcolor{keywordtype}{int} nth = \_\_kmp\_omp\_num\_threads( loc );
1660         \textcolor{keywordflow}{if} ( nth > 0 ) \{        \textcolor{comment}{// 0 means debugger does not want to change number of threads.}
1661             master\_set\_numthreads = nth;
1662         \}; \textcolor{comment}{// if}
1663     \}; \textcolor{comment}{// if}
1664 \textcolor{preprocessor}{#endif}
1665 \textcolor{preprocessor}{}
1666         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: before internal fork: root=%p, team=%p, master\_th=%p,
       gtid=%d\(\backslash\)n"}, root, parent\_team, master\_th, gtid ) );
1667         \hyperlink{kmp__runtime_8c_aa733ff3ae9a095e5dd24907ca3adf92e}{\_\_kmp\_internal\_fork}( loc, gtid, parent\_team );
1668         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: after internal fork: root=%p, team=%p, master\_th=%p,
       gtid=%d\(\backslash\)n"}, root, parent\_team, master\_th, gtid ) );
1669 
1670         \textcolor{comment}{/* Invoke microtask for MASTER thread */}
1671         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d(%d:0) invoke microtask = %p\(\backslash\)n"},
1672                     gtid, parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn ) );
1673 
1674         \{
1675             \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
1676             \textcolor{keywordflow}{if} (! parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke( gtid )) \{
1677                 \hyperlink{kmp__debug_8h_afa985a577299cb10dafe8d3bd462d635}{KMP\_ASSERT2}( 0, \textcolor{stringliteral}{"cannot invoke microtask for MASTER thread"} );
1678             \}
1679         \}
1680         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d(%d:0) done microtask = %p\(\backslash\)n"},
1681             gtid, parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn ) );
1682         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
1683 
1684         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: parallel exit T#%d\(\backslash\)n"}, gtid ));
1685 
1686         \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1687     \} \textcolor{comment}{// Parallel closely nested in teams construct}
1688 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1689 \textcolor{preprocessor}{}
1690 \textcolor{preprocessor}{#if KMP\_DEBUG}
1691 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
1692         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(master\_th->th.th\_task\_team == parent\_team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.th\_task\_state]);
1693     \}
1694 \textcolor{preprocessor}{#endif}
1695 \textcolor{preprocessor}{}
1696     \textcolor{keywordflow}{if} ( parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level >= master\_th->th.th\_current\_task->td\_icvs.max\_active\_levels ) \{
1697         nthreads = 1;
1698     \} \textcolor{keywordflow}{else} \{
1699 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1700 \textcolor{preprocessor}{}        \textcolor{keywordtype}{int} enter\_teams = ((ap==NULL && active\_level==0)||(ap && teams\_level>0 && teams\_level==level));
1701 \textcolor{preprocessor}{#endif}
1702 \textcolor{preprocessor}{}        nthreads = master\_set\_numthreads ?
1703             master\_set\_numthreads : \hyperlink{kmp_8h_a2abbe3ac4913a220526df580e52ee8ac}{get\_\_nproc\_2}( parent\_team, master\_tid ); \textcolor{comment}{// TODO: get nproc
       directly from current task}
1704 
1705         \textcolor{comment}{// Check if we need to take forkjoin lock? (no need for serialized parallel out of teams
       construct).}
1706         \textcolor{comment}{// This code moved here from \_\_kmp\_reserve\_threads() to speedup nested serialized parallels.}
1707         \textcolor{keywordflow}{if} (nthreads > 1) \{
1708             \textcolor{keywordflow}{if} ( ( !\hyperlink{kmp_8h_a8ab0a9ce64834c1da7adf63f04031da9}{get\_\_nested}(master\_th) && (root->r.r\_in\_parallel
1709 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
1710                 && !enter\_teams
1711 #endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
1712             ) ) || ( \hyperlink{kmp_8h_aa8f77de14d1515a05937d68622e74d61}{\_\_kmp\_library} == \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599dab9408e6f6c86c0912aea425b98e37d5a}{library\_serial} ) ) \{
1713                 \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d serializing team; requested %d threads\(\backslash\)n"},
1714                                 gtid, nthreads ));
1715                 nthreads = 1;
1716             \}
1717         \}
1718         \textcolor{keywordflow}{if} ( nthreads > 1 ) \{
1719             \textcolor{comment}{/* determine how many new threads we can use */}
1720             \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
1721 
1722             nthreads = \hyperlink{kmp__runtime_8c_adbe354e826a5327d1f0a7cb6cac7c6ba}{\_\_kmp\_reserve\_threads}(root, parent\_team, master\_tid, nthreads
1723 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
1724 \textcolor{comment}{/* AC: If we execute teams from parallel region (on host), then teams should be created}
1725 \textcolor{comment}{   but each can only have 1 thread if nesting is disabled. If teams called from serial region,}
1726 \textcolor{comment}{   then teams and their threads should be created regardless of the nesting setting. */}
1727                                          , enter\_teams
1728 #endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
1729                                          );
1730             \textcolor{keywordflow}{if} ( nthreads == 1 ) \{
1731                 \textcolor{comment}{// Free lock for single thread execution here;}
1732                 \textcolor{comment}{// for multi-thread execution it will be freed later}
1733                 \textcolor{comment}{// after team of threads created and initialized}
1734                 \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
1735             \}
1736         \}
1737     \}
1738     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( nthreads > 0 );
1739 
1740     \textcolor{comment}{/* If we temporarily changed the set number of threads then restore it now */}
1741     master\_th->th.th\_set\_nproc = 0;
1742 
1743     \textcolor{comment}{/* create a serialized parallel region? */}
1744     \textcolor{keywordflow}{if} ( nthreads == 1 ) \{
1745         \textcolor{comment}{/* josh todo: hypothetical question: what do we do for OS X*? */}
1746 \textcolor{preprocessor}{#if KMP\_OS\_LINUX && ( KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 || KMP\_ARCH\_ARM || KMP\_ARCH\_AARCH64)}
1747 \textcolor{preprocessor}{}        \textcolor{keywordtype}{void} *   \hyperlink{kmp__str_8c_acd08a6295eccfeb30c79985f047e4be5}{args}[ argc ];
1748 \textcolor{preprocessor}{#else}
1749 \textcolor{preprocessor}{}        \textcolor{keywordtype}{void} * * args = (\textcolor{keywordtype}{void}**) \hyperlink{kmp__safe__c__api_8h_a2280690d07037589e6ac2faf9e9a2b28}{KMP\_ALLOCA}( argc * \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{void} * ) );
1750 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_OS\_LINUX && ( KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 || KMP\_ARCH\_ARM || KMP\_ARCH\_AARCH64) */}\textcolor{preprocessor}{}
1751 \textcolor{preprocessor}{}
1752         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d serializing parallel region\(\backslash\)n"}, gtid ));
1753 
1754         \hyperlink{group__PARALLEL_ga7b1ba1cc8d9d2fea8654bbb1e59f079e}{\_\_kmpc\_serialized\_parallel}(loc, gtid);
1755 
1756         \textcolor{keywordflow}{if} ( call\_context == \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel} ) \{
1757             \textcolor{comment}{/* TODO this sucks, use the compiler itself to pass args! :) */}
1758             master\_th->th.th\_serial\_team->t.t\_ident = loc;
1759 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1760 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} ( !ap ) \{
1761                 \textcolor{comment}{// revert change made in \_\_kmpc\_serialized\_parallel()}
1762                 master\_th->th.th\_serial\_team->t.t\_level--;
1763                 \textcolor{comment}{// Get args from parent team for teams construct}
1764 
1765 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1766 \textcolor{preprocessor}{}                \textcolor{keywordtype}{void} *dummy;
1767                 \textcolor{keywordtype}{void} **exit\_runtime\_p;
1768 
1769                 \hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t} lw\_taskteam;
1770 
1771                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1772                     \hyperlink{ompt-specific_8c_aa3b1a660dbaf7d2a72732e1eebc4d3db}{\_\_ompt\_lw\_taskteam\_init}(&lw\_taskteam, master\_th, gtid,
1773                         unwrapped\_task, ompt\_parallel\_id);
1774                     lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 
      \hyperlink{ompt-specific_8c_a00dc76b44da40dee97e27a16c472e0ca}{\_\_ompt\_task\_id\_new}(gtid);
1775                     exit\_runtime\_p = &(lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.
      \hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame);
1776 
1777                     \hyperlink{ompt-specific_8c_a3272fe5fad9706e746997b6c6aa55458}{\_\_ompt\_lw\_taskteam\_link}(&lw\_taskteam, master\_th);
1778 
1779 \textcolor{preprocessor}{#if OMPT\_TRACE}
1780 \textcolor{preprocessor}{}                    my\_task\_id = lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.
      \hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id};
1781                     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)) \{
1782                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)(
1783                             ompt\_parallel\_id, my\_task\_id);
1784                     \}
1785 \textcolor{preprocessor}{#endif}
1786 \textcolor{preprocessor}{}
1787                     \textcolor{comment}{/* OMPT state */}
1788                     master\_th->th.ompt\_thread\_info.state = ompt\_state\_work\_parallel;
1789                 \} \textcolor{keywordflow}{else} \{
1790                     exit\_runtime\_p = &dummy;
1791                 \}
1792 \textcolor{preprocessor}{#endif}
1793 \textcolor{preprocessor}{}
1794                 \{
1795                     \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
1796                     \hyperlink{kmp_8h_af1b91ebb601311b9b29a6d1d8db93243}{\_\_kmp\_invoke\_microtask}( microtask, gtid, 0, argc, parent\_team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv
1797 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
1798                         , exit\_runtime\_p
1799 #endif
1800                     );
1801                 \}
1802 
1803 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1804 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1805                     lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
1806 
1807 \textcolor{preprocessor}{#if OMPT\_TRACE}
1808 \textcolor{preprocessor}{}                    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)) \{
1809                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)(
1810                             ompt\_parallel\_id, ompt\_task\_id);
1811                     \}
1812 \textcolor{preprocessor}{#endif}
1813 \textcolor{preprocessor}{}
1814                     \hyperlink{ompt-specific_8c_a08e5e3e94237b2bf04a271d942936eef}{\_\_ompt\_lw\_taskteam\_unlink}(master\_th);
1815                     \textcolor{comment}{// reset clear the task id only after unlinking the task}
1816                     lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = ompt\_task\_id\_none;
1817 
1818                     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)) \{
1819                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)(
1820                             ompt\_parallel\_id, ompt\_task\_id,
1821                             \hyperlink{ompt-internal_8h_a0afe14fdda6f1478f12e6dd2e754e3af}{OMPT\_INVOKER}(call\_context));
1822                     \}
1823                     master\_th->th.ompt\_thread\_info.state = ompt\_state\_overhead;
1824                 \}
1825 \textcolor{preprocessor}{#endif}
1826 \textcolor{preprocessor}{}            \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( microtask == (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} ) \{
1827                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( master\_th->th.th\_team == master\_th->th.th\_serial\_team );
1828                 team = master\_th->th.th\_team;
1829                 \textcolor{comment}{//team->t.t\_pkfn = microtask;}
1830                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke = invoker;
1831                 \hyperlink{kmp__runtime_8c_ace70afe7c1c078fe3de2a7a293b17817}{\_\_kmp\_alloc\_argv\_entries}( argc, team, 
      \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
1832                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc = argc;
1833                 argv = (\textcolor{keywordtype}{void}**) team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv;
1834                 if ( ap ) \{
1835                     \textcolor{keywordflow}{for}( i=argc-1; i >= 0; --\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} )
1836 \textcolor{comment}{// TODO: revert workaround for Intel(R) 64 tracker #96}
1837 # \textcolor{keywordflow}{if} (\hyperlink{kmp__platform_8h_a4bbc822bf311c981aab5b1704c1566ab}{KMP\_ARCH\_X86\_64} || KMP\_ARCH\_ARM || \hyperlink{kmp__platform_8h_ac8a9f5686f72dd943400cd0e44eea79e}{KMP\_ARCH\_AARCH64}) && 
      \hyperlink{kmp__platform_8h_a08355ecda6b7d50d12e62476c0727cba}{KMP\_OS\_LINUX}
1838                         *argv++ = va\_arg( *ap, \textcolor{keywordtype}{void} * );
1839 \textcolor{preprocessor}{# else}
1840 \textcolor{preprocessor}{}                        *argv++ = va\_arg( ap, \textcolor{keywordtype}{void} * );
1841 \textcolor{preprocessor}{# endif}
1842 \textcolor{preprocessor}{}                \} \textcolor{keywordflow}{else} \{
1843                     \textcolor{keywordflow}{for}( i=0; i < argc; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} )
1844                         \textcolor{comment}{// Get args from parent team for teams construct}
1845                         argv[i] = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv[i];
1846                 \}
1847                 \textcolor{comment}{// AC: revert change made in \_\_kmpc\_serialized\_parallel()}
1848                 \textcolor{comment}{//     because initial code in teams should have level=0}
1849                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level--;
1850                 \textcolor{comment}{// AC: call special invoker for outer "parallel" of the teams construct}
1851                 \{
1852                     \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
1853                     invoker(gtid);
1854                 \}
1855             \} \textcolor{keywordflow}{else} \{
1856 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1857 \textcolor{preprocessor}{}                argv = \hyperlink{kmp__str_8c_acd08a6295eccfeb30c79985f047e4be5}{args};
1858                 \textcolor{keywordflow}{for}( i=argc-1; i >= 0; --\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} )
1859 \textcolor{comment}{// TODO: revert workaround for Intel(R) 64 tracker #96}
1860 #\textcolor{keywordflow}{if} (\hyperlink{kmp__platform_8h_a4bbc822bf311c981aab5b1704c1566ab}{KMP\_ARCH\_X86\_64} || KMP\_ARCH\_ARM || \hyperlink{kmp__platform_8h_ac8a9f5686f72dd943400cd0e44eea79e}{KMP\_ARCH\_AARCH64}) && 
      \hyperlink{kmp__platform_8h_a08355ecda6b7d50d12e62476c0727cba}{KMP\_OS\_LINUX}
1861                     *argv++ = va\_arg( *ap, \textcolor{keywordtype}{void} * );
1862 \textcolor{preprocessor}{#else}
1863 \textcolor{preprocessor}{}                    *argv++ = va\_arg( ap, \textcolor{keywordtype}{void} * );
1864 \textcolor{preprocessor}{#endif}
1865 \textcolor{preprocessor}{}                \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1866 
1867 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1868 \textcolor{preprocessor}{}                \textcolor{keywordtype}{void} *dummy;
1869                 \textcolor{keywordtype}{void} **exit\_runtime\_p;
1870 
1871                 \hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t} lw\_taskteam;
1872 
1873                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1874                     \hyperlink{ompt-specific_8c_aa3b1a660dbaf7d2a72732e1eebc4d3db}{\_\_ompt\_lw\_taskteam\_init}(&lw\_taskteam, master\_th, gtid,
1875                         unwrapped\_task, ompt\_parallel\_id);
1876                     lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 
      \hyperlink{ompt-specific_8c_a00dc76b44da40dee97e27a16c472e0ca}{\_\_ompt\_task\_id\_new}(gtid);
1877                     exit\_runtime\_p = &(lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.
      \hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame);
1878 
1879                     \hyperlink{ompt-specific_8c_a3272fe5fad9706e746997b6c6aa55458}{\_\_ompt\_lw\_taskteam\_link}(&lw\_taskteam, master\_th);
1880 
1881 \textcolor{preprocessor}{#if OMPT\_TRACE}
1882 \textcolor{preprocessor}{}                    \textcolor{comment}{/* OMPT implicit task begin */}
1883                     my\_task\_id = lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.
      \hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id};
1884                     my\_parallel\_id = ompt\_parallel\_id;
1885                     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)) \{
1886                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)(
1887                             my\_parallel\_id, my\_task\_id);
1888                     \}
1889 \textcolor{preprocessor}{#endif}
1890 \textcolor{preprocessor}{}
1891                     \textcolor{comment}{/* OMPT state */}
1892                     master\_th->th.ompt\_thread\_info.state = ompt\_state\_work\_parallel;
1893                 \} \textcolor{keywordflow}{else} \{
1894                     exit\_runtime\_p = &dummy;
1895                 \}
1896 \textcolor{preprocessor}{#endif}
1897 \textcolor{preprocessor}{}
1898                 \{
1899                     \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
1900                     \hyperlink{kmp_8h_af1b91ebb601311b9b29a6d1d8db93243}{\_\_kmp\_invoke\_microtask}( microtask, gtid, 0, argc, args
1901 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
1902                         , exit\_runtime\_p
1903 #endif
1904                     );
1905                 \}
1906 
1907 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1908 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1909 \textcolor{preprocessor}{#if OMPT\_TRACE}
1910 \textcolor{preprocessor}{}                    lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
1911 
1912                     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)) \{
1913                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)(
1914                             my\_parallel\_id, my\_task\_id);
1915                     \}
1916 \textcolor{preprocessor}{#endif}
1917 \textcolor{preprocessor}{}
1918                     \hyperlink{ompt-specific_8c_a08e5e3e94237b2bf04a271d942936eef}{\_\_ompt\_lw\_taskteam\_unlink}(master\_th);
1919                     \textcolor{comment}{// reset clear the task id only after unlinking the task}
1920                     lw\_taskteam.\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = ompt\_task\_id\_none;
1921 
1922                     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)) \{
1923                         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_parallel\_end)(
1924                             ompt\_parallel\_id, ompt\_task\_id,
1925                             \hyperlink{ompt-internal_8h_a0afe14fdda6f1478f12e6dd2e754e3af}{OMPT\_INVOKER}(call\_context));
1926                     \}
1927                     master\_th->th.ompt\_thread\_info.state = ompt\_state\_overhead;
1928                 \}
1929 \textcolor{preprocessor}{#endif}
1930 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1931 \textcolor{preprocessor}{}            \}
1932 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1933 \textcolor{preprocessor}{}        \}
1934         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( call\_context == \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0a58c5bad04e427f0063bb39d20405a18c}{fork\_context\_gnu} ) \{
1935 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1936 \textcolor{preprocessor}{}            \hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t} *lwt = (\hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t} *)
1937                 \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(\textcolor{keyword}{sizeof}(\hyperlink{structompt__lw__taskteam__s}{ompt\_lw\_taskteam\_t}));
1938             \hyperlink{ompt-specific_8c_aa3b1a660dbaf7d2a72732e1eebc4d3db}{\_\_ompt\_lw\_taskteam\_init}(lwt, master\_th, gtid,
1939                 unwrapped\_task, ompt\_parallel\_id);
1940 
1941             lwt->\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 
      \hyperlink{ompt-specific_8c_a00dc76b44da40dee97e27a16c472e0ca}{\_\_ompt\_task\_id\_new}(gtid);
1942             lwt->\hyperlink{structompt__lw__taskteam__s_aef7e0a0307d5b34644ddaa0cc7e9ba46}{ompt\_task\_info}.\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
1943             \hyperlink{ompt-specific_8c_a3272fe5fad9706e746997b6c6aa55458}{\_\_ompt\_lw\_taskteam\_link}(lwt, master\_th);
1944 \textcolor{preprocessor}{#endif}
1945 \textcolor{preprocessor}{}
1946             \textcolor{comment}{// we were called from GNU native code}
1947             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d serial exit\(\backslash\)n"}, gtid ));
1948             \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1949         \}
1950         \textcolor{keywordflow}{else} \{
1951             \hyperlink{kmp__debug_8h_afa985a577299cb10dafe8d3bd462d635}{KMP\_ASSERT2}( call\_context < \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0ab74424b0d5514623d5e299d30ebd8df2}{fork\_context\_last}, \textcolor{stringliteral}{"\_\_kmp\_fork\_call:
       unknown fork\_context parameter"} );
1952         \}
1953 
1954 
1955         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d serial exit\(\backslash\)n"}, gtid ));
1956         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1957         \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1958     \}
1959 
1960     \textcolor{comment}{// GEH: only modify the executing flag in the case when not serialized}
1961     \textcolor{comment}{//      serialized case is handled in kmpc\_serialized\_parallel}
1962     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: parent\_team\_aclevel=%d, master\_th=%p, curtask=%p,
       curtask\_max\_aclevel=%d\(\backslash\)n"},
1963                   parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level, master\_th, master\_th->th.th\_current\_task,
1964                   master\_th->th.th\_current\_task->td\_icvs.max\_active\_levels ) );
1965     \textcolor{comment}{// TODO: GEH - cannot do this assertion because root thread not set up as executing}
1966     \textcolor{comment}{// KMP\_ASSERT( master\_th->th.th\_current\_task->td\_flags.executing == 1 );}
1967     master\_th->th.th\_current\_task->td\_flags.executing = 0;
1968 
1969 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1970 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( !master\_th->th.th\_teams\_microtask || level > teams\_level )
1971 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1972 \textcolor{preprocessor}{}    \{
1973         \textcolor{comment}{/* Increment our nested depth level */}
1974         \hyperlink{kmp__os_8h_a201982f51ff23ad84ae6781ad4265e3a}{KMP\_TEST\_THEN\_INC32}( (kmp\_int32*) &root->r.r\_in\_parallel );
1975     \}
1976 
1977     \textcolor{comment}{// See if we need to make a copy of the ICVs.}
1978     \textcolor{keywordtype}{int} nthreads\_icv = master\_th->th.th\_current\_task->td\_icvs.nproc;
1979     \textcolor{keywordflow}{if} ((level+1 < \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used}) && (
      \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[level+1] != nthreads\_icv)) \{
1980         nthreads\_icv = \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[level+1];
1981     \}
1982     \textcolor{keywordflow}{else} \{
1983         nthreads\_icv = 0;  \textcolor{comment}{// don't update}
1984     \}
1985 
1986 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1987 \textcolor{preprocessor}{}    \textcolor{comment}{// Figure out the proc\_bind\_policy for the new team.}
1988     \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\_proc\_bind\_t} proc\_bind = master\_th->th.th\_set\_proc\_bind;
1989     \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\_proc\_bind\_t} proc\_bind\_icv = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default}; \textcolor{comment}{// proc\_bind\_default
       means don't update}
1990     \textcolor{keywordflow}{if} ( master\_th->th.th\_current\_task->td\_icvs.proc\_bind == \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a26efad2e13ae31e934f83c4d9a6ceb99}{proc\_bind\_false} ) \{
1991         proc\_bind = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a26efad2e13ae31e934f83c4d9a6ceb99}{proc\_bind\_false};
1992     \}
1993     \textcolor{keywordflow}{else} \{
1994         \textcolor{keywordflow}{if} (proc\_bind == \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default}) \{
1995             \textcolor{comment}{// No proc\_bind clause specified; use current proc-bind-var for this parallel region}
1996             proc\_bind = master\_th->th.th\_current\_task->td\_icvs.proc\_bind;
1997         \}
1998         \textcolor{comment}{/* else: The proc\_bind policy was specified explicitly on parallel clause. This}
1999 \textcolor{comment}{           overrides proc-bind-var for this parallel region, but does not change proc-bind-var. */}
2000         \textcolor{comment}{// Figure the value of proc-bind-var for the child threads.}
2001         \textcolor{keywordflow}{if} ((level+1 < \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a4ab1e74b13e91c54a0ff105c9d7db9f6}{used})
2002             && (\hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[level+1] != master\_th->th
      .th\_current\_task->td\_icvs.proc\_bind)) \{
2003             proc\_bind\_icv = \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.
      \hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[level+1];
2004         \}
2005     \}
2006 
2007     \textcolor{comment}{// Reset for next parallel region}
2008     master\_th->th.th\_set\_proc\_bind = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default};
2009 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2010 \textcolor{preprocessor}{}
2011     \textcolor{keywordflow}{if} ((nthreads\_icv > 0)
2012 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
2013         || (proc\_bind\_icv != \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default})
2014 #endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
2015         ) \{
2016         \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} new\_icvs;
2017         \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}(&new\_icvs, &master\_th->th.th\_current\_task->td\_icvs);
2018         new\_icvs.\hyperlink{structkmp__internal__control_a4860e215a4af81a65d3441cdf8b2fd97}{next} = NULL;
2019         \textcolor{keywordflow}{if} (nthreads\_icv > 0) \{
2020             new\_icvs.\hyperlink{structkmp__internal__control_a807067319fd06b644c3aecefadac01e6}{nproc} = nthreads\_icv;
2021         \}
2022 
2023 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2024 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (proc\_bind\_icv != \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default}) \{
2025             new\_icvs.\hyperlink{structkmp__internal__control_a17ef4ac8abe321e2d0ea11f730be3995}{proc\_bind} = proc\_bind\_icv;
2026         \}
2027 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2028 \textcolor{preprocessor}{}
2029         \textcolor{comment}{/* allocate a new parallel team */}
2030         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: before \_\_kmp\_allocate\_team\(\backslash\)n"} ) );
2031         team = \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}(root, nthreads, nthreads,
2032 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
2033                                    ompt\_parallel\_id,
2034 #endif
2035 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
2036                                    proc\_bind,
2037 #endif
2038                                    &new\_icvs, argc \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(master\_th) );
2039     \} \textcolor{keywordflow}{else} \{
2040         \textcolor{comment}{/* allocate a new parallel team */}
2041         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: before \_\_kmp\_allocate\_team\(\backslash\)n"} ) );
2042         team = \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}(root, nthreads, nthreads,
2043 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
2044                                    ompt\_parallel\_id,
2045 #endif
2046 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
2047                                    proc\_bind,
2048 #endif
2049                                    &master\_th->th.th\_current\_task->td\_icvs, argc
2050                                    \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(master\_th) );
2051     \}
2052     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: after \_\_kmp\_allocate\_team - team = %p\(\backslash\)n"}, team ) );
2053 
2054     \textcolor{comment}{/* setup the new team */}
2055     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid = master\_tid;
2056     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_this\_cons = master\_this\_cons;
2057     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident      = loc;
2058     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent     = parent\_team;
2059     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn, microtask);
2060 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2061 \textcolor{preprocessor}{}    \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.microtask, unwrapped\_task);
2062 \textcolor{preprocessor}{#endif}
2063 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke     = invoker;  \textcolor{comment}{/* TODO move this to root, maybe */}
2064     \textcolor{comment}{// TODO: parent\_team->t.t\_level == INT\_MAX ???}
2065 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2066 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( !master\_th->th.th\_teams\_microtask || level > teams\_level ) \{
2067 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2068 \textcolor{preprocessor}{}        team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level        = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level + 1;
2069         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level + 1;
2070 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2071 \textcolor{preprocessor}{}    \} \textcolor{keywordflow}{else} \{
2072         \textcolor{comment}{// AC: Do not increase parallel level at start of the teams construct}
2073         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level        = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level;
2074         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level;
2075     \}
2076 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2077 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched      = \hyperlink{kmp_8h_a8595645f5a1edaa9b625e5acb548a32c}{get\_\_sched\_2}(parent\_team, master\_tid); \textcolor{comment}{// set master's schedule as
       new run-time schedule}
2078 
2079 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2080 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_cancel\_request = \hyperlink{kmp_8h_a7346f2e741ade19c05b63e57099c7cfeaf5b4fc915ab576dd1e7d4ad12b5dc6c0}{cancel\_noreq};
2081 \textcolor{preprocessor}{#endif}
2082 \textcolor{preprocessor}{}
2083     \textcolor{comment}{// Update the floating point rounding in the team if required.}
2084     \hyperlink{kmp__runtime_8c_a1fe9d72aca3be52b82f7ddba504a6def}{propagateFPControl}(team);
2085 
2086     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
2087         \textcolor{comment}{// Set master's task team to team's task team. Unless this is hot team, it should be NULL.}
2088 \textcolor{preprocessor}{#if 0}
2089 \textcolor{preprocessor}{}        \textcolor{comment}{// Patch out an assertion that trips while the runtime seems to operate correctly.}
2090         \textcolor{comment}{// Avoiding the preconditions that cause the assertion to trip has been promised as a forthcoming
       patch.}
2091         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(master\_th->th.th\_task\_team == parent\_team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.th\_task\_state]);
2092 \textcolor{preprocessor}{#endif}
2093 \textcolor{preprocessor}{}        \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_fork\_call: Master T#%d pushing task\_team %p / team %p, new task\_team
       %p / team %p\(\backslash\)n"},
2094                       \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( master\_th ), master\_th->th.th\_task\_team
      ,
2095                       parent\_team, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.th\_task\_state], team ) );
2096 
2097         \textcolor{keywordflow}{if} ( level || master\_th->th.th\_task\_team ) \{
2098             \textcolor{comment}{// Take a memo of master's task\_state}
2099             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(master\_th->th.th\_task\_state\_memo\_stack);
2100             \textcolor{keywordflow}{if} (master\_th->th.th\_task\_state\_top >= master\_th->th.th\_task\_state\_stack\_sz) \{ \textcolor{comment}{// increase size}
2101                 kmp\_uint32 \hyperlink{ittnotify__static_8h_a2b3f76e6c1e053f69bf377c00991ba4d}{new\_size} = 2*master\_th->th.th\_task\_state\_stack\_sz;
2102                 kmp\_uint8 *old\_stack, *new\_stack;
2103                 kmp\_uint32 \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
2104                 new\_stack = (kmp\_uint8 *)\hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(new\_size);
2105                 \textcolor{keywordflow}{for} (i=0; i<master\_th->th.th\_task\_state\_stack\_sz; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \{
2106                     new\_stack[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}] = master\_th->th.th\_task\_state\_memo\_stack[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}];
2107                 \}
2108                 \textcolor{keywordflow}{for} (i=master\_th->th.th\_task\_state\_stack\_sz; i<new\_size; ++i) \{ \textcolor{comment}{// zero-init rest of stack}
2109                     new\_stack[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}] = 0;
2110                 \}
2111                 old\_stack = master\_th->th.th\_task\_state\_memo\_stack;
2112                 master\_th->th.th\_task\_state\_memo\_stack = new\_stack;
2113                 master\_th->th.th\_task\_state\_stack\_sz = \hyperlink{ittnotify__static_8h_a2b3f76e6c1e053f69bf377c00991ba4d}{new\_size};
2114                 \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(old\_stack);
2115             \}
2116             \textcolor{comment}{// Store master's task\_state on stack}
2117             master\_th->th.th\_task\_state\_memo\_stack[master\_th->th.th\_task\_state\_top] = master\_th->th.
      th\_task\_state;
2118             master\_th->th.th\_task\_state\_top++;
2119 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
2120 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (team == master\_th->th.th\_hot\_teams[level].hot\_team) \{ \textcolor{comment}{// Restore master's nested state if
       nested hot team}
2121                 master\_th->th.th\_task\_state = master\_th->th.th\_task\_state\_memo\_stack[master\_th->th.
      th\_task\_state\_top];
2122             \}
2123             \textcolor{keywordflow}{else} \{
2124 \textcolor{preprocessor}{#endif}
2125 \textcolor{preprocessor}{}                master\_th->th.th\_task\_state = 0;
2126 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
2127 \textcolor{preprocessor}{}            \}
2128 \textcolor{preprocessor}{#endif}
2129 \textcolor{preprocessor}{}        \}
2130 \textcolor{preprocessor}{#if !KMP\_NESTED\_HOT\_TEAMS}
2131 \textcolor{preprocessor}{}        \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}((master\_th->th.th\_task\_team == NULL) || (team == root->r.
      r\_hot\_team));
2132 \textcolor{preprocessor}{#endif}
2133 \textcolor{preprocessor}{}    \}
2134 
2135     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d(%d:%d)->(%d:0) created a team of %d threads\(\backslash\)n"},
2136                 gtid, parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc ));
2137     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team != root->r.r\_hot\_team ||
2138                       ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid == 0 &&
2139                         ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent == root->r.r\_root\_team || team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent->t.t\_serialized ) )
      );
2140     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
2141 
2142     \textcolor{comment}{/* now, setup the arguments */}
2143     argv = (\textcolor{keywordtype}{void}**)team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv;
2144 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
2145     if ( ap ) \{
2146 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2147 \textcolor{preprocessor}{}        \textcolor{keywordflow}{for} ( i=argc-1; i >= 0; --\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} )
2148 \textcolor{comment}{// TODO: revert workaround for Intel(R) 64 tracker #96}
2149 #\textcolor{keywordflow}{if} (\hyperlink{kmp__platform_8h_a4bbc822bf311c981aab5b1704c1566ab}{KMP\_ARCH\_X86\_64} || KMP\_ARCH\_ARM || \hyperlink{kmp__platform_8h_ac8a9f5686f72dd943400cd0e44eea79e}{KMP\_ARCH\_AARCH64}) && 
      \hyperlink{kmp__platform_8h_a08355ecda6b7d50d12e62476c0727cba}{KMP\_OS\_LINUX}
2150             *argv++ = va\_arg( *ap, \textcolor{keywordtype}{void} * );
2151 \textcolor{preprocessor}{#else}
2152 \textcolor{preprocessor}{}            *argv++ = va\_arg( ap, \textcolor{keywordtype}{void} * );
2153 \textcolor{preprocessor}{#endif}
2154 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2155 \textcolor{preprocessor}{}    \} \textcolor{keywordflow}{else} \{
2156         \textcolor{keywordflow}{for} ( i=0; i < argc; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} )
2157             \textcolor{comment}{// Get args from parent team for teams construct}
2158             argv[i] = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent->t.t\_argv[i];
2159     \}
2160 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2161 \textcolor{preprocessor}{}
2162     \textcolor{comment}{/* now actually fork the threads */}
2163     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_active = master\_active;
2164     \textcolor{keywordflow}{if} (!root->r.r\_active) \textcolor{comment}{// Only do assignment if it prevents cache ping-pong}
2165         root->r.r\_active = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2166 
2167     \hyperlink{kmp__runtime_8c_ab0c2c80f414c50972ef61b8a0c2edc1e}{\_\_kmp\_fork\_team\_threads}( root, team, master\_th, gtid );
2168     \hyperlink{kmp__runtime_8c_a3cb36a9e9ab38ef825b47442b4f78bc7}{\_\_kmp\_setup\_icv\_copy}( team, nthreads, &master\_th->th.th\_current\_task->td\_icvs, loc 
      );
2169 
2170 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2171 \textcolor{preprocessor}{}    master\_th->th.ompt\_thread\_info.state = ompt\_state\_work\_parallel;
2172 \textcolor{preprocessor}{#endif}
2173 \textcolor{preprocessor}{}
2174     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
2175 
2176 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
2177 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level == 1 \textcolor{comment}{// only report frames at level 1}
2178 # \textcolor{keywordflow}{if} OMP\_40\_ENABLED
2179         && !master\_th->th.th\_teams\_microtask \textcolor{comment}{// not in teams construct}
2180 # endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
2181     ) \{
2182 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
2183 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_submit\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
2184              ( \_\_kmp\_forkjoin\_frames\_mode == 3 || \_\_kmp\_forkjoin\_frames\_mode == 1 ) )
2185         \{
2186             kmp\_uint64 tmp\_time = 0;
2187             \textcolor{keywordflow}{if} ( \_\_itt\_get\_timestamp\_ptr )
2188                 tmp\_time = \_\_itt\_get\_timestamp();
2189             \textcolor{comment}{// Internal fork - report frame begin}
2190             master\_th->th.th\_frame\_time  = tmp\_time;
2191             \textcolor{keywordflow}{if} ( \_\_kmp\_forkjoin\_frames\_mode == 3 )
2192                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_region\_time = tmp\_time;
2193         \} \textcolor{keywordflow}{else} \textcolor{comment}{// only one notification scheme (either "submit" or "forking/joined", not both)}
2194 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_NOTIFY */}\textcolor{preprocessor}{}
2195 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_begin\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
2196              \_\_kmp\_forkjoin\_frames && !\_\_kmp\_forkjoin\_frames\_mode )
2197         \{ \textcolor{comment}{// Mark start of "parallel" region for VTune.}
2198             \_\_kmp\_itt\_region\_forking(gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc, 0);
2199         \}
2200     \}
2201 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
2202 \textcolor{preprocessor}{}
2203     \textcolor{comment}{/* now go on and do the work */}
2204     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team == \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_team );
2205     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
2206     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_fork : root=%p, team=%p, master\_th=%p, gtid=%d\(\backslash\)n"},
2207                   root, team, master\_th, gtid));
2208 
2209 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
2210 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_itt\_stack\_caller\_create\_ptr ) \{
2211         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_stack\_id = \_\_kmp\_itt\_stack\_caller\_create(); \textcolor{comment}{// create new stack stitching id before
       entering fork barrier}
2212     \}
2213 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
2214 \textcolor{preprocessor}{}
2215 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2216 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( ap )   \textcolor{comment}{// AC: skip \_\_kmp\_internal\_fork at teams construct, let only master threads execute}
2217 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2218 \textcolor{preprocessor}{}    \{
2219         \hyperlink{kmp__runtime_8c_aa733ff3ae9a095e5dd24907ca3adf92e}{\_\_kmp\_internal\_fork}( loc, gtid, team );
2220         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_fork : after : root=%p, team=%p, master\_th=%p, gtid=%d\(\backslash\)n"},
2221                       root, team, master\_th, gtid));
2222     \}
2223 
2224     \textcolor{keywordflow}{if} (call\_context == \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0a58c5bad04e427f0063bb39d20405a18c}{fork\_context\_gnu}) \{
2225         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: parallel exit T#%d\(\backslash\)n"}, gtid ));
2226         \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2227     \}
2228 
2229     \textcolor{comment}{/* Invoke microtask for MASTER thread */}
2230     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d(%d:0) invoke microtask = %p\(\backslash\)n"},
2231                 gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn ) );
2232     \}  \textcolor{comment}{// END of timer KMP\_fork\_call block}
2233 
2234     \{
2235         \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
2236         \textcolor{comment}{// KMP\_TIME\_DEVELOPER\_BLOCK(USER\_master\_invoke);}
2237         \textcolor{keywordflow}{if} (! team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke( gtid )) \{
2238             \hyperlink{kmp__debug_8h_afa985a577299cb10dafe8d3bd462d635}{KMP\_ASSERT2}( 0, \textcolor{stringliteral}{"cannot invoke microtask for MASTER thread"} );
2239         \}
2240     \}
2241     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: T#%d(%d:0) done microtask = %p\(\backslash\)n"},
2242         gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn ) );
2243     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
2244 
2245     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_call: parallel exit T#%d\(\backslash\)n"}, gtid ));
2246 
2247 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2248 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
2249         master\_th->th.ompt\_thread\_info.state = ompt\_state\_overhead;
2250     \}
2251 \textcolor{preprocessor}{#endif}
2252 \textcolor{preprocessor}{}
2253     \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
2254 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ab0c2c80f414c50972ef61b8a0c2edc1e}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads}}
\index{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{master\-\_\-th, }
\item[{{\bf int}}]{master\-\_\-gtid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ab0c2c80f414c50972ef61b8a0c2edc1e}


Definition at line 1034 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
1036 \{
1037     \textcolor{keywordtype}{int}         \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
1038     \textcolor{keywordtype}{int} use\_hot\_team;
1039 
1040     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_fork\_team\_threads: new\_nprocs = %d\(\backslash\)n"}, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc ) );
1041     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( master\_gtid == \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}() );
1042     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1043 
1044     \textcolor{comment}{/* first, let's setup the master thread */}
1045     master\_th->th.th\_info.ds.ds\_tid  = 0;
1046     master\_th->th.th\_team            = team;
1047     master\_th->th.th\_team\_nproc      = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
1048     master\_th->th.th\_team\_master     = master\_th;
1049     master\_th->th.th\_team\_serialized = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1050     master\_th->th.th\_dispatch        = & team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ 0 ];
1051 
1052     \textcolor{comment}{/* make sure we are not the optimized hot team */}
1053 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
1054 \textcolor{preprocessor}{}    use\_hot\_team = 0;
1055     kmp\_hot\_team\_ptr\_t *hot\_teams = master\_th->th.th\_hot\_teams;
1056     \textcolor{keywordflow}{if}( hot\_teams ) \{  \textcolor{comment}{// hot teams array is not allocated if KMP\_HOT\_TEAMS\_MAX\_LEVEL=0}
1057         \textcolor{keywordtype}{int} level = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level - 1;    \textcolor{comment}{// index in array of hot teams}
1058         \textcolor{keywordflow}{if}( master\_th->th.th\_teams\_microtask ) \{    \textcolor{comment}{// are we inside the teams?}
1059             \textcolor{keywordflow}{if}( master\_th->th.th\_teams\_size.nteams > 1 ) \{
1060                 ++level; \textcolor{comment}{// level was not increased in teams construct for team\_of\_masters}
1061             \}
1062             \textcolor{keywordflow}{if}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn != (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} &&
1063                 master\_th->th.th\_teams\_level == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level ) \{
1064                 ++level; \textcolor{comment}{// level was not increased in teams construct for team\_of\_workers before the
       parallel}
1065             \}            \textcolor{comment}{// team->t.t\_level will be increased inside parallel}
1066         \}
1067         \textcolor{keywordflow}{if}( level < \_\_kmp\_hot\_teams\_max\_level ) \{
1068             \textcolor{keywordflow}{if}( hot\_teams[level].hot\_team ) \{
1069                 \textcolor{comment}{// hot team has already been allocated for given level}
1070                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(hot\_teams[level].hot\_team == team);
1071                 use\_hot\_team = 1; \textcolor{comment}{// the team is ready to use}
1072             \} \textcolor{keywordflow}{else} \{
1073                 use\_hot\_team = 0; \textcolor{comment}{// AC: threads are not allocated yet}
1074                 hot\_teams[level].hot\_team = team; \textcolor{comment}{// remember new hot team}
1075                 hot\_teams[level].hot\_team\_nth = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
1076             \}
1077         \} \textcolor{keywordflow}{else} \{
1078             use\_hot\_team = 0;
1079         \}
1080     \}
1081 \textcolor{preprocessor}{#else}
1082 \textcolor{preprocessor}{}    use\_hot\_team = team == root->r.r\_hot\_team;
1083 \textcolor{preprocessor}{#endif}
1084 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( !use\_hot\_team ) \{
1085 
1086         \textcolor{comment}{/* install the master thread */}
1087         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ 0 ]    = master\_th;
1088         \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\_\_kmp\_initialize\_info}( master\_th, team, 0, master\_gtid );
1089 
1090         \textcolor{comment}{/* now, install the worker threads */}
1091         \textcolor{keywordflow}{for} ( i=1 ;  i < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc ; i++ ) \{
1092 
1093             \textcolor{comment}{/* fork or reallocate a new thread and install it in team */}
1094             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = \hyperlink{kmp__runtime_8c_aa26d2dfa84cff79bae57f1141c5d4d80}{\_\_kmp\_allocate\_thread}( root, team, i );
1095             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ] = thr;
1096             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thr );
1097             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thr->th.th\_team == team );
1098             \textcolor{comment}{/* align team and thread arrived states */}
1099             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_fork\_team\_threads: T#%d(%d:%d) init arrived T#%d(%d:%d) join
       =%llu, plain=%llu\(\backslash\)n"},
1100                             \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}( 0, team ), team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, 0,
1101                             \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}( i, team ), team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, i,
1102                             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ].b\_arrived,
1103                             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier} ].b\_arrived ) );
1104 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1105 \textcolor{preprocessor}{}            thr->th.th\_teams\_microtask = master\_th->th.th\_teams\_microtask;
1106             thr->th.th\_teams\_level     = master\_th->th.th\_teams\_level;
1107             thr->th.th\_teams\_size      = master\_th->th.th\_teams\_size;
1108 \textcolor{preprocessor}{#endif}
1109 \textcolor{preprocessor}{}            \{ \textcolor{comment}{// Initialize threads' barrier data.}
1110                 \textcolor{keywordtype}{int} b;
1111                 \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ]->th.th\_bar;
1112                 \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
1113                     balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_arrived        = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived;
1114                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[b].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
1115 \textcolor{preprocessor}{#if USE\_DEBUGGER}
1116 \textcolor{preprocessor}{}                    balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_worker\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived;
1117 \textcolor{preprocessor}{#endif}
1118 \textcolor{preprocessor}{}                \}; \textcolor{comment}{// for b}
1119             \}
1120         \}
1121 
1122 \textcolor{preprocessor}{#if OMP\_40\_ENABLED && KMP\_AFFINITY\_SUPPORTED}
1123 \textcolor{preprocessor}{}        \_\_kmp\_partition\_places( team );
1124 \textcolor{preprocessor}{#endif}
1125 \textcolor{preprocessor}{}
1126     \}
1127 
1128     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1129 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-free\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team}}
\index{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-free\-\_\-team (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$team }]{U\-S\-E\-\_\-\-N\-E\-S\-T\-E\-D\-\_\-\-H\-O\-T\-\_\-\-A\-R\-Gkmp\-\_\-info\-\_\-t $\ast$master}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}


Definition at line 5251 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-join\-\_\-call(), and \-\_\-\-\_\-kmp\-\_\-reset\-\_\-root().


\begin{DoxyCode}
5252 \{
5253     \textcolor{keywordtype}{int} f;
5254     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_free\_team: T#%d freeing team %d\(\backslash\)n"}, 
      \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), team->t.t\_id ));
5255 
5256     \textcolor{comment}{/* verify state */}
5257     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root );
5258     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
5259     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->t.t\_nproc <= team->t.t\_max\_nproc );
5260     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->t.t\_threads );
5261 
5262     \textcolor{keywordtype}{int} use\_hot\_team = team == root->r.r\_hot\_team;
5263 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
5264 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} level;
5265     kmp\_hot\_team\_ptr\_t *hot\_teams;
5266     \textcolor{keywordflow}{if}( master ) \{
5267         level = team->t.t\_active\_level - 1;
5268         \textcolor{keywordflow}{if}( master->th.th\_teams\_microtask ) \{                         \textcolor{comment}{// in teams construct?}
5269             \textcolor{keywordflow}{if}( master->th.th\_teams\_size.nteams > 1 ) \{
5270                ++level; \textcolor{comment}{// level was not increased in teams construct for team\_of\_masters}
5271             \}
5272             \textcolor{keywordflow}{if}( team->t.t\_pkfn != (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} &&
5273                 master->th.th\_teams\_level == team->t.t\_level ) \{
5274                 ++level; \textcolor{comment}{// level was not increased in teams construct for team\_of\_workers before the
       parallel}
5275             \}            \textcolor{comment}{// team->t.t\_level will be increased inside parallel}
5276         \}
5277         hot\_teams = master->th.th\_hot\_teams;
5278         \textcolor{keywordflow}{if}( level < \_\_kmp\_hot\_teams\_max\_level ) \{
5279             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team == hot\_teams[level].hot\_team );
5280             use\_hot\_team = 1;
5281         \}
5282     \}
5283 \textcolor{preprocessor}{#endif // KMP\_NESTED\_HOT\_TEAMS}
5284 \textcolor{preprocessor}{}
5285     \textcolor{comment}{/* team is done working */}
5286     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(team->t.t\_pkfn, NULL); \textcolor{comment}{// Important for Debugging Support Library.}
5287     team->t.t\_copyin\_counter = 0; \textcolor{comment}{// init counter for possible reuse}
5288     \textcolor{comment}{// Do not reset pointer to parent team to NULL for hot teams.}
5289 
5290     \textcolor{comment}{/* if we are non-hot team, release our threads */}
5291     \textcolor{keywordflow}{if}( ! use\_hot\_team ) \{
5292         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
5293             \textcolor{comment}{// Delete task teams}
5294             \textcolor{keywordtype}{int} tt\_idx;
5295             \textcolor{keywordflow}{for} (tt\_idx=0; tt\_idx<2; ++tt\_idx) \{
5296                 \hyperlink{unionkmp__task__team}{kmp\_task\_team\_t} *task\_team = team->t.t\_task\_team[tt\_idx];
5297                 \textcolor{keywordflow}{if} ( task\_team != NULL ) \{
5298                     \textcolor{keywordflow}{for} (f=0; f<team->t.t\_nproc; ++f) \{ \textcolor{comment}{// Have all threads unref task teams}
5299                         team->t.t\_threads[f]->th.th\_task\_team = NULL;
5300                     \}
5301                     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_free\_team: T#%d deactivating task\_team %p on team %d\(\backslash\)n"},
       \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), task\_team, team->t.t\_id ) );
5302 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
5303 \textcolor{preprocessor}{}                    \hyperlink{kmp_8h_a006431c8d77d632eeb5b6f8c16d9fd87}{\_\_kmp\_free\_task\_team}( master, task\_team );
5304 \textcolor{preprocessor}{#endif}
5305 \textcolor{preprocessor}{}                    team->t.t\_task\_team[tt\_idx] = NULL;
5306                 \}
5307             \}
5308         \}
5309 
5310         \textcolor{comment}{// Reset pointer to parent team only for non-hot teams.}
5311         team->t.t\_parent = NULL;
5312 
5313         \textcolor{comment}{/* free the worker threads */}
5314         \textcolor{keywordflow}{for} ( f = 1; f < team->t.t\_nproc; ++ f ) \{
5315             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->t.t\_threads[ f ] );
5316             \hyperlink{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}{\_\_kmp\_free\_thread}( team->t.t\_threads[ f ] );
5317             team->t.t\_threads[ f ] = NULL;
5318         \}
5319 
5320         \textcolor{comment}{/* put the team back in the team pool */}
5321         \textcolor{comment}{/* TODO limit size of team pool, call reap\_team if pool too large */}
5322         team->t.t\_next\_pool  = (\hyperlink{unionkmp__team}{kmp\_team\_t}*) \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool};
5323         \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool}        = (\textcolor{keyword}{volatile} \hyperlink{unionkmp__team}{kmp\_team\_t}*) team;
5324     \}
5325 
5326     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5327 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a50220bcdbf9d2bd78cf51373757a97e1}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays}}
\index{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-free\-\_\-team\-\_\-arrays (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a50220bcdbf9d2bd78cf51373757a97e1}


Definition at line 3058 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-reap\-\_\-team().


\begin{DoxyCode}
3058                                          \{
3059     \textcolor{comment}{/* Note: this does not free the threads in t\_threads (\_\_kmp\_free\_threads) */}
3060     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
3061     \textcolor{keywordflow}{for} ( i = 0; i < team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc; ++ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
3062         \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ i ].th\_disp\_buffer != NULL ) \{
3063             \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ i ].th\_disp\_buffer );
3064             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ].th\_disp\_buffer = NULL;
3065         \}; \textcolor{comment}{// if}
3066     \}; \textcolor{comment}{// for}
3067     \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads);
3068 \textcolor{preprocessor}{    #if !KMP\_USE\_POOLED\_ALLOC}
3069 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer);
3070         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch);
3071         \textcolor{comment}{//\_\_kmp\_free(team->t.t\_set\_max\_active\_levels);}
3072         \textcolor{comment}{//\_\_kmp\_free(team->t.t\_set\_sched);}
3073         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata);
3074 \textcolor{preprocessor}{    #endif}
3075 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads     = NULL;
3076     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer = NULL;
3077     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch    = NULL;
3078     \textcolor{comment}{//team->t.t\_set\_sched   = 0;}
3079     \textcolor{comment}{//team->t.t\_set\_max\_active\_levels = 0;}
3080     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata = 0;
3081 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-free\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-free\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{this\-\_\-th}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}


Definition at line 5383 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), \-\_\-\-\_\-kmp\-\_\-free\-\_\-team(), and \-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads().


\begin{DoxyCode}
5384 \{
5385     \textcolor{keywordtype}{int} gtid;
5386     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **scan;
5387 
5388     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_free\_thread: T#%d putting T#%d back on free pool.\(\backslash\)n"},
5389                 \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), this\_th->th.th\_info.ds.ds\_gtid ));
5390 
5391     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_th );
5392 
5393     \textcolor{comment}{// When moving thread to pool, switch thread to wait on own b\_go flag, and uninitialized (NULL team).}
5394     \textcolor{keywordtype}{int} b;
5395     \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} *balign = this\_th->th.th\_bar;
5396     \textcolor{keywordflow}{for} (b=0; b<\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++b) \{
5397         \textcolor{keywordflow}{if} (balign[b].bb.wait\_flag == \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG})
5398             balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.wait\_flag = \hyperlink{kmp_8h_a9047ed06d38892c3a2fa977b3a4056e2}{KMP\_BARRIER\_SWITCH\_TO\_OWN\_FLAG};
5399         balign[b].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.team = NULL;
5400     \}
5401     this\_th->th.th\_task\_state = 0;
5402 
5403     \textcolor{comment}{/* put thread back on the free pool */}
5404     \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(this\_th->th.th\_team, NULL);
5405     \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(this\_th->th.th\_root, NULL);
5406     \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(this\_th->th.th\_dispatch, NULL);               \textcolor{comment}{/* NOT NEEDED */}
5407 
5408     \textcolor{comment}{//}
5409     \textcolor{comment}{// If the \_\_kmp\_thread\_pool\_insert\_pt is already past the new insert}
5410     \textcolor{comment}{// point, then we need to re-scan the entire list.}
5411     \textcolor{comment}{//}
5412     gtid = this\_th->th.th\_info.ds.ds\_gtid;
5413     \textcolor{keywordflow}{if} ( \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} != NULL ) \{
5414         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} != NULL );
5415         \textcolor{keywordflow}{if} ( \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt}->th.th\_info.ds.ds\_gtid > gtid ) \{
5416              \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} = NULL;
5417         \}
5418     \}
5419 
5420     \textcolor{comment}{//}
5421     \textcolor{comment}{// Scan down the list to find the place to insert the thread.}
5422     \textcolor{comment}{// scan is the address of a link in the list, possibly the address of}
5423     \textcolor{comment}{// \_\_kmp\_thread\_pool itself.}
5424     \textcolor{comment}{//}
5425     \textcolor{comment}{// In the absence of nested parallism, the for loop will have 0 iterations.}
5426     \textcolor{comment}{//}
5427     \textcolor{keywordflow}{if} ( \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} != NULL ) \{
5428         scan = &( \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt}->th.th\_next\_pool );
5429     \}
5430     \textcolor{keywordflow}{else} \{
5431         scan = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **)&\hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool};
5432     \}
5433     \textcolor{keywordflow}{for} (; ( *scan != NULL ) && ( (*scan)->th.th\_info.ds.ds\_gtid < gtid );
5434       scan = &( (*scan)->th.th\_next\_pool ) );
5435 
5436     \textcolor{comment}{//}
5437     \textcolor{comment}{// Insert the new element on the list, and set \_\_kmp\_thread\_pool\_insert\_pt}
5438     \textcolor{comment}{// to its address.}
5439     \textcolor{comment}{//}
5440     \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(this\_th->th.th\_next\_pool, *scan);
5441     \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} = *scan = this\_th;
5442     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ( this\_th->th.th\_next\_pool == NULL )
5443       || ( this\_th->th.th\_info.ds.ds\_gtid
5444       < this\_th->th.th\_next\_pool->th.th\_info.ds.ds\_gtid ) );
5445     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(this\_th->th.th\_in\_pool, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
5446     \hyperlink{kmp_8h_ab77f7a31d04d2d654e78546530b71ab9}{\_\_kmp\_thread\_pool\_nth}++;
5447 
5448     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}, \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} - 1);
5449 
5450 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
5451 \textcolor{preprocessor}{}    \textcolor{comment}{/* Adjust blocktime back to user setting or default if necessary */}
5452     \textcolor{comment}{/* Middle initialization might never have occurred                */}
5453     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
5454         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 );
5455         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} <= \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
5456             \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
5457         \}
5458     \}
5459 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
5460 \textcolor{preprocessor}{}
5461     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5462 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a82039234188b257e6943ece1824ebbdf}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{level}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a82039234188b257e6943ece1824ebbdf}


Definition at line 2821 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-A\-N\-C\-E\-S\-T\-O\-R\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-N\-U\-M(), and ompc\-\_\-get\-\_\-ancestor\-\_\-thread\-\_\-num().


\begin{DoxyCode}
2821                                                      \{
2822 
2823     \textcolor{keywordtype}{int} ii, dd;
2824     \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
2825     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr;
2826 
2827     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_get\_ancestor\_thread\_num: thread %d %d\(\backslash\)n"}, gtid, level ));
2828     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2829 
2830     \textcolor{comment}{// validate level}
2831     \textcolor{keywordflow}{if}( level == 0 ) \textcolor{keywordflow}{return} 0;
2832     \textcolor{keywordflow}{if}( level < 0 ) \textcolor{keywordflow}{return} -1;
2833     thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2834     team = thr->th.th\_team;
2835     ii = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level;
2836     \textcolor{keywordflow}{if}( level > ii ) \textcolor{keywordflow}{return} -1;
2837 
2838 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2839 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( thr->th.th\_teams\_microtask ) \{
2840         \textcolor{comment}{// AC: we are in teams region where multiple nested teams have same level}
2841         \textcolor{keywordtype}{int} tlevel = thr->th.th\_teams\_level; \textcolor{comment}{// the level of the teams construct}
2842         \textcolor{keywordflow}{if}( level <= tlevel ) \{ \textcolor{comment}{// otherwise usual algorithm works (will not touch the teams)}
2843             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ii >= tlevel );
2844             \textcolor{comment}{// AC: As we need to pass by the teams league, we need to artificially increase ii}
2845             \textcolor{keywordflow}{if} ( ii == tlevel ) \{
2846                 ii += 2; \textcolor{comment}{// three teams have same level}
2847             \} \textcolor{keywordflow}{else} \{
2848                 ii ++;   \textcolor{comment}{// two teams have same level}
2849             \}
2850         \}
2851     \}
2852 \textcolor{preprocessor}{#endif}
2853 \textcolor{preprocessor}{}
2854     \textcolor{keywordflow}{if}( ii == level ) \textcolor{keywordflow}{return} \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid );
2855 
2856     dd = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
2857     level++;
2858     \textcolor{keywordflow}{while}( ii > level )
2859     \{
2860         \textcolor{keywordflow}{for}( dd = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized; ( dd > 0 ) && ( ii > level ); dd--, ii-- )
2861         \{
2862         \}
2863         \textcolor{keywordflow}{if}( ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) && ( !dd ) ) \{
2864             team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2865             \textcolor{keywordflow}{continue};
2866         \}
2867         \textcolor{keywordflow}{if}( ii > level ) \{
2868             team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2869             dd = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
2870             ii--;
2871         \}
2872     \}
2873 
2874     \textcolor{keywordflow}{return} ( dd > 1 ) ? ( 0 ) : ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid );
2875 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a9ad37994c0b2b9e6c900768047c82362}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf kmp\-\_\-internal\-\_\-control\-\_\-t} \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a9ad37994c0b2b9e6c900768047c82362}


Definition at line 3102 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root(), and \-\_\-\-\_\-kmp\-\_\-register\-\_\-root().


\begin{DoxyCode}
3102                               \{
3103 
3104     \hyperlink{structkmp__r__sched}{kmp\_r\_sched\_t} r\_sched = \hyperlink{kmp__runtime_8c_a939a55f9e1a1b31d54915926998f2bae}{\_\_kmp\_get\_schedule\_global}(); \textcolor{comment}{// get
       current state of scheduling globals}
3105 
3106 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
3107 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.
      \hyperlink{structkmp__nested__proc__bind__t_a4ab1e74b13e91c54a0ff105c9d7db9f6}{used} > 0 );
3108 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
3109 \textcolor{preprocessor}{}
3110     \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} g\_icvs = \{
3111       0,                            \textcolor{comment}{//int serial\_nesting\_level; //corresponds to the value of the
       th\_team\_serialized field}
3112       (kmp\_int8)\hyperlink{kmp_8h_a97777d7313012bbad5f5e4e897489172}{\_\_kmp\_dflt\_nested},            \textcolor{comment}{//int nested;               //internal
       control for nested parallelism (per thread)}
3113       (kmp\_int8)\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic,                                 \textcolor{comment}{//internal control
       for dynamic adjustment of threads (per thread)}
3114       (kmp\_int8)\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime},          \textcolor{comment}{//int bt\_set;               //internal
       control for whether blocktime is explicitly set}
3115       \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime},         \textcolor{comment}{//int blocktime;            //internal control for
       blocktime}
3116       \hyperlink{kmp_8h_a317b8269abca72565ca88f1784dee86b}{\_\_kmp\_bt\_intervals},           \textcolor{comment}{//int bt\_intervals;         //internal control for
       blocktime intervals}
3117       \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth},          \textcolor{comment}{//int nproc;                //internal control for #
       of threads for next parallel region (per thread)}
3118                                     \textcolor{comment}{// (use a max ub on value if \_\_kmp\_parallel\_initialize not called yet)}
3119       \hyperlink{kmp_8h_a337fac6e4af9a3e783d5f4e39e5bfcde}{\_\_kmp\_dflt\_max\_active\_levels}, \textcolor{comment}{//int max\_active\_levels;    //internal
       control for max\_active\_levels}
3120       r\_sched,                      \textcolor{comment}{//kmp\_r\_sched\_t sched;      //internal control for runtime schedule
       \{sched,chunk\} pair}
3121 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
3122       \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[0],
3123 #endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
3124       NULL                          \textcolor{comment}{//struct kmp\_internal\_control *next;}
3125     \};
3126 
3127     \textcolor{keywordflow}{return} g\_icvs;
3128 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ae3cca5d62ca05d4a4e9179aae9ecf949}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ae3cca5d62ca05d4a4e9179aae9ecf949}


Definition at line 102 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg().


\begin{DoxyCode}
103 \{
104     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
105     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}   **other\_threads;
106     \textcolor{keywordtype}{size\_t}         stack\_data;
107     \textcolor{keywordtype}{char}          *stack\_addr;
108     \textcolor{keywordtype}{size\_t}         stack\_size;
109     \textcolor{keywordtype}{char}          *stack\_base;
110 
111     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id: entering, nproc=%d  all\_nproc=%d\(\backslash\)n"},
112                       \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}, \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} ));
113 
114     \textcolor{comment}{/* JPH - to handle the case where \_\_kmpc\_end(0) is called immediately prior to a}
115 \textcolor{comment}{             parallel region, made it return KMP\_GTID\_DNE to force serial\_initialize by}
116 \textcolor{comment}{             caller.  Had to handle KMP\_GTID\_DNE at all call-sites, or else guarantee}
117 \textcolor{comment}{             \_\_kmp\_init\_gtid for this to work.  */}
118 
119     \textcolor{keywordflow}{if} ( !\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a3f91f5b94048484e40c6caeb66c60f27}{\_\_kmp\_init\_gtid}) ) \textcolor{keywordflow}{return} \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE};
120 
121 \textcolor{preprocessor}{#ifdef KMP\_TDATA\_GTID}
122 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) >= 3) \{
123         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id: using TDATA\(\backslash\)n"} ));
124         \textcolor{keywordflow}{return} \_\_kmp\_gtid;
125     \}
126 \textcolor{preprocessor}{#endif}
127 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) >= 2) \{
128         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id: using keyed TLS\(\backslash\)n"} ));
129         \textcolor{keywordflow}{return} \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
130     \}
131     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id: using internal alg.\(\backslash\)n"} ));
132 
133     stack\_addr    = (\textcolor{keywordtype}{char}*) & stack\_data;
134     other\_threads = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads};
135 
136     \textcolor{comment}{/*}
137 \textcolor{comment}{        ATT: The code below is a source of potential bugs due to unsynchronized access to}
138 \textcolor{comment}{        \_\_kmp\_threads array. For example:}
139 \textcolor{comment}{            1. Current thread loads other\_threads[i] to thr and checks it, it is non-NULL.}
140 \textcolor{comment}{            2. Current thread is suspended by OS.}
141 \textcolor{comment}{            3. Another thread unregisters and finishes (debug versions of free() may fill memory}
142 \textcolor{comment}{               with something like 0xEF).}
143 \textcolor{comment}{            4. Current thread is resumed.}
144 \textcolor{comment}{            5. Current thread reads junk from *thr.}
145 \textcolor{comment}{        TODO: Fix it.}
146 \textcolor{comment}{        --ln}
147 \textcolor{comment}{    */}
148 
149     \textcolor{keywordflow}{for}( i = 0 ; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} ; i++ ) \{
150 
151         \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *)\hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}(other\_threads[i]);
152         \textcolor{keywordflow}{if}( !thr ) \textcolor{keywordflow}{continue};
153 
154         stack\_size =  (size\_t)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(thr->th.th\_info.ds.ds\_stacksize);
155         stack\_base =  (\textcolor{keywordtype}{char} *)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(thr->th.th\_info.ds.ds\_stackbase);
156 
157         \textcolor{comment}{/* stack grows down -- search through all of the active threads */}
158 
159         \textcolor{keywordflow}{if}( stack\_addr <= stack\_base ) \{
160             \textcolor{keywordtype}{size\_t} stack\_diff = stack\_base - stack\_addr;
161 
162             \textcolor{keywordflow}{if}( stack\_diff <= stack\_size ) \{
163                 \textcolor{comment}{/* The only way we can be closer than the allocated */}
164                 \textcolor{comment}{/* stack size is if we are running on this thread. */}
165                 \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}() == i );
166                 \textcolor{keywordflow}{return} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
167             \}
168         \}
169     \}
170 
171     \textcolor{comment}{/* get specific to try and determine our gtid */}
172     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id: internal alg. failed to find "}
173                       \textcolor{stringliteral}{"thread, using TLS\(\backslash\)n"} ));
174     i = \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
175 
176     \textcolor{comment}{/*fprintf( stderr, "=== %d\(\backslash\)n", i );  */} \textcolor{comment}{/* GROO */}
177 
178     \textcolor{comment}{/* if we havn't been assigned a gtid, then return code */}
179     \textcolor{keywordflow}{if}( i<0 ) \textcolor{keywordflow}{return} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
180 
181     \textcolor{comment}{/* dynamically updated stack window for uber threads to avoid get\_specific call */}
182     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(other\_threads[i]->th.th\_info.ds.ds\_stackgrow) ) \{
183         \hyperlink{kmp__i18n_8h_aaa06fec585285ef7883baea41bfd948f}{KMP\_FATAL}( StackOverflow, i );
184     \}
185 
186     stack\_base = (\textcolor{keywordtype}{char} *) other\_threads[i]->th.th\_info.ds.ds\_stackbase;
187     \textcolor{keywordflow}{if}( stack\_addr > stack\_base ) \{
188         \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(other\_threads[i]->th.th\_info.ds.ds\_stackbase, stack\_addr);
189         \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(other\_threads[i]->th.th\_info.ds.ds\_stacksize,
190           other\_threads[i]->th.th\_info.ds.ds\_stacksize + stack\_addr - stack\_base);
191     \} \textcolor{keywordflow}{else} \{
192         \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(other\_threads[i]->th.th\_info.ds.ds\_stacksize, stack\_base - stack\_addr);
193     \}
194 
195     \textcolor{comment}{/* Reprint stack bounds for ubermaster since they have been refined */}
196     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
197         \textcolor{keywordtype}{char} *stack\_end = (\textcolor{keywordtype}{char} *) other\_threads[i]->th.th\_info.ds.ds\_stackbase;
198         \textcolor{keywordtype}{char} *stack\_beg = stack\_end - other\_threads[i]->th.th\_info.ds.ds\_stacksize;
199         \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( i, stack\_beg, stack\_end,
200                                       other\_threads[i]->th.th\_info.ds.ds\_stacksize,
201                                       \textcolor{stringliteral}{"th\_%d stack (refinement)"}, i );
202     \}
203     \textcolor{keywordflow}{return} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
204 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aede2ee8759dd6b89fdfbe674dbf6bb23}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aede2ee8759dd6b89fdfbe674dbf6bb23}


Definition at line 207 of file kmp\-\_\-runtime.\-c.


\begin{DoxyCode}
208 \{
209     \textcolor{keywordtype}{int} gtid;
210 
211     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
212         gtid = \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE};
213     \} \textcolor{keywordflow}{else}
214 \textcolor{preprocessor}{#ifdef KMP\_TDATA\_GTID}
215 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) >= 3 ) \{
216         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id\_reg: using TDATA\(\backslash\)n"} ));
217         gtid = \_\_kmp\_gtid;
218     \} \textcolor{keywordflow}{else}
219 \textcolor{preprocessor}{#endif}
220 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) >= 2 ) \{
221         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id\_reg: using keyed TLS\(\backslash\)n"} ));
222         gtid = \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
223     \} \textcolor{keywordflow}{else} \{
224         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1000, ( \textcolor{stringliteral}{"*** \_\_kmp\_get\_global\_thread\_id\_reg: using internal alg.\(\backslash\)n"} ));
225         gtid = \hyperlink{kmp__runtime_8c_ae3cca5d62ca05d4a4e9179aae9ecf949}{\_\_kmp\_get\_global\_thread\_id}();
226     \}
227 
228     \textcolor{comment}{/* we must be a new uber master sibling thread */}
229     \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE} ) \{
230         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_get\_global\_thread\_id\_reg: Encountered new root thread. "}
231                         \textcolor{stringliteral}{"Registering a new gtid.\(\backslash\)n"} ));
232         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
233         \textcolor{keywordflow}{if}( !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
234             \hyperlink{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}{\_\_kmp\_do\_serial\_initialize}();
235             gtid = \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
236         \} \textcolor{keywordflow}{else} \{
237             gtid = \hyperlink{kmp__runtime_8c_a35f021c58bf7593d6c096cea30edbcc0}{\_\_kmp\_register\_root}(\hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
238         \}
239         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
240         \textcolor{comment}{/*\_\_kmp\_printf( "+++ %d\(\backslash\)n", gtid ); */} \textcolor{comment}{/* GROO */}
241     \}
242 
243     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( gtid >=0 );
244 
245     \textcolor{keywordflow}{return} gtid;
246 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a2ee7c4d1122f1adcfe84e9744d1ed45f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-get\-\_\-max\-\_\-active\-\_\-levels (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a2ee7c4d1122f1adcfe84e9744d1ed45f}


Definition at line 2701 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-M\-A\-X\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-L\-E\-V\-E\-L\-S().


\begin{DoxyCode}
2702 \{
2703     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread;
2704 
2705     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_get\_max\_active\_levels: thread %d\(\backslash\)n"}, gtid ) );
2706     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2707 
2708     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2709     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thread->th.th\_current\_task );
2710     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_get\_max\_active\_levels: thread %d, curtask=%p, curtask\_maxaclevel=%d\(\backslash\)n"},
2711         gtid, thread->th.th\_current\_task, thread->th.th\_current\_task->td\_icvs.max\_active\_levels ) );
2712     \textcolor{keywordflow}{return} thread->th.th\_current\_task->td\_icvs.max\_active\_levels;
2713 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a35a3fb5fe916330a8e3f844603bb6a09}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-random@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-random}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-random@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-random}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-random}]{\setlength{\rightskip}{0pt plus 5cm}unsigned short \-\_\-\-\_\-kmp\-\_\-get\-\_\-random (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thread}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a35a3fb5fe916330a8e3f844603bb6a09}


Definition at line 3466 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-execute\-\_\-tasks\-\_\-template(), and \-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads().


\begin{DoxyCode}
3467 \{
3468   \textcolor{keywordtype}{unsigned} \hyperlink{ittnotify__static_8h_a25eb27b280775b27a5ddc4d1673225aa}{x} = thread->th.th\_x;
3469   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} r = x>>16;
3470 
3471   thread->th.th\_x = x*thread->th.th\_a+1;
3472 
3473   \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(30, (\textcolor{stringliteral}{"\_\_kmp\_get\_random: THREAD: %d, RETURN: %u\(\backslash\)n"},
3474          thread->th.th\_info.ds.ds\_tid, r) );
3475 
3476   \textcolor{keywordflow}{return} r;
3477 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_af7da2e6709bcf9f6c9ad3ca6eb6808e9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method}]{\setlength{\rightskip}{0pt plus 5cm}kmp\-\_\-int32 \-\_\-\-\_\-kmp\-\_\-get\-\_\-reduce\-\_\-method (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_af7da2e6709bcf9f6c9ad3ca6eb6808e9}


Definition at line 7681 of file kmp\-\_\-runtime.\-c.


\begin{DoxyCode}
7681                                 \{
7682     \textcolor{keywordflow}{return} ( ( \hyperlink{kmp_8h_ab5c65087a44197c3b69cd133df0d6f85}{\_\_kmp\_entry\_thread}()->th.th\_local.packed\_reduction\_method ) >> 8 );
7683 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ac565b833e04ae8d41f17d7b6d97d5b09}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-sched\-\_\-t} $\ast$}]{kind, }
\item[{{\bf int} $\ast$}]{chunk}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ac565b833e04ae8d41f17d7b6d97d5b09}


Definition at line 2770 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-S\-C\-H\-E\-D\-U\-L\-E().


\begin{DoxyCode}
2771 \{
2772     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}     *thread;
2773     \textcolor{keyword}{enum} \hyperlink{group__WORK__SHARING_gadcaf200537aaa0218a60c398438f81be}{sched\_type} th\_type;
2774 
2775     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_get\_schedule: thread %d\(\backslash\)n"}, gtid ));
2776     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2777 
2778     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2779 
2780     \textcolor{comment}{//th\_type = thread->th.th\_team->t.t\_set\_sched[ thread->th.th\_info.ds.ds\_tid ].r\_sched\_type;}
2781     th\_type = thread->th.th\_current\_task->td\_icvs.sched.r\_sched\_type;
2782 
2783     \textcolor{keywordflow}{switch} ( th\_type ) \{
2784     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea2a987351b9605b918693a17d4dd90772}{kmp\_sch\_static}:
2785     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea67c1b7c70c012361c0218269ac063606}{kmp\_sch\_static\_greedy}:
2786     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea5869a7f3c202fef826c9368fa155dcdb}{kmp\_sch\_static\_balanced}:
2787         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3af458bf7281ae12d9fdc486be35239fe4}{kmp\_sched\_static};
2788         *chunk = 0;   \textcolor{comment}{// chunk was not set, try to show this fact via zero value}
2789         \textcolor{keywordflow}{return};
2790     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea8521b598e4c2014936813c104adfab4b}{kmp\_sch\_static\_chunked}:
2791         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3af458bf7281ae12d9fdc486be35239fe4}{kmp\_sched\_static};
2792         \textcolor{keywordflow}{break};
2793     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea55ec779ed16f7959a24e65feadcbdbeb}{kmp\_sch\_dynamic\_chunked}:
2794         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a41ae43405b80c38529575ddc7eb6a3fa}{kmp\_sched\_dynamic};
2795         \textcolor{keywordflow}{break};
2796     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea52b66fc7ba82beb3d6fbdb82a6ef045d}{kmp\_sch\_guided\_chunked}:
2797     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81beaa6177807dac327b1240c43ab9f2d1f12}{kmp\_sch\_guided\_iterative\_chunked}:
2798     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea569ad1692047e89645f19bca3f2c26af}{kmp\_sch\_guided\_analytical\_chunked}:
2799         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a62916ce8caf05060eae4c8b4c6d61a4e}{kmp\_sched\_guided};
2800         \textcolor{keywordflow}{break};
2801     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea270b6b98ec2f9ec4832f7a59b0a0d532}{kmp\_sch\_auto}:
2802         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a4f568012ad340035a9eb18b5e23fd91c}{kmp\_sched\_auto};
2803         \textcolor{keywordflow}{break};
2804     \textcolor{keywordflow}{case} \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea904631666318a8490fc48df394616dbd}{kmp\_sch\_trapezoidal}:
2805         *kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a224fa7b533dd25dd7623aa2b8e877efb}{kmp\_sched\_trapezoidal};
2806         \textcolor{keywordflow}{break};
2807 \textcolor{comment}{/*}
2808 \textcolor{comment}{    case kmp\_sch\_static\_steal:}
2809 \textcolor{comment}{        *kind = kmp\_sched\_static\_steal;}
2810 \textcolor{comment}{        break;}
2811 \textcolor{comment}{*/}
2812     \textcolor{keywordflow}{default}:
2813         \hyperlink{kmp__i18n_8h_aaa06fec585285ef7883baea41bfd948f}{KMP\_FATAL}( UnknownSchedulingType, th\_type );
2814     \}
2815 
2816     \textcolor{comment}{//*chunk = thread->th.th\_team->t.t\_set\_sched[ thread->th.th\_info.ds.ds\_tid ].chunk;}
2817     *chunk = thread->th.th\_current\_task->td\_icvs.sched.chunk;
2818 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a939a55f9e1a1b31d54915926998f2bae}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-r\-\_\-sched\-\_\-t} \-\_\-\-\_\-kmp\-\_\-get\-\_\-schedule\-\_\-global (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a939a55f9e1a1b31d54915926998f2bae}


Definition at line 2930 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-icvs(), and \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root().


\begin{DoxyCode}
2930                             \{
2931 \textcolor{comment}{// This routine created because pairs (\_\_kmp\_sched, \_\_kmp\_chunk) and (\_\_kmp\_static, \_\_kmp\_guided)}
2932 \textcolor{comment}{// may be changed by kmp\_set\_defaults independently. So one can get the updated schedule here.}
2933 
2934     \hyperlink{structkmp__r__sched}{kmp\_r\_sched\_t} r\_sched;
2935 
2936     \textcolor{comment}{// create schedule from 4 globals: \_\_kmp\_sched, \_\_kmp\_chunk, \_\_kmp\_static, \_\_kmp\_guided}
2937     \textcolor{comment}{// \_\_kmp\_sched should keep original value, so that user can set KMP\_SCHEDULE multiple times,}
2938     \textcolor{comment}{// and thus have different run-time schedules in different roots (even in OMP 2.5)}
2939     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a8c039a5dbf8b1d50c8809face611f8e6}{\_\_kmp\_sched} == \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea2a987351b9605b918693a17d4dd90772}{kmp\_sch\_static} ) \{
2940         r\_sched.\hyperlink{structkmp__r__sched_adc5935f3b0a5ef40ba9b9a019f815fc1}{r\_sched\_type} = \hyperlink{kmp_8h_a7520297e68a11d20d86df78cf53442c1}{\_\_kmp\_static}; \textcolor{comment}{// replace STATIC with more detailed
       schedule (balanced or greedy)}
2941     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a8c039a5dbf8b1d50c8809face611f8e6}{\_\_kmp\_sched} == \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea52b66fc7ba82beb3d6fbdb82a6ef045d}{kmp\_sch\_guided\_chunked} ) \{
2942         r\_sched.\hyperlink{structkmp__r__sched_adc5935f3b0a5ef40ba9b9a019f815fc1}{r\_sched\_type} = \hyperlink{kmp_8h_ad5661902aa5eb6cb8644cc0e3f559a8c}{\_\_kmp\_guided}; \textcolor{comment}{// replace GUIDED with more detailed
       schedule (iterative or analytical)}
2943     \} \textcolor{keywordflow}{else} \{
2944         r\_sched.\hyperlink{structkmp__r__sched_adc5935f3b0a5ef40ba9b9a019f815fc1}{r\_sched\_type} = \hyperlink{kmp_8h_a8c039a5dbf8b1d50c8809face611f8e6}{\_\_kmp\_sched};  \textcolor{comment}{// (STATIC\_CHUNKED), or
       (DYNAMIC\_CHUNKED), or other}
2945     \}
2946 
2947     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a4e654b862068cfd131f0c5cd9afcca26}{\_\_kmp\_chunk} < \hyperlink{kmp_8h_a0b753aac7a3d6af072f31243cdab6d5f}{KMP\_DEFAULT\_CHUNK} ) \{ \textcolor{comment}{// \_\_kmp\_chunk may be wrong here
       (if it was not ever set)}
2948         r\_sched.\hyperlink{structkmp__r__sched_a22eae9ec8051de2d700b8991f33dead5}{chunk} = \hyperlink{kmp_8h_a0b753aac7a3d6af072f31243cdab6d5f}{KMP\_DEFAULT\_CHUNK};
2949     \} \textcolor{keywordflow}{else} \{
2950         r\_sched.\hyperlink{structkmp__r__sched_a22eae9ec8051de2d700b8991f33dead5}{chunk} = \hyperlink{kmp_8h_a4e654b862068cfd131f0c5cd9afcca26}{\_\_kmp\_chunk};
2951     \}
2952 
2953     \textcolor{keywordflow}{return} r\_sched;
2954 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4baac334ea2302a23b0ddfed6bfee3db}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-get\-\_\-team\-\_\-size (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{level}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a4baac334ea2302a23b0ddfed6bfee3db}


Definition at line 2878 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-T\-E\-A\-M\-\_\-\-S\-I\-Z\-E(), and ompc\-\_\-get\-\_\-team\-\_\-size().


\begin{DoxyCode}
2878                                            \{
2879 
2880     \textcolor{keywordtype}{int} ii, dd;
2881     \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
2882     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr;
2883 
2884     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_get\_team\_size: thread %d %d\(\backslash\)n"}, gtid, level ));
2885     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2886 
2887     \textcolor{comment}{// validate level}
2888     \textcolor{keywordflow}{if}( level == 0 ) \textcolor{keywordflow}{return} 1;
2889     \textcolor{keywordflow}{if}( level < 0 ) \textcolor{keywordflow}{return} -1;
2890     thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2891     team = thr->th.th\_team;
2892     ii = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level;
2893     \textcolor{keywordflow}{if}( level > ii ) \textcolor{keywordflow}{return} -1;
2894 
2895 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2896 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( thr->th.th\_teams\_microtask ) \{
2897         \textcolor{comment}{// AC: we are in teams region where multiple nested teams have same level}
2898         \textcolor{keywordtype}{int} tlevel = thr->th.th\_teams\_level; \textcolor{comment}{// the level of the teams construct}
2899         \textcolor{keywordflow}{if}( level <= tlevel ) \{ \textcolor{comment}{// otherwise usual algorithm works (will not touch the teams)}
2900             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ii >= tlevel );
2901             \textcolor{comment}{// AC: As we need to pass by the teams league, we need to artificially increase ii}
2902             \textcolor{keywordflow}{if} ( ii == tlevel ) \{
2903                 ii += 2; \textcolor{comment}{// three teams have same level}
2904             \} \textcolor{keywordflow}{else} \{
2905                 ii ++;   \textcolor{comment}{// two teams have same level}
2906             \}
2907         \}
2908     \}
2909 \textcolor{preprocessor}{#endif}
2910 \textcolor{preprocessor}{}
2911     \textcolor{keywordflow}{while}( ii > level )
2912     \{
2913         \textcolor{keywordflow}{for}( dd = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized; ( dd > 0 ) && ( ii > level ); dd--, ii-- )
2914         \{
2915         \}
2916         \textcolor{keywordflow}{if}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized && ( !dd ) ) \{
2917             team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2918             \textcolor{keywordflow}{continue};
2919         \}
2920         \textcolor{keywordflow}{if}( ii > level ) \{
2921             team = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2922             ii--;
2923         \}
2924     \}
2925 
2926     \textcolor{keywordflow}{return} team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
2927 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a5f124655ad8830498b4dbfd1f5ee8ae1}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs}}
\index{\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs@{\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf kmp\-\_\-internal\-\_\-control\-\_\-t} \-\_\-\-\_\-kmp\-\_\-get\-\_\-x\-\_\-global\-\_\-icvs (
\begin{DoxyParamCaption}
\item[{const {\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a5f124655ad8830498b4dbfd1f5ee8ae1}


Definition at line 3131 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread().


\begin{DoxyCode}
3131                                                   \{
3132 
3133     \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} gx\_icvs;
3134     gx\_icvs.\hyperlink{structkmp__internal__control_aace7f1175db32707e8ad500ed5aea229}{serial\_nesting\_level} = 0; \textcolor{comment}{// probably =team->t.t\_serial like in
       save\_inter\_controls}
3135     \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}( & gx\_icvs, & team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]->th.th\_current\_task->td\_icvs );
3136     gx\_icvs.\hyperlink{structkmp__internal__control_a4860e215a4af81a65d3441cdf8b2fd97}{next} = NULL;
3137 
3138     \textcolor{keywordflow}{return} gx\_icvs;
3139 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a9f825530c4d005a17b222607db3db40f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg@{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg}}
\index{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg@{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppbeg (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a9f825530c4d005a17b222607db3db40f}


Definition at line 7331 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-begin().


\begin{DoxyCode}
7332 \{
7333     \textcolor{keywordtype}{char} *env;
7334 
7335     \textcolor{keywordflow}{if} ((env = getenv( \textcolor{stringliteral}{"KMP\_IGNORE\_MPPBEG"} )) != NULL) \{
7336         \textcolor{keywordflow}{if} (\hyperlink{kmp__str_8c_af4d2e35c93b79090cace08593b665a2b}{\_\_kmp\_str\_match\_false}( env ))
7337             \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
7338     \}
7339     \textcolor{comment}{// By default \_\_kmpc\_begin() is no-op.}
7340     \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
7341 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_af5c4899a5713f6d8c209fc1bfb57d07b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend@{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend}}
\index{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend@{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-ignore\-\_\-mppend (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_af5c4899a5713f6d8c209fc1bfb57d07b}


Definition at line 7344 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-end().


\begin{DoxyCode}
7345 \{
7346     \textcolor{keywordtype}{char} *env;
7347 
7348     \textcolor{keywordflow}{if} ((env = getenv( \textcolor{stringliteral}{"KMP\_IGNORE\_MPPEND"} )) != NULL) \{
7349         \textcolor{keywordflow}{if} (\hyperlink{kmp__str_8c_af4d2e35c93b79090cace08593b665a2b}{\_\_kmp\_str\_match\_false}( env ))
7350             \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
7351     \}
7352     \textcolor{comment}{// By default \_\_kmpc\_end() is no-op.}
7353     \textcolor{keywordflow}{return} \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
7354 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop@{\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop}}
\index{\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop@{\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-infinite\-\_\-loop (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}


Definition at line 316 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-abort\-\_\-process(), \-\_\-\-\_\-kmp\-\_\-abort\-\_\-thread(), and \-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize().


\begin{DoxyCode}
317 \{
318     \textcolor{keyword}{static} \textcolor{keywordtype}{int} done = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
319 
320     \textcolor{keywordflow}{while} (! done) \{
321         \hyperlink{kmp_8h_a9f0d88d1970adda4ad38d272e65d7844}{KMP\_YIELD}( 1 );
322     \}
323 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a0b1c80696ad8f5e7f3cf131fd8e9eeed}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator@{\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator}}
\index{\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator@{\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-init\-\_\-allocator (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a0b1c80696ad8f5e7f3cf131fd8e9eeed}


Definition at line 556 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().


\begin{DoxyCode}
556 \{\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a60fcea18938e34651a2bf9f5d15d95fa}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-init\-\_\-random@{\-\_\-\-\_\-kmp\-\_\-init\-\_\-random}}
\index{\-\_\-\-\_\-kmp\-\_\-init\-\_\-random@{\-\_\-\-\_\-kmp\-\_\-init\-\_\-random}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-init\-\_\-random}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-init\-\_\-random (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thread}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a60fcea18938e34651a2bf9f5d15d95fa}


Definition at line 3482 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), and \-\_\-\-\_\-kmp\-\_\-register\-\_\-root().


\begin{DoxyCode}
3483 \{
3484   \textcolor{keywordtype}{unsigned} seed = thread->th.th\_info.ds.ds\_tid;
3485 
3486   thread->th.th\_a = \hyperlink{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}{\_\_kmp\_primes}[seed%(\textcolor{keyword}{sizeof}(\hyperlink{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}{\_\_kmp\_primes})/\textcolor{keyword}{sizeof}(
      \hyperlink{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}{\_\_kmp\_primes}[0]))];
3487   thread->th.th\_x = (seed+1)*thread->th.th\_a+1;
3488   \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(30, (\textcolor{stringliteral}{"\_\_kmp\_init\_random: THREAD: %u; A: %u\(\backslash\)n"}, seed, thread->th.th\_a) );
3489 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info}}
\index{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{this\-\_\-thr, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{tid, }
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}


Definition at line 4050 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), \-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads(), and \-\_\-\-\_\-kmp\-\_\-register\-\_\-root().


\begin{DoxyCode}
4051 \{
4052     \textcolor{comment}{/* this\_thr->th.th\_info.ds.ds\_gtid is setup in kmp\_allocate\_thread/create\_worker}
4053 \textcolor{comment}{     * this\_thr->th.th\_serial\_team is setup in \_\_kmp\_allocate\_thread */}
4054     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *master = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0];
4055     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr != NULL );
4056     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_serial\_team );
4057     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
4058     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads  );
4059     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch );
4060     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( master );
4061     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( master->th.th\_root );
4062 
4063     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4064 
4065     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(this\_thr->th.th\_team, team);
4066 
4067     this\_thr->th.th\_info.ds.ds\_tid  = tid;
4068     this\_thr->th.th\_set\_nproc       = 0;
4069 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
4070 \textcolor{preprocessor}{}    this\_thr->th.th\_set\_proc\_bind   = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default};
4071 \textcolor{preprocessor}{# if KMP\_AFFINITY\_SUPPORTED}
4072 \textcolor{preprocessor}{}    this\_thr->th.th\_new\_place       = this\_thr->th.th\_current\_place;
4073 \textcolor{preprocessor}{# endif}
4074 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
4075 \textcolor{preprocessor}{}    this\_thr->th.th\_root            = master->th.th\_root;
4076 
4077     \textcolor{comment}{/* setup the thread's cache of the team structure */}
4078     this\_thr->th.th\_team\_nproc      = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
4079     this\_thr->th.th\_team\_master     = master;
4080     this\_thr->th.th\_team\_serialized = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
4081     \hyperlink{kmp__os_8h_a0ab189f0527d57d1c1af19fa3d16067f}{TCW\_PTR}(this\_thr->th.th\_sleep\_loc, NULL);
4082 
4083     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata );
4084 
4085     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_info1: T#%d:%d this\_thread=%p curtask=%p\(\backslash\)n"},
4086                     tid, gtid, this\_thr, this\_thr->th.th\_current\_task ) );
4087 
4088     \hyperlink{kmp_8h_a8387c1b95f3b497a14fc3916515ad4c3}{\_\_kmp\_init\_implicit\_task}( this\_thr->th.th\_team\_master->th.th\_ident, this\_thr, 
      team, tid, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
4089 
4090     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_info2: T#%d:%d this\_thread=%p curtask=%p\(\backslash\)n"},
4091                     tid, gtid, this\_thr, this\_thr->th.th\_current\_task ) );
4092     \textcolor{comment}{// TODO: Initialize ICVs from parent; GEH - isn't that already done in \_\_kmp\_initialize\_team()?}
4093 
4094     \textcolor{comment}{/* TODO no worksharing in speculative threads */}
4095     this\_thr->th.th\_dispatch      = &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ tid ];
4096 
4097     this\_thr->th.th\_local.this\_construct = 0;
4098 
4099 \textcolor{preprocessor}{#ifdef BUILD\_TV}
4100 \textcolor{preprocessor}{}    this\_thr->th.th\_local.tv\_data = 0;
4101 \textcolor{preprocessor}{#endif}
4102 \textcolor{preprocessor}{}
4103     \textcolor{keywordflow}{if} ( ! this\_thr->th.th\_pri\_common ) \{
4104         this\_thr->th.th\_pri\_common = (\textcolor{keyword}{struct }\hyperlink{structcommon__table}{common\_table} *) 
      \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structcommon__table}{common\_table}) );
4105         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
4106             \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}(
4107                 gtid, this\_thr->th.th\_pri\_common, this\_thr->th.th\_pri\_common + 1,
4108                 \textcolor{keyword}{sizeof}( \textcolor{keyword}{struct} \hyperlink{structcommon__table}{common\_table} ), \textcolor{stringliteral}{"th\_%d.th\_pri\_common\(\backslash\)n"}, gtid
4109             );
4110         \}; \textcolor{comment}{// if}
4111         this\_thr->th.th\_pri\_head = NULL;
4112     \}; \textcolor{comment}{// if}
4113 
4114     \textcolor{comment}{/* Initialize dynamic dispatch */}
4115     \{
4116         \textcolor{keyword}{volatile} \hyperlink{structkmp__disp}{kmp\_disp\_t} *dispatch = this\_thr->th.th\_dispatch;
4117         \textcolor{comment}{/*}
4118 \textcolor{comment}{         * Use team max\_nproc since this will never change for the team.}
4119 \textcolor{comment}{         */}
4120         \textcolor{keywordtype}{size\_t} disp\_size = \textcolor{keyword}{sizeof}( \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} ) *
4121             ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc == 1 ? 1 : \hyperlink{kmp_8h_a7d5c6777861c49affd8d4ff04cde845a}{KMP\_MAX\_DISP\_BUF} );
4122         \hyperlink{kmp__debug_8h_ab36654bdefb7cf295069bacc38f7ed84}{KD\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_initialize\_info: T#%d max\_nproc: %d\(\backslash\)n"}, gtid, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc ) );
4123         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( dispatch );
4124         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch );
4125         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( dispatch == &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ tid ] );
4126 
4127         dispatch->\hyperlink{structkmp__disp_a160f4b28144ce1cb64ccf0ceb9ad9ffc}{th\_disp\_index} = 0;
4128 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
4129 \textcolor{preprocessor}{}        dispatch->th\_doacross\_buf\_idx = 0;
4130 \textcolor{preprocessor}{#endif}
4131 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if}( ! dispatch->\hyperlink{structkmp__disp_ae9f9d6c19682600e62d7a9d8ab55fe75}{th\_disp\_buffer} )  \{
4132             dispatch->\hyperlink{structkmp__disp_ae9f9d6c19682600e62d7a9d8ab55fe75}{th\_disp\_buffer} = (\hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} *) 
      \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( disp\_size );
4133 
4134             \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
4135                 \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &dispatch->
      \hyperlink{structkmp__disp_ae9f9d6c19682600e62d7a9d8ab55fe75}{th\_disp\_buffer}[ 0 ],
4136                                          &dispatch->\hyperlink{structkmp__disp_ae9f9d6c19682600e62d7a9d8ab55fe75}{th\_disp\_buffer}[ team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc == 1 ? 1 : \hyperlink{kmp_8h_a7d5c6777861c49affd8d4ff04cde845a}{KMP\_MAX\_DISP\_BUF} ],
4137                                          disp\_size, \textcolor{stringliteral}{"th\_%d.th\_dispatch.th\_disp\_buffer "}
4138                                          \textcolor{stringliteral}{"(team\_%d.t\_dispatch[%d].th\_disp\_buffer)"},
4139                                          gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, gtid );
4140             \}
4141         \} \textcolor{keywordflow}{else} \{
4142             memset( & dispatch->\hyperlink{structkmp__disp_ae9f9d6c19682600e62d7a9d8ab55fe75}{th\_disp\_buffer}[0], \textcolor{charliteral}{'\(\backslash\)0'}, disp\_size );
4143         \}
4144 
4145         dispatch->\hyperlink{structkmp__disp_a720af84b753cfa5961f42459754972b2}{th\_dispatch\_pr\_current} = 0;
4146         dispatch->\hyperlink{structkmp__disp_afe430cfc39a695761004b645704b6b63}{th\_dispatch\_sh\_current} = 0;
4147 
4148         dispatch->\hyperlink{structkmp__disp_a34c2a4a67bbbb9a596e8cee765a12467}{th\_deo\_fcn} = 0;             \textcolor{comment}{/* ORDERED     */}
4149         dispatch->\hyperlink{structkmp__disp_a661b8f748ff2f3204218ae2d7ece3287}{th\_dxo\_fcn} = 0;             \textcolor{comment}{/* END ORDERED */}
4150     \}
4151 
4152     this\_thr->th.th\_next\_pool = NULL;
4153 
4154     \textcolor{keywordflow}{if} (!this\_thr->th.th\_task\_state\_memo\_stack) \{
4155         \textcolor{keywordtype}{size\_t} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
4156         this\_thr->th.th\_task\_state\_memo\_stack = (kmp\_uint8 *) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( 4*\textcolor{keyword}{sizeof}(
      kmp\_uint8) );
4157         this\_thr->th.th\_task\_state\_top = 0;
4158         this\_thr->th.th\_task\_state\_stack\_sz = 4;
4159         \textcolor{keywordflow}{for} (i=0; i<this\_thr->th.th\_task\_state\_stack\_sz; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \textcolor{comment}{// zero init the stack}
4160             this\_thr->th.th\_task\_state\_memo\_stack[i] = 0;
4161     \}
4162 
4163     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( !this\_thr->th.th\_spin\_here );
4164     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_next\_waiting == 0 );
4165 
4166     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4167 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a50a4b71438f212672e584f38bb68d745}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root}}
\index{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-root (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a50a4b71438f212672e584f38bb68d745}


Definition at line 3142 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-register\-\_\-root().


\begin{DoxyCode}
3143 \{
3144     \textcolor{keywordtype}{int}           f;
3145     \hyperlink{unionkmp__team}{kmp\_team\_t}   *root\_team;
3146     \hyperlink{unionkmp__team}{kmp\_team\_t}   *hot\_team;
3147     \textcolor{keywordtype}{int}           hot\_team\_max\_nth;
3148     \hyperlink{structkmp__r__sched}{kmp\_r\_sched\_t} r\_sched = \hyperlink{kmp__runtime_8c_a939a55f9e1a1b31d54915926998f2bae}{\_\_kmp\_get\_schedule\_global}(); \textcolor{comment}{// get
       current state of scheduling globals}
3149     \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} r\_icvs = \hyperlink{kmp__runtime_8c_a9ad37994c0b2b9e6c900768047c82362}{\_\_kmp\_get\_global\_icvs}();
3150     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root );
3151     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( ! root->r.r\_begin );
3152 
3153     \textcolor{comment}{/* setup the root state structure */}
3154     \hyperlink{kmp__lock_8h_a44d857bfef49fda9213da11d71aae54e}{\_\_kmp\_init\_lock}( &root->r.r\_begin\_lock );
3155     root->r.r\_begin        = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
3156     root->r.r\_active       = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
3157     root->r.r\_in\_parallel  = 0;
3158     root->r.r\_blocktime    = \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime};
3159     root->r.r\_nested       = \hyperlink{kmp_8h_a97777d7313012bbad5f5e4e897489172}{\_\_kmp\_dflt\_nested};
3160 
3161     \textcolor{comment}{/* setup the root team for this task */}
3162     \textcolor{comment}{/* allocate the root team structure */}
3163     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_root: before root\_team\(\backslash\)n"} ) );
3164 
3165     root\_team =
3166         \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}(
3167             root,
3168             1,                                                         \textcolor{comment}{// new\_nproc}
3169             1,                                                         \textcolor{comment}{// max\_nproc}
3170 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
3171             0, \textcolor{comment}{// root parallel id}
3172 #endif
3173 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
3174             \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[0],
3175 #endif
3176             &r\_icvs,
3177             0                                                          \textcolor{comment}{// argc}
3178             \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL)                                   \textcolor{comment}{// master thread
       is unknown}
3179         );
3180 \textcolor{preprocessor}{#if USE\_DEBUGGER}
3181 \textcolor{preprocessor}{}    \textcolor{comment}{// Non-NULL value should be assigned to make the debugger display the root team.}
3182     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn, (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})( ~ 0 ));
3183 \textcolor{preprocessor}{#endif}
3184 \textcolor{preprocessor}{}
3185     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_root: after root\_team = %p\(\backslash\)n"}, root\_team ) );
3186 
3187     root->r.r\_root\_team = root\_team;
3188     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_control\_stack\_top = NULL;
3189 
3190     \textcolor{comment}{/* initialize root team */}
3191     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0] = NULL;
3192     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc      = 1;
3193     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized = 1;
3194     \textcolor{comment}{// TODO???: root\_team->t.t\_max\_active\_levels = \_\_kmp\_dflt\_max\_active\_levels;}
3195     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched.r\_sched\_type = r\_sched.\hyperlink{structkmp__r__sched_adc5935f3b0a5ef40ba9b9a019f815fc1}{r\_sched\_type};
3196     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched.chunk        = r\_sched.\hyperlink{structkmp__r__sched_a22eae9ec8051de2d700b8991f33dead5}{chunk};
3197     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_initialize\_root: init root team %d arrived: join=%u, plain=%u\(\backslash\)n"},
3198                     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id, \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE}, 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} ));
3199 
3200     \textcolor{comment}{/* setup the  hot team for this task */}
3201     \textcolor{comment}{/* allocate the hot team structure */}
3202     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_root: before hot\_team\(\backslash\)n"} ) );
3203 
3204     hot\_team =
3205         \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}(
3206             root,
3207             1,                                                         \textcolor{comment}{// new\_nproc}
3208             \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} * 2,                                \textcolor{comment}{// max\_nproc}
3209 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
3210             0, \textcolor{comment}{// root parallel id}
3211 #endif
3212 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
3213             \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[0],
3214 #endif
3215             &r\_icvs,
3216             0                                                          \textcolor{comment}{// argc}
3217             \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL)                                   \textcolor{comment}{// master thread
       is unknown}
3218         );
3219     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_root: after hot\_team = %p\(\backslash\)n"}, hot\_team ) );
3220 
3221     root->r.r\_hot\_team = hot\_team;
3222     root\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_control\_stack\_top = NULL;
3223 
3224     \textcolor{comment}{/* first-time initialization */}
3225     hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent = root\_team;
3226 
3227     \textcolor{comment}{/* initialize hot team */}
3228     hot\_team\_max\_nth = hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc;
3229     \textcolor{keywordflow}{for} ( f = 0; f < hot\_team\_max\_nth; ++ f ) \{
3230         hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[ f ] = NULL;
3231     \}; \textcolor{comment}{// for}
3232     hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = 1;
3233     \textcolor{comment}{// TODO???: hot\_team->t.t\_max\_active\_levels = \_\_kmp\_dflt\_max\_active\_levels;}
3234     hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched.r\_sched\_type = r\_sched.\hyperlink{structkmp__r__sched_adc5935f3b0a5ef40ba9b9a019f815fc1}{r\_sched\_type};
3235     hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched.chunk        = r\_sched.\hyperlink{structkmp__r__sched_a22eae9ec8051de2d700b8991f33dead5}{chunk};
3236     hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = 0;
3237 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team}}
\index{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{new\-\_\-nproc, }
\item[{{\bf kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$}]{new\-\_\-icvs, }
\item[{{\bf ident\-\_\-t} $\ast$}]{loc}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a06c3f8663ed04899138d7be3b44f9f23}


Definition at line 4430 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team().


\begin{DoxyCode}
4435   \{
4436     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_team: enter: team=%p\(\backslash\)n"}, team ) );
4437 
4438     \textcolor{comment}{/* verify */}
4439     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
4440     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( new\_nproc <= team->t.t\_max\_nproc );
4441     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads );
4442     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4443 
4444     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid  = 0;    \textcolor{comment}{/* not needed */}
4445     \textcolor{comment}{/* team->t.t\_master\_bar;        not needed */}
4446     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized  = new\_nproc > 1 ? 0 : 1;
4447     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc       = new\_nproc;
4448 
4449     \textcolor{comment}{/* team->t.t\_parent     = NULL; TODO not needed & would mess up hot team */}
4450     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_next\_pool   = NULL;
4451     \textcolor{comment}{/* memset( team->t.t\_threads, 0, sizeof(kmp\_info\_t*)*new\_nproc ); would mess up hot team */}
4452 
4453     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn, NULL); \textcolor{comment}{/* not needed */}
4454     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_invoke      = NULL; \textcolor{comment}{/* not needed */}
4455 
4456     \textcolor{comment}{// TODO???: team->t.t\_max\_active\_levels       = new\_max\_active\_levels;}
4457     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched       = new\_icvs->\hyperlink{structkmp__internal__control_a39684c4ec5986537da3c14792fd003fb}{sched};
4458 
4459 \textcolor{preprocessor}{#if KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64}
4460 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_fp\_control\_saved = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}; \textcolor{comment}{/* not needed */}
4461     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_x87\_fpu\_control\_word = 0; \textcolor{comment}{/* not needed */}
4462     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_mxcsr = 0;                \textcolor{comment}{/* not needed */}
4463 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 */}\textcolor{preprocessor}{}
4464 \textcolor{preprocessor}{}
4465     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_construct   = 0;
4466     \hyperlink{kmp__lock_8h_a44d857bfef49fda9213da11d71aae54e}{\_\_kmp\_init\_lock}( & team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_single\_lock );
4467 
4468     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ordered .dt.t\_value = 0;
4469     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_active = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
4470 
4471     memset( & team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_taskq, \textcolor{charliteral}{'\(\backslash\)0'}, \textcolor{keyword}{sizeof}( \hyperlink{kmp_8h_ae207b236f7a3d55695081785fc567eaf}{kmp\_taskq\_t} ));
4472 
4473 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
4474 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_copypriv\_data = NULL;  \textcolor{comment}{/* not necessary, but nice for debugging */}
4475 \textcolor{preprocessor}{#endif}
4476 \textcolor{preprocessor}{}    team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_copyin\_counter = 0;    \textcolor{comment}{/* for barrier-free copyin implementation */}
4477 
4478     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_control\_stack\_top = NULL;
4479 
4480     \hyperlink{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\_\_kmp\_reinitialize\_team}( team, new\_icvs, loc );
4481 
4482     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4483     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_initialize\_team: exit: team=%p\(\backslash\)n"}, team ) );
4484 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ae46804a9f563aa89ebb2c15a412d9f82}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-begin (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ae46804a9f563aa89ebb2c15a412d9f82}


Definition at line 7357 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-begin().


\begin{DoxyCode}
7358 \{
7359     \textcolor{keywordtype}{int} gtid;
7360     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} *root;
7361 
7362     \textcolor{comment}{/* this is a very important step as it will register new sibling threads}
7363 \textcolor{comment}{     * and assign these new uber threads a new gtid */}
7364     gtid = \hyperlink{kmp_8h_a5d1e6d7c35de87705193f11d65457229}{\_\_kmp\_entry\_gtid}();
7365     root = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ]->th.th\_root;
7366     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid ));
7367 
7368     \textcolor{keywordflow}{if}( root->r.r\_begin ) \textcolor{keywordflow}{return};
7369     \hyperlink{kmp__lock_8h_a0eb3c836f2c88a4b8cad9535b53bafe0}{\_\_kmp\_acquire\_lock}( &root->r.r\_begin\_lock, gtid );
7370     \textcolor{keywordflow}{if}( root->r.r\_begin ) \{
7371         \hyperlink{kmp__lock_8h_ab32472fcbb6de6d99adb9fbbdaf5a39a}{\_\_kmp\_release\_lock}( & root->r.r\_begin\_lock, gtid );
7372         \textcolor{keywordflow}{return};
7373     \}
7374 
7375     root->r.r\_begin = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
7376 
7377     \hyperlink{kmp__lock_8h_ab32472fcbb6de6d99adb9fbbdaf5a39a}{\_\_kmp\_release\_lock}( & root->r.r\_begin\_lock, gtid );
7378 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3739a3b19edccc322e6dc17b0260cac9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a3739a3b19edccc322e6dc17b0260cac9}


Definition at line 5809 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library(), and \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread().


\begin{DoxyCode}
5810 \{
5811     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
5812 
5813     \textcolor{comment}{/* First, unregister the library */}
5814     \hyperlink{kmp__runtime_8c_a9d810421d1895c17ac6e8774f0f0bd39}{\_\_kmp\_unregister\_library}();
5815 
5816 \textcolor{preprocessor}{    #if KMP\_OS\_WINDOWS}
5817 \textcolor{preprocessor}{}        \textcolor{comment}{/* In Win static library, we can't tell when a root actually dies, so we}
5818 \textcolor{comment}{           reclaim the data structures for any root threads that have died but not}
5819 \textcolor{comment}{           unregistered themselves, in order to shut down cleanly.}
5820 \textcolor{comment}{           In Win dynamic library we also can't tell when a thread dies.}
5821 \textcolor{comment}{        */}
5822         \_\_kmp\_reclaim\_dead\_roots(); \textcolor{comment}{// AC: moved here to always clean resources of dead roots}
5823 \textcolor{preprocessor}{    #endif}
5824 \textcolor{preprocessor}{}
5825     \textcolor{keywordflow}{for}( i=0 ; i<\hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} ; i++ )
5826         \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[i] )
5827             \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[i]->r.r\_active )
5828                 \textcolor{keywordflow}{break};
5829     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
5830     \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
5831 
5832     \textcolor{keywordflow}{if} ( i < \_\_kmp\_threads\_capacity ) \{
5833         \textcolor{comment}{// 2009-09-08 (lev): Other alive roots found. Why do we kill the monitor??}
5834         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
5835 
5836         \textcolor{comment}{//}
5837         \textcolor{comment}{// Need to check that monitor was initialized before reaping it.}
5838         \textcolor{comment}{// If we are called form \_\_kmp\_atfork\_child (which sets}
5839         \textcolor{comment}{// \_\_kmp\_init\_parallel = 0), then \_\_kmp\_monitor will appear to}
5840         \textcolor{comment}{// contain valid data, but it is only valid in the parent process,}
5841         \textcolor{comment}{// not the child.}
5842         \textcolor{comment}{//}
5843         \textcolor{comment}{// New behavior (201008): instead of keying off of the flag}
5844         \textcolor{comment}{// \_\_kmp\_init\_parallel, the monitor thread creation is keyed off}
5845         \textcolor{comment}{// of the new flag \_\_kmp\_init\_monitor.}
5846         \textcolor{comment}{//}
5847         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
5848         \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor} ) ) \{
5849             \hyperlink{kmp_8h_a6f1cbadac27343041f6bb97e0ab76c69}{\_\_kmp\_reap\_monitor}( & \hyperlink{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}{\_\_kmp\_monitor} );
5850             \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor}, 0 );
5851         \}
5852         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
5853         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end: monitor reaped\(\backslash\)n"} ) );
5854     \} \textcolor{keywordflow}{else} \{
5855         \textcolor{comment}{/* TODO move this to cleanup code */}
5856 \textcolor{preprocessor}{        #ifdef KMP\_DEBUG}
5857 \textcolor{preprocessor}{}            \textcolor{comment}{/* make sure that everything has properly ended */}
5858             \textcolor{keywordflow}{for} ( i = 0; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; i++ ) \{
5859                 \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[i] ) \{
5860 \textcolor{comment}{//                    KMP\_ASSERT( ! KMP\_UBER\_GTID( i ) );         // AC: there can be uber threads alive
       here}
5861                     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( ! \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[i]->r.r\_active );  \textcolor{comment}{// TODO: can they be
       active?}
5862                 \}
5863             \}
5864 \textcolor{preprocessor}{        #endif}
5865 \textcolor{preprocessor}{}
5866         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5867 
5868         \textcolor{comment}{// Reap the worker threads.}
5869         \textcolor{comment}{// This is valid for now, but be careful if threads are reaped sooner.}
5870         \textcolor{keywordflow}{while} ( \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} != NULL ) \{    \textcolor{comment}{// Loop thru all the thread in the pool.}
5871             \textcolor{comment}{// Get the next thread from the pool.}
5872             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} * thread = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *) 
      \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool};
5873             \hyperlink{kmp_8h_a3cab107cb6b7391dc221c14353ec6350}{\_\_kmp\_thread\_pool} = thread->th.th\_next\_pool;
5874             \textcolor{comment}{// Reap it.}
5875             thread->th.th\_next\_pool = NULL;
5876             thread->th.th\_in\_pool = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
5877             \hyperlink{kmp__runtime_8c_a8dcaceda5809cef836f90d78710e7bed}{\_\_kmp\_reap\_thread}( thread, 0 );
5878         \}; \textcolor{comment}{// while}
5879         \hyperlink{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\_\_kmp\_thread\_pool\_insert\_pt} = NULL;
5880 
5881         \textcolor{comment}{// Reap teams.}
5882         \textcolor{keywordflow}{while} ( \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool} != NULL ) \{     \textcolor{comment}{// Loop thru all the teams in the pool.}
5883             \textcolor{comment}{// Get the next team from the pool.}
5884             \hyperlink{unionkmp__team}{kmp\_team\_t} * team = (\hyperlink{unionkmp__team}{kmp\_team\_t} *) 
      \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool};
5885             \hyperlink{kmp_8h_a04811f0174c4d50bd75362cfc85a83f7}{\_\_kmp\_team\_pool} = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_next\_pool;
5886             \textcolor{comment}{// Reap it.}
5887             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_next\_pool = NULL;
5888             \hyperlink{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}{\_\_kmp\_reap\_team}( team );
5889         \}; \textcolor{comment}{// while}
5890 
5891         \hyperlink{kmp_8h_a22a6e6a06a23962fc8de80d5d474e82c}{\_\_kmp\_reap\_task\_teams}( );
5892 
5893         \textcolor{keywordflow}{for} ( i = 0; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; ++ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
5894             \textcolor{comment}{// TBD: Add some checking...}
5895             \textcolor{comment}{// Something like KMP\_DEBUG\_ASSERT( \_\_kmp\_thread[ i ] == NULL );}
5896         \}
5897 
5898         \textcolor{comment}{/* Make sure all threadprivate destructors get run by joining with all worker}
5899 \textcolor{comment}{           threads before resetting this flag */}
5900         \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a5f3438a34f9250663bc10f78b727dc1a}{\_\_kmp\_init\_common}, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
5901 
5902         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end: all workers reaped\(\backslash\)n"} ) );
5903         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5904 
5905         \textcolor{comment}{//}
5906         \textcolor{comment}{// See note above: One of the possible fixes for CQ138434 / CQ140126}
5907         \textcolor{comment}{//}
5908         \textcolor{comment}{// FIXME: push both code fragments down and CSE them?}
5909         \textcolor{comment}{// push them into \_\_kmp\_cleanup() ?}
5910         \textcolor{comment}{//}
5911         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
5912         \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor} ) ) \{
5913             \hyperlink{kmp_8h_a6f1cbadac27343041f6bb97e0ab76c69}{\_\_kmp\_reap\_monitor}( & \hyperlink{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}{\_\_kmp\_monitor} );
5914             \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}( \hyperlink{kmp_8h_a7837f92b7bc9827769108bb115d180e8}{\_\_kmp\_init\_monitor}, 0 );
5915         \}
5916         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & 
      \hyperlink{kmp_8h_ae898939654132601bc5cd26774d899fc}{\_\_kmp\_monitor\_lock} );
5917         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end: monitor reaped\(\backslash\)n"} ) );
5918 
5919     \} \textcolor{comment}{/* else !\_\_kmp\_global.t\_active */}
5920     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a3f91f5b94048484e40c6caeb66c60f27}{\_\_kmp\_init\_gtid}, \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
5921     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
5922 
5923     \hyperlink{kmp__runtime_8c_afb0978e7a9bd0e5f91d089c4571e618f}{\_\_kmp\_cleanup}();
5924 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5925 \textcolor{preprocessor}{}    \hyperlink{ompt-general_8c_a037e453a3ca5f6cadb948ab9c5451350}{ompt\_fini}();
5926 \textcolor{preprocessor}{#endif}
5927 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3cb9d65a5473297ec40988b57ab4db11}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3cb9d65a5473297ec40988b57ab4db11}


Definition at line 5663 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().


\begin{DoxyCode}
5664 \{
5665     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 30, ( \textcolor{stringliteral}{"\_\_kmp\_internal\_end\_atexit\(\backslash\)n"} ) );
5666     \textcolor{comment}{/* [Windows]}
5667 \textcolor{comment}{       josh: ideally, we want to completely shutdown the library in this atexit handler, but}
5668 \textcolor{comment}{       stat code that depends on thread specific data for gtid fails because that data becomes}
5669 \textcolor{comment}{       unavailable at some point during the shutdown, so we call \_\_kmp\_internal\_end\_thread}
5670 \textcolor{comment}{       instead.  We should eventually remove the dependency on \_\_kmp\_get\_specific\_gtid in the}
5671 \textcolor{comment}{       stat code and use \_\_kmp\_internal\_end\_library to cleanly shutdown the library.}
5672 \textcolor{comment}{}
5673 \textcolor{comment}{// TODO: Can some of this comment about GVS be removed?}
5674 \textcolor{comment}{       I suspect that the offending stat code is executed when the calling thread tries to}
5675 \textcolor{comment}{       clean up a dead root thread's data structures, resulting in GVS code trying to close}
5676 \textcolor{comment}{       the GVS structures for that thread, but since the stat code uses}
5677 \textcolor{comment}{       \_\_kmp\_get\_specific\_gtid to get the gtid with the assumption that the calling thread is}
5678 \textcolor{comment}{       cleaning up itself instead of another thread, it gets confused.  This happens because}
5679 \textcolor{comment}{       allowing a thread to unregister and cleanup another thread is a recent modification for}
5680 \textcolor{comment}{       addressing an issue with Maxon Cinema4D.  Based on the current design (20050722), a}
5681 \textcolor{comment}{       thread may end up trying to unregister another thread only if thread death does not}
5682 \textcolor{comment}{       trigger the calling of \_\_kmp\_internal\_end\_thread.  For Linux* OS, there is the thread}
5683 \textcolor{comment}{       specific data destructor function to detect thread death.  For Windows dynamic, there}
5684 \textcolor{comment}{       is DllMain(THREAD\_DETACH).  For Windows static, there is nothing.  Thus, the}
5685 \textcolor{comment}{       workaround is applicable only for Windows static stat library.}
5686 \textcolor{comment}{    */}
5687     \hyperlink{kmp__runtime_8c_aac19f436c6f29b33591829da3e2bb626}{\_\_kmp\_internal\_end\_library}( -1 );
5688 \textcolor{preprocessor}{    #if KMP\_OS\_WINDOWS}
5689 \textcolor{preprocessor}{}        \hyperlink{kmp__io_8h_af81f5473283b2e95761257dca06c3d82}{\_\_kmp\_close\_console}();
5690 \textcolor{preprocessor}{    #endif}
5691 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a6cff683557975c0b72ecd87bef7985de}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest (
\begin{DoxyParamCaption}
\item[{{\bf void} $\ast$}]{specific\-\_\-gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a6cff683557975c0b72ecd87bef7985de}


Definition at line 5606 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-runtime\-\_\-initialize().


\begin{DoxyCode}
5607 \{
5608 \textcolor{preprocessor}{    #if KMP\_COMPILER\_ICC}
5609 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #pragma warning( push )}
5610 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #pragma warning( disable:  810 ) // conversion from "void *" to "int" may lose significant bits}
5611 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif}
5612 \textcolor{preprocessor}{}    \textcolor{comment}{// Make sure no significant bits are lost}
5613     \textcolor{keywordtype}{int} gtid = (\hyperlink{kmp__os_8h_a43fe09095a192381a5e7c93d20a3a2f9}{kmp\_intptr\_t})specific\_gtid - 1;
5614 \textcolor{preprocessor}{    #if KMP\_COMPILER\_ICC}
5615 \textcolor{preprocessor}{}\textcolor{preprocessor}{        #pragma warning( pop )}
5616 \textcolor{preprocessor}{}\textcolor{preprocessor}{    #endif}
5617 \textcolor{preprocessor}{}
5618     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 30, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_dest: T#%d\(\backslash\)n"}, gtid));
5619     \textcolor{comment}{/* NOTE: the gtid is stored as gitd+1 in the thread-local-storage}
5620 \textcolor{comment}{     * this is because 0 is reserved for the nothing-stored case */}
5621 
5622     \textcolor{comment}{/* josh: One reason for setting the gtid specific data even when it is being}
5623 \textcolor{comment}{       destroyed by pthread is to allow gtid lookup through thread specific data}
5624 \textcolor{comment}{       (\_\_kmp\_gtid\_get\_specific).  Some of the code, especially stat code,}
5625 \textcolor{comment}{       that gets executed in the call to \_\_kmp\_internal\_end\_thread, actually}
5626 \textcolor{comment}{       gets the gtid through the thread specific data.  Setting it here seems}
5627 \textcolor{comment}{       rather inelegant and perhaps wrong, but allows \_\_kmp\_internal\_end\_thread}
5628 \textcolor{comment}{       to run smoothly.}
5629 \textcolor{comment}{       todo: get rid of this after we remove the dependence on}
5630 \textcolor{comment}{       \_\_kmp\_gtid\_get\_specific}
5631 \textcolor{comment}{    */}
5632     \textcolor{keywordflow}{if}(gtid >= 0 && \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}(gtid))
5633         \hyperlink{kmp_8h_ae3492f3ab3c30ed2c204dc10e93c8471}{\_\_kmp\_gtid\_set\_specific}( gtid );
5634 \textcolor{preprocessor}{    #ifdef KMP\_TDATA\_GTID}
5635 \textcolor{preprocessor}{}        \_\_kmp\_gtid = gtid;
5636 \textcolor{preprocessor}{    #endif}
5637 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a75a86276e70967f171eae5df8dc2215c}{\_\_kmp\_internal\_end\_thread}( gtid );
5638 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aac19f436c6f29b33591829da3e2bb626}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid\-\_\-req}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aac19f436c6f29b33591829da3e2bb626}


Definition at line 5930 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-atexit().


\begin{DoxyCode}
5931 \{
5932     \textcolor{comment}{/* if we have already cleaned up, don't try again, it wouldn't be pretty */}
5933     \textcolor{comment}{/* this shouldn't be a race condition because \_\_kmp\_internal\_end() is the}
5934 \textcolor{comment}{     * only place to clear \_\_kmp\_serial\_init */}
5935     \textcolor{comment}{/* we'll check this later too, after we get the lock */}
5936     \textcolor{comment}{// 2009-09-06: We do not set g\_abort without setting g\_done. This check looks redundaant,}
5937     \textcolor{comment}{// because the next check will work in any case.}
5938     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort ) \{
5939         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 11, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: abort, exiting\(\backslash\)n"} ));
5940         \textcolor{comment}{/* TODO abort? */}
5941         \textcolor{keywordflow}{return};
5942     \}
5943     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) || !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
5944         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: already finished\(\backslash\)n"} ));
5945         \textcolor{keywordflow}{return};
5946     \}
5947 
5948 
5949     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
5950 
5951     \textcolor{comment}{/* find out who we are and what we should do */}
5952     \{
5953         \textcolor{keywordtype}{int} gtid = (gtid\_req>=0) ? gtid\_req : \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
5954         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: enter T#%d  (%d)\(\backslash\)n"}, gtid, gtid\_req ));
5955         \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_a4f2fd385fbacda6b6de0ce54eb2dd028}{KMP\_GTID\_SHUTDOWN} ) \{
5956             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: !\_\_kmp\_init\_runtime, system already
       shutdown\(\backslash\)n"} ));
5957             \textcolor{keywordflow}{return};
5958         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_a5eb958603bc237a3484be5bd2b0de39a}{KMP\_GTID\_MONITOR} ) \{
5959             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: monitor thread, gtid not registered, or
       system shutdown\(\backslash\)n"} ));
5960             \textcolor{keywordflow}{return};
5961         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE} ) \{
5962             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: gtid not registered or system shutdown\(\backslash\)n"} )
      );
5963             \textcolor{comment}{/* we don't know who we are, but we may still shutdown the library */}
5964         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid )) \{
5965             \textcolor{comment}{/* unregister ourselves as an uber thread.  gtid is no longer valid */}
5966             \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid]->r.r\_active ) \{
5967                 \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort = -1;
5968                 \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
5969                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: root still active, abort T#%d\(\backslash\)n"}, gtid 
      ));
5970                 \textcolor{keywordflow}{return};
5971             \} \textcolor{keywordflow}{else} \{
5972                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: unregistering sibling T#%d\(\backslash\)n"}, gtid ));
5973                 \hyperlink{kmp__runtime_8c_a87754754d79922faa89637e40ef50579}{\_\_kmp\_unregister\_root\_current\_thread}( gtid );
5974             \}
5975         \} \textcolor{keywordflow}{else} \{
5976             \textcolor{comment}{/* worker threads may call this function through the atexit handler, if they call exit() */}
5977             \textcolor{comment}{/* For now, skip the usual subsequent processing and just dump the debug buffer.}
5978 \textcolor{comment}{               TODO: do a thorough shutdown instead}
5979 \textcolor{comment}{            */}
5980 \textcolor{preprocessor}{            #ifdef DUMP\_DEBUG\_ON\_EXIT}
5981 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a34cced9aee5b6e711fe55d15363aa6d4}{\_\_kmp\_debug\_buf} )
5982                     \hyperlink{kmp__debug_8c_a051d40c547de052d7beccac6cc20479a}{\_\_kmp\_dump\_debug\_buffer}( );
5983 \textcolor{preprocessor}{            #endif}
5984 \textcolor{preprocessor}{}            \textcolor{keywordflow}{return};
5985         \}
5986     \}
5987     \textcolor{comment}{/* synchronize the termination process */}
5988     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
5989 
5990     \textcolor{comment}{/* have we already finished */}
5991     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort ) \{
5992         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: abort, exiting\(\backslash\)n"} ));
5993         \textcolor{comment}{/* TODO abort? */}
5994         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
5995         \textcolor{keywordflow}{return};
5996     \}
5997     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) || !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
5998         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
5999         \textcolor{keywordflow}{return};
6000     \}
6001 
6002     \textcolor{comment}{/* We need this lock to enforce mutex between this reading of}
6003 \textcolor{comment}{       \_\_kmp\_threads\_capacity and the writing by \_\_kmp\_register\_root.}
6004 \textcolor{comment}{       Alternatively, we can use a counter of roots that is}
6005 \textcolor{comment}{       atomically updated by \_\_kmp\_get\_global\_thread\_id\_reg,}
6006 \textcolor{comment}{       \_\_kmp\_do\_serial\_initialize and \_\_kmp\_internal\_end\_*.}
6007 \textcolor{comment}{    */}
6008     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
6009 
6010     \textcolor{comment}{/* now we can safely conduct the actual termination */}
6011     \hyperlink{kmp__runtime_8c_a3739a3b19edccc322e6dc17b0260cac9}{\_\_kmp\_internal\_end}();
6012 
6013     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
6014     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6015 
6016     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_library: exit\(\backslash\)n"} ) );
6017 
6018 \textcolor{preprocessor}{    #ifdef DUMP\_DEBUG\_ON\_EXIT}
6019 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a34cced9aee5b6e711fe55d15363aa6d4}{\_\_kmp\_debug\_buf} )
6020             \hyperlink{kmp__debug_8c_a051d40c547de052d7beccac6cc20479a}{\_\_kmp\_dump\_debug\_buffer}();
6021 \textcolor{preprocessor}{    #endif}
6022 \textcolor{preprocessor}{}
6023 \textcolor{preprocessor}{    #if KMP\_OS\_WINDOWS}
6024 \textcolor{preprocessor}{}        \hyperlink{kmp__io_8h_af81f5473283b2e95761257dca06c3d82}{\_\_kmp\_close\_console}();
6025 \textcolor{preprocessor}{    #endif}
6026 \textcolor{preprocessor}{}
6027     \hyperlink{kmp__runtime_8c_a08510dec818bea07a313d1c0b0534da5}{\_\_kmp\_fini\_allocator}();
6028 
6029 \} \textcolor{comment}{// \_\_kmp\_internal\_end\_library}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a75a86276e70967f171eae5df8dc2215c}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid\-\_\-req}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a75a86276e70967f171eae5df8dc2215c}


Definition at line 6032 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-dest(), and \-\_\-\-\_\-kmpc\-\_\-end().


\begin{DoxyCode}
6033 \{
6034     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
6035 
6036     \textcolor{comment}{/* if we have already cleaned up, don't try again, it wouldn't be pretty */}
6037     \textcolor{comment}{/* this shouldn't be a race condition because \_\_kmp\_internal\_end() is the}
6038 \textcolor{comment}{     * only place to clear \_\_kmp\_serial\_init */}
6039     \textcolor{comment}{/* we'll check this later too, after we get the lock */}
6040     \textcolor{comment}{// 2009-09-06: We do not set g\_abort without setting g\_done. This check looks redundant,}
6041     \textcolor{comment}{// because the next check will work in any case.}
6042     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort ) \{
6043         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 11, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: abort, exiting\(\backslash\)n"} ));
6044         \textcolor{comment}{/* TODO abort? */}
6045         \textcolor{keywordflow}{return};
6046     \}
6047     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) || !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
6048         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: already finished\(\backslash\)n"} ));
6049         \textcolor{keywordflow}{return};
6050     \}
6051 
6052     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
6053 
6054     \textcolor{comment}{/* find out who we are and what we should do */}
6055     \{
6056         \textcolor{keywordtype}{int} gtid = (gtid\_req>=0) ? gtid\_req : \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}();
6057         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: enter T#%d  (%d)\(\backslash\)n"}, gtid, gtid\_req ));
6058         \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_a4f2fd385fbacda6b6de0ce54eb2dd028}{KMP\_GTID\_SHUTDOWN} ) \{
6059             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: !\_\_kmp\_init\_runtime, system already shutdown
      \(\backslash\)n"} ));
6060             \textcolor{keywordflow}{return};
6061         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_a5eb958603bc237a3484be5bd2b0de39a}{KMP\_GTID\_MONITOR} ) \{
6062             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: monitor thread, gtid not registered, or
       system shutdown\(\backslash\)n"} ));
6063             \textcolor{keywordflow}{return};
6064         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( gtid == \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE} ) \{
6065             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: gtid not registered or system shutdown\(\backslash\)n"} ))
      ;
6066             \textcolor{keywordflow}{return};
6067             \textcolor{comment}{/* we don't know who we are */}
6068         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid )) \{
6069         \textcolor{comment}{/* unregister ourselves as an uber thread.  gtid is no longer valid */}
6070             \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid]->r.r\_active ) \{
6071                 \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort = -1;
6072                 \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
6073                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: root still active, abort T#%d\(\backslash\)n"}, gtid )
      );
6074                 \textcolor{keywordflow}{return};
6075             \} \textcolor{keywordflow}{else} \{
6076                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: unregistering sibling T#%d\(\backslash\)n"}, gtid ));
6077                 \hyperlink{kmp__runtime_8c_a87754754d79922faa89637e40ef50579}{\_\_kmp\_unregister\_root\_current\_thread}( gtid );
6078             \}
6079         \} \textcolor{keywordflow}{else} \{
6080             \textcolor{comment}{/* just a worker thread, let's leave */}
6081             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: worker thread T#%d\(\backslash\)n"}, gtid ));
6082 
6083             \textcolor{keywordflow}{if} ( gtid >= 0 ) \{
6084                 \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_task\_team = NULL;
6085             \}
6086 
6087             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: worker thread done, exiting T#%d\(\backslash\)n"}, gtid ))
      ;
6088             \textcolor{keywordflow}{return};
6089         \}
6090     \}
6091 \textcolor{preprocessor}{    #if defined KMP\_DYNAMIC\_LIB}
6092 \textcolor{preprocessor}{}    \textcolor{comment}{// AC: lets not shutdown the Linux* OS dynamic library at the exit of uber thread,}
6093     \textcolor{comment}{//     because we will better shutdown later in the library destructor.}
6094     \textcolor{comment}{//     The reason of this change is performance problem when non-openmp thread}
6095     \textcolor{comment}{//     in a loop forks and joins many openmp threads. We can save a lot of time}
6096     \textcolor{comment}{//     keeping worker threads alive until the program shutdown.}
6097     \textcolor{comment}{// OM: Removed Linux* OS restriction to fix the crash on OS X* (DPD200239966) and}
6098     \textcolor{comment}{//     Windows(DPD200287443) that occurs when using critical sections from foreign threads.}
6099         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: exiting T#%d\(\backslash\)n"}, gtid\_req) );
6100         \textcolor{keywordflow}{return};
6101 \textcolor{preprocessor}{    #endif}
6102 \textcolor{preprocessor}{}    \textcolor{comment}{/* synchronize the termination process */}
6103     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6104 
6105     \textcolor{comment}{/* have we already finished */}
6106     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_abort ) \{
6107         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: abort, exiting\(\backslash\)n"} ));
6108         \textcolor{comment}{/* TODO abort? */}
6109         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6110         \textcolor{keywordflow}{return};
6111     \}
6112     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) || !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
6113         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6114         \textcolor{keywordflow}{return};
6115     \}
6116 
6117     \textcolor{comment}{/* We need this lock to enforce mutex between this reading of}
6118 \textcolor{comment}{       \_\_kmp\_threads\_capacity and the writing by \_\_kmp\_register\_root.}
6119 \textcolor{comment}{       Alternatively, we can use a counter of roots that is}
6120 \textcolor{comment}{       atomically updated by \_\_kmp\_get\_global\_thread\_id\_reg,}
6121 \textcolor{comment}{       \_\_kmp\_do\_serial\_initialize and \_\_kmp\_internal\_end\_*.}
6122 \textcolor{comment}{    */}
6123 
6124     \textcolor{comment}{/* should we finish the run-time?  are all siblings done? */}
6125     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
6126 
6127     \textcolor{keywordflow}{for} ( i = 0; i < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity}; ++ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
6128         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( i ) ) \{
6129             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: remaining sibling task: gtid==%d\(\backslash\)n"}, i ));
6130             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
6131             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6132             \textcolor{keywordflow}{return};
6133         \};
6134     \}
6135 
6136     \textcolor{comment}{/* now we can safely conduct the actual termination */}
6137 
6138     \hyperlink{kmp__runtime_8c_a3739a3b19edccc322e6dc17b0260cac9}{\_\_kmp\_internal\_end}();
6139 
6140     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
6141     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6142 
6143     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_internal\_end\_thread: exit T#%d\(\backslash\)n"}, gtid\_req ) );
6144 
6145 \textcolor{preprocessor}{    #ifdef DUMP\_DEBUG\_ON\_EXIT}
6146 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a34cced9aee5b6e711fe55d15363aa6d4}{\_\_kmp\_debug\_buf} )
6147             \hyperlink{kmp__debug_8c_a051d40c547de052d7beccac6cc20479a}{\_\_kmp\_dump\_debug\_buffer}();
6148 \textcolor{preprocessor}{    #endif}
6149 \textcolor{preprocessor}{}\} \textcolor{comment}{// \_\_kmp\_internal\_end\_thread}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_aa733ff3ae9a095e5dd24907ca3adf92e}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-fork (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{id, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_aa733ff3ae9a095e5dd24907ca3adf92e}


Definition at line 7045 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
7046 \{
7047     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
7048 
7049 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
7050 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} f;
7051 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
7052 \textcolor{preprocessor}{}
7053     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
7054     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_team  ==  team );
7055     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(       \hyperlink{kmp_8h_a996fe75425730b06ff88477bf72b8134}{KMP\_MASTER\_GTID}(gtid) );
7056     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
7057 
7058     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_construct = 0;          \textcolor{comment}{/* no single directives seen yet */}
7059     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ordered.dt.t\_value = 0; \textcolor{comment}{/* thread 0 enters the ordered section first */}
7060 
7061     \textcolor{comment}{/* Reset the identifiers on the dispatch buffer */}
7062     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer );
7063     \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc > 1 ) \{
7064         \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
7065         \textcolor{keywordflow}{for} (i = 0; i <  \hyperlink{kmp_8h_a7d5c6777861c49affd8d4ff04cde845a}{KMP\_MAX\_DISP\_BUF}; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \{
7066             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[ \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ].buffer\_index = \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
7067 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
7068 \textcolor{preprocessor}{}            team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}].doacross\_buf\_idx = \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
7069 \textcolor{preprocessor}{#endif}
7070 \textcolor{preprocessor}{}        \}
7071     \} \textcolor{keywordflow}{else} \{
7072         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[ 0 ].buffer\_index = 0;
7073 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
7074 \textcolor{preprocessor}{}        team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[0].doacross\_buf\_idx = 0;
7075 \textcolor{preprocessor}{#endif}
7076 \textcolor{preprocessor}{}    \}
7077 
7078     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
7079     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( this\_thr->th.th\_team  ==  team );
7080 
7081 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
7082 \textcolor{preprocessor}{}    \textcolor{keywordflow}{for}( f=0 ; f<team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc ; f++ ) \{
7083         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] &&
7084                           team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_team\_nproc == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc );
7085     \}
7086 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
7087 \textcolor{preprocessor}{}
7088     \textcolor{comment}{/* release the worker threads so they may begin working */}
7089     \hyperlink{kmp__runtime_8c_aea1108b093169cef205a6766bdfa5a40}{\_\_kmp\_fork\_barrier}( gtid, 0 );
7090 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7f0781abf1c47553c64f9ddddaf17c66}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join}}
\index{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join@{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-internal\-\_\-join}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-internal\-\_\-join (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{id, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a7f0781abf1c47553c64f9ddddaf17c66}


Definition at line 7094 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-join\-\_\-call().


\begin{DoxyCode}
7095 \{
7096     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
7097 
7098     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
7099     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_team  ==  team );
7100     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(       \hyperlink{kmp_8h_a996fe75425730b06ff88477bf72b8134}{KMP\_MASTER\_GTID}(gtid) );
7101     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
7102 
7103     \textcolor{comment}{/* Join barrier after fork */}
7104 
7105 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
7106 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid] && \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_team\_nproc != team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc ) \{
7107         \hyperlink{kmp__io_8c_ac0b96ed999ee9819c544e6f24057da91}{\_\_kmp\_printf}(\textcolor{stringliteral}{"GTID: %d, \_\_kmp\_threads[%d]=%p\(\backslash\)n"},gtid, gtid, 
      \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]);
7108         \hyperlink{kmp__io_8c_ac0b96ed999ee9819c544e6f24057da91}{\_\_kmp\_printf}(\textcolor{stringliteral}{"\_\_kmp\_threads[%d]->th.th\_team\_nproc=%d, TEAM: %p, team->t.t\_nproc=%d\(\backslash\)n"},
7109                      gtid, \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_team\_nproc, team, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc);
7110         \hyperlink{kmp__barrier_8cpp_a8c4e5bfa41738c5f588746983ee491a9}{\_\_kmp\_print\_structure}();
7111     \}
7112     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid] &&
7113                      \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_team\_nproc == team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc );
7114 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
7115 \textcolor{preprocessor}{}
7116     \hyperlink{kmp__runtime_8c_a5e8f7c63d5e652f73e8998922edf14a4}{\_\_kmp\_join\_barrier}( gtid );  \textcolor{comment}{/* wait for everyone */}
7117 
7118     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
7119     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( this\_thr->th.th\_team  ==  team );
7120 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ac3c18dacc189c300ca06e4ab033fc211}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func@{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func}}
\index{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func@{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ac3c18dacc189c300ca06e4ab033fc211}


Definition at line 6844 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-\-G\-O\-M\-P\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-teams\-\_\-master(), \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call(), and \-\_\-\-\_\-kmpc\-\_\-invoke\-\_\-task\-\_\-func().


\begin{DoxyCode}
6845 \{
6846     \textcolor{keywordtype}{int}          rc;
6847     \textcolor{keywordtype}{int}          tid      = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid );
6848     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}  *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
6849     \hyperlink{unionkmp__team}{kmp\_team\_t}  *team     = this\_thr->th.th\_team;
6850 
6851     \hyperlink{kmp__runtime_8c_a2b2e7087eea1ede7973094294abaac82}{\_\_kmp\_run\_before\_invoked\_task}( gtid, tid, this\_thr, team );
6852 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
6853 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_itt\_stack\_caller\_create\_ptr ) \{
6854         \_\_kmp\_itt\_stack\_callee\_enter( (\hyperlink{ittnotify__static_8h_a13361cbb7d40628ec1345dcfb7264892}{\_\_itt\_caller})team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_stack\_id ); \textcolor{comment}{// inform ittnotify
       about entering user's code}
6855     \}
6856 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
6857 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if INCLUDE\_SSC\_MARKS}
6858 \textcolor{preprocessor}{}    SSC\_MARK\_INVOKING();
6859 \textcolor{preprocessor}{#endif}
6860 \textcolor{preprocessor}{}
6861 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
6862 \textcolor{preprocessor}{}    \textcolor{keywordtype}{void} *dummy;
6863     \textcolor{keywordtype}{void} **exit\_runtime\_p;
6864     ompt\_task\_id\_t my\_task\_id;
6865     ompt\_parallel\_id\_t my\_parallel\_id;
6866 
6867     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
6868         exit\_runtime\_p = &(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].
6869             ompt\_task\_info.frame.exit\_runtime\_frame);
6870     \} \textcolor{keywordflow}{else} \{
6871         exit\_runtime\_p = &dummy;
6872     \}
6873 
6874 \textcolor{preprocessor}{#if OMPT\_TRACE}
6875 \textcolor{preprocessor}{}    my\_task\_id = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].ompt\_task\_info.task\_id;
6876     my\_parallel\_id = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.parallel\_id;
6877     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
6878         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)) \{
6879         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_begin)(
6880             my\_parallel\_id, my\_task\_id);
6881     \}
6882 \textcolor{preprocessor}{#endif}
6883 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
6884 \textcolor{preprocessor}{}
6885     \{
6886         \hyperlink{group__STATS__GATHERING_ga62f4b6e3a4ba48c04b172b97df137839}{KMP\_TIME\_BLOCK}(OMP\_work);
6887         rc = \hyperlink{kmp_8h_af1b91ebb601311b9b29a6d1d8db93243}{\_\_kmp\_invoke\_microtask}( (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t}) 
      \hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn),
6888                                      gtid, tid, (\textcolor{keywordtype}{int}) team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc, (\textcolor{keywordtype}{void} **) team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv
6889 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
6890                                      , exit\_runtime\_p
6891 #endif
6892                                      );
6893     \}
6894 
6895 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
6896 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_itt\_stack\_caller\_create\_ptr ) \{
6897         \_\_kmp\_itt\_stack\_callee\_leave( (\hyperlink{ittnotify__static_8h_a13361cbb7d40628ec1345dcfb7264892}{\_\_itt\_caller})team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_stack\_id ); \textcolor{comment}{// inform ittnotify
       about leaving user's code}
6898     \}
6899 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
6900 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a99118650304b0dbf1c8fc131d3a60d5f}{\_\_kmp\_run\_after\_invoked\_task}( gtid, tid, this\_thr, team );
6901 
6902     \textcolor{keywordflow}{return} rc;
6903 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ad176caa723133097e5ef49b4db44ea31}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master@{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master}}
\index{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master@{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ad176caa723133097e5ef49b4db44ea31}


Definition at line 6945 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams().


\begin{DoxyCode}
6946 \{
6947     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}  *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
6948     \hyperlink{unionkmp__team}{kmp\_team\_t}  *team     = this\_thr->th.th\_team;
6949 \textcolor{preprocessor}{    #if KMP\_DEBUG}
6950 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]-> th.th\_team->t.t\_serialized )
6951         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( (\textcolor{keywordtype}{void}*)\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]-> th.th\_team->t.t\_pkfn ==
       (\textcolor{keywordtype}{void}*)\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} );
6952 \textcolor{preprocessor}{    #endif}
6953 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a2b2e7087eea1ede7973094294abaac82}{\_\_kmp\_run\_before\_invoked\_task}( gtid, 0, this\_thr, team );
6954     \hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master}( gtid );
6955     \hyperlink{kmp__runtime_8c_a99118650304b0dbf1c8fc131d3a60d5f}{\_\_kmp\_run\_after\_invoked\_task}( gtid, 0, this\_thr, team );
6956     \textcolor{keywordflow}{return} 1;
6957 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a5e8f7c63d5e652f73e8998922edf14a4}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier@{\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier}}
\index{\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier@{\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-join\-\_\-barrier (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a5e8f7c63d5e652f73e8998922edf14a4}


Definition at line 1346 of file kmp\-\_\-barrier.\-cpp.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-join(), and \-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread().


\begin{DoxyCode}
1347 \{
1348     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_join\_barrier);
1349     \textcolor{keyword}{register} \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
1350     \textcolor{keyword}{register} \hyperlink{unionkmp__team}{kmp\_team\_t} *team;
1351     \textcolor{keyword}{register} \hyperlink{kmp__os_8h_a2bced771303068eeaf1ba0bcfa6f85de}{kmp\_uint} nproc;
1352     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *master\_thread;
1353     \textcolor{keywordtype}{int} tid;
1354 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
1355 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} team\_id;
1356 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
1357 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if USE\_ITT\_BUILD}
1358 \textcolor{preprocessor}{}    \textcolor{keywordtype}{void} *itt\_sync\_obj = NULL;
1359 \textcolor{preprocessor}{# if USE\_ITT\_NOTIFY}
1360 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG) \textcolor{comment}{// Don't call routine without need}
1361         \textcolor{comment}{// Get object created at fork\_barrier}
1362         itt\_sync\_obj = \_\_kmp\_itt\_barrier\_object(gtid, \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier});
1363 \textcolor{preprocessor}{# endif}
1364 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1365 \textcolor{preprocessor}{}    \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1366 
1367     \textcolor{comment}{// Get current info}
1368     team = this\_thr->th.th\_team;
1369     nproc = this\_thr->th.th\_team\_nproc;
1370     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}((\textcolor{keywordtype}{int})nproc == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc);
1371     tid = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}(gtid);
1372 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
1373 \textcolor{preprocessor}{}    team\_id = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id;
1374 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
1375 \textcolor{preprocessor}{}    master\_thread = this\_thr->th.th\_team\_master;
1376 \textcolor{preprocessor}{#ifdef KMP\_DEBUG}
1377 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (master\_thread != team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]) \{
1378         \hyperlink{kmp__barrier_8cpp_a8c4e5bfa41738c5f588746983ee491a9}{\_\_kmp\_print\_structure}();
1379     \}
1380 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
1381 \textcolor{preprocessor}{}    \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(master\_thread == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]);
1382     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1383 
1384     \textcolor{comment}{// Verify state}
1385     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} && \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]);
1386     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(this\_thr->th.th\_team));
1387     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(this\_thr->th.th\_root));
1388     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[tid]);
1389     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_join\_barrier: T#%d(%d:%d) arrived at join barrier\(\backslash\)n"}, gtid, team\_id, tid))
      ;
1390 
1391 \textcolor{preprocessor}{#if OMPT\_SUPPORT }
1392 \textcolor{preprocessor}{}\textcolor{preprocessor}{#if OMPT\_TRACE}
1393 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
1394         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_barrier\_begin)) \{
1395         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_barrier\_begin)(
1396             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.parallel\_id,
1397             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].ompt\_task\_info.task\_id);
1398     \}
1399 \textcolor{preprocessor}{#endif}
1400 \textcolor{preprocessor}{}    this\_thr->th.ompt\_thread\_info.state = ompt\_state\_wait\_barrier;
1401 \textcolor{preprocessor}{#endif}
1402 \textcolor{preprocessor}{}
1403     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} == \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2a001d1f241bf760fd902d3fccc21918d3}{tskm\_extra\_barrier}) \{
1404         \hyperlink{kmp_8h_aaada49301d2ae62b774b7d55dd220b5a}{\_\_kmp\_tasking\_barrier}(team, this\_thr, gtid);
1405         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_join\_barrier: T#%d(%d:%d) past taking barrier\(\backslash\)n"}, gtid, team\_id, tid))
      ;
1406     \}
1407 \textcolor{preprocessor}{# ifdef KMP\_DEBUG}
1408 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
1409         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(20, ( \textcolor{stringliteral}{"\_\_kmp\_join\_barrier: T#%d, old team = %d, old task\_team = %p, th\_task\_team =
       %p\(\backslash\)n"},
1410                        \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}(this\_thr), team\_id, team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[this\_thr->th.th\_task\_state],
1411                        this\_thr->th.th\_task\_team));
1412         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr->th.th\_task\_team == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[this\_thr->th.
      th\_task\_state]);
1413     \}
1414 \textcolor{preprocessor}{# endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
1415 \textcolor{preprocessor}{}
1416     \textcolor{comment}{/* Copy the blocktime info to the thread, where \_\_kmp\_wait\_template() can access it when the}
1417 \textcolor{comment}{       team struct is not guaranteed to exist. Doing these loads causes a cache miss slows}
1418 \textcolor{comment}{       down EPCC parallel by 2x. As a workaround, we do not perform the copy if blocktime=infinite,}
1419 \textcolor{comment}{       since the values are not used by \_\_kmp\_wait\_template() in that case. */}
1420     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime} != \hyperlink{kmp_8h_a1ca6c6ce04115f143dc5df627de57958}{KMP\_MAX\_BLOCKTIME}) \{
1421         this\_thr->th.th\_team\_bt\_intervals = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].td\_icvs.bt\_intervals;
1422         this\_thr->th.th\_team\_bt\_set = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].td\_icvs.bt\_set;
1423     \}
1424 
1425 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
1426 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG)
1427         \_\_kmp\_itt\_barrier\_starting(gtid, itt\_sync\_obj);
1428 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1429 \textcolor{preprocessor}{}
1430     \textcolor{keywordflow}{switch} (\hyperlink{kmp_8h_a3919081570d178345aff3877da7dbd8a}{\_\_kmp\_barrier\_gather\_pattern}[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}]) \{
1431     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aad01aaab58a5ceeebbf8f9d5a170afa33}{bp\_hyper\_bar}: \{
1432         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(\hyperlink{kmp_8h_ac686c46b38f93904467b30f15ec1c15e}{\_\_kmp\_barrier\_gather\_branch\_bits}[
      bs\_forkjoin\_barrier]);
1433         \hyperlink{kmp__barrier_8cpp_a53561cb5f3b4a1b71eb128e83ac2a4b0}{\_\_kmp\_hyper\_barrier\_gather}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, NULL
1434                                    \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1435         \textcolor{keywordflow}{break};
1436     \}
1437     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aab0183e6c51993f58d4f0af1fb6298c82}{bp\_hierarchical\_bar}: \{
1438         \hyperlink{kmp__barrier_8cpp_af7a9e6ac2476553d1fb94039fde53b75}{\_\_kmp\_hierarchical\_barrier\_gather}(bs\_forkjoin\_barrier, this\_thr, 
      gtid, tid, NULL
1439                                           \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1440         \textcolor{keywordflow}{break};
1441     \}
1442     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_afa95b644d435d20b66b1b5a7302dd86aa64f2941fea2d51b943240075d1db0d64}{bp\_tree\_bar}: \{
1443         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(\hyperlink{kmp_8h_ac686c46b38f93904467b30f15ec1c15e}{\_\_kmp\_barrier\_gather\_branch\_bits}[
      bs\_forkjoin\_barrier]);
1444         \hyperlink{kmp__barrier_8cpp_a7055b9bc973e4cab4e2b3144d0da2e6d}{\_\_kmp\_tree\_barrier\_gather}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, NULL
1445                                   \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1446         \textcolor{keywordflow}{break};
1447     \}
1448     \textcolor{keywordflow}{default}: \{
1449         \hyperlink{kmp__barrier_8cpp_a86dab93f80bfcc456e2cd2c5608962f6}{\_\_kmp\_linear\_barrier\_gather}(bs\_forkjoin\_barrier, this\_thr, gtid, tid, 
      NULL
1450                                     \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1451     \}
1452     \}
1453 
1454     \textcolor{comment}{/* From this point on, the team data structure may be deallocated at any time by the}
1455 \textcolor{comment}{       master thread - it is unsafe to reference it in any of the worker threads. Any per-team}
1456 \textcolor{comment}{       data items that need to be referenced before the end of the barrier should be moved to}
1457 \textcolor{comment}{       the kmp\_task\_team\_t structs.  */}
1458     \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{
1459         \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
1460             \hyperlink{kmp_8h_afd36f17a7257b41ac1c0ac640225e292}{\_\_kmp\_task\_team\_wait}(this\_thr, team
1461                                  \hyperlink{kmp__itt_8h_ac31864b9b5b30f5dcac5ab285ee97ae0}{USE\_ITT\_BUILD\_ARG}(itt\_sync\_obj) );
1462         \}
1463 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
1464 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG)
1465             \_\_kmp\_itt\_barrier\_middle(gtid, itt\_sync\_obj);
1466 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1467 \textcolor{preprocessor}{}
1468 \textcolor{preprocessor}{# if USE\_ITT\_BUILD && USE\_ITT\_NOTIFY}
1469 \textcolor{preprocessor}{}        \textcolor{comment}{// Join barrier - report frame end}
1470         \textcolor{keywordflow}{if} ((\_\_itt\_frame\_submit\_v3\_ptr || KMP\_ITT\_DEBUG) && \_\_kmp\_forkjoin\_frames\_mode &&
1471 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
1472             this\_thr->th.th\_teams\_microtask == NULL &&
1473 #endif
1474             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level == 1)
1475         \{
1476             kmp\_uint64 cur\_time = \_\_itt\_get\_timestamp();
1477             \hyperlink{structident}{ident\_t} * loc = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident;
1478             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **other\_threads = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
1479             \textcolor{keywordtype}{int} nproc = this\_thr->th.th\_team\_nproc;
1480             \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
1481             \textcolor{keywordflow}{switch}(\_\_kmp\_forkjoin\_frames\_mode) \{
1482             \textcolor{keywordflow}{case} 1:
1483                 \_\_kmp\_itt\_frame\_submit(gtid, this\_thr->th.th\_frame\_time, cur\_time, 0, loc, nproc);
1484                 \textcolor{keywordflow}{break};
1485             \textcolor{keywordflow}{case} 2:
1486                 \_\_kmp\_itt\_frame\_submit(gtid, this\_thr->th.th\_bar\_min\_time, cur\_time, 1, loc, nproc);
1487                 \textcolor{keywordflow}{break};
1488             \textcolor{keywordflow}{case} 3:
1489                 \textcolor{keywordflow}{if}( \_\_itt\_metadata\_add\_ptr ) \{
1490                     \textcolor{comment}{// Initialize with master's wait time}
1491                     kmp\_uint64 delta = cur\_time - this\_thr->th.th\_bar\_arrive\_time;
1492                     \textcolor{keywordflow}{for} (i=1; i<nproc; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}) \{
1493                         delta += ( cur\_time - other\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}]->th.th\_bar\_arrive\_time );
1494                     \}
1495                     \_\_kmp\_itt\_metadata\_imbalance(gtid, this\_thr->th.th\_frame\_time, cur\_time, delta, 0);
1496                 \}
1497                 \_\_kmp\_itt\_frame\_submit(gtid, this\_thr->th.th\_frame\_time, cur\_time, 0, loc, nproc);
1498                 this\_thr->th.th\_frame\_time = cur\_time;
1499                 \textcolor{keywordflow}{break};
1500             \}
1501         \}
1502 \textcolor{preprocessor}{# endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1503 \textcolor{preprocessor}{}    \}
1504 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
1505 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else} \{
1506         \textcolor{keywordflow}{if} (\hyperlink{group__sync_gab7f1ba7abf5c98e0e0e0ea53d0e34661}{\_\_itt\_sync\_create\_ptr} || KMP\_ITT\_DEBUG)
1507             \_\_kmp\_itt\_barrier\_middle(gtid, itt\_sync\_obj);
1508     \}
1509 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1510 \textcolor{preprocessor}{}
1511 \textcolor{preprocessor}{#if KMP\_DEBUG}
1512 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{kmp_8h_a7a4e2494d803bbee99f23af2117f6dd8}{KMP\_MASTER\_TID}(tid)) \{
1513         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(15, (\textcolor{stringliteral}{"\_\_kmp\_join\_barrier: T#%d(%d:%d) says all %d team threads arrived\(\backslash\)n"},
1514                       gtid, team\_id, tid, nproc));
1515     \}
1516 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_DEBUG */}\textcolor{preprocessor}{}
1517 \textcolor{preprocessor}{}
1518     \textcolor{comment}{// TODO now, mark worker threads as done so they may be disbanded}
1519     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}(); \textcolor{comment}{// Flush all pending memory write invalidates.}
1520     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_join\_barrier: T#%d(%d:%d) leaving\(\backslash\)n"}, gtid, team\_id, tid));
1521 
1522 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1523 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
1524 \textcolor{preprocessor}{#if OMPT\_BLAME}
1525 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_barrier\_end)) \{
1526             \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_barrier\_end)(
1527                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.parallel\_id,
1528                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].ompt\_task\_info.task\_id);
1529         \}
1530 \textcolor{preprocessor}{#endif}
1531 \textcolor{preprocessor}{}
1532         \textcolor{comment}{// return to default state}
1533         this\_thr->th.ompt\_thread\_info.state = ompt\_state\_overhead;
1534     \}
1535 \textcolor{preprocessor}{#endif}
1536 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7f7de8f765a397ab1b076555bdee9504}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-join\-\_\-call@{\-\_\-\-\_\-kmp\-\_\-join\-\_\-call}}
\index{\-\_\-\-\_\-kmp\-\_\-join\-\_\-call@{\-\_\-\-\_\-kmp\-\_\-join\-\_\-call}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-join\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-join\-\_\-call (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{exit\-\_\-teams}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a7f7de8f765a397ab1b076555bdee9504}


Definition at line 2285 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-teams\-\_\-master(), \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-E\-N\-D().


\begin{DoxyCode}
2293 \{
2294     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_join\_call);
2295     \hyperlink{unionkmp__team}{kmp\_team\_t}     *team;
2296     \hyperlink{unionkmp__team}{kmp\_team\_t}     *parent\_team;
2297     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}     *master\_th;
2298     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}     *root;
2299     \textcolor{keywordtype}{int}             master\_active;
2300     \textcolor{keywordtype}{int}             \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
2301 
2302     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_join\_call: enter T#%d\(\backslash\)n"}, gtid ));
2303 
2304     \textcolor{comment}{/* setup current data */}
2305     master\_th     = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2306     root          = master\_th->th.th\_root;
2307     team          = master\_th->th.th\_team;
2308     parent\_team   = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent;
2309 
2310     master\_th->th.th\_ident = loc;
2311 
2312 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2313 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
2314         master\_th->th.ompt\_thread\_info.state = ompt\_state\_overhead;
2315     \}
2316 \textcolor{preprocessor}{#endif}
2317 \textcolor{preprocessor}{}
2318 \textcolor{preprocessor}{#if KMP\_DEBUG}
2319 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
2320         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_join\_call: T#%d, old team = %p old task\_team = %p, th\_task\_team = %p
      \(\backslash\)n"},
2321                          \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( master\_th ), team,
2322                          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.th\_task\_state], master\_th->th.th\_task\_team) );
2323         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( master\_th->th.th\_task\_team == team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.
      th\_task\_state] );
2324     \}
2325 \textcolor{preprocessor}{#endif}
2326 \textcolor{preprocessor}{}
2327     \textcolor{keywordflow}{if}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) \{
2328 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2329 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( master\_th->th.th\_teams\_microtask ) \{
2330             \textcolor{comment}{// We are in teams construct}
2331             \textcolor{keywordtype}{int} level = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level;
2332             \textcolor{keywordtype}{int} tlevel = master\_th->th.th\_teams\_level;
2333             \textcolor{keywordflow}{if} ( level == tlevel ) \{
2334                 \textcolor{comment}{// AC: we haven't incremented it earlier at start of teams construct,}
2335                 \textcolor{comment}{//     so do it here - at the end of teams construct}
2336                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level++;
2337             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( level == tlevel + 1 ) \{
2338                 \textcolor{comment}{// AC: we are exiting parallel inside teams, need to increment serialization}
2339                 \textcolor{comment}{//     in order to restore it in the next call to \_\_kmpc\_end\_serialized\_parallel}
2340                 team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized++;
2341             \}
2342         \}
2343 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2344 \textcolor{preprocessor}{}        \hyperlink{group__PARALLEL_gac341818e68b06d910111e4cf08bb54dd}{\_\_kmpc\_end\_serialized\_parallel}( loc, gtid );
2345 
2346 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2347 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
2348             \_\_kmp\_join\_restore\_state(master\_th, parent\_team);
2349         \}
2350 \textcolor{preprocessor}{#endif}
2351 \textcolor{preprocessor}{}
2352         \textcolor{keywordflow}{return};
2353     \}
2354 
2355     master\_active = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_active;
2356 
2357 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2358 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (!exit\_teams)
2359 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2360 \textcolor{preprocessor}{}    \{
2361         \textcolor{comment}{// AC: No barrier for internal teams at exit from teams construct.}
2362         \textcolor{comment}{//     But there is barrier for external team (league).}
2363         \hyperlink{kmp__runtime_8c_a7f0781abf1c47553c64f9ddddaf17c66}{\_\_kmp\_internal\_join}( loc, gtid, team );
2364     \}
2365 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2366 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else} \{
2367         master\_th->th.th\_task\_state = 0; \textcolor{comment}{// AC: no tasking in teams (out of any parallel)}
2368     \}
2369 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2370 \textcolor{preprocessor}{}
2371     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
2372 
2373 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2374 \textcolor{preprocessor}{}    ompt\_parallel\_id\_t parallel\_id = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.ompt\_team\_info.parallel\_id;
2375 \textcolor{preprocessor}{#endif}
2376 \textcolor{preprocessor}{}
2377 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
2378 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_itt\_stack\_caller\_create\_ptr ) \{
2379         \_\_kmp\_itt\_stack\_caller\_destroy( (\hyperlink{ittnotify__static_8h_a13361cbb7d40628ec1345dcfb7264892}{\_\_itt\_caller})team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_stack\_id ); \textcolor{comment}{// destroy the
       stack stitching id after join barrier}
2380     \}
2381 
2382     \textcolor{comment}{// Mark end of "parallel" region for VTune.}
2383     \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level == 1
2384 # \textcolor{keywordflow}{if} OMP\_40\_ENABLED
2385         && !master\_th->th.th\_teams\_microtask \textcolor{comment}{/* not in teams construct */}
2386 # endif \textcolor{comment}{/* OMP\_40\_ENABLED */}
2387     ) \{
2388         master\_th->th.th\_ident = loc;
2389         \textcolor{comment}{// only one notification scheme (either "submit" or "forking/joined", not both)}
2390         \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_submit\_v3\_ptr || KMP\_ITT\_DEBUG ) && \_\_kmp\_forkjoin\_frames\_mode == 3 )
2391             \_\_kmp\_itt\_frame\_submit( gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_region\_time, master\_th->th.th\_frame\_time,
2392                                     0, loc, master\_th->th.th\_team\_nproc, 1 );
2393         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_end\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
2394             ! \_\_kmp\_forkjoin\_frames\_mode && \_\_kmp\_forkjoin\_frames )
2395             \_\_kmp\_itt\_region\_joined( gtid );
2396     \} \textcolor{comment}{// active\_level == 1}
2397 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
2398 \textcolor{preprocessor}{}
2399 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2400 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( master\_th->th.th\_teams\_microtask &&
2401          !exit\_teams &&
2402          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn != (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})\hyperlink{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master} &&
2403          team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level == master\_th->th.th\_teams\_level + 1 ) \{
2404         \textcolor{comment}{// AC: We need to leave the team structure intact at the end}
2405         \textcolor{comment}{//     of parallel inside the teams construct, so that at the next}
2406         \textcolor{comment}{//     parallel same (hot) team works, only adjust nesting levels}
2407 
2408         \textcolor{comment}{/* Decrement our nested depth level */}
2409         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level --;
2410         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level --;
2411         \hyperlink{kmp__os_8h_a5b23523b95ee4b2307a8f344cbbe8050}{KMP\_TEST\_THEN\_DEC32}( (kmp\_int32*) &root->r.r\_in\_parallel );
2412 
2413         \textcolor{comment}{/* Restore number of threads in the team if needed */}
2414         \textcolor{keywordflow}{if} ( master\_th->th.th\_team\_nproc < master\_th->th.th\_teams\_size.nth ) \{
2415             \textcolor{keywordtype}{int} old\_num = master\_th->th.th\_team\_nproc;
2416             \textcolor{keywordtype}{int} new\_num = master\_th->th.th\_teams\_size.nth;
2417             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **other\_threads = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
2418             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = new\_num;
2419             \textcolor{keywordflow}{for} ( i = 0; i < old\_num; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
2420                 other\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}]->th.th\_team\_nproc = new\_num;
2421             \}
2422             \textcolor{comment}{// Adjust states of non-used threads of the team}
2423             \textcolor{keywordflow}{for} ( i = old\_num; i < new\_num; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
2424                 \textcolor{comment}{// Re-initialize thread's barrier data.}
2425                 \textcolor{keywordtype}{int} b;
2426                 \hyperlink{unionkmp__barrier__union}{kmp\_balign\_t} * balign = other\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}]->th.th\_bar;
2427                 \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
2428                     balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_arrived        = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_arrived;
2429                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(balign[ b ].bb.wait\_flag != 
      \hyperlink{kmp_8h_a8d57cc4e79ac9ca2aec875d9293382e8}{KMP\_BARRIER\_PARENT\_FLAG});
2430 \textcolor{preprocessor}{#if USE\_DEBUGGER}
2431 \textcolor{preprocessor}{}                    balign[ b ].\hyperlink{unionkmp__barrier__union_ae01f3b4d1f256f9ec18b0528587bcceb}{bb}.b\_worker\_arrived = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[ b ].b\_team\_arrived;
2432 \textcolor{preprocessor}{#endif}
2433 \textcolor{preprocessor}{}                \}
2434                 \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
2435                     \textcolor{comment}{// Synchronize thread's task state}
2436                     other\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}]->th.th\_task\_state = master\_th->th.th\_task\_state;
2437                 \}
2438             \}
2439         \}
2440 
2441 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2442 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
2443             \_\_kmp\_join\_ompt(master\_th, parent\_team, parallel\_id, fork\_context);
2444         \}
2445 \textcolor{preprocessor}{#endif}
2446 \textcolor{preprocessor}{}
2447         \textcolor{keywordflow}{return};
2448     \}
2449 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2450 \textcolor{preprocessor}{}
2451     \textcolor{comment}{/* do cleanup and restore the parent team */}
2452     master\_th->th.th\_info .ds.ds\_tid = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid;
2453     master\_th->th.th\_local.this\_construct = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_this\_cons;
2454 
2455     master\_th->th.th\_dispatch =
2456                 & parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[ team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid ];
2457 
2458     \textcolor{comment}{/* jc: The following lock has instructions with REL and ACQ semantics,}
2459 \textcolor{comment}{       separating the parallel user code called in this parallel region}
2460 \textcolor{comment}{       from the serial user code called after this function returns.}
2461 \textcolor{comment}{    */}
2462     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
2463 
2464 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
2465 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( !master\_th->th.th\_teams\_microtask || team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level > master\_th->th.th\_teams\_level )
2466 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2467 \textcolor{preprocessor}{}    \{
2468         \textcolor{comment}{/* Decrement our nested depth level */}
2469         \hyperlink{kmp__os_8h_a5b23523b95ee4b2307a8f344cbbe8050}{KMP\_TEST\_THEN\_DEC32}( (kmp\_int32*) &root->r.r\_in\_parallel );
2470     \}
2471     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root->r.r\_in\_parallel >= 0 );
2472 
2473 \textcolor{preprocessor}{#if OMPT\_SUPPORT && OMPT\_TRACE}
2474 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}(\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled})\{
2475         \hyperlink{structompt__task__info__t}{ompt\_task\_info\_t} *task\_info = \hyperlink{ompt-specific_8c_a31168da811886ba5fef353af949900b3}{\_\_ompt\_get\_taskinfo}(0);
2476         \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)) \{
2477              \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)(
2478                parallel\_id, task\_info->\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id});
2479         \}
2480         task\_info->\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
2481         task\_info->\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 0;
2482     \}
2483 \textcolor{preprocessor}{#endif}
2484 \textcolor{preprocessor}{}
2485     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_join\_call1: T#%d, this\_thread=%p team=%p\(\backslash\)n"},
2486                    0, master\_th, team ) );
2487     \hyperlink{kmp_8h_ae3470280dc2ee8dde4f95debde6575e4}{\_\_kmp\_pop\_current\_task\_from\_thread}( master\_th );
2488 
2489 \textcolor{preprocessor}{#if OMP\_40\_ENABLED && KMP\_AFFINITY\_SUPPORTED}
2490 \textcolor{preprocessor}{}    \textcolor{comment}{//}
2491     \textcolor{comment}{// Restore master thread's partition.}
2492     \textcolor{comment}{//}
2493     master\_th->th.th\_first\_place = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_first\_place;
2494     master\_th->th.th\_last\_place = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_last\_place;
2495 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
2496 \textcolor{preprocessor}{}
2497     \hyperlink{kmp__runtime_8c_a6ae754850170a17b0f3e266e802051ab}{updateHWFPControl} (team);
2498 
2499     \textcolor{keywordflow}{if} ( root->r.r\_active != master\_active )
2500         root->r.r\_active = master\_active;
2501 
2502     \hyperlink{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\_\_kmp\_free\_team}( root, team \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(master\_th) ); \textcolor{comment}{// this
       will free worker threads}
2503 
2504     \textcolor{comment}{/* this race was fun to find.  make sure the following is in the critical}
2505 \textcolor{comment}{     * region otherwise assertions may fail occasionally since the old team}
2506 \textcolor{comment}{     * may be reallocated and the hierarchy appears inconsistent.  it is}
2507 \textcolor{comment}{     * actually safe to run and won't cause any bugs, but will cause those}
2508 \textcolor{comment}{     * assertion failures.  it's only one deref&assign so might as well put this}
2509 \textcolor{comment}{     * in the critical region */}
2510     master\_th->th.th\_team        =   parent\_team;
2511     master\_th->th.th\_team\_nproc  =   parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
2512     master\_th->th.th\_team\_master =   parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0];
2513     master\_th->th.th\_team\_serialized = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
2514 
2515     \textcolor{comment}{/* restore serialized team, if need be */}
2516     \textcolor{keywordflow}{if}( parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized &&
2517         parent\_team != master\_th->th.th\_serial\_team &&
2518         parent\_team != root->r.r\_root\_team ) \{
2519             \hyperlink{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\_\_kmp\_free\_team}( root, master\_th->th.th\_serial\_team 
      \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
2520             master\_th->th.th\_serial\_team = parent\_team;
2521     \}
2522 
2523     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
2524         \textcolor{keywordflow}{if} (master\_th->th.th\_task\_state\_top > 0) \{ \textcolor{comment}{// Restore task state from memo stack}
2525             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(master\_th->th.th\_task\_state\_memo\_stack);
2526             \textcolor{comment}{// Remember master's state if we re-use this nested hot team}
2527             master\_th->th.th\_task\_state\_memo\_stack[master\_th->th.th\_task\_state\_top] = master\_th->th.
      th\_task\_state;
2528             --master\_th->th.th\_task\_state\_top; \textcolor{comment}{// pop}
2529             \textcolor{comment}{// Now restore state at this level}
2530             master\_th->th.th\_task\_state = master\_th->th.th\_task\_state\_memo\_stack[master\_th->th.
      th\_task\_state\_top];
2531         \}
2532         \textcolor{comment}{// Copy the task team from the parent team to the master thread}
2533         master\_th->th.th\_task\_team = parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[master\_th->th.th\_task\_state];
2534         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmp\_join\_call: Master T#%d restoring task\_team %p / team %p\(\backslash\)n"},
2535                         \hyperlink{kmp_8h_a31d799169fae2285dc2703faf7f7c258}{\_\_kmp\_gtid\_from\_thread}( master\_th ), master\_th->th.
      th\_task\_team, parent\_team ) );
2536     \}
2537 
2538      \textcolor{comment}{// TODO: GEH - cannot do this assertion because root thread not set up as executing}
2539      \textcolor{comment}{// KMP\_ASSERT( master\_th->th.th\_current\_task->td\_flags.executing == 0 );}
2540      master\_th->th.th\_current\_task->td\_flags.executing = 1;
2541 
2542     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
2543 
2544 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
2545 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
2546         \_\_kmp\_join\_ompt(master\_th, parent\_team, parallel\_id, fork\_context);
2547     \}
2548 \textcolor{preprocessor}{#endif}
2549 \textcolor{preprocessor}{}
2550     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
2551     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_join\_call: exit T#%d\(\backslash\)n"}, gtid ));
2552 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3fbd0f646b0562ab5164a520888b0ac1}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void}$\ast$ \-\_\-\-\_\-kmp\-\_\-launch\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{this\-\_\-thr}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3fbd0f646b0562ab5164a520888b0ac1}


Definition at line 5468 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-launch\-\_\-worker().


\begin{DoxyCode}
5469 \{
5470     \textcolor{keywordtype}{int}                   gtid = this\_thr->th.th\_info.ds.ds\_gtid;
5471 \textcolor{comment}{/*    void                 *stack\_data;*/}
5472     \hyperlink{unionkmp__team}{kmp\_team\_t} *(*\textcolor{keyword}{volatile} pteam);
5473 
5474     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5475     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_launch\_thread: T#%d start\(\backslash\)n"}, gtid ) );
5476 
5477     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
5478         this\_thr->th.th\_cons = \hyperlink{kmp__error_8c_a6937a7feee3b38116aeccf3c7922c7de}{\_\_kmp\_allocate\_cons\_stack}( gtid );  \textcolor{comment}{// ATT: Memory
       leak?}
5479     \}
5480 
5481 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5482 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5483         this\_thr->th.ompt\_thread\_info.state = ompt\_state\_overhead;
5484         this\_thr->th.ompt\_thread\_info.wait\_id = 0;
5485         this\_thr->th.ompt\_thread\_info.idle\_frame = \_\_builtin\_frame\_address(0);
5486         \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_thread\_begin)) \{
5487             \hyperlink{ompt-specific_8c_ac67291ade668df85fa534e15aa1041e6}{\_\_ompt\_thread\_begin}(ompt\_thread\_worker, gtid);
5488         \}
5489     \}
5490 \textcolor{preprocessor}{#endif}
5491 \textcolor{preprocessor}{}
5492     \textcolor{comment}{// hash: kmp\_global.g.g.done?}
5493     \textcolor{comment}{/* This is the place where threads wait for work */}
5494     \textcolor{keywordflow}{while}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) ) \{
5495         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr == \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ] );
5496         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5497 
5498         \textcolor{comment}{/* wait for work to do */}
5499         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_launch\_thread: T#%d waiting for work\(\backslash\)n"}, gtid ));
5500 
5501 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5502 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5503             this\_thr->th.ompt\_thread\_info.state = ompt\_state\_idle;
5504         \}
5505 \textcolor{preprocessor}{#endif}
5506 \textcolor{preprocessor}{}
5507         \textcolor{comment}{/* No tid yet since not part of a team */}
5508         \hyperlink{kmp__runtime_8c_aea1108b093169cef205a6766bdfa5a40}{\_\_kmp\_fork\_barrier}( gtid, \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE} );
5509 
5510 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5511 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5512             this\_thr->th.ompt\_thread\_info.state = ompt\_state\_overhead;
5513         \}
5514 \textcolor{preprocessor}{#endif}
5515 \textcolor{preprocessor}{}     
5516         \textcolor{comment}{// hash: what is the pteam construct}
5517         pteam = (\hyperlink{unionkmp__team}{kmp\_team\_t} *(*))(& this\_thr->th.th\_team);
5518 
5519         \textcolor{comment}{/* have we been allocated? */}
5520         \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}(*pteam) && !\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) ) \{
5521 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5522 \textcolor{preprocessor}{}            \hyperlink{structompt__task__info__t}{ompt\_task\_info\_t} *task\_info;
5523             ompt\_parallel\_id\_t my\_parallel\_id;
5524             \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5525                 task\_info = \hyperlink{ompt-specific_8c_a31168da811886ba5fef353af949900b3}{\_\_ompt\_get\_taskinfo}(0);
5526                 my\_parallel\_id = (*pteam)->t.ompt\_team\_info.parallel\_id;
5527             \}
5528 \textcolor{preprocessor}{#endif}
5529 \textcolor{preprocessor}{}            \textcolor{comment}{/* we were just woken up, so run our new task */}
5530             \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}((*pteam)->t.t\_pkfn) != NULL ) \{
5531                 \textcolor{keywordtype}{int} rc;
5532                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(20, (\textcolor{stringliteral}{"\_\_kmp\_launch\_thread: T#%d(%d:%d) invoke microtask = %p\(\backslash\)n"},
5533                               gtid, (*pteam)->t.t\_id, \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}(gtid), 
      (*pteam)->t.t\_pkfn));
5534 
5535                 \hyperlink{kmp__runtime_8c_a6ae754850170a17b0f3e266e802051ab}{updateHWFPControl} (*pteam);
5536 
5537 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5538 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5539                     this\_thr->th.ompt\_thread\_info.state = ompt\_state\_work\_parallel;
5540                     \textcolor{comment}{// Initialize OMPT task id for implicit task.}
5541                     \textcolor{keywordtype}{int} tid = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}(gtid);
5542                     task\_info->\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = \hyperlink{ompt-specific_8c_a00dc76b44da40dee97e27a16c472e0ca}{\_\_ompt\_task\_id\_new}(tid);
5543                 \}
5544 \textcolor{preprocessor}{#endif}
5545 \textcolor{preprocessor}{}
5546                 \hyperlink{kmp__stats_8h_a9e46c8b60b11ebb1646bc71459e9759e}{KMP\_STOP\_DEVELOPER\_EXPLICIT\_TIMER}(USER\_launch\_thread\_loop)
      ;
5547                 \{
5548                     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(USER\_worker\_invoke);
5549                     \textcolor{comment}{// hash: is this invoke microtask?}
5550 
5551                     rc = (*pteam)->t.t\_invoke( gtid );
5552                 \}
5553                 \hyperlink{kmp__stats_8h_afc3175681dd42574bc35dc58283081b1}{KMP\_START\_DEVELOPER\_EXPLICIT\_TIMER}(
      USER\_launch\_thread\_loop);
5554                 \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( rc );
5555 
5556 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5557 \textcolor{preprocessor}{}                \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5558                     \textcolor{comment}{/* no frame set while outside task */}
5559                     task\_info->\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
5560 
5561                     this\_thr->th.ompt\_thread\_info.state = ompt\_state\_overhead;
5562                 \}
5563 \textcolor{preprocessor}{#endif}
5564 \textcolor{preprocessor}{}                \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5565                 \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}(20, (\textcolor{stringliteral}{"\_\_kmp\_launch\_thread: T#%d(%d:%d) done microtask = %p\(\backslash\)n"},
5566                               gtid, (*pteam)->t.t\_id, \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}(gtid), 
      (*pteam)->t.t\_pkfn));
5567             \}
5568             \textcolor{comment}{/* join barrier after parallel region */}
5569             \hyperlink{kmp__runtime_8c_a5e8f7c63d5e652f73e8998922edf14a4}{\_\_kmp\_join\_barrier}( gtid );
5570 \textcolor{preprocessor}{#if OMPT\_SUPPORT && OMPT\_TRACE}
5571 \textcolor{preprocessor}{}            \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
5572                 \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)) \{
5573                     \textcolor{comment}{// don't access *pteam here: it may have already been freed}
5574                     \textcolor{comment}{// by the master thread behind the barrier (possible race)}
5575                     \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_implicit\_task\_end)(
5576                         my\_parallel\_id, task\_info->\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id});
5577                 \}
5578                 task\_info->\hyperlink{structompt__task__info__t_ab4b3a1c10b649c40015c133ea25fc3ae}{frame}.exit\_runtime\_frame = 0;
5579                 task\_info->\hyperlink{structompt__task__info__t_a9b45ec47bd1086973892108a3a71e6fe}{task\_id} = 0;
5580             \}
5581 \textcolor{preprocessor}{#endif }
5582 \textcolor{preprocessor}{}        \}
5583     \}
5584     \hyperlink{kmp__os_8h_a4eff9c5e66d3fbb78577292c4c035ffe}{TCR\_SYNC\_PTR}((intptr\_t)\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done);
5585 
5586 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
5587 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
5588         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_thread\_end)) \{
5589         \hyperlink{ompt-specific_8c_a6df3ac9845bff98373f885b319bc2e38}{\_\_ompt\_thread\_end}(ompt\_thread\_worker, gtid);
5590     \}
5591 \textcolor{preprocessor}{#endif}
5592 \textcolor{preprocessor}{}
5593     this\_thr->th.th\_task\_team = NULL;
5594     \textcolor{comment}{/* run the destructors for the threadprivate data for this thread */}
5595     \hyperlink{kmp_8h_ad3ce124dfe851be0147daa831b27af5d}{\_\_kmp\_common\_destroy\_gtid}( gtid );
5596 
5597     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_launch\_thread: T#%d done\(\backslash\)n"}, gtid ) );
5598     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5599     \textcolor{keywordflow}{return} this\_thr;
5600 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a86759bf6b8380906f716603052f60fc9}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize}}
\index{\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-middle\-\_\-initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a86759bf6b8380906f716603052f60fc9}


Definition at line 6721 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams(), F\-T\-N\-\_\-\-C\-R\-E\-A\-T\-E\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-S\-K(), F\-T\-N\-\_\-\-D\-E\-S\-T\-R\-O\-Y\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-S\-K(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-S\-K\-\_\-\-P\-R\-O\-C(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-X\-\_\-\-P\-R\-O\-C(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-M\-A\-X\-\_\-\-T\-H\-R\-E\-A\-D\-S(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-N\-U\-M\-\_\-\-P\-R\-O\-C\-S(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-S\-K\-\_\-\-P\-R\-O\-C(), F\-T\-N\-\_\-\-U\-N\-S\-E\-T\-\_\-\-A\-F\-F\-I\-N\-I\-T\-Y\-\_\-\-M\-A\-S\-K\-\_\-\-P\-R\-O\-C(), kmpc\-\_\-get\-\_\-affinity\-\_\-mask\-\_\-proc(), kmpc\-\_\-set\-\_\-affinity\-\_\-mask\-\_\-proc(), and kmpc\-\_\-unset\-\_\-affinity\-\_\-mask\-\_\-proc().


\begin{DoxyCode}
6722 \{
6723     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle} ) \{
6724         \textcolor{keywordflow}{return};
6725     \}
6726     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6727     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle} ) \{
6728         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6729         \textcolor{keywordflow}{return};
6730     \}
6731     \hyperlink{kmp__runtime_8c_a4d6565c9ee276582946d645c8c67986e}{\_\_kmp\_do\_middle\_initialize}();
6732     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6733 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a93417722a11d683f9bab68d1fc0a315b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo}}
\index{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-parallel\-\_\-deo (
\begin{DoxyParamCaption}
\item[{{\bf int} $\ast$}]{gtid\-\_\-ref, }
\item[{{\bf int} $\ast$}]{cid\-\_\-ref, }
\item[{{\bf ident\-\_\-t} $\ast$}]{loc\-\_\-ref}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a93417722a11d683f9bab68d1fc0a315b}


Definition at line 713 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-ordered().


\begin{DoxyCode}
714 \{
715     \textcolor{keywordtype}{int} gtid = *gtid\_ref;
716 \textcolor{preprocessor}{#ifdef BUILD\_PARALLEL\_ORDERED}
717 \textcolor{preprocessor}{}    \hyperlink{unionkmp__team}{kmp\_team\_t} *team = \hyperlink{kmp_8h_a44712b8a86bcc5e3bd49981e5bb3ce6c}{\_\_kmp\_team\_from\_gtid}( gtid );
718 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* BUILD\_PARALLEL\_ORDERED */}\textcolor{preprocessor}{}
719 \textcolor{preprocessor}{}
720     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
721         \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_root->r.r\_active )
722 \textcolor{preprocessor}{#if KMP\_USE\_DYNAMIC\_LOCK}
723 \textcolor{preprocessor}{}            \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315afbed18df3f813a5ba4b049998ea42d50}{ct\_ordered\_in\_parallel}, loc\_ref, 
      NULL, 0 );
724 \textcolor{preprocessor}{#else}
725 \textcolor{preprocessor}{}            \hyperlink{kmp__error_8c_a17886697972a1ad707cb5797332a7229}{\_\_kmp\_push\_sync}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315afbed18df3f813a5ba4b049998ea42d50}{ct\_ordered\_in\_parallel}, loc\_ref, 
      NULL );
726 \textcolor{preprocessor}{#endif}
727 \textcolor{preprocessor}{}    \}
728 \textcolor{preprocessor}{#ifdef BUILD\_PARALLEL\_ORDERED}
729 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( !team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) \{
730         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
731         \hyperlink{kmp__os_8h_a355e68ac2502d05ca4df8c3b20784dae}{KMP\_WAIT\_YIELD}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ordered.dt.t\_value, 
      \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid ), \hyperlink{kmp__os_8h_ac546f755fb26ab453bc8af8e759b3758}{KMP\_EQ}, NULL);
732         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
733     \}
734 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* BUILD\_PARALLEL\_ORDERED */}\textcolor{preprocessor}{}
735 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a5364b46d12144725799b06d5c3e5d31a}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo}}
\index{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-parallel\-\_\-dxo (
\begin{DoxyParamCaption}
\item[{{\bf int} $\ast$}]{gtid\-\_\-ref, }
\item[{{\bf int} $\ast$}]{cid\-\_\-ref, }
\item[{{\bf ident\-\_\-t} $\ast$}]{loc\-\_\-ref}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a5364b46d12144725799b06d5c3e5d31a}


Definition at line 742 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-end\-\_\-ordered().


\begin{DoxyCode}
743 \{
744     \textcolor{keywordtype}{int} gtid = *gtid\_ref;
745 \textcolor{preprocessor}{#ifdef BUILD\_PARALLEL\_ORDERED}
746 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} tid =  \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid );
747     \hyperlink{unionkmp__team}{kmp\_team\_t} *team = \hyperlink{kmp_8h_a44712b8a86bcc5e3bd49981e5bb3ce6c}{\_\_kmp\_team\_from\_gtid}( gtid );
748 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* BUILD\_PARALLEL\_ORDERED */}\textcolor{preprocessor}{}
749 \textcolor{preprocessor}{}
750     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
751         \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_root->r.r\_active )
752             \hyperlink{kmp__error_8c_ab716717d70650eeeb205b057232d7c1c}{\_\_kmp\_pop\_sync}( gtid, \hyperlink{kmp_8h_a1582e7ddc609220a660d10244ef3e315afbed18df3f813a5ba4b049998ea42d50}{ct\_ordered\_in\_parallel}, loc\_ref );
753     \}
754 \textcolor{preprocessor}{#ifdef BUILD\_PARALLEL\_ORDERED}
755 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( ! team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) \{
756         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
757 
758         \textcolor{comment}{/* use the tid of the next thread in this team */}
759         \textcolor{comment}{/* TODO repleace with general release procedure */}
760         team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ordered.dt.t\_value = ((tid + 1) % team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc );
761 
762 \textcolor{preprocessor}{#if OMPT\_SUPPORT && OMPT\_BLAME}
763 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
764             \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_release\_ordered)) \{
765             \textcolor{comment}{/* accept blame for "ordered" waiting */}
766             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
767             \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_release\_ordered)(
768                 this\_thread->th.ompt\_thread\_info.wait\_id);
769         \}
770 \textcolor{preprocessor}{#endif}
771 \textcolor{preprocessor}{}
772         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
773     \}
774 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* BUILD\_PARALLEL\_ORDERED */}\textcolor{preprocessor}{}
775 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize}}
\index{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-parallel\-\_\-initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}


Definition at line 6736 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-dispatch\-\_\-init(), \-\_\-\-\_\-kmp\-\_\-enter\-\_\-single(), \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel(), \-\_\-\-\_\-kmpc\-\_\-barrier(), \-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master(), \-\_\-\-\_\-kmpc\-\_\-barrier\-\_\-master\-\_\-nowait(), \-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel(), \-\_\-\-\_\-kmpc\-\_\-master(), \-\_\-\-\_\-kmpc\-\_\-ordered(), \-\_\-\-\_\-kmpc\-\_\-reduce(), \-\_\-\-\_\-kmpc\-\_\-reduce\-\_\-nowait(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-S\-I\-N\-G\-L\-E\-\_\-\-C\-O\-P\-Y\-\_\-\-S\-T\-A\-R\-T(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-S\-I\-N\-G\-L\-E\-\_\-\-S\-T\-A\-R\-T().


\begin{DoxyCode}
6737 \{
6738     \textcolor{keywordtype}{int} gtid = \hyperlink{kmp_8h_a5d1e6d7c35de87705193f11d65457229}{\_\_kmp\_entry\_gtid}();      \textcolor{comment}{// this might be a new root}
6739 
6740     \textcolor{comment}{/* synchronize parallel initialization (for sibling) */}
6741     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}) ) \textcolor{keywordflow}{return};
6742     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6743     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}) ) \{ 
      \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} ); \textcolor{keywordflow}{return}; \}
6744 
6745     \textcolor{comment}{/* TODO reinitialization after we have already shut down */}
6746     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) ) \{
6747         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_parallel\_initialize: attempt to init while shutting down\(\backslash\)n"} ) );
6748         \hyperlink{kmp__runtime_8c_a21ef7768be6c43e1a7a312f783adc2ca}{\_\_kmp\_infinite\_loop}();
6749     \}
6750 
6751     \textcolor{comment}{/* jc: The lock \_\_kmp\_initz\_lock is already held, so calling \_\_kmp\_serial\_initialize}
6752 \textcolor{comment}{           would cause a deadlock.  So we call \_\_kmp\_do\_serial\_initialize directly.}
6753 \textcolor{comment}{    */}
6754     \textcolor{keywordflow}{if}( !\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle} ) \{
6755         \hyperlink{kmp__runtime_8c_a4d6565c9ee276582946d645c8c67986e}{\_\_kmp\_do\_middle\_initialize}();
6756     \}
6757 
6758     \textcolor{comment}{/* begin initialization */}
6759     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_parallel\_initialize: enter\(\backslash\)n"} ) );
6760     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid ) );
6761 
6762 \textcolor{preprocessor}{#if KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64}
6763 \textcolor{preprocessor}{}    \textcolor{comment}{//}
6764     \textcolor{comment}{// Save the FP control regs.}
6765     \textcolor{comment}{// Worker threads will set theirs to these values at thread startup.}
6766     \textcolor{comment}{//}
6767     \_\_kmp\_store\_x87\_fpu\_control\_word( &\_\_kmp\_init\_x87\_fpu\_control\_word );
6768     \_\_kmp\_store\_mxcsr( &\_\_kmp\_init\_mxcsr );
6769     \_\_kmp\_init\_mxcsr &= KMP\_X86\_MXCSR\_MASK;
6770 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 */}\textcolor{preprocessor}{}
6771 \textcolor{preprocessor}{}
6772 \textcolor{preprocessor}{#if KMP\_OS\_UNIX}
6773 \textcolor{preprocessor}{}\textcolor{preprocessor}{# if KMP\_HANDLE\_SIGNALS}
6774 \textcolor{preprocessor}{}    \textcolor{comment}{/*  must be after \_\_kmp\_serial\_initialize  */}
6775     \_\_kmp\_install\_signals( \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
6776 \textcolor{preprocessor}{# endif}
6777 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
6778 \textcolor{preprocessor}{}
6779     \hyperlink{kmp_8h_a4b300606c79ebf03aaee1fdc9b9c141d}{\_\_kmp\_suspend\_initialize}();
6780 
6781 \textcolor{preprocessor}{#if defined(USE\_LOAD\_BALANCE)}
6782 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode == \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853ae523db459efe51f06654eccdfcba8d4a}{dynamic\_default} ) \{
6783         \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode = dynamic\_load\_balance;
6784     \}
6785 \textcolor{preprocessor}{#else}
6786 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode == \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853ae523db459efe51f06654eccdfcba8d4a}{dynamic\_default} ) \{
6787         \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode = \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853a4aa2fe6783bee15ca53a7e49684edef2}{dynamic\_thread\_limit};
6788     \}
6789 \textcolor{preprocessor}{#endif}
6790 \textcolor{preprocessor}{}
6791     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a0db70dba44885cb5eb238fd59b4d638f}{\_\_kmp\_version} ) \{
6792         \hyperlink{kmp__version_8c_ac92bab523d80a8d15888dd75d433dde2}{\_\_kmp\_print\_version\_2}();
6793     \}
6794 
6795     \textcolor{comment}{/* we have finished parallel initialization */}
6796     \hyperlink{kmp__os_8h_aa87da17e7b31a360efb533f0b7150bd4}{TCW\_SYNC\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
6797 
6798     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
6799     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_parallel\_initialize: exit\(\backslash\)n"} ) );
6800 
6801     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6802 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid}}
\index{\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-print\-\_\-storage\-\_\-map\-\_\-gtid (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf void} $\ast$}]{p1, }
\item[{{\bf void} $\ast$}]{p2, }
\item[{size\-\_\-t}]{size, }
\item[{char const $\ast$}]{format, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}


Definition at line 328 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-alloc\-\_\-argv\-\_\-entries(), \-\_\-\-\_\-kmp\-\_\-check\-\_\-stack\-\_\-overlap(), \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id(), \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-info(), \-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map(), and \-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map().


\begin{DoxyCode}
328                                                                                                   \{
329     \textcolor{keywordtype}{char} buffer[\hyperlink{kmp__runtime_8c_a8cea0c1cc1fc60a52e79998580bbf1a7}{MAX\_MESSAGE}];
330     va\_list ap;
331 
332     va\_start( ap, format);
333     \hyperlink{kmp__safe__c__api_8h_a69d5e0c1eb5568cc66b5faf64a772617}{KMP\_SNPRINTF}( buffer, \textcolor{keyword}{sizeof}(buffer), \textcolor{stringliteral}{"OMP storage map: %p %p%8lu %s\(\backslash\)n"}, p1, p2, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{
      long}) \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size}, format );
334     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & \hyperlink{kmp__io_8c_a49e60c011739f46589bb4fae4ad737cc}{\_\_kmp\_stdio\_lock} );
335     \hyperlink{kmp__io_8c_a1d4c137bf5adc9e0d804be83a75294cf}{\_\_kmp\_vprintf}( \hyperlink{kmp__io_8h_ad5c7b251dd2d5c33df5f3ac1e706730eac430a76c55aa8cd34020bd29e6f75ee1}{kmp\_err}, buffer, ap );
336 \textcolor{preprocessor}{#if KMP\_PRINT\_DATA\_PLACEMENT}
337 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} node;
338     \textcolor{keywordflow}{if}(gtid >= 0) \{
339         \textcolor{keywordflow}{if}(p1 <= p2 && (\textcolor{keywordtype}{char}*)p2 - (\textcolor{keywordtype}{char}*)p1 == \hyperlink{ittnotify__static_8h_a5a1daa0c1d342747e3884fa54fc64fb1}{size}) \{
340             \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_a7513189068c7dbf2f2141b26489e2c12}{\_\_kmp\_storage\_map\_verbose} ) \{
341                 node = \_\_kmp\_get\_host\_node(p1);
342                 \textcolor{keywordflow}{if}(node < 0)  \textcolor{comment}{/* doesn't work, so don't try this next time */}
343                     \hyperlink{kmp_8h_a7513189068c7dbf2f2141b26489e2c12}{\_\_kmp\_storage\_map\_verbose} = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
344                 \textcolor{keywordflow}{else} \{
345                     \textcolor{keywordtype}{char} *last;
346                     \textcolor{keywordtype}{int} lastNode;
347                     \textcolor{keywordtype}{int} localProc = \_\_kmp\_get\_cpu\_from\_gtid(gtid);
348 
349                     p1 = (\textcolor{keywordtype}{void} *)( (\textcolor{keywordtype}{size\_t})p1 & ~((size\_t)\hyperlink{kmp__os_8h_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE} - 1) );
350                     p2 = (\textcolor{keywordtype}{void} *)( ((\textcolor{keywordtype}{size\_t}) p2 - 1) & ~((\textcolor{keywordtype}{size\_t})\hyperlink{kmp__os_8h_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE} - 1) );
351                     \textcolor{keywordflow}{if}(localProc >= 0)
352                         \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"  GTID %d localNode %d\(\backslash\)n"}, gtid, 
      localProc>>1);
353                     \textcolor{keywordflow}{else}
354                         \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"  GTID %d\(\backslash\)n"}, gtid);
355 \textcolor{preprocessor}{# if KMP\_USE\_PRCTL}
356 \textcolor{preprocessor}{}\textcolor{comment}{/* The more elaborate format is disabled for now because of the prctl hanging bug. */}
357                     \textcolor{keywordflow}{do} \{
358                         last = p1;
359                         lastNode = node;
360                         \textcolor{comment}{/* This loop collates adjacent pages with the same host node. */}
361                         \textcolor{keywordflow}{do} \{
362                             (\textcolor{keywordtype}{char}*)p1 += \hyperlink{kmp__os_8h_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE};
363                         \} \textcolor{keywordflow}{while}(p1 <= p2 && (node = \_\_kmp\_get\_host\_node(p1)) == lastNode);
364                         \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"    %p-%p memNode %d\(\backslash\)n"}, last,
365                                              (\textcolor{keywordtype}{char}*)p1 - 1, lastNode);
366                     \} \textcolor{keywordflow}{while}(p1 <= p2);
367 \textcolor{preprocessor}{# else}
368 \textcolor{preprocessor}{}                    \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"    %p-%p memNode %d\(\backslash\)n"}, p1,
369                                          (\textcolor{keywordtype}{char}*)p1 + (\hyperlink{kmp__os_8h_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE} - 1), \_\_kmp\_get\_host\_node(p1));
370                     \textcolor{keywordflow}{if}(p1 < p2)  \{
371                         \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"    %p-%p memNode %d\(\backslash\)n"}, p2,
372                                              (\textcolor{keywordtype}{char}*)p2 + (\hyperlink{kmp__os_8h_a7d467c1d283fdfa1f2081ba1e0d01b6e}{PAGE\_SIZE} - 1), \_\_kmp\_get\_host\_node(p2))
      ;
373                     \}
374 \textcolor{preprocessor}{# endif}
375 \textcolor{preprocessor}{}                \}
376             \}
377         \} \textcolor{keywordflow}{else}
378             \hyperlink{kmp__io_8c_adfa9239ad26934b69d751b190582b5a7}{\_\_kmp\_printf\_no\_lock}(\textcolor{stringliteral}{"  %s\(\backslash\)n"}, \hyperlink{kmp__i18n_8h_a99e697f5e6a8c6c430205fd93ce557b8}{KMP\_I18N\_STR}( StorageMapWarning 
      ) );
379     \}
380 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_PRINT\_DATA\_PLACEMENT */}\textcolor{preprocessor}{}
381 \textcolor{preprocessor}{}    \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & \hyperlink{kmp__io_8c_a49e60c011739f46589bb4fae4ad737cc}{\_\_kmp\_stdio\_lock} );
382 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ae66c7ec463ab127171b5ff69c6709d94}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map}}
\index{\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-print\-\_\-team\-\_\-storage\-\_\-map (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{header, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{team\-\_\-id, }
\item[{{\bf int}}]{num\-\_\-thr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ae66c7ec463ab127171b5ff69c6709d94}


Definition at line 491 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team().


\begin{DoxyCode}
492 \{
493     \textcolor{keywordtype}{int} num\_disp\_buff = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_max\_nproc > 1 ? \hyperlink{kmp_8h_a7d5c6777861c49affd8d4ff04cde845a}{KMP\_MAX\_DISP\_BUF} : 2;
494     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, team, team + 1, \textcolor{keyword}{sizeof}(
      \hyperlink{unionkmp__team}{kmp\_team\_t}), \textcolor{stringliteral}{"%s\_%d"},
495                              header, team\_id );
496 
497     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[0], &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}],
498                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__team__union}{kmp\_balign\_team\_t}) * 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}, \textcolor{stringliteral}{"%s\_%d.t\_bar"}, header, team\_id );
499 
500 
501     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}+1],
502                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__team__union}{kmp\_balign\_team\_t}), \textcolor{stringliteral}{"%s\_%d.t\_bar[plain]"}, header, 
      team\_id );
503 
504     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}+1],
505                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__team__union}{kmp\_balign\_team\_t}), \textcolor{stringliteral}{"%s\_%d.t\_bar[forkjoin]"}, header, 
      team\_id );
506 
507 \textcolor{preprocessor}{    #if KMP\_FAST\_REDUCTION\_BARRIER}
508 \textcolor{preprocessor}{}        \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier}], &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier}+1],
509                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__team__union}{kmp\_balign\_team\_t}), \textcolor{stringliteral}{"%s\_%d.t\_bar[reduction]"}, header, 
      team\_id );
510 \textcolor{preprocessor}{    #endif // KMP\_FAST\_REDUCTION\_BARRIER}
511 \textcolor{preprocessor}{}
512     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[0], &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch[num\_thr],
513                              \textcolor{keyword}{sizeof}(\hyperlink{structkmp__disp}{kmp\_disp\_t}) * num\_thr, \textcolor{stringliteral}{"%s\_%d.t\_dispatch"}, header, team\_id );
514 
515     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[num\_thr],
516                              \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *) * num\_thr, \textcolor{stringliteral}{"%s\_%d.t\_threads"}, header, team\_id )
      ;
517 
518     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[0], &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer[num\_disp\_buff],
519                              \textcolor{keyword}{sizeof}(\hyperlink{structdispatch__shared__info}{dispatch\_shared\_info\_t}) * num\_disp\_buff, \textcolor{stringliteral}{"
      %s\_%d.t\_disp\_buffer"},
520                              header, team\_id );
521 
522     \textcolor{comment}{/*}
523 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_nproc[0], &team->t.t\_set\_nproc[num\_thr],}
524 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_nproc", header, team\_id );}
525 \textcolor{comment}{}
526 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_dynamic[0], &team->t.t\_set\_dynamic[num\_thr],}
527 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_dynamic", header, team\_id );}
528 \textcolor{comment}{}
529 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_nested[0], &team->t.t\_set\_nested[num\_thr],}
530 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_nested", header, team\_id );}
531 \textcolor{comment}{}
532 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_blocktime[0], &team->t.t\_set\_blocktime[num\_thr],}
533 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_nproc", header, team\_id );}
534 \textcolor{comment}{}
535 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_bt\_intervals[0], &team->t.t\_set\_bt\_intervals[num\_thr],}
536 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_dynamic", header, team\_id );}
537 \textcolor{comment}{}
538 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_bt\_set[0], &team->t.t\_set\_bt\_set[num\_thr],}
539 \textcolor{comment}{                             sizeof(int) * num\_thr, "%s\_%d.t\_set\_nested", header, team\_id );}
540 \textcolor{comment}{}
541 \textcolor{comment}{    //\_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_max\_active\_levels[0],
       &team->t.t\_set\_max\_active\_levels[num\_thr],}
542 \textcolor{comment}{    //                        sizeof(int) * num\_thr, "%s\_%d.t\_set\_max\_active\_levels", header, team\_id );}
543 \textcolor{comment}{}
544 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_sched[0], &team->t.t\_set\_sched[num\_thr],}
545 \textcolor{comment}{                             sizeof(kmp\_r\_sched\_t) * num\_thr, "%s\_%d.t\_set\_sched", header, team\_id );}
546 \textcolor{comment}{#if OMP\_40\_ENABLED}
547 \textcolor{comment}{    \_\_kmp\_print\_storage\_map\_gtid( -1, &team->t.t\_set\_proc\_bind[0], &team->t.t\_set\_proc\_bind[num\_thr],}
548 \textcolor{comment}{                             sizeof(kmp\_proc\_bind\_t) * num\_thr, "%s\_%d.t\_set\_proc\_bind", header, team\_id );}
549 \textcolor{comment}{#endif}
550 \textcolor{comment}{    */}
551 
552     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( -1, &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_taskq, &team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_copypriv\_data,
553                              \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_ae207b236f7a3d55695081785fc567eaf}{kmp\_taskq\_t}), \textcolor{stringliteral}{"%s\_%d.t\_taskq"}, header, team\_id );
554 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ab34d7ba2a604c6ca0bf177e8e88148a1}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map}}
\index{\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map@{\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-print\-\_\-thread\-\_\-storage\-\_\-map (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thr, }
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ab34d7ba2a604c6ca0bf177e8e88148a1}


Definition at line 457 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), and \-\_\-\-\_\-kmp\-\_\-register\-\_\-root().


\begin{DoxyCode}
458 \{
459     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, thr, thr + 1, \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}), \textcolor{stringliteral}{"th\_%d"}, gtid );
460 
461     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_info, &thr->th.th\_team, \textcolor{keyword}{
      sizeof}(\hyperlink{kmp_8h_a0b10af61096e1bac18cf4fc6acae5708}{kmp\_desc\_t}),
462                              \textcolor{stringliteral}{"th\_%d.th\_info"}, gtid );
463 
464     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_local, &thr->th.th\_pri\_head
      , \textcolor{keyword}{sizeof}(\hyperlink{structkmp__local}{kmp\_local\_t}),
465                              \textcolor{stringliteral}{"th\_%d.th\_local"}, gtid );
466 
467     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_bar[0], &thr->th.th\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}],
468                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__union}{kmp\_balign\_t}) * \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}, \textcolor{stringliteral}{"
      th\_%d.th\_bar"}, gtid );
469 
470     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}],
471                              &thr->th.th\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa364ac8fcf1df87a7d5793a693f2e4051}{bs\_plain\_barrier}+1],
472                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__union}{kmp\_balign\_t}), \textcolor{stringliteral}{"th\_%d.th\_bar[plain]"}, gtid);
473 
474     \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}],
475                              &thr->th.th\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}+1],
476                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__union}{kmp\_balign\_t}), \textcolor{stringliteral}{"th\_%d.th\_bar[forkjoin]"}, gtid);
477 
478 \textcolor{preprocessor}{    #if KMP\_FAST\_REDUCTION\_BARRIER}
479 \textcolor{preprocessor}{}        \hyperlink{kmp__runtime_8c_a32790846a1d92106ea6f663ea47011ce}{\_\_kmp\_print\_storage\_map\_gtid}( gtid, &thr->th.th\_bar[
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier}],
480                              &thr->th.th\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfa29c197b0a78444fe03a07639ae7b106e}{bs\_reduction\_barrier}+1],
481                              \textcolor{keyword}{sizeof}(\hyperlink{unionkmp__barrier__union}{kmp\_balign\_t}), \textcolor{stringliteral}{"th\_%d.th\_bar[reduction]"}, gtid);
482 \textcolor{preprocessor}{    #endif // KMP\_FAST\_REDUCTION\_BARRIER}
483 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a4b8c42f74758d5b28a257f941ca5e5bb}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams}}
\index{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-teams (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{id, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{num\-\_\-teams, }
\item[{{\bf int}}]{num\-\_\-threads}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a4b8c42f74758d5b28a257f941ca5e5bb}


Definition at line 6979 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams(), and \-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams().


\begin{DoxyCode}
6980 \{
6981     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
6982     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(num\_teams >= 0);
6983     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(num\_threads >= 0);
6984 
6985     \textcolor{keywordflow}{if}( num\_teams == 0 )
6986         num\_teams = 1;    \textcolor{comment}{// default number of teams is 1.}
6987     \textcolor{keywordflow}{if}( num\_teams > \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} ) \{ \textcolor{comment}{// if too many teams requested?}
6988         \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} ) \{
6989             \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} = 1;
6990             \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
6991                 \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
6992                 \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantFormThrTeam, num\_teams, \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} ),
6993                 \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( Unset\_ALL\_THREADS ),
6994                 \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
6995             );
6996         \}
6997         num\_teams = \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth};
6998     \}
6999     \textcolor{comment}{// Set number of teams (number of threads in the outer "parallel" of the teams)}
7000     thr->th.th\_set\_nproc = thr->th.th\_teams\_size.nteams = num\_teams;
7001 
7002     \textcolor{comment}{// Remember the number of threads for inner parallel regions}
7003     \textcolor{keywordflow}{if}( num\_threads == 0 ) \{
7004         \textcolor{keywordflow}{if}( !\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle}) )
7005             \hyperlink{kmp__runtime_8c_a86759bf6b8380906f716603052f60fc9}{\_\_kmp\_middle\_initialize}();  \textcolor{comment}{// get \_\_kmp\_avail\_proc calculated}
7006         num\_threads = \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} / num\_teams;
7007         \textcolor{keywordflow}{if}( num\_teams * num\_threads > \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} ) \{
7008             \textcolor{comment}{// adjust num\_threads w/o warning as it is not user setting}
7009             num\_threads = \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} / num\_teams;
7010         \}
7011     \} \textcolor{keywordflow}{else} \{
7012         \textcolor{keywordflow}{if}( num\_teams * num\_threads > \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} ) \{
7013             \textcolor{keywordtype}{int} new\_threads = \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} / num\_teams;
7014             \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} ) \{ \textcolor{comment}{// user asked for too many threads}
7015                 \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} = 1;  \textcolor{comment}{// that conflicts with OMP\_THREAD\_LIMIT}
7016                 \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
7017                     \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
7018                     \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantFormThrTeam, num\_threads, new\_threads ),
7019                     \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( Unset\_ALL\_THREADS ),
7020                     \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
7021                 );
7022             \}
7023             num\_threads = new\_threads;
7024         \}
7025     \}
7026     thr->th.th\_teams\_size.nth = num\_threads;
7027 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a68747f6af5ebfc6c26c14b0820fe2082}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads}}
\index{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-push\-\_\-num\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{id, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{num\-\_\-threads}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a68747f6af5ebfc6c26c14b0820fe2082}


Definition at line 6966 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-S\-E\-C\-T\-I\-O\-N\-S(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-S\-E\-C\-T\-I\-O\-N\-S\-\_\-\-S\-T\-A\-R\-T(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-S\-T\-A\-R\-T().


\begin{DoxyCode}
6967 \{
6968     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
6969 
6970     \textcolor{keywordflow}{if}( num\_threads > 0 )
6971         thr->th.th\_set\_nproc = num\_threads;
6972 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3f9064973202dcd6602376f53f7df6ce}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind}}
\index{\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind@{\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-push\-\_\-proc\-\_\-bind (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{id, }
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-proc\-\_\-bind\-\_\-t}}]{proc\-\_\-bind}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3f9064973202dcd6602376f53f7df6ce}


Definition at line 7034 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmpc\-\_\-push\-\_\-proc\-\_\-bind(), K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-S\-E\-C\-T\-I\-O\-N\-S().


\begin{DoxyCode}
7035 \{
7036     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
7037     thr->th.th\_set\_proc\_bind = proc\_bind;
7038 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ad94006b7baff285b913102630774d4a5}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays}}
\index{\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays@{\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-reallocate\-\_\-team\-\_\-arrays (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{max\-\_\-nth}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ad94006b7baff285b913102630774d4a5}


Definition at line 3084 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team().


\begin{DoxyCode}
3084                                                             \{
3085     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} **oldThreads = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads;
3086 
3087 \textcolor{preprocessor}{    #if !KMP\_USE\_POOLED\_ALLOC}
3088 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer);
3089         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch);
3090         \textcolor{comment}{//\_\_kmp\_free(team->t.t\_set\_max\_active\_levels);}
3091         \textcolor{comment}{//\_\_kmp\_free(team->t.t\_set\_sched);}
3092         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata);
3093 \textcolor{preprocessor}{    #endif}
3094 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a4bd75779a9760d87a4ee0a439f55192b}{\_\_kmp\_allocate\_team\_arrays}(team, max\_nth);
3095 
3096     \hyperlink{kmp__safe__c__api_8h_ab63a75e8bb537bb3ae55c05d0a3b7ca0}{KMP\_MEMCPY}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads, oldThreads, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc * sizeof (
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*));
3097 
3098     \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(oldThreads);
3099 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team}}
\index{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-team}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-team\-\_\-t}$\ast$ \-\_\-\-\_\-kmp\-\_\-reap\-\_\-team (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}


Definition at line 5332 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end(), and \-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread().


\begin{DoxyCode}
5333 \{
5334     \hyperlink{unionkmp__team}{kmp\_team\_t} *next\_pool = team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_next\_pool;
5335 
5336     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team );
5337     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch    );
5338     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_disp\_buffer );
5339     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads     );
5340     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv        );
5341 
5342     \textcolor{comment}{/* TODO clean the threads that are a part of this? */}
5343 
5344     \textcolor{comment}{/* free stuff */}
5345 
5346     \hyperlink{kmp__runtime_8c_a50220bcdbf9d2bd78cf51373757a97e1}{\_\_kmp\_free\_team\_arrays}( team );
5347     \textcolor{keywordflow}{if} ( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv != &team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_inline\_argv[0] )
5348         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( (\textcolor{keywordtype}{void}*) team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argv );
5349     \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( team );
5350 
5351     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5352     \textcolor{keywordflow}{return} next\_pool;
5353 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a8dcaceda5809cef836f90d78710e7bed}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-reap\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thread, }
\item[{{\bf int}}]{is\-\_\-root}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a8dcaceda5809cef836f90d78710e7bed}


Definition at line 5694 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end(), and \-\_\-\-\_\-kmp\-\_\-reset\-\_\-root().


\begin{DoxyCode}
5697   \{
5698 
5699     \textcolor{comment}{// It is assumed \_\_kmp\_forkjoin\_lock is acquired.}
5700 
5701     \textcolor{keywordtype}{int} gtid;
5702 
5703     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thread != NULL );
5704 
5705     gtid = thread->th.th\_info.ds.ds\_gtid;
5706 
5707     \textcolor{keywordflow}{if} ( ! is\_root ) \{
5708 
5709         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a3b56e2e90e1539c0b794e4137724bc1c}{\_\_kmp\_dflt\_blocktime} != \hyperlink{kmp_8h_a1ca6c6ce04115f143dc5df627de57958}{KMP\_MAX\_BLOCKTIME} ) \{
5710             \textcolor{comment}{/* Assume the threads are at the fork barrier here */}
5711             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_reap\_thread: releasing T#%d from fork barrier for reap\(\backslash\)n"}, gtid )
       );
5712             \textcolor{comment}{/* Need release fence here to prevent seg faults for tree forkjoin barrier (GEH) */}
5713             \hyperlink{classkmp__flag__64}{kmp\_flag\_64} flag(&thread->th.th\_bar[ \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ].bb.
      b\_go, thread);
5714             \hyperlink{kmp_8h_a5908378ca06b1ae7f71c72ad4b1a81a3}{\_\_kmp\_release\_64}(&flag);
5715         \}; \textcolor{comment}{// if}
5716 
5717         \textcolor{comment}{// Terminate OS thread.}
5718         \hyperlink{kmp_8h_af9e43e476cd1e6220df32409d2025761}{\_\_kmp\_reap\_worker}( thread );
5719 
5720         \textcolor{comment}{//}
5721         \textcolor{comment}{// The thread was killed asynchronously.  If it was actively}
5722         \textcolor{comment}{// spinning in the thread pool, decrement the global count.}
5723         \textcolor{comment}{//}
5724         \textcolor{comment}{// There is a small timing hole here - if the worker thread was}
5725         \textcolor{comment}{// just waking up after sleeping in the pool, had reset it's}
5726         \textcolor{comment}{// th\_active\_in\_pool flag but not decremented the global counter}
5727         \textcolor{comment}{// \_\_kmp\_thread\_pool\_active\_nth yet, then the global counter}
5728         \textcolor{comment}{// might not get updated.}
5729         \textcolor{comment}{//}
5730         \textcolor{comment}{// Currently, this can only happen as the library is unloaded,}
5731         \textcolor{comment}{// so there are no harmful side effects.}
5732         \textcolor{comment}{//}
5733         \textcolor{keywordflow}{if} ( thread->th.th\_active\_in\_pool ) \{
5734             thread->th.th\_active\_in\_pool = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
5735             \hyperlink{kmp__os_8h_a5b23523b95ee4b2307a8f344cbbe8050}{KMP\_TEST\_THEN\_DEC32}(
5736               (kmp\_int32 *) &\hyperlink{kmp_8h_adeeafca09cd1560dcc9bc78ee1df217d}{\_\_kmp\_thread\_pool\_active\_nth} );
5737             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(
      \hyperlink{kmp_8h_adeeafca09cd1560dcc9bc78ee1df217d}{\_\_kmp\_thread\_pool\_active\_nth}) >= 0 );
5738         \}
5739 
5740         \textcolor{comment}{// Decrement # of [worker] threads in the pool.}
5741         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_ab77f7a31d04d2d654e78546530b71ab9}{\_\_kmp\_thread\_pool\_nth} > 0 );
5742         --\hyperlink{kmp_8h_ab77f7a31d04d2d654e78546530b71ab9}{\_\_kmp\_thread\_pool\_nth};
5743     \}; \textcolor{comment}{// if}
5744 
5745     \textcolor{comment}{// Free the fast memory for tasking}
5746 \textcolor{preprocessor}{    #if USE\_FAST\_MEMORY}
5747 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_a3d231dc8385bed5f0e9cf1d49a12abe2}{\_\_kmp\_free\_fast\_memory}( thread );
5748 \textcolor{preprocessor}{    #endif }\textcolor{comment}{/* USE\_FAST\_MEMORY */}\textcolor{preprocessor}{}
5749 \textcolor{preprocessor}{}
5750     \hyperlink{kmp_8h_a8da648a8950059fa34eeca0f54b437a6}{\_\_kmp\_suspend\_uninitialize\_thread}( thread );
5751 
5752     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ] == thread );
5753     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid], NULL);
5754 
5755     -- \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth};
5756     \textcolor{comment}{// \_\_kmp\_nth was decremented when thread is added to the pool.}
5757 
5758 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
5759 \textcolor{preprocessor}{}    \textcolor{comment}{/* Adjust blocktime back to user setting or default if necessary */}
5760     \textcolor{comment}{/* Middle initialization might never have occurred                */}
5761     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
5762         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 );
5763         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} <= \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
5764             \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
5765         \}
5766     \}
5767 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
5768 \textcolor{preprocessor}{}
5769     \textcolor{comment}{/* free the memory being used */}
5770     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
5771         \textcolor{keywordflow}{if} ( thread->th.th\_cons ) \{
5772             \hyperlink{kmp__error_8c_af22b9aa73970c933530face5cdfc41fb}{\_\_kmp\_free\_cons\_stack}( thread->th.th\_cons );
5773             thread->th.th\_cons = NULL;
5774         \}; \textcolor{comment}{// if}
5775     \}
5776 
5777     \textcolor{keywordflow}{if} ( thread->th.th\_pri\_common != NULL ) \{
5778         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( thread->th.th\_pri\_common );
5779         thread->th.th\_pri\_common = NULL;
5780     \}; \textcolor{comment}{// if}
5781 
5782     \textcolor{keywordflow}{if} (thread->th.th\_task\_state\_memo\_stack != NULL) \{
5783         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(thread->th.th\_task\_state\_memo\_stack);
5784         thread->th.th\_task\_state\_memo\_stack = NULL;
5785     \}
5786 
5787 \textcolor{preprocessor}{    #if KMP\_USE\_BGET}
5788 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( thread->th.th\_local.bget\_data != NULL ) \{
5789             \hyperlink{kmp_8h_a9013b6561b0953fae3f61d09d418602b}{\_\_kmp\_finalize\_bget}( thread );
5790         \}; \textcolor{comment}{// if}
5791 \textcolor{preprocessor}{    #endif}
5792 \textcolor{preprocessor}{}
5793 \textcolor{preprocessor}{#if KMP\_AFFINITY\_SUPPORTED}
5794 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( thread->th.th\_affin\_mask != NULL ) \{
5795         KMP\_CPU\_FREE( thread->th.th\_affin\_mask );
5796         thread->th.th\_affin\_mask = NULL;
5797     \}; \textcolor{comment}{// if}
5798 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
5799 \textcolor{preprocessor}{}
5800     \hyperlink{kmp__runtime_8c_a26a24948da4451156049e32070c152aa}{\_\_kmp\_reap\_team}( thread->th.th\_serial\_team );
5801     thread->th.th\_serial\_team = NULL;
5802     \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( thread );
5803 
5804     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
5805 
5806 \} \textcolor{comment}{// \_\_kmp\_reap\_thread}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a02c91cce4fb3b2bd2b7b7d08eeb6b0a8}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name@{\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name}}
\index{\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name@{\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}static char$\ast$ \-\_\-\-\_\-kmp\-\_\-reg\-\_\-status\-\_\-name (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}}\label{kmp__runtime_8c_a02c91cce4fb3b2bd2b7b7d08eeb6b0a8}


Definition at line 6162 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup(), and \-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library().


\begin{DoxyCode}
6162                         \{
6163     \textcolor{comment}{/*}
6164 \textcolor{comment}{        On RHEL 3u5 if linked statically, getpid() returns different values in each thread.}
6165 \textcolor{comment}{        If registration and unregistration go in different threads (omp\_misc\_other\_root\_exit.cpp test
       case),}
6166 \textcolor{comment}{        the name of registered\_lib\_env env var can not be found, because the name will contain different
       pid.}
6167 \textcolor{comment}{    */}
6168     \textcolor{keywordflow}{return} \hyperlink{kmp__str_8c_ac396f8f8ac717893794e30821c1ec12e}{\_\_kmp\_str\_format}( \textcolor{stringliteral}{"\_\_KMP\_REGISTERED\_LIB\_%d"}, (\textcolor{keywordtype}{int}) getpid() );
6169 \} \textcolor{comment}{// \_\_kmp\_reg\_status\_get}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ac0ef7f6136fa82420b38e14ae9daacc0}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup@{\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup}}
\index{\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup@{\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-register\-\_\-library\-\_\-startup (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ac0ef7f6136fa82420b38e14ae9daacc0}


Definition at line 6173 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize().


\begin{DoxyCode}
6175   \{
6176 
6177     \textcolor{keywordtype}{char} * \hyperlink{ittnotify__static_8h_a1c34b35a4952969fef60192313bba34a}{name}   = \hyperlink{kmp__runtime_8c_a02c91cce4fb3b2bd2b7b7d08eeb6b0a8}{\_\_kmp\_reg\_status\_name}();  \textcolor{comment}{// Name of the environment variable.}
6178     \textcolor{keywordtype}{int}    done   = 0;
6179     \textcolor{keyword}{union }\{
6180         \textcolor{keywordtype}{double} dtime;
6181         \textcolor{keywordtype}{long}   ltime;
6182     \} time;
6183 \textcolor{preprocessor}{    #if KMP\_OS\_WINDOWS}
6184 \textcolor{preprocessor}{}        \hyperlink{z__Windows__NT__util_8c_a62b59839eaf67757384be830989a54ba}{\_\_kmp\_initialize\_system\_tick}();
6185 \textcolor{preprocessor}{    #endif}
6186 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_a1f49d8ebe9ab3485ce41c35d80d202d5}{\_\_kmp\_read\_system\_time}( & time.dtime );
6187     \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\_\_kmp\_registration\_flag} = 0xCAFE0000L | ( time.ltime & 0x0000FFFFL );
6188     \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str} =
6189         \hyperlink{kmp__str_8c_ac396f8f8ac717893794e30821c1ec12e}{\_\_kmp\_str\_format}(
6190             \textcolor{stringliteral}{"%p-%lx-%s"},
6191             & \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\_\_kmp\_registration\_flag},
6192             \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\_\_kmp\_registration\_flag},
6193             KMP\_LIBRARY\_FILE
6194         );
6195 
6196     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 50, ( \textcolor{stringliteral}{"\_\_kmp\_register\_library\_startup: %s=\(\backslash\)"%s\(\backslash\)"\(\backslash\)n"}, name, 
      \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str} ) );
6197 
6198     \textcolor{keywordflow}{while} ( ! done ) \{
6199 
6200         \textcolor{keywordtype}{char} * value  = NULL; \textcolor{comment}{// Actual value of the environment variable.}
6201 
6202         \textcolor{comment}{// Set environment variable, but do not overwrite if it is exist.}
6203         \hyperlink{kmp__environment_8c_aed66640640fce6ae13a8ada9e032b9c4}{\_\_kmp\_env\_set}( name, \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str}, 0 );
6204         \textcolor{comment}{// Check the variable is written.}
6205         value = \hyperlink{kmp__environment_8c_a8ca0c26acad07b836fc8d8013979e8cd}{\_\_kmp\_env\_get}( name );
6206         \textcolor{keywordflow}{if} ( value != NULL && strcmp( value, \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str} ) == 0 ) \{
6207 
6208             done = 1;    \textcolor{comment}{// Ok, environment variable set successfully, exit the loop.}
6209 
6210         \} \textcolor{keywordflow}{else} \{
6211 
6212             \textcolor{comment}{// Oops. Write failed. Another copy of OpenMP RTL is in memory.}
6213             \textcolor{comment}{// Check whether it alive or dead.}
6214             \textcolor{keywordtype}{int}    neighbor = 0; \textcolor{comment}{// 0 -- unknown status, 1 -- alive, 2 -- dead.}
6215             \textcolor{keywordtype}{char} * \hyperlink{ittnotify__static_8h_a7205a2ef1da3b41743f40e66ffb8a1be}{tail}          = value;
6216             \textcolor{keywordtype}{char} * flag\_addr\_str = NULL;
6217             \textcolor{keywordtype}{char} * flag\_val\_str  = NULL;
6218             \textcolor{keywordtype}{char} \textcolor{keyword}{const} * file\_name     = NULL;
6219             \hyperlink{kmp__str_8c_a1ffb8c903bb1f2a7c2a93913a1e63920}{\_\_kmp\_str\_split}( tail, \textcolor{charliteral}{'-'}, & flag\_addr\_str, & tail );
6220             \hyperlink{kmp__str_8c_a1ffb8c903bb1f2a7c2a93913a1e63920}{\_\_kmp\_str\_split}( tail, \textcolor{charliteral}{'-'}, & flag\_val\_str,  & tail );
6221             file\_name = \hyperlink{ittnotify__static_8h_a7205a2ef1da3b41743f40e66ffb8a1be}{tail};
6222             \textcolor{keywordflow}{if} ( tail != NULL ) \{
6223                 \textcolor{keywordtype}{long} * flag\_addr = 0;
6224                 \textcolor{keywordtype}{long}   flag\_val  = 0;
6225                 \hyperlink{kmp__safe__c__api_8h_a70e17572e3cba886b748509b25f14af5}{KMP\_SSCANF}( flag\_addr\_str, \textcolor{stringliteral}{"%p"},  & flag\_addr );
6226                 \hyperlink{kmp__safe__c__api_8h_a70e17572e3cba886b748509b25f14af5}{KMP\_SSCANF}( flag\_val\_str,  \textcolor{stringliteral}{"%lx"}, & flag\_val  );
6227                 \textcolor{keywordflow}{if} ( flag\_addr != 0 && flag\_val != 0 && strcmp( file\_name, \textcolor{stringliteral}{""} ) != 0 ) \{
6228                     \textcolor{comment}{// First, check whether environment-encoded address is mapped into addr space.}
6229                     \textcolor{comment}{// If so, dereference it to see if it still has the right value.}
6230 
6231                     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a5676bfae90caed2d037a605382449d2c}{\_\_kmp\_is\_address\_mapped}( flag\_addr ) && * flag\_addr == 
      flag\_val ) \{
6232                         neighbor = 1;
6233                     \} \textcolor{keywordflow}{else} \{
6234                         \textcolor{comment}{// If not, then we know the other copy of the library is no longer running.}
6235                         neighbor = 2;
6236                     \}; \textcolor{comment}{// if}
6237                 \}; \textcolor{comment}{// if}
6238             \}; \textcolor{comment}{// if}
6239             \textcolor{keywordflow}{switch} ( neighbor ) \{
6240                 \textcolor{keywordflow}{case} 0 :      \textcolor{comment}{// Cannot parse environment variable -- neighbor status unknown.}
6241                     \textcolor{comment}{// Assume it is the incompatible format of future version of the library.}
6242                     \textcolor{comment}{// Assume the other library is alive.}
6243                     \textcolor{comment}{// WARN( ... ); // TODO: Issue a warning.}
6244                     file\_name = \textcolor{stringliteral}{"unknown library"};
6245                     \textcolor{comment}{// Attention! Falling to the next case. That's intentional.}
6246                 \textcolor{keywordflow}{case} 1 : \{    \textcolor{comment}{// Neighbor is alive.}
6247                     \textcolor{comment}{// Check it is allowed.}
6248                     \textcolor{keywordtype}{char} * duplicate\_ok = \hyperlink{kmp__environment_8c_a8ca0c26acad07b836fc8d8013979e8cd}{\_\_kmp\_env\_get}( \textcolor{stringliteral}{"KMP\_DUPLICATE\_LIB\_OK"} );
6249                     \textcolor{keywordflow}{if} ( ! \hyperlink{kmp__str_8c_a8cd4e13706553ea42292e282a0ced826}{\_\_kmp\_str\_match\_true}( duplicate\_ok ) ) \{
6250                         \textcolor{comment}{// That's not allowed. Issue fatal error.}
6251                         \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
6252                             \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060aac29006d355ede42e04f48ccd9c23f98}{kmp\_ms\_fatal},
6253                             \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( DuplicateLibrary, KMP\_LIBRARY\_FILE, file\_name ),
6254                             \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( DuplicateLibrary ),
6255                             \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
6256                         );
6257                     \}; \textcolor{comment}{// if}
6258                     \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( duplicate\_ok );
6259                     \hyperlink{kmp_8h_a7ca8380dd04faadb926b10e293bc16be}{\_\_kmp\_duplicate\_library\_ok} = 1;
6260                     done = 1;    \textcolor{comment}{// Exit the loop.}
6261                 \} \textcolor{keywordflow}{break};
6262                 \textcolor{keywordflow}{case} 2 : \{    \textcolor{comment}{// Neighbor is dead.}
6263                     \textcolor{comment}{// Clear the variable and try to register library again.}
6264                     \hyperlink{kmp__environment_8c_af0715e0365570b19fd22c7370e3d4938}{\_\_kmp\_env\_unset}( name );
6265                 \}  \textcolor{keywordflow}{break};
6266                 \textcolor{keywordflow}{default} : \{
6267                     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( 0 );
6268                 \} \textcolor{keywordflow}{break};
6269             \}; \textcolor{comment}{// switch}
6270 
6271         \}; \textcolor{comment}{// if}
6272         \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( (\textcolor{keywordtype}{void} *) value );
6273 
6274     \}; \textcolor{comment}{// while}
6275     \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( (\textcolor{keywordtype}{void} *) name );
6276 
6277 \} \textcolor{comment}{// func \_\_kmp\_register\_library\_startup}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a35f021c58bf7593d6c096cea30edbcc0}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-register\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-register\-\_\-root}}
\index{\-\_\-\-\_\-kmp\-\_\-register\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-register\-\_\-root}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-register\-\_\-root}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} \-\_\-\-\_\-kmp\-\_\-register\-\_\-root (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{initial\-\_\-thread}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a35f021c58bf7593d6c096cea30edbcc0}


Definition at line 3659 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize(), and \-\_\-\-\_\-kmp\-\_\-get\-\_\-global\-\_\-thread\-\_\-id\-\_\-reg().


\begin{DoxyCode}
3660 \{
3661     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *root\_thread;
3662     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} *root;
3663     \textcolor{keywordtype}{int}         gtid;
3664     \textcolor{keywordtype}{int}         capacity;
3665     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
3666     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_register\_root: entered\(\backslash\)n"}));
3667     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
3668 
3669 
3670     \textcolor{comment}{/*}
3671 \textcolor{comment}{        2007-03-02:}
3672 \textcolor{comment}{}
3673 \textcolor{comment}{        If initial thread did not invoke OpenMP RTL yet, and this thread is not an initial one,}
3674 \textcolor{comment}{        "\_\_kmp\_all\_nth >= \_\_kmp\_threads\_capacity" condition does not work as expected -- it may}
3675 \textcolor{comment}{        return false (that means there is at least one empty slot in \_\_kmp\_threads array), but it}
3676 \textcolor{comment}{        is possible the only free slot is #0, which is reserved for initial thread and so cannot be}
3677 \textcolor{comment}{        used for this one. Following code workarounds this bug.}
3678 \textcolor{comment}{}
3679 \textcolor{comment}{        However, right solution seems to be not reserving slot #0 for initial thread because:}
3680 \textcolor{comment}{            (1) there is no magic in slot #0,}
3681 \textcolor{comment}{            (2) we cannot detect initial thread reliably (the first thread which does serial}
3682 \textcolor{comment}{                initialization may be not a real initial thread).}
3683 \textcolor{comment}{    */}
3684     capacity = \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity};
3685     \textcolor{keywordflow}{if} ( ! initial\_thread && \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[0]) == NULL ) \{
3686         -- capacity;
3687     \}; \textcolor{comment}{// if}
3688 
3689     \textcolor{comment}{/* see if there are too many threads */}
3690     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} >= capacity && !\hyperlink{kmp__runtime_8c_a393e842afa40d6cd0bd01d36e27e40c9}{\_\_kmp\_expand\_threads}( 1, 1 ) ) \{
3691         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached} ) \{
3692             \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
3693                 \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060aac29006d355ede42e04f48ccd9c23f98}{kmp\_ms\_fatal},
3694                 \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantRegisterNewThread ),
3695                 \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( Set\_ALL\_THREADPRIVATE, \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity} ),
3696                 \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( PossibleSystemLimitOnThreads ),
3697                 \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
3698             );
3699         \}
3700         \textcolor{keywordflow}{else} \{
3701             \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
3702                 \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060aac29006d355ede42e04f48ccd9c23f98}{kmp\_ms\_fatal},
3703                 \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantRegisterNewThread ),
3704                 \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( SystemLimitOnThreads ),
3705                 \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
3706             );
3707         \}
3708     \}; \textcolor{comment}{// if}
3709 
3710     \textcolor{comment}{/* find an available thread slot */}
3711     \textcolor{comment}{/* Don't reassign the zero slot since we need that to only be used by initial}
3712 \textcolor{comment}{       thread */}
3713     \textcolor{keywordflow}{for}( gtid=(initial\_thread ? 0 : 1) ; \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]) != NULL ; gtid++ 
      )
3714         ;
3715     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1, (\textcolor{stringliteral}{"\_\_kmp\_register\_root: found slot in threads array: T#%d\(\backslash\)n"}, gtid ));
3716     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( gtid < \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity} );
3717 
3718     \textcolor{comment}{/* update global accounting */}
3719     \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} ++;
3720     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}, \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + 1);
3721 
3722     \textcolor{comment}{//}
3723     \textcolor{comment}{// if \_\_kmp\_adjust\_gtid\_mode is set, then we use method #1 (sp search)}
3724     \textcolor{comment}{// for low numbers of procs, and method #2 (keyed API call) for higher}
3725     \textcolor{comment}{// numbers of procs.}
3726     \textcolor{comment}{//}
3727     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a5c671e87df31e6aad0b217b0d4ab2bad}{\_\_kmp\_adjust\_gtid\_mode} ) \{
3728         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a521a7c7af6217ee75a79b5abd627779c}{\_\_kmp\_all\_nth} >= \hyperlink{kmp_8h_afce1a0df7f7512062fd0494459776dae}{\_\_kmp\_tls\_gtid\_min} ) \{
3729             \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) != 2) \{
3730                 \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}, 2);
3731             \}
3732         \}
3733         \textcolor{keywordflow}{else} \{
3734             \textcolor{keywordflow}{if} (\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}) != 1 ) \{
3735                 \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_ae8d713bc264db1f092c97ca94f3b82bc}{\_\_kmp\_gtid\_mode}, 1);
3736             \}
3737         \}
3738     \}
3739 
3740 \textcolor{preprocessor}{#ifdef KMP\_ADJUST\_BLOCKTIME}
3741 \textcolor{preprocessor}{}    \textcolor{comment}{/* Adjust blocktime to zero if necessary            */}
3742     \textcolor{comment}{/* Middle initialization might not have occurred yet */}
3743     \textcolor{keywordflow}{if} ( !\hyperlink{kmp_8h_a5caf27b26a61e30dbb9cdfb3211dcbb1}{\_\_kmp\_env\_blocktime} && ( \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} > 0 ) ) \{
3744         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} > \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} ) \{
3745             \_\_kmp\_zero\_bt = \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
3746         \}
3747     \}
3748 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ADJUST\_BLOCKTIME */}\textcolor{preprocessor}{}
3749 \textcolor{preprocessor}{}
3750     \textcolor{comment}{/* setup this new hierarchy */}
3751     \textcolor{keywordflow}{if}( ! ( root = \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid] )) \{
3752         root = \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid] = (\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}*) 
      \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(\hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t}) );
3753         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ! root->r.r\_root\_team );
3754     \}
3755 
3756     \hyperlink{kmp__runtime_8c_a50a4b71438f212672e584f38bb68d745}{\_\_kmp\_initialize\_root}( root );
3757 
3758     \textcolor{comment}{/* setup new root thread structure */}
3759     \textcolor{keywordflow}{if}( root->r.r\_uber\_thread ) \{
3760         root\_thread = root->r.r\_uber\_thread;
3761     \} \textcolor{keywordflow}{else} \{
3762         root\_thread = (\hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}*) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}(
      \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t}) );
3763         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a9ebbdbe73e3d15e7a0b23ce875f3dac9}{\_\_kmp\_storage\_map} ) \{
3764             \hyperlink{kmp__runtime_8c_ab34d7ba2a604c6ca0bf177e8e88148a1}{\_\_kmp\_print\_thread\_storage\_map}( root\_thread, gtid );
3765         \}
3766         root\_thread->th.th\_info .ds.ds\_gtid = gtid;
3767         root\_thread->th.th\_root =  root;
3768         \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} ) \{
3769             root\_thread->th.th\_cons = \hyperlink{kmp__error_8c_a6937a7feee3b38116aeccf3c7922c7de}{\_\_kmp\_allocate\_cons\_stack}( gtid );
3770         \}
3771 \textcolor{preprocessor}{        #if USE\_FAST\_MEMORY}
3772 \textcolor{preprocessor}{}            \hyperlink{kmp_8h_a69fe87136a9efb3f397250ae7838f470}{\_\_kmp\_initialize\_fast\_memory}( root\_thread );
3773 \textcolor{preprocessor}{        #endif }\textcolor{comment}{/* USE\_FAST\_MEMORY */}\textcolor{preprocessor}{}
3774 \textcolor{preprocessor}{}
3775 \textcolor{preprocessor}{        #if KMP\_USE\_BGET}
3776 \textcolor{preprocessor}{}            \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root\_thread->th.th\_local.bget\_data == NULL );
3777             \hyperlink{kmp_8h_adf0ede820c2a58e37d06987be170dde4}{\_\_kmp\_initialize\_bget}( root\_thread );
3778 \textcolor{preprocessor}{        #endif}
3779 \textcolor{preprocessor}{}        \hyperlink{kmp__runtime_8c_a60fcea18938e34651a2bf9f5d15d95fa}{\_\_kmp\_init\_random}( root\_thread );  \textcolor{comment}{// Initialize random number generator}
3780     \}
3781 
3782     \textcolor{comment}{/* setup the serial team held in reserve by the root thread */}
3783     \textcolor{keywordflow}{if}( ! root\_thread->th.th\_serial\_team ) \{
3784         \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} r\_icvs = 
      \hyperlink{kmp__runtime_8c_a9ad37994c0b2b9e6c900768047c82362}{\_\_kmp\_get\_global\_icvs}();
3785         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_register\_root: before serial\_team\(\backslash\)n"} ) );
3786 
3787         root\_thread->th.th\_serial\_team = \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}( root, 1, 1,
3788 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
3789           0, \textcolor{comment}{// root parallel id}
3790 #endif
3791 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
3792           \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default},
3793 #endif
3794           &r\_icvs,
3795           0 \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
3796     \}
3797     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( root\_thread->th.th\_serial\_team );
3798     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_register\_root: after serial\_team = %p\(\backslash\)n"},
3799       root\_thread->th.th\_serial\_team ) );
3800 
3801     \textcolor{comment}{/* drop root\_thread into place */}
3802     \hyperlink{kmp__os_8h_a2f525396d7d7493be7c586f24213fb39}{TCW\_SYNC\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid], root\_thread);
3803 
3804     root->r.r\_root\_team->t.t\_threads[0] = root\_thread;
3805     root->r.r\_hot\_team ->t.t\_threads[0] = root\_thread;
3806     root\_thread->th.th\_serial\_team->t.t\_threads[0] = root\_thread;
3807     root\_thread->th.th\_serial\_team->t.t\_serialized = 0; \textcolor{comment}{// AC: the team created in reserve, not for
       execution (it is unused for now).}
3808     root->r.r\_uber\_thread = root\_thread;
3809 
3810     \textcolor{comment}{/* initialize the thread, get it ready to go */}
3811     \hyperlink{kmp__runtime_8c_a7cf92b0a749db129c80e46acb7590716}{\_\_kmp\_initialize\_info}( root\_thread, root->r.r\_root\_team, 0, gtid );
3812 
3813     \textcolor{comment}{/* prepare the master thread for get\_gtid() */}
3814     \hyperlink{kmp_8h_ae3492f3ab3c30ed2c204dc10e93c8471}{\_\_kmp\_gtid\_set\_specific}( gtid );
3815 
3816     \_\_kmp\_itt\_thread\_name( gtid );
3817 
3818 \textcolor{preprocessor}{    #ifdef KMP\_TDATA\_GTID}
3819 \textcolor{preprocessor}{}        \_\_kmp\_gtid = gtid;
3820 \textcolor{preprocessor}{    #endif}
3821 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_aa0827020920859540910bfb0f89e2584}{\_\_kmp\_create\_worker}( gtid, root\_thread, \hyperlink{kmp_8h_a4524fc3a41e208a6cf6d7cad17f028c7}{\_\_kmp\_stksize} );
3822     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a6f6175733adad71e903b95b0339f1f3b}{\_\_kmp\_gtid\_get\_specific}() == gtid );
3823     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a3f91f5b94048484e40c6caeb66c60f27}{\_\_kmp\_init\_gtid}, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
3824 
3825     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_register\_root: T#%d init T#%d(%d:%d) arrived: join=%u, plain=%u\(\backslash\)n"},
3826                     gtid, \hyperlink{kmp_8h_a66d8a210d86c996e250ea9971fe3cd3a}{\_\_kmp\_gtid\_from\_tid}( 0, root->r.r\_hot\_team ),
3827                     root->r.r\_hot\_team->t.t\_id, 0, \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE},
3828                     \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} ) );
3829     \{ \textcolor{comment}{// Initialize barrier data.}
3830         \textcolor{keywordtype}{int} b;
3831         \textcolor{keywordflow}{for} ( b = 0; b < \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfaab77402926ed27b4683d9f72f0c369ed}{bs\_last\_barrier}; ++ b ) \{
3832             root\_thread->th.th\_bar[ b ].bb.b\_arrived        = 
      \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE};
3833 \textcolor{preprocessor}{#if USE\_DEBUGGER}
3834 \textcolor{preprocessor}{}            root\_thread->th.th\_bar[ b ].bb.b\_worker\_arrived = 0;
3835 \textcolor{preprocessor}{#endif}
3836 \textcolor{preprocessor}{}        \}; \textcolor{comment}{// for}
3837     \}
3838     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root->r.r\_hot\_team->t.t\_bar[ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ].b\_arrived == \hyperlink{kmp_8h_abf682c7f66b0baa7f7184ac388224569}{KMP\_INIT\_BARRIER\_STATE} );
3839 
3840 \textcolor{preprocessor}{#if KMP\_AFFINITY\_SUPPORTED}
3841 \textcolor{preprocessor}{}\textcolor{preprocessor}{# if OMP\_40\_ENABLED}
3842 \textcolor{preprocessor}{}    root\_thread->th.th\_current\_place = KMP\_PLACE\_UNDEFINED;
3843     root\_thread->th.th\_new\_place = KMP\_PLACE\_UNDEFINED;
3844     root\_thread->th.th\_first\_place = KMP\_PLACE\_UNDEFINED;
3845     root\_thread->th.th\_last\_place = KMP\_PLACE\_UNDEFINED;
3846 \textcolor{preprocessor}{# endif}
3847 \textcolor{preprocessor}{}
3848     \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a70576d967f407af9d2ecb6174c1c7add}{\_\_kmp\_init\_middle}) ) \{
3849         \_\_kmp\_affinity\_set\_init\_mask( gtid, \hyperlink{kmp_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
3850     \}
3851 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_AFFINITY\_SUPPORTED */}\textcolor{preprocessor}{}
3852 \textcolor{preprocessor}{}
3853     \hyperlink{kmp_8h_ae8940c05c34b3e38e04f31833d386e23}{\_\_kmp\_root\_counter} ++;
3854 
3855     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
3856     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
3857 
3858     \textcolor{keywordflow}{return} gtid;
3859 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team}}
\index{\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team@{\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf void} \-\_\-\-\_\-kmp\-\_\-reinitialize\-\_\-team (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$}]{new\-\_\-icvs, }
\item[{{\bf ident\-\_\-t} $\ast$}]{loc}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a50e58be634ec2ce8b854edc4e26a0d23}


Definition at line 4408 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), and \-\_\-\-\_\-kmp\-\_\-initialize\-\_\-team().


\begin{DoxyCode}
4408                                                                                             \{
4409     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reinitialize\_team: enter this\_thread=%p team=%p\(\backslash\)n"},
4410                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team ) );
4411     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team && new\_icvs);
4412     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel}) ) || new\_icvs
      ->\hyperlink{structkmp__internal__control_a807067319fd06b644c3aecefadac01e6}{nproc} );
4413     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident = loc;
4414 
4415     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_id = \hyperlink{kmp_8h_a82c66c7d50417abe41d36f2a5bf82f54}{KMP\_GEN\_TEAM\_ID}();
4416 
4417     \textcolor{comment}{// Copy ICVs to the master thread's implicit taskdata}
4418     \hyperlink{kmp_8h_a8387c1b95f3b497a14fc3916515ad4c3}{\_\_kmp\_init\_implicit\_task}( loc, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team, 0, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} );
4419     \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[0].td\_icvs, new\_icvs);
4420 
4421     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reinitialize\_team: exit this\_thread=%p team=%p\(\backslash\)n"},
4422                     team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team ) );
4423 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_adbe354e826a5327d1f0a7cb6cac7c6ba}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads}}
\index{\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf int} \-\_\-\-\_\-kmp\-\_\-reserve\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{parent\-\_\-team, }
\item[{{\bf int}}]{master\-\_\-tid, }
\item[{{\bf int}}]{set\-\_\-nthreads, }
\item[{{\bf int}}]{enter\-\_\-teams}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_adbe354e826a5327d1f0a7cb6cac7c6ba}


Definition at line 860 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
866 \{
867     \textcolor{keywordtype}{int} capacity;
868     \textcolor{keywordtype}{int} new\_nthreads;
869     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
870     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( root && parent\_team );
871 
872     \textcolor{comment}{//}
873     \textcolor{comment}{// If dyn-var is set, dynamically adjust the number of desired threads,}
874     \textcolor{comment}{// according to the method specified by dynamic\_mode.}
875     \textcolor{comment}{//}
876     new\_nthreads = set\_nthreads;
877     \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_a04c626ef439f6a5a608307842f2283f4}{get\_\_dynamic\_2}( parent\_team, master\_tid ) ) \{
878         ;
879     \}
880 \textcolor{preprocessor}{#ifdef USE\_LOAD\_BALANCE}
881 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode == dynamic\_load\_balance ) \{
882         new\_nthreads = \_\_kmp\_load\_balance\_nproc( root, set\_nthreads );
883         \textcolor{keywordflow}{if} ( new\_nthreads == 1 ) \{
884             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d load balance reduced reservation to 1
       thread\(\backslash\)n"},
885               master\_tid ));
886             \textcolor{keywordflow}{return} 1;
887         \}
888         \textcolor{keywordflow}{if} ( new\_nthreads < set\_nthreads ) \{
889             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d load balance reduced reservation to %d
       threads\(\backslash\)n"},
890               master\_tid, new\_nthreads ));
891         \}
892     \}
893 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_LOAD\_BALANCE */}\textcolor{preprocessor}{}
894 \textcolor{preprocessor}{}    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode == \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853a4aa2fe6783bee15ca53a7e49684edef2}{dynamic\_thread\_limit} ) \{
895         new\_nthreads = \hyperlink{kmp_8h_adc73a89e0c77c9b0a3233f9fde48a5b2}{\_\_kmp\_avail\_proc} - \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + (root->r.r\_active ? 1
896           : root->r.r\_hot\_team->t.t\_nproc);
897         \textcolor{keywordflow}{if} ( new\_nthreads <= 1 ) \{
898             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d thread limit reduced reservation to 1
       thread\(\backslash\)n"},
899               master\_tid ));
900             \textcolor{keywordflow}{return} 1;
901         \}
902         \textcolor{keywordflow}{if} ( new\_nthreads < set\_nthreads ) \{
903             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d thread limit reduced reservation to %d
       threads\(\backslash\)n"},
904               master\_tid, new\_nthreads ));
905         \}
906         \textcolor{keywordflow}{else} \{
907             new\_nthreads = set\_nthreads;
908         \}
909     \}
910     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_dynamic\_mode == \hyperlink{kmp_8h_afad9dc14c1f4e31f03a77297c13e0853afa64d2cb56b47551fb6c03f72742ac2c}{dynamic\_random} ) \{
911         \textcolor{keywordflow}{if} ( set\_nthreads > 2 ) \{
912             new\_nthreads = \hyperlink{kmp__runtime_8c_a35a3fb5fe916330a8e3f844603bb6a09}{\_\_kmp\_get\_random}( parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[master\_tid] );
913             new\_nthreads = ( new\_nthreads % set\_nthreads ) + 1;
914             \textcolor{keywordflow}{if} ( new\_nthreads == 1 ) \{
915                 \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d dynamic random reduced reservation to
       1 thread\(\backslash\)n"},
916                   master\_tid ));
917                 \textcolor{keywordflow}{return} 1;
918             \}
919             \textcolor{keywordflow}{if} ( new\_nthreads < set\_nthreads ) \{
920                 \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d dynamic random reduced reservation to
       %d threads\(\backslash\)n"},
921                   master\_tid, new\_nthreads ));
922             \}
923         \}
924     \}
925     \textcolor{keywordflow}{else} \{
926         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( 0 );
927     \}
928 
929     \textcolor{comment}{//}
930     \textcolor{comment}{// Respect KMP\_ALL\_THREADS, KMP\_MAX\_THREADS, OMP\_THREAD\_LIMIT.}
931     \textcolor{comment}{//}
932     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + new\_nthreads - ( root->r.r\_active ? 1 :
933       root->r.r\_hot\_team->t.t\_nproc ) > \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} ) \{
934         \textcolor{keywordtype}{int} tl\_nthreads = \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth} - \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + ( root->r.r\_active ? 1 :
935           root->r.r\_hot\_team->t.t\_nproc );
936         \textcolor{keywordflow}{if} ( tl\_nthreads <= 0 ) \{
937             tl\_nthreads = 1;
938         \}
939 
940         \textcolor{comment}{//}
941         \textcolor{comment}{// If dyn-var is false, emit a 1-time warning.}
942         \textcolor{comment}{//}
943         \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_a04c626ef439f6a5a608307842f2283f4}{get\_\_dynamic\_2}( parent\_team, master\_tid )
944           && ( ! \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} ) ) \{
945             \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} = 1;
946             \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
947                 \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
948                 \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantFormThrTeam, set\_nthreads, tl\_nthreads ),
949                 \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( Unset\_ALL\_THREADS ),
950                 \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
951             );
952         \}
953         \textcolor{keywordflow}{if} ( tl\_nthreads == 1 ) \{
954             \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d KMP\_ALL\_THREADS reduced reservation to 1
       thread\(\backslash\)n"},
955               master\_tid ));
956             \textcolor{keywordflow}{return} 1;
957         \}
958         \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d KMP\_ALL\_THREADS reduced reservation to %d
       threads\(\backslash\)n"},
959           master\_tid, tl\_nthreads ));
960         new\_nthreads = tl\_nthreads;
961     \}
962 
963     \textcolor{comment}{//}
964     \textcolor{comment}{// Check if the threads array is large enough, or needs expanding.}
965     \textcolor{comment}{//}
966     \textcolor{comment}{// See comment in \_\_kmp\_register\_root() about the adjustment if}
967     \textcolor{comment}{// \_\_kmp\_threads[0] == NULL.}
968     \textcolor{comment}{//}
969     capacity = \hyperlink{kmp_8h_acae0af8cf6e8a8367b389986b372ab0a}{\_\_kmp\_threads\_capacity};
970     \textcolor{keywordflow}{if} ( \hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(\hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[0]) == NULL ) \{
971         --capacity;
972     \}
973     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + new\_nthreads - ( root->r.r\_active ? 1 :
974       root->r.r\_hot\_team->t.t\_nproc ) > capacity ) \{
975         \textcolor{comment}{//}
976         \textcolor{comment}{// Expand the threads array.}
977         \textcolor{comment}{//}
978         \textcolor{keywordtype}{int} slotsRequired = \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} + new\_nthreads - ( root->r.r\_active ? 1 :
979           root->r.r\_hot\_team->t.t\_nproc ) - capacity;
980         \textcolor{keywordtype}{int} slotsAdded = \hyperlink{kmp__runtime_8c_a393e842afa40d6cd0bd01d36e27e40c9}{\_\_kmp\_expand\_threads}(slotsRequired, slotsRequired);
981         \textcolor{keywordflow}{if} ( slotsAdded < slotsRequired ) \{
982             \textcolor{comment}{//}
983             \textcolor{comment}{// The threads array was not expanded enough.}
984             \textcolor{comment}{//}
985             new\_nthreads -= ( slotsRequired - slotsAdded );
986             \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( new\_nthreads >= 1 );
987 
988             \textcolor{comment}{//}
989             \textcolor{comment}{// If dyn-var is false, emit a 1-time warning.}
990             \textcolor{comment}{//}
991             \textcolor{keywordflow}{if} ( ! \hyperlink{kmp_8h_a04c626ef439f6a5a608307842f2283f4}{get\_\_dynamic\_2}( parent\_team, master\_tid )
992               && ( ! \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} ) ) \{
993                 \hyperlink{kmp_8h_a7467cd4fe436813f2f8b023ad137e384}{\_\_kmp\_reserve\_warn} = 1;
994                 \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a644251d4c84b1f4f3e9e40b666ea0de5}{\_\_kmp\_tp\_cached} ) \{
995                     \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
996                         \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
997                         \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantFormThrTeam, set\_nthreads, new\_nthreads ),
998                         \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( Set\_ALL\_THREADPRIVATE, \hyperlink{kmp_8h_aaab3768311811ffdcd85f5a55bef2318}{\_\_kmp\_tp\_capacity} ),
999                         \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( PossibleSystemLimitOnThreads ),
1000                         \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
1001                     );
1002                 \}
1003                 \textcolor{keywordflow}{else} \{
1004                     \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
1005                         \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
1006                         \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( CantFormThrTeam, set\_nthreads, new\_nthreads ),
1007                         \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( SystemLimitOnThreads ),
1008                         \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
1009                     );
1010                 \}
1011             \}
1012         \}
1013     \}
1014 
1015     \textcolor{keywordflow}{if} ( new\_nthreads == 1 ) \{
1016         \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d serializing team after reclaiming dead roots
       and rechecking; requested %d threads\(\backslash\)n"},
1017                         \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), set\_nthreads ) );
1018         \textcolor{keywordflow}{return} 1;
1019     \}
1020 
1021     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_reserve\_threads: T#%d allocating %d threads; requested %d threads\(\backslash\)n"},
1022                     \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}(), new\_nthreads, set\_nthreads ));
1023     \textcolor{keywordflow}{return} new\_nthreads;
1024 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a81d484eadddec5aa9fb9e84cac63ca72}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root}}
\index{\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root@{\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-reset\-\_\-root}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf int} \-\_\-\-\_\-kmp\-\_\-reset\-\_\-root (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-root\-\_\-t} $\ast$}]{root}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a81d484eadddec5aa9fb9e84cac63ca72}


Definition at line 3893 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread().


\begin{DoxyCode}
3894 \{
3895     \hyperlink{unionkmp__team}{kmp\_team\_t} * root\_team = root->r.r\_root\_team;
3896     \hyperlink{unionkmp__team}{kmp\_team\_t} * hot\_team  = root->r.r\_hot\_team;
3897     \textcolor{keywordtype}{int}          n         = hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc;
3898     \textcolor{keywordtype}{int} \hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i};
3899 
3900     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( ! root->r.r\_active );
3901 
3902     root->r.r\_root\_team = NULL;
3903     root->r.r\_hot\_team  = NULL;
3904         \textcolor{comment}{// \_\_kmp\_free\_team() does not free hot teams, so we have to clear r\_hot\_team before call}
3905         \textcolor{comment}{// to \_\_kmp\_free\_team().}
3906     \hyperlink{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\_\_kmp\_free\_team}( root, root\_team \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
3907 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
3908 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( \_\_kmp\_hot\_teams\_max\_level > 1 ) \{  \textcolor{comment}{// need to free nested hot teams and their threads if any}
3909         \textcolor{keywordflow}{for}( i = 0; i < hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; ++\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i} ) \{
3910             \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *th = hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[\hyperlink{kmp__stub_8c_a08582ce460e3d5e1cf0b7fea017d608e}{i}];
3911             n += \_\_kmp\_free\_hot\_teams( root, th, 1, \_\_kmp\_hot\_teams\_max\_level );
3912             \textcolor{keywordflow}{if}( th->th.th\_hot\_teams ) \{
3913                 \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( th->th.th\_hot\_teams );
3914                 th->th.th\_hot\_teams = NULL;
3915             \}
3916         \}
3917     \}
3918 \textcolor{preprocessor}{#endif}
3919 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a39350b00fc9cb22776fc9af3112198ec}{\_\_kmp\_free\_team}( root, hot\_team \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
3920 
3921     \textcolor{comment}{//}
3922     \textcolor{comment}{// Before we can reap the thread, we need to make certain that all}
3923     \textcolor{comment}{// other threads in the teams that had this root as ancestor have stopped trying to steal tasks.}
3924     \textcolor{comment}{//}
3925     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
3926         \hyperlink{kmp_8h_a2ba40a9ae9c2993a034826efe186f41c}{\_\_kmp\_wait\_to\_unref\_task\_teams}();
3927     \}
3928 
3929 \textcolor{preprocessor}{    #if KMP\_OS\_WINDOWS}
3930 \textcolor{preprocessor}{}        \textcolor{comment}{/* Close Handle of root duplicated in \_\_kmp\_create\_worker (tr #62919) */}
3931         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_reset\_root: free handle, th = %p, handle = %"} 
      \hyperlink{kmp__os_8h_a716dd0090b3c62cb5a8203b27846585e}{KMP\_UINTPTR\_SPEC} \textcolor{stringliteral}{"\(\backslash\)n"},
3932             (LPVOID)&(root->r.r\_uber\_thread->th),
3933             root->r.r\_uber\_thread->th.th\_info.ds.ds\_thread ) );
3934         \hyperlink{z__Windows__NT__util_8c_a0603ae87485cdde7a3a054e585f324fd}{\_\_kmp\_free\_handle}( root->r.r\_uber\_thread->th.th\_info.ds.ds\_thread );
3935 \textcolor{preprocessor}{    #endif }\textcolor{comment}{/* KMP\_OS\_WINDOWS */}\textcolor{preprocessor}{}
3936 \textcolor{preprocessor}{}
3937 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
3938 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled} &&
3939         \hyperlink{ompt-general_8c_a84a29d89cef82c7c38e1ee1f70ec994f}{ompt\_callbacks}.ompt\_callback(ompt\_event\_thread\_end)) \{
3940         \textcolor{keywordtype}{int} gtid = \hyperlink{kmp_8h_ad9b4e1a8a911f57a29a75f7536e5200c}{\_\_kmp\_get\_gtid}();
3941         \hyperlink{ompt-specific_8c_a6df3ac9845bff98373f885b319bc2e38}{\_\_ompt\_thread\_end}(ompt\_thread\_initial, gtid);
3942     \}
3943 \textcolor{preprocessor}{#endif}
3944 \textcolor{preprocessor}{}
3945     \hyperlink{kmp__os_8h_ae67779cc7794b5dd7eee4c7f2c7789d4}{TCW\_4}(\hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth}, \hyperlink{kmp_8h_a774ce85ac109df119feaca45ed4e69b1}{\_\_kmp\_nth} - 1); \textcolor{comment}{// \_\_kmp\_reap\_thread will decrement
       \_\_kmp\_all\_nth.}
3946     \hyperlink{kmp__runtime_8c_a8dcaceda5809cef836f90d78710e7bed}{\_\_kmp\_reap\_thread}( root->r.r\_uber\_thread, 1 );
3947 
3948         \textcolor{comment}{// We canot put root thread to \_\_kmp\_thread\_pool, so we have to reap it istead of freeing.}
3949     root->r.r\_uber\_thread = NULL;
3950     \textcolor{comment}{/* mark root as no longer in use */}
3951     root->r.r\_begin = \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
3952 
3953     \textcolor{keywordflow}{return} n;
3954 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a99118650304b0dbf1c8fc131d3a60d5f}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task@{\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task}}
\index{\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task@{\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-run\-\_\-after\-\_\-invoked\-\_\-task (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{tid, }
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{this\-\_\-thr, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a99118650304b0dbf1c8fc131d3a60d5f}


Definition at line 6836 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func(), \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-E\-N\-D().


\begin{DoxyCode}
6838 \{
6839     \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
6840         \hyperlink{kmp__error_8c_aef349dfa99115c3307bff95369f1a813}{\_\_kmp\_pop\_parallel}( gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident );
6841 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a2b2e7087eea1ede7973094294abaac82}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task@{\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task}}
\index{\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task@{\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-run\-\_\-before\-\_\-invoked\-\_\-task (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{tid, }
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{this\-\_\-thr, }
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a2b2e7087eea1ede7973094294abaac82}


Definition at line 6808 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-\-G\-O\-M\-P\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-task\-\_\-func(), and \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master().


\begin{DoxyCode}
6810 \{
6811     \hyperlink{structkmp__disp}{kmp\_disp\_t} *dispatch;
6812 
6813     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
6814 
6815     \textcolor{comment}{/* none of the threads have encountered any constructs, yet. */}
6816     this\_thr->th.th\_local.this\_construct = 0;
6817 \textcolor{preprocessor}{#if KMP\_CACHE\_MANAGE}
6818 \textcolor{preprocessor}{}    \hyperlink{kmp__os_8h_a936407f18975a175fbff4bddca4ff389}{KMP\_CACHE\_PREFETCH}( &this\_thr->th.th\_bar[ 
      \hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier} ].bb.b\_arrived );
6819 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_CACHE\_MANAGE */}\textcolor{preprocessor}{}
6820 \textcolor{preprocessor}{}    dispatch = (\hyperlink{structkmp__disp}{kmp\_disp\_t} *)\hyperlink{kmp__os_8h_a6e40f65c18c7b47fb612607b9bf8fdfc}{TCR\_PTR}(this\_thr->th.th\_dispatch);
6821     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( dispatch );
6822     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch );
6823     \textcolor{comment}{//KMP\_DEBUG\_ASSERT( this\_thr->th.th\_dispatch == &team->t.t\_dispatch[ this\_thr->th.th\_info.ds.ds\_tid ]
       );}
6824 
6825     dispatch->\hyperlink{structkmp__disp_a160f4b28144ce1cb64ccf0ceb9ad9ffc}{th\_disp\_index} = 0;    \textcolor{comment}{/* reset the dispatch buffer counter */}
6826 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
6827 \textcolor{preprocessor}{}    dispatch->th\_doacross\_buf\_idx = 0; \textcolor{comment}{/* reset the doacross dispatch buffer counter */}
6828 \textcolor{preprocessor}{#endif}
6829 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if}( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
6830         \hyperlink{kmp__error_8c_a44b2bd6b8bdee19190ed64f737be4444}{\_\_kmp\_push\_parallel}( gtid, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident );
6831 
6832     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();       \textcolor{comment}{/* Flush all pending memory write invalidates.  */}
6833 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls@{\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls}}
\index{\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls@{\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-save\-\_\-internal\-\_\-controls (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-info\-\_\-t} $\ast$}]{thread}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}


Definition at line 2560 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-blocktime(), \-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels(), \-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads(), \-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-D\-Y\-N\-A\-M\-I\-C(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-N\-E\-S\-T\-E\-D(), ompc\-\_\-set\-\_\-dynamic(), and ompc\-\_\-set\-\_\-nested().


\begin{DoxyCode}
2561 \{
2562 
2563     \textcolor{keywordflow}{if} ( thread->th.th\_team != thread->th.th\_serial\_team ) \{
2564         \textcolor{keywordflow}{return};
2565     \}
2566     \textcolor{keywordflow}{if} (thread->th.th\_team->t.t\_serialized > 1) \{
2567         \textcolor{keywordtype}{int} push = 0;
2568 
2569         \textcolor{keywordflow}{if} (thread->th.th\_team->t.t\_control\_stack\_top == NULL) \{
2570             push = 1;
2571         \} \textcolor{keywordflow}{else} \{
2572             \textcolor{keywordflow}{if} ( thread->th.th\_team->t.t\_control\_stack\_top->serial\_nesting\_level !=
2573                  thread->th.th\_team->t.t\_serialized ) \{
2574                 push = 1;
2575             \}
2576         \}
2577         \textcolor{keywordflow}{if} (push) \{  \textcolor{comment}{/* push a record on the serial team's stack */}
2578             \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} * control = (
      \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} *) \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}(\textcolor{keyword}{sizeof}(
      \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t}));
2579 
2580             \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}( control, & thread->th.th\_current\_task->td\_icvs );
2581 
2582             control->\hyperlink{structkmp__internal__control_aace7f1175db32707e8ad500ed5aea229}{serial\_nesting\_level} = thread->th.th\_team->t.t\_serialized;
2583 
2584             control->\hyperlink{structkmp__internal__control_a4860e215a4af81a65d3441cdf8b2fd97}{next} = thread->th.th\_team->t.t\_control\_stack\_top;
2585             thread->th.th\_team->t.t\_control\_stack\_top = control;
2586         \}
2587     \}
2588 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_adc4261d970464abd5acafefe3a030132}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize}}
\index{\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize@{\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-serial\-\_\-initialize (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_adc4261d970464abd5acafefe3a030132}


Definition at line 6592 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-defaults(), \-\_\-\-\_\-kmp\-\_\-aux\-\_\-set\-\_\-stacksize(), \-\_\-\-\_\-kmp\-\_\-runtime\-\_\-initialize(), \-\_\-\-\_\-kmpc\-\_\-place\-\_\-threads(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-C\-A\-N\-C\-E\-L\-L\-A\-T\-I\-O\-N(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-L\-I\-B\-R\-A\-R\-Y(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-N\-U\-M\-\_\-\-K\-N\-O\-W\-N\-\_\-\-T\-H\-R\-E\-A\-D\-S(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-S\-T\-A\-C\-K\-S\-I\-Z\-E(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-S\-T\-A\-C\-K\-S\-I\-Z\-E\-\_\-\-S(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-L\-I\-M\-I\-T(), F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-W\-T\-I\-C\-K(), and F\-T\-N\-\_\-\-G\-E\-T\-\_\-\-W\-T\-I\-M\-E().


\begin{DoxyCode}
6593 \{
6594     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
6595         \textcolor{keywordflow}{return};
6596     \}
6597     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6598     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
6599         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6600         \textcolor{keywordflow}{return};
6601     \}
6602     \hyperlink{kmp__runtime_8c_ae9c17fb97e88460cb1bf8c134a0e79a9}{\_\_kmp\_do\_serial\_initialize}();
6603     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &\hyperlink{kmp_8h_a0e6256b159476ca7409660e01d49b556}{\_\_kmp\_initz\_lock} );
6604 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_ae1639202a88bd6e0f3b55e7150e5450b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel}}
\index{\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-serialized\-\_\-parallel (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_ae1639202a88bd6e0f3b55e7150e5450b}


Definition at line 1212 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-\-G\-O\-M\-P\-\_\-serialized\-\_\-parallel(), and \-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel().


\begin{DoxyCode}
1213 \{
1214     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr;
1215     \hyperlink{unionkmp__team}{kmp\_team\_t} *serial\_team;
1216 
1217     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: called by T#%d\(\backslash\)n"}, global\_tid ) );
1218 
1219     \textcolor{comment}{/* Skip all this code for autopar serialized loops since it results in}
1220 \textcolor{comment}{       unacceptable overhead */}
1221     \textcolor{keywordflow}{if}( loc != NULL && (loc->\hyperlink{structident_afa1ec17df36c4bf1e36e97eab63953b9}{flags} & \hyperlink{group__BASIC__TYPES_ga744ef043bd848d5e338b4c72ef247adc}{KMP\_IDENT\_AUTOPAR} ) )
1222         \textcolor{keywordflow}{return};
1223 
1224     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel} ) )
1225         \hyperlink{kmp__runtime_8c_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
1226 
1227     this\_thr     = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ global\_tid ];
1228     serial\_team  = this\_thr->th.th\_serial\_team;
1229 
1230     \textcolor{comment}{/* utilize the serialized team held by this thread */}
1231     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team );
1232     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1233 
1234     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
1235         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr->th.th\_task\_team == this\_thr->th.th\_team->t.t\_task\_team[
      this\_thr->th.th\_task\_state]);
1236         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_task\_team[this\_thr->th.th\_task\_state] == NULL )
      ;
1237         \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: T#%d pushing task\_team %p / team %p, new
       task\_team = NULL\(\backslash\)n"},
1238                         global\_tid, this\_thr->th.th\_task\_team, this\_thr->th.th\_team ) );
1239         this\_thr->th.th\_task\_team = NULL;
1240     \}
1241 
1242 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1243 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241}{kmp\_proc\_bind\_t} proc\_bind = this\_thr->th.th\_set\_proc\_bind;
1244     \textcolor{keywordflow}{if} ( this\_thr->th.th\_current\_task->td\_icvs.proc\_bind == \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a26efad2e13ae31e934f83c4d9a6ceb99}{proc\_bind\_false} ) \{
1245         proc\_bind = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241a26efad2e13ae31e934f83c4d9a6ceb99}{proc\_bind\_false};
1246     \}
1247     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( proc\_bind == \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default} ) \{
1248         \textcolor{comment}{//}
1249         \textcolor{comment}{// No proc\_bind clause was specified, so use the current value}
1250         \textcolor{comment}{// of proc-bind-var for this parallel region.}
1251         \textcolor{comment}{//}
1252         proc\_bind = this\_thr->th.th\_current\_task->td\_icvs.proc\_bind;
1253     \}
1254     \textcolor{comment}{//}
1255     \textcolor{comment}{// Reset for next parallel region}
1256     \textcolor{comment}{//}
1257     this\_thr->th.th\_set\_proc\_bind = \hyperlink{kmp_8h_ae587debf3f0331e4f824daa05f47a241af8d3acedea79a51c882ffafbe7a42442}{proc\_bind\_default};
1258 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1259 \textcolor{preprocessor}{}
1260     \textcolor{keywordflow}{if}( this\_thr->th.th\_team != serial\_team ) \{
1261         \textcolor{comment}{// Nested level will be an index in the nested nthreads array}
1262         \textcolor{keywordtype}{int} level = this\_thr->th.th\_team->t.t\_level;
1263 
1264         \textcolor{keywordflow}{if}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized ) \{
1265             \textcolor{comment}{/* this serial team was already used}
1266 \textcolor{comment}{             * TODO increase performance by making this locks more specific */}
1267             \hyperlink{unionkmp__team}{kmp\_team\_t} *new\_team;
1268 
1269             \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
1270 
1271 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1272 \textcolor{preprocessor}{}            ompt\_parallel\_id\_t ompt\_parallel\_id = \hyperlink{ompt-specific_8c_a541d97d3f1e1d09a459326dd60c630ce}{\_\_ompt\_parallel\_id\_new}(global\_tid);
1273 \textcolor{preprocessor}{#endif}
1274 \textcolor{preprocessor}{}
1275             new\_team = \hyperlink{kmp__runtime_8c_a72794e1d1d04605235557ad5291faa26}{\_\_kmp\_allocate\_team}(this\_thr->th.th\_root, 1, 1,
1276 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
1277                                            ompt\_parallel\_id,
1278 #endif
1279 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
1280                                            proc\_bind,
1281 #endif
1282                                            & this\_thr->th.th\_current\_task->td\_icvs,
1283                                            0 \hyperlink{kmp_8h_ab3e2e42ffa2d2b5db652aba5ea0851e0}{USE\_NESTED\_HOT\_ARG}(NULL) );
1284             \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
1285             \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( new\_team );
1286 
1287             \textcolor{comment}{/* setup new serialized team and install it */}
1288             new\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0] = this\_thr;
1289             new\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent = this\_thr->th.th\_team;
1290             serial\_team = new\_team;
1291             this\_thr->th.th\_serial\_team = serial\_team;
1292 
1293             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: T#%d allocated new serial team %p\(\backslash\)n"},
1294                             global\_tid, serial\_team ) );
1295 
1296 
1297             \textcolor{comment}{/* TODO the above breaks the requirement that if we run out of}
1298 \textcolor{comment}{             * resources, then we can still guarantee that serialized teams}
1299 \textcolor{comment}{             * are ok, since we may need to allocate a new one */}
1300         \} \textcolor{keywordflow}{else} \{
1301             \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: T#%d reusing cached serial team %p\(\backslash\)n"},
1302                             global\_tid, serial\_team ) );
1303         \}
1304 
1305         \textcolor{comment}{/* we have to initialize this serial team */}
1306         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads );
1307         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0] == this\_thr );
1308         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_team != serial\_team );
1309         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident         = loc;
1310         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized    = 1;
1311         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc         = 1;
1312         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent        = this\_thr->th.th\_team;
1313         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_sched         = this\_thr->th.th\_team->t.t\_sched;
1314         this\_thr->th.th\_team           = serial\_team;
1315         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_master\_tid    = this\_thr->th.th\_info.ds.ds\_tid;
1316 
1317         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: T#d curtask=%p\(\backslash\)n"},
1318                         global\_tid, this\_thr->th.th\_current\_task ) );
1319         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( this\_thr->th.th\_current\_task->td\_flags.executing == 1 );
1320         this\_thr->th.th\_current\_task->td\_flags.executing = 0;
1321 
1322         \hyperlink{kmp_8h_acbb44e4a3167875a9a9d4b5eca8fb3d8}{\_\_kmp\_push\_current\_task\_to\_thread}( this\_thr, serial\_team, 0 );
1323 
1324         \textcolor{comment}{/* TODO: GEH: do the ICVs work for nested serialized teams?  Don't we need an implicit task for}
1325 \textcolor{comment}{           each serialized task represented by team->t.t\_serialized? */}
1326         \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}(
1327                   & this\_thr->th.th\_current\_task->td\_icvs,
1328                   & this\_thr->th.th\_current\_task->td\_parent->td\_icvs );
1329 
1330         \textcolor{comment}{// Thread value exists in the nested nthreads array for the next nested level}
1331         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} && ( level + 1 < 
      \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} ) ) \{
1332             this\_thr->th.th\_current\_task->td\_icvs.nproc = \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.
      \hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[ level + 1 ];
1333         \}
1334 
1335 \textcolor{preprocessor}{#if OMP\_40\_ENABLED}
1336 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a4ab1e74b13e91c54a0ff105c9d7db9f6}{used} && ( level + 1 < 
      \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a4ab1e74b13e91c54a0ff105c9d7db9f6}{used} ) ) \{
1337             this\_thr->th.th\_current\_task->td\_icvs.proc\_bind
1338                 = \hyperlink{kmp_8h_a47bc631a510ddd8aa5b20d3525499a4a}{\_\_kmp\_nested\_proc\_bind}.\hyperlink{structkmp__nested__proc__bind__t_a9dd5b54da2cd6bdcf6b056cb3593dbe2}{bind\_types}[ level + 1 ];
1339         \}
1340 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* OMP\_40\_ENABLED */}\textcolor{preprocessor}{}
1341 \textcolor{preprocessor}{}
1342 \textcolor{preprocessor}{#if USE\_DEBUGGER}
1343 \textcolor{preprocessor}{}        serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_pkfn = (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})( ~0 ); \textcolor{comment}{// For the debugger.}
1344 \textcolor{preprocessor}{#endif}
1345 \textcolor{preprocessor}{}        this\_thr->th.th\_info.ds.ds\_tid = 0;
1346 
1347         \textcolor{comment}{/* set thread cache values */}
1348         this\_thr->th.th\_team\_nproc     = 1;
1349         this\_thr->th.th\_team\_master    = this\_thr;
1350         this\_thr->th.th\_team\_serialized = 1;
1351 
1352         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level        = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent->t.t\_level + 1;
1353         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_active\_level = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_parent->t.t\_active\_level;
1354 
1355         \hyperlink{kmp__runtime_8c_a1fe9d72aca3be52b82f7ddba504a6def}{propagateFPControl} (serial\_team);
1356 
1357         \textcolor{comment}{/* check if we need to allocate dispatch buffers stack */}
1358         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch);
1359         \textcolor{keywordflow}{if} ( !serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer ) \{
1360             serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer = (
      \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} *)
1361                 \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}( \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} ) );
1362         \}
1363         this\_thr->th.th\_dispatch = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch;
1364 
1365 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
1366 \textcolor{preprocessor}{}        ompt\_parallel\_id\_t ompt\_parallel\_id = \hyperlink{ompt-specific_8c_a541d97d3f1e1d09a459326dd60c630ce}{\_\_ompt\_parallel\_id\_new}(global\_tid);
1367         \hyperlink{ompt-specific_8c_a42b74b829cdbf17b033acb9f5e2cdd2b}{\_\_ompt\_team\_assign\_id}(serial\_team, ompt\_parallel\_id);
1368 \textcolor{preprocessor}{#endif}
1369 \textcolor{preprocessor}{}
1370         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1371 
1372     \} \textcolor{keywordflow}{else} \{
1373         \textcolor{comment}{/* this serialized team is already being used,}
1374 \textcolor{comment}{         * that's fine, just add another nested level */}
1375         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr->th.th\_team == serial\_team );
1376         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads );
1377         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0] == this\_thr );
1378         ++ serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
1379         this\_thr->th.th\_team\_serialized = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_serialized;
1380 
1381         \textcolor{comment}{// Nested level will be an index in the nested nthreads array}
1382         \textcolor{keywordtype}{int} level = this\_thr->th.th\_team->t.t\_level;
1383         \textcolor{comment}{// Thread value exists in the nested nthreads array for the next nested level}
1384         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} && ( level + 1 < 
      \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.\hyperlink{structkmp__nested__nthreads__t_aa7837e3819e8a02eb1fafcc4ff890939}{used} ) ) \{
1385             this\_thr->th.th\_current\_task->td\_icvs.nproc = \hyperlink{kmp_8h_a4bb4b8763f9bcb453e89051a1580b77e}{\_\_kmp\_nested\_nth}.
      \hyperlink{structkmp__nested__nthreads__t_acea2450edad467092ec428717c924ae3}{nth}[ level + 1 ];
1386         \}
1387         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level++;
1388         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmpc\_serialized\_parallel: T#%d increasing nesting level of serial team
       %p to %d\(\backslash\)n"},
1389                         global\_tid, serial\_team, serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level ) );
1390 
1391         \textcolor{comment}{/* allocate/push dispatch buffers stack */}
1392         \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch);
1393         \{
1394             \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} * disp\_buffer = (
      \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} *)
1395                 \hyperlink{kmp_8h_aa6a69b47037dcffbfc5dba21a4a64d85}{\_\_kmp\_allocate}( \textcolor{keyword}{sizeof}( \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} ) );
1396             disp\_buffer->next = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer;
1397             serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer = disp\_buffer;
1398         \}
1399         this\_thr->th.th\_dispatch = serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch;
1400 
1401         \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
1402     \}
1403 
1404     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
1405         \hyperlink{kmp__error_8c_a44b2bd6b8bdee19190ed64f737be4444}{\_\_kmp\_push\_parallel}( global\_tid, NULL );
1406 
1407 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
1408 \textcolor{preprocessor}{}    \textcolor{comment}{// Mark the start of the "parallel" region for VTune. Only use one of frame notification scheme at the
       moment}
1409     \textcolor{keywordflow}{if} ( serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_level == 1
1410 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
1411         && this\_thr->th.th\_teams\_microtask == NULL
1412 #endif
1413     ) \{
1414 \textcolor{preprocessor}{#if USE\_ITT\_NOTIFY}
1415 \textcolor{preprocessor}{}        \textcolor{comment}{// Save the start of the "parallel" region for VTune. This is the frame begin at the same time.}
1416         \textcolor{keywordflow}{if} ( ( \_\_itt\_get\_timestamp\_ptr || KMP\_ITT\_DEBUG ) &&
1417             ( \_\_kmp\_forkjoin\_frames\_mode == 3 || \_\_kmp\_forkjoin\_frames\_mode == 1 ) )
1418         \{
1419              serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_region\_time = this\_thr->th.th\_frame\_time\_serialized = \_\_itt\_get\_timestamp();
1420         \} \textcolor{keywordflow}{else} \textcolor{comment}{// only one notification scheme (either "submit" or "forking/joined", not both)}
1421 \textcolor{preprocessor}{#endif}
1422 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_begin\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
1423              \_\_kmp\_forkjoin\_frames && ! \_\_kmp\_forkjoin\_frames\_mode )
1424         \{
1425             this\_thr->th.th\_ident = loc;
1426             \textcolor{comment}{// 0 - no barriers; 1 - serialized parallel}
1427             \_\_kmp\_itt\_region\_forking( global\_tid, this\_thr->th.th\_team\_nproc, 0, 1 );
1428         \}
1429     \}
1430 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
1431 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3a7126ad63b8b98e9bc45447f87f716e}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels}}
\index{\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-set\-\_\-max\-\_\-active\-\_\-levels (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf int}}]{max\-\_\-active\-\_\-levels}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3a7126ad63b8b98e9bc45447f87f716e}


Definition at line 2663 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-M\-A\-X\-\_\-\-A\-C\-T\-I\-V\-E\-\_\-\-L\-E\-V\-E\-L\-S(), and ompc\-\_\-set\-\_\-max\-\_\-active\-\_\-levels().


\begin{DoxyCode}
2664 \{
2665     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread;
2666 
2667     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_set\_max\_active\_levels: new max\_active\_levels for thread %d = (%d)\(\backslash\)n"}, 
      gtid, max\_active\_levels ) );
2668     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2669 
2670     \textcolor{comment}{// validate max\_active\_levels}
2671     \textcolor{keywordflow}{if}( max\_active\_levels < 0 ) \{
2672         \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ActiveLevelsNegative, max\_active\_levels );
2673         \textcolor{comment}{// We ignore this call if the user has specified a negative value.}
2674         \textcolor{comment}{// The current setting won't be changed. The last valid setting will be used.}
2675         \textcolor{comment}{// A warning will be issued (if warnings are allowed as controlled by the KMP\_WARNINGS env var).}
2676         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_set\_max\_active\_levels: the call is ignored: new max\_active\_levels
       for thread %d = (%d)\(\backslash\)n"}, gtid, max\_active\_levels ) );
2677         \textcolor{keywordflow}{return};
2678     \}
2679     \textcolor{keywordflow}{if}( max\_active\_levels <= \hyperlink{kmp_8h_af28f3dc11a5e484f732177a048fbecc9}{KMP\_MAX\_ACTIVE\_LEVELS\_LIMIT} ) \{
2680         \textcolor{comment}{// it's OK, the max\_active\_levels is within the valid range: [ 0; KMP\_MAX\_ACTIVE\_LEVELS\_LIMIT ]}
2681         \textcolor{comment}{// We allow a zero value. (implementation defined behavior)}
2682     \} \textcolor{keywordflow}{else} \{
2683         \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( ActiveLevelsExceedLimit, max\_active\_levels, 
      \hyperlink{kmp_8h_af28f3dc11a5e484f732177a048fbecc9}{KMP\_MAX\_ACTIVE\_LEVELS\_LIMIT}  );
2684         max\_active\_levels = \hyperlink{kmp_8h_af28f3dc11a5e484f732177a048fbecc9}{KMP\_MAX\_ACTIVE\_LEVELS\_LIMIT};
2685         \textcolor{comment}{// Current upper limit is MAX\_INT. (implementation defined behavior)}
2686         \textcolor{comment}{// If the input exceeds the upper limit, we correct the input to be the upper limit.
       (implementation defined behavior)}
2687         \textcolor{comment}{// Actually, the flow should never get here until we use MAX\_INT limit.}
2688     \}
2689     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, ( \textcolor{stringliteral}{"\_\_kmp\_set\_max\_active\_levels: after validation: new max\_active\_levels for
       thread %d = (%d)\(\backslash\)n"}, gtid, max\_active\_levels ) );
2690 
2691     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2692 
2693     \hyperlink{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\_\_kmp\_save\_internal\_controls}( thread );
2694 
2695     \hyperlink{kmp_8h_a974fcdf0c24f4b6b48a055b519cf465a}{set\_\_max\_active\_levels}( thread, max\_active\_levels );
2696 
2697 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a7120d169a8fbd79e5140bfa0b2d93a3b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads}}
\index{\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-set\-\_\-num\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{new\-\_\-nth, }
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a7120d169a8fbd79e5140bfa0b2d93a3b}


Definition at line 2592 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-N\-U\-M\-\_\-\-T\-H\-R\-E\-A\-D\-S(), and ompc\-\_\-set\-\_\-num\-\_\-threads().


\begin{DoxyCode}
2593 \{
2594     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread;
2595     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} *root;
2596 
2597     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_set\_num\_threads: new \_\_kmp\_nth = %d\(\backslash\)n"}, new\_nth ));
2598     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2599 
2600     \textcolor{keywordflow}{if} (new\_nth < 1)
2601         new\_nth = 1;
2602     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (new\_nth > \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth})
2603         new\_nth = \hyperlink{kmp_8h_a4d084c7a33d676bae3980e69345e8adf}{\_\_kmp\_max\_nth};
2604 
2605     \hyperlink{group__STATS__GATHERING_ga7691000a7864b475046ae62fcf0536ac}{KMP\_COUNT\_VALUE}(OMP\_set\_numthreads, new\_nth);
2606     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
2607 
2608     \hyperlink{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\_\_kmp\_save\_internal\_controls}( thread );
2609 
2610     \hyperlink{kmp_8h_a528ef662aebf927aa7e586d2ea70bb04}{set\_\_nproc}( thread, new\_nth );
2611 
2612     \textcolor{comment}{//}
2613     \textcolor{comment}{// If this omp\_set\_num\_threads() call will cause the hot team size to be}
2614     \textcolor{comment}{// reduced (in the absence of a num\_threads clause), then reduce it now,}
2615     \textcolor{comment}{// rather than waiting for the next parallel region.}
2616     \textcolor{comment}{//}
2617     root = thread->th.th\_root;
2618     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel} && ( ! root->r.r\_active )
2619       && ( root->r.r\_hot\_team->t.t\_nproc > new\_nth )
2620 #\textcolor{keywordflow}{if} \hyperlink{kmp_8h_a739529c023a72ce5fc558f33b0a6f634}{KMP\_NESTED\_HOT\_TEAMS}
2621       && \_\_kmp\_hot\_teams\_max\_level && !\_\_kmp\_hot\_teams\_mode
2622 #endif
2623     ) \{
2624         \hyperlink{unionkmp__team}{kmp\_team\_t} *hot\_team = root->r.r\_hot\_team;
2625         \textcolor{keywordtype}{int} f;
2626 
2627         \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
2628 
2629         \textcolor{comment}{// Release the extra threads we don't need any more.}
2630         \textcolor{keywordflow}{for} ( f = new\_nth;  f < hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc; f++ ) \{
2631             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] != NULL );
2632             \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec}) \{
2633                 \textcolor{comment}{// When decreasing team size, threads no longer in the team should unref task team.}
2634                 hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_task\_team = NULL;
2635             \}
2636             \hyperlink{kmp__runtime_8c_ac3ad8410f1b481e3980bdfd0cbac751c}{\_\_kmp\_free\_thread}( hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] );
2637             hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] =  NULL;
2638         \}
2639         hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_nproc = new\_nth;
2640 \textcolor{preprocessor}{#if KMP\_NESTED\_HOT\_TEAMS}
2641 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if}( thread->th.th\_hot\_teams ) \{
2642             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( hot\_team == thread->th.th\_hot\_teams[0].hot\_team );
2643             thread->th.th\_hot\_teams[0].hot\_team\_nth = new\_nth;
2644         \}
2645 \textcolor{preprocessor}{#endif}
2646 \textcolor{preprocessor}{}
2647         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
2648 
2649         \textcolor{comment}{//}
2650         \textcolor{comment}{// Update the t\_nproc field in the threads that are still active.}
2651         \textcolor{comment}{//}
2652         \textcolor{keywordflow}{for}( f=0 ; f < new\_nth; f++ ) \{
2653             \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f] != NULL );
2654             hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f]->th.th\_team\_nproc = new\_nth;
2655         \}
2656         \textcolor{comment}{// Special flag in case omp\_set\_num\_threads() call}
2657         hot\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_size\_changed = -1;
2658     \}
2659 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a06b2a0a58f3c86172b40ee9144b698c8}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule}}
\index{\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule@{\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-set\-\_\-schedule (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid, }
\item[{{\bf kmp\-\_\-sched\-\_\-t}}]{kind, }
\item[{{\bf int}}]{chunk}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a06b2a0a58f3c86172b40ee9144b698c8}


Definition at line 2717 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-S\-C\-H\-E\-D\-U\-L\-E(), and ompc\-\_\-set\-\_\-schedule().


\begin{DoxyCode}
2718 \{
2719     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread;
2720 \textcolor{comment}{//    kmp\_team\_t *team;}
2721 
2722     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_set\_schedule: new schedule for thread %d = (%d, %d)\(\backslash\)n"}, gtid, (\textcolor{keywordtype}{int})kind, 
      chunk ));
2723     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} );
2724 
2725     \textcolor{comment}{// Check if the kind parameter is valid, correct if needed.}
2726     \textcolor{comment}{// Valid parameters should fit in one of two intervals - standard or extended:}
2727     \textcolor{comment}{//       <lower>, <valid>, <upper\_std>, <lower\_ext>, <valid>, <upper>}
2728     \textcolor{comment}{// 2008-01-25: 0,  1 - 4,       5,         100,     101 - 102, 103}
2729     \textcolor{keywordflow}{if} ( kind <= kmp\_sched\_lower || kind >= \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a0fc3032f6ec554a40e86e24849c2a5f5}{kmp\_sched\_upper} ||
2730        ( kind <= kmp\_sched\_lower\_ext && kind >= \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a301ce7173fe03762194df14262323de7}{kmp\_sched\_upper\_std} ) )
2731     \{
2732         \textcolor{comment}{// TODO: Hint needs attention in case we change the default schedule.}
2733         \hyperlink{kmp__i18n_8c_adeba56c5fec6ef3d5a6eae2c8785dd01}{\_\_kmp\_msg}(
2734             \hyperlink{kmp__i18n_8h_a7c4bb6100d3330d1491644b331ed8060af43a3e02113c5b36d94c603bad0cd807}{kmp\_ms\_warning},
2735             \hyperlink{kmp__i18n_8h_a6e819105ffc76141b666a1c784e6b5ab}{KMP\_MSG}( ScheduleKindOutOfRange, kind ),
2736             \hyperlink{kmp__i18n_8h_ac5fe3f32cfaa3b9268776d372a0f09c4}{KMP\_HNT}( DefaultScheduleKindUsed, \textcolor{stringliteral}{"static, no chunk"} ),
2737             \hyperlink{kmp__i18n_8c_a4b36bb61ac53271694e7e36bd166a600}{\_\_kmp\_msg\_null}
2738         );
2739         kind = \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a9d7098449a8c3534d6b7bddd31302dbe}{kmp\_sched\_default};
2740         chunk = 0;         \textcolor{comment}{// ignore chunk value in case of bad kind}
2741     \}
2742 
2743     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
2744 
2745     \hyperlink{kmp__runtime_8c_acf1e2ef819ba73965651e8bb56462750}{\_\_kmp\_save\_internal\_controls}( thread );
2746 
2747     \textcolor{keywordflow}{if} ( kind < \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a301ce7173fe03762194df14262323de7}{kmp\_sched\_upper\_std} ) \{
2748         \textcolor{keywordflow}{if} ( kind == \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3af458bf7281ae12d9fdc486be35239fe4}{kmp\_sched\_static} && chunk < 
      \hyperlink{kmp_8h_a0b753aac7a3d6af072f31243cdab6d5f}{KMP\_DEFAULT\_CHUNK} ) \{
2749             \textcolor{comment}{// differ static chunked vs. unchunked:}
2750             \textcolor{comment}{// chunk should be invalid to indicate unchunked schedule (which is the default)}
2751             thread->th.th\_current\_task->td\_icvs.sched.r\_sched\_type = 
      \hyperlink{group__WORK__SHARING_ggadcaf200537aaa0218a60c398438f81bea2a987351b9605b918693a17d4dd90772}{kmp\_sch\_static};
2752         \} \textcolor{keywordflow}{else} \{
2753             thread->th.th\_current\_task->td\_icvs.sched.r\_sched\_type = 
      \hyperlink{kmp_8h_afc778719905155d9cde6395ca3fd80e7}{\_\_kmp\_sch\_map}[ kind - \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a223d28a39916e347a9036845fe68a9b6}{kmp\_sched\_lower} - 1 ];
2754         \}
2755     \} \textcolor{keywordflow}{else} \{
2756         \textcolor{comment}{//    \_\_kmp\_sch\_map[ kind - kmp\_sched\_lower\_ext + kmp\_sched\_upper\_std - kmp\_sched\_lower - 2 ];}
2757         thread->th.th\_current\_task->td\_icvs.sched.r\_sched\_type =
2758             \hyperlink{kmp_8h_afc778719905155d9cde6395ca3fd80e7}{\_\_kmp\_sch\_map}[ kind - \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a6be48ebc642e0d94eb4f501c40602ba7}{kmp\_sched\_lower\_ext} + 
      \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a301ce7173fe03762194df14262323de7}{kmp\_sched\_upper\_std} - \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a223d28a39916e347a9036845fe68a9b6}{kmp\_sched\_lower} - 2 ];
2759     \}
2760     \textcolor{keywordflow}{if} ( kind == \hyperlink{kmp_8h_ac150ec15d3fa59f49e4bf27425bc27c3a4f568012ad340035a9eb18b5e23fd91c}{kmp\_sched\_auto} ) \{
2761         \textcolor{comment}{// ignore parameter chunk for schedule auto}
2762         thread->th.th\_current\_task->td\_icvs.sched.chunk = \hyperlink{kmp_8h_a0b753aac7a3d6af072f31243cdab6d5f}{KMP\_DEFAULT\_CHUNK};
2763     \} \textcolor{keywordflow}{else} \{
2764         thread->th.th\_current\_task->td\_icvs.sched.chunk = chunk;
2765     \}
2766 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a3cb36a9e9ab38ef825b47442b4f78bc7}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy@{\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy}}
\index{\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy@{\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-setup\-\_\-icv\-\_\-copy (
\begin{DoxyParamCaption}
\item[{{\bf kmp\-\_\-team\-\_\-t} $\ast$}]{team, }
\item[{{\bf int}}]{new\-\_\-nproc, }
\item[{{\bf kmp\-\_\-internal\-\_\-control\-\_\-t} $\ast$}]{new\-\_\-icvs, }
\item[{{\bf ident\-\_\-t} $\ast$}]{loc}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a3cb36a9e9ab38ef825b47442b4f78bc7}


Definition at line 1708 of file kmp\-\_\-barrier.\-cpp.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
1709 \{
1710     \hyperlink{kmp__stats_8h_a340afca3214165ed1920481f0e8fa67c}{KMP\_TIME\_DEVELOPER\_BLOCK}(KMP\_setup\_icv\_copy);
1711 
1712     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(team && new\_nproc && new\_icvs);
1713     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}((!\hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel})) || new\_icvs->
      \hyperlink{structkmp__internal__control_a807067319fd06b644c3aecefadac01e6}{nproc});
1714 
1715     \textcolor{comment}{/* Master thread's copy of the ICVs was set up on the implicit taskdata in}
1716 \textcolor{comment}{       \_\_kmp\_reinitialize\_team. \_\_kmp\_fork\_call() assumes the master thread's implicit task has}
1717 \textcolor{comment}{       this data before this function is called. */}
1718 \textcolor{preprocessor}{#if KMP\_BARRIER\_ICV\_PULL}
1719 \textcolor{preprocessor}{}    \textcolor{comment}{/* Copy ICVs to master's thread structure into th\_fixed\_icvs (which remains untouched), where}
1720 \textcolor{comment}{       all of the worker threads can access them and make their own copies after the barrier. */}
1721     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]);  \textcolor{comment}{// The threads arrays should be allocated at
       this point}
1722     \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]->th.th\_bar[\hyperlink{kmp_8h_ad0f7c21f2f1d446087ef5714eb0fd8cfab7dbfe1300085e4a7825c809112aaf7c}{bs\_forkjoin\_barrier}].bb.
      th\_fixed\_icvs, new\_icvs);
1723     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_setup\_icv\_copy: PULL: T#%d this\_thread=%p team=%p\(\backslash\)n"},
1724                   0, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team));
1725 \textcolor{preprocessor}{#elif KMP\_BARRIER\_ICV\_PUSH}
1726 \textcolor{preprocessor}{}    \textcolor{comment}{// The ICVs will be propagated in the fork barrier, so nothing needs to be done here.}
1727     \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_setup\_icv\_copy: PUSH: T#%d this\_thread=%p team=%p\(\backslash\)n"},
1728                   0, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0], team));
1729 \textcolor{preprocessor}{#else}
1730 \textcolor{preprocessor}{}    \textcolor{comment}{// Copy the ICVs to each of the non-master threads.  This takes O(nthreads) time.}
1731     \hyperlink{kmp__barrier_8cpp_a041fcfa491f1f402a50d53fb23c915bb}{ngo\_load}(new\_icvs);
1732     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[0]);  \textcolor{comment}{// The threads arrays should be allocated at
       this point}
1733     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} f=1; f<new\_nproc; ++f) \{ \textcolor{comment}{// Skip the master thread}
1734         \textcolor{comment}{// TODO: GEH - pass in better source location info since usually NULL here}
1735         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_setup\_icv\_copy: LINEAR: T#%d this\_thread=%p team=%p\(\backslash\)n"},
1736                       f, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f], team));
1737         \hyperlink{kmp_8h_a8387c1b95f3b497a14fc3916515ad4c3}{\_\_kmp\_init\_implicit\_task}(loc, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f], team, f, 
      \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1738         \hyperlink{kmp__barrier_8cpp_a12530abe295809b23e5f414fa302448b}{ngo\_store\_icvs}(&team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[f].td\_icvs, new\_icvs);
1739         \hyperlink{kmp__debug_8h_aa77d06a01f304e7b70fe1f4b052a1b57}{KF\_TRACE}(10, (\textcolor{stringliteral}{"\_\_kmp\_setup\_icv\_copy: LINEAR: T#%d this\_thread=%p team=%p\(\backslash\)n"},
1740                       f, team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_threads[f], team));
1741     \}
1742     \hyperlink{kmp__barrier_8cpp_a303ca33adc792fd05f7da5d34b75aa4c}{ngo\_sync}();
1743 \textcolor{preprocessor}{#endif // KMP\_BARRIER\_ICV\_PULL}
1744 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master@{\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master}}
\index{\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master@{\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-teams\-\_\-master}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-teams\-\_\-master (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a1693973bc1f13f7210d814c81815f602}


Definition at line 6907 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-team(), \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call(), \-\_\-\-\_\-kmp\-\_\-fork\-\_\-team\-\_\-threads(), \-\_\-\-\_\-kmp\-\_\-free\-\_\-team(), \-\_\-\-\_\-kmp\-\_\-hierarchical\-\_\-barrier\-\_\-release(), \-\_\-\-\_\-kmp\-\_\-invoke\-\_\-teams\-\_\-master(), \-\_\-\-\_\-kmp\-\_\-join\-\_\-call(), and \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams().


\begin{DoxyCode}
6908 \{
6909     \textcolor{comment}{// This routine is called by all master threads in teams construct}
6910     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
6911     \hyperlink{unionkmp__team}{kmp\_team\_t} *team = thr->th.th\_team;
6912     \hyperlink{structident}{ident\_t}     *loc =  team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_ident;
6913     thr->th.th\_set\_nproc = thr->th.th\_teams\_size.nth;
6914     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thr->th.th\_teams\_microtask );
6915     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( thr->th.th\_set\_nproc );
6916     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_teams\_master: T#%d, Tid %d, microtask %p\(\backslash\)n"},
6917                    gtid, \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid ), thr->th.th\_teams\_microtask ) );
6918     \textcolor{comment}{// Launch league of teams now, but not let workers execute}
6919     \textcolor{comment}{// (they hang on fork barrier until next parallel)}
6920 \textcolor{preprocessor}{#if INCLUDE\_SSC\_MARKS}
6921 \textcolor{preprocessor}{}    SSC\_MARK\_FORKING();
6922 \textcolor{preprocessor}{#endif}
6923 \textcolor{preprocessor}{}    \hyperlink{kmp__runtime_8c_a2c67bc63fbc37afe564202b2cdc7d5ba}{\_\_kmp\_fork\_call}( loc, gtid, \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel},
6924             team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_argc,
6925 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
6926             (\textcolor{keywordtype}{void} *)thr->th.th\_teams\_microtask,      \textcolor{comment}{// "unwrapped" task}
6927 #endif
6928             (\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t})thr->th.th\_teams\_microtask, \textcolor{comment}{// "wrapped" task}
6929             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\hyperlink{kmp_8h_a850b6d220ac7bc7284cfe27996d78e98}{launch\_t}) \hyperlink{kmp__runtime_8c_ac3c18dacc189c300ca06e4ab033fc211}{\_\_kmp\_invoke\_task\_func},
6930             NULL );
6931 \textcolor{preprocessor}{#if INCLUDE\_SSC\_MARKS}
6932 \textcolor{preprocessor}{}    SSC\_MARK\_JOINING();
6933 \textcolor{preprocessor}{#endif}
6934 \textcolor{preprocessor}{}    
6935     \textcolor{comment}{// AC: last parameter "1" eliminates join barrier which won't work because}
6936     \textcolor{comment}{// worker threads are in a fork barrier waiting for more parallel regions}
6937     \hyperlink{kmp__runtime_8c_a7f7de8f765a397ab1b076555bdee9504}{\_\_kmp\_join\_call}( loc, gtid
6938 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
6939         , \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel}
6940 #endif
6941         , 1 ); 
6942 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a9d810421d1895c17ac6e8774f0f0bd39}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library}}
\index{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-unregister\-\_\-library (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a9d810421d1895c17ac6e8774f0f0bd39}


Definition at line 6281 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end().


\begin{DoxyCode}
6281                                  \{
6282 
6283     \textcolor{keywordtype}{char} * \hyperlink{ittnotify__static_8h_a1c34b35a4952969fef60192313bba34a}{name}  = \hyperlink{kmp__runtime_8c_a02c91cce4fb3b2bd2b7b7d08eeb6b0a8}{\_\_kmp\_reg\_status\_name}();
6284     \textcolor{keywordtype}{char} * value = \hyperlink{kmp__environment_8c_a8ca0c26acad07b836fc8d8013979e8cd}{\_\_kmp\_env\_get}( name );
6285 
6286     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\_\_kmp\_registration\_flag} != 0 );
6287     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str}  != NULL );
6288     \textcolor{keywordflow}{if} ( value != NULL && strcmp( value, \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str} ) == 0 ) \{
6289         \textcolor{comment}{// Ok, this is our variable. Delete it.}
6290         \hyperlink{kmp__environment_8c_af0715e0365570b19fd22c7370e3d4938}{\_\_kmp\_env\_unset}( name );
6291     \}; \textcolor{comment}{// if}
6292 
6293     \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str} );
6294     \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( value );
6295     \hyperlink{kmp_8h_ac9035c424aa6f5daac89143f720e3848}{KMP\_INTERNAL\_FREE}( name );
6296 
6297     \hyperlink{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\_\_kmp\_registration\_flag} = 0;
6298     \hyperlink{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\_\_kmp\_registration\_str}  = NULL;
6299 
6300 \} \textcolor{comment}{// \_\_kmp\_unregister\_library}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a87754754d79922faa89637e40ef50579}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread}}
\index{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread@{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-unregister\-\_\-root\-\_\-current\-\_\-thread (
\begin{DoxyParamCaption}
\item[{{\bf int}}]{gtid}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a87754754d79922faa89637e40ef50579}


Definition at line 3957 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-library(), and \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end\-\_\-thread().


\begin{DoxyCode}
3958 \{
3959     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 1, (\textcolor{stringliteral}{"\_\_kmp\_unregister\_root\_current\_thread: enter T#%d\(\backslash\)n"}, gtid ));
3960     \textcolor{comment}{/* this lock should be ok, since unregister\_root\_current\_thread is never called during}
3961 \textcolor{comment}{     * and abort, only during a normal close.  furthermore, if you have the}
3962 \textcolor{comment}{     * forkjoin lock, you should never try to get the initz lock */}
3963 
3964     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
3965     \textcolor{keywordflow}{if}( \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}(\hyperlink{kmp_8h_a11b71922a4df46ff9e8dbc68693e8d67}{\_\_kmp\_global}.g.g\_done) || !\hyperlink{kmp_8h_aee22cd19970207e05e9c86cc0a802f9c}{\_\_kmp\_init\_serial} ) \{
3966         \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_unregister\_root\_current\_thread: already finished, exiting T#%d\(\backslash\)n"}, 
      gtid ));
3967         \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
3968         \textcolor{keywordflow}{return};
3969     \}
3970     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} *root = \hyperlink{kmp_8h_aa55bed3b4f4c286e5dd1f23ccda86c65}{\_\_kmp\_root}[gtid];
3971 
3972     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads} && 
      \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid] );
3973     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( \hyperlink{kmp_8h_a1ad5b094aa539d78ab4155b10b0ced21}{KMP\_UBER\_GTID}( gtid ));
3974     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( root == \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid]->th.th\_root );
3975     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( root->r.r\_active == \hyperlink{kmp_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} );
3976 
3977 
3978     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
3979 
3980 \textcolor{preprocessor}{#if OMP\_41\_ENABLED}
3981 \textcolor{preprocessor}{}   \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} * thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[gtid];
3982    \hyperlink{unionkmp__team}{kmp\_team\_t} * team = thread->th.th\_team;
3983    \hyperlink{unionkmp__task__team}{kmp\_task\_team\_t} *   task\_team = thread->th.th\_task\_team;
3984 
3985    \textcolor{comment}{// we need to wait for the proxy tasks before finishing the thread}
3986    \textcolor{keywordflow}{if} ( task\_team != NULL && task\_team->\hyperlink{unionkmp__task__team_a18728e49ce76f29250a4be77cd7a2ff4}{tt}.tt\_found\_proxy\_tasks ) \{
3987 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
3988 \textcolor{preprocessor}{}        \textcolor{comment}{// the runtime is shutting down so we won't report any events}
3989         thread->th.ompt\_thread\_info.state = ompt\_state\_undefined;
3990 \textcolor{preprocessor}{#endif}
3991 \textcolor{preprocessor}{}        \hyperlink{kmp_8h_afd36f17a7257b41ac1c0ac640225e292}{\_\_kmp\_task\_team\_wait}(thread, team, NULL );
3992    \}
3993 \textcolor{preprocessor}{#endif}
3994 \textcolor{preprocessor}{}
3995     \hyperlink{kmp__runtime_8c_a81d484eadddec5aa9fb9e84cac63ca72}{\_\_kmp\_reset\_root}(gtid, root);
3996 
3997     \textcolor{comment}{/* free up this thread slot */}
3998     \hyperlink{kmp_8h_ae3492f3ab3c30ed2c204dc10e93c8471}{\_\_kmp\_gtid\_set\_specific}( \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE} );
3999 \textcolor{preprocessor}{#ifdef KMP\_TDATA\_GTID}
4000 \textcolor{preprocessor}{}    \_\_kmp\_gtid = \hyperlink{kmp_8h_afa6317d5d5bf13b0e47e5b8d2a04043d}{KMP\_GTID\_DNE};
4001 \textcolor{preprocessor}{#endif}
4002 \textcolor{preprocessor}{}
4003     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
4004     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmp\_unregister\_root\_current\_thread: T#%d unregistered\(\backslash\)n"}, gtid ));
4005 
4006     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( &
      \hyperlink{kmp_8h_a7f54ac3466c74a71cd89ecb3af8c9956}{\_\_kmp\_forkjoin\_lock} );
4007 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a6a533c08740e41e820de3564c7f72029}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library}}
\index{\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library@{\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-user\-\_\-set\-\_\-library (
\begin{DoxyParamCaption}
\item[{enum {\bf library\-\_\-type}}]{arg}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a6a533c08740e41e820de3564c7f72029}


Definition at line 7385 of file kmp\-\_\-runtime.\-c.



Referenced by F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-L\-I\-B\-R\-A\-R\-Y(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-L\-I\-B\-R\-A\-R\-Y\-\_\-\-S\-E\-R\-I\-A\-L(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-L\-I\-B\-R\-A\-R\-Y\-\_\-\-T\-H\-R\-O\-U\-G\-H\-P\-U\-T(), F\-T\-N\-\_\-\-S\-E\-T\-\_\-\-L\-I\-B\-R\-A\-R\-Y\-\_\-\-T\-U\-R\-N\-A\-R\-O\-U\-N\-D(), and kmpc\-\_\-set\-\_\-library().


\begin{DoxyCode}
7386 \{
7387     \textcolor{keywordtype}{int} gtid;
7388     \hyperlink{kmp_8h_a59e316f709f2c4317309755daa824d7e}{kmp\_root\_t} *root;
7389     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *thread;
7390 
7391     \textcolor{comment}{/* first, make sure we are initialized so we can get our gtid */}
7392 
7393     gtid = \hyperlink{kmp_8h_a5d1e6d7c35de87705193f11d65457229}{\_\_kmp\_entry\_gtid}();
7394     thread = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
7395 
7396     root = thread->th.th\_root;
7397 
7398     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmp\_user\_set\_library: enter T#%d, arg: %d, %d\(\backslash\)n"}, gtid, arg, 
      \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599dab9408e6f6c86c0912aea425b98e37d5a}{library\_serial} ));
7399     \textcolor{keywordflow}{if} (root->r.r\_in\_parallel) \{ \textcolor{comment}{/* Must be called in serial section of top-level thread */}
7400         \hyperlink{kmp__i18n_8h_a5aeb48e92a07c52661a33ec3fcee938f}{KMP\_WARNING}( SetLibraryIncorrectCall );
7401         \textcolor{keywordflow}{return};
7402     \}
7403 
7404     \textcolor{keywordflow}{switch} ( arg ) \{
7405     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599dab9408e6f6c86c0912aea425b98e37d5a}{library\_serial} :
7406         thread->th.th\_set\_nproc = 0;
7407         \hyperlink{kmp_8h_a528ef662aebf927aa7e586d2ea70bb04}{set\_\_nproc}( thread, 1 );
7408         \textcolor{keywordflow}{break};
7409     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599daa9ed1bfecb34570e64bff6167eb99f44}{library\_turnaround} :
7410         thread->th.th\_set\_nproc = 0;
7411         \hyperlink{kmp_8h_a528ef662aebf927aa7e586d2ea70bb04}{set\_\_nproc}( thread, \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} ? 
      \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} : \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} );
7412         \textcolor{keywordflow}{break};
7413     \textcolor{keywordflow}{case} \hyperlink{kmp_8h_aee0cf894df4706d555a64e6d5b51599daadaa2a9ce75fbdb96025b8f6e9c2a4d7}{library\_throughput} :
7414         thread->th.th\_set\_nproc = 0;
7415         \hyperlink{kmp_8h_a528ef662aebf927aa7e586d2ea70bb04}{set\_\_nproc}( thread, \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} ? 
      \hyperlink{kmp_8h_ae1cbb4cacdc7604067520251592308db}{\_\_kmp\_dflt\_team\_nth} : \hyperlink{kmp_8h_a276ff01bccbaef288bb657d70b097b11}{\_\_kmp\_dflt\_team\_nth\_ub} );
7416         \textcolor{keywordflow}{break};
7417     \textcolor{keywordflow}{default}:
7418         \hyperlink{kmp__i18n_8h_aaa06fec585285ef7883baea41bfd948f}{KMP\_FATAL}( UnknownLibraryType, arg );
7419     \}
7420 
7421     \hyperlink{kmp__runtime_8c_a322e39ae06914545d6ef1532da1df903}{\_\_kmp\_aux\_set\_library} ( arg );
7422 \}
\end{DoxyCode}
\hypertarget{kmp__runtime_8c_a051615c6f879f3ce422ba7d55bb60f46}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-warn@{\-\_\-\-\_\-kmp\-\_\-warn}}
\index{\-\_\-\-\_\-kmp\-\_\-warn@{\-\_\-\-\_\-kmp\-\_\-warn}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-warn}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmp\-\_\-warn (
\begin{DoxyParamCaption}
\item[{char const $\ast$}]{format, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{kmp__runtime_8c_a051615c6f879f3ce422ba7d55bb60f46}


Definition at line 385 of file kmp\-\_\-runtime.\-c.


\begin{DoxyCode}
386 \{
387     \textcolor{keywordtype}{char} buffer[\hyperlink{kmp__runtime_8c_a8cea0c1cc1fc60a52e79998580bbf1a7}{MAX\_MESSAGE}];
388     va\_list ap;
389 
390     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a06223e20c3936db72421888ea9ae6912}{\_\_kmp\_generate\_warnings} == \hyperlink{kmp__os_8h_a73d4f0dfc65917c280dcb4c1b5f8448da2bfc72cc0b000927dccb59a34a0ee756}{kmp\_warnings\_off} ) \{
391         \textcolor{keywordflow}{return};
392     \}
393 
394     va\_start( ap, format );
395 
396     \hyperlink{kmp__safe__c__api_8h_a69d5e0c1eb5568cc66b5faf64a772617}{KMP\_SNPRINTF}( buffer, \textcolor{keyword}{sizeof}(buffer) , \textcolor{stringliteral}{"OMP warning: %s\(\backslash\)n"}, format );
397     \hyperlink{kmp__lock_8h_a85412da5c0d085bde951a77690cf1f74}{\_\_kmp\_acquire\_bootstrap\_lock}( & \hyperlink{kmp__io_8c_a49e60c011739f46589bb4fae4ad737cc}{\_\_kmp\_stdio\_lock} );
398     \hyperlink{kmp__io_8c_a1d4c137bf5adc9e0d804be83a75294cf}{\_\_kmp\_vprintf}( \hyperlink{kmp__io_8h_ad5c7b251dd2d5c33df5f3ac1e706730eac430a76c55aa8cd34020bd29e6f75ee1}{kmp\_err}, buffer, ap );
399     \hyperlink{kmp__lock_8h_a058b93e191c678dfe3e0b98bee82ff9b}{\_\_kmp\_release\_bootstrap\_lock}( & \hyperlink{kmp__io_8c_a49e60c011739f46589bb4fae4ad737cc}{\_\_kmp\_stdio\_lock} );
400 
401     va\_end( ap );
402 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-monitor@{\-\_\-\-\_\-kmp\-\_\-monitor}}
\index{\-\_\-\-\_\-kmp\-\_\-monitor@{\-\_\-\-\_\-kmp\-\_\-monitor}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-monitor}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-info\-\_\-t} \-\_\-\-\_\-kmp\-\_\-monitor}}\label{kmp__runtime_8c_a5f889b5c933ca73bdf7f43cbe76d5f93}


Definition at line 62 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), and \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end().

\hypertarget{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-primes@{\-\_\-\-\_\-kmp\-\_\-primes}}
\index{\-\_\-\-\_\-kmp\-\_\-primes@{\-\_\-\-\_\-kmp\-\_\-primes}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-primes}]{\setlength{\rightskip}{0pt plus 5cm}const unsigned \-\_\-\-\_\-kmp\-\_\-primes\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a8e0f74e53621aa9633c6833d6b1c315b}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
  0x9e3779b1, 0xffe6cc59, 0x2109f6dd, 0x43977ab5,
  0xba5703f5, 0xb495a877, 0xe1626741, 0x79695e6b,
  0xbc98c09f, 0xd5bee2b3, 0x287488f9, 0x3af18231,
  0x9677cd4d, 0xbe3a6929, 0xadc6a877, 0xdcf0674b,
  0xbe4d6fe9, 0x5f15e201, 0x99afc3fd, 0xf3f16801,
  0xe222cfff, 0x24ba5fdb, 0x0620452d, 0x79f149e3,
  0xc8b93f49, 0x972702cd, 0xb07dd827, 0x6c97d5ed,
  0x085a3d61, 0x46eb5ea7, 0x3d9910ed, 0x2e687b5b,
  0x29609227, 0x6eb081f1, 0x0954c4e1, 0x9d114db9,
  0x542acfa9, 0xb3e6bd7b, 0x0742d917, 0xe9f3ffa7,
  0x54581edb, 0xf2480f45, 0x0bb9288f, 0xef1affc7,
  0x85fa0ca7, 0x3ccc14db, 0xe6baf34b, 0x343377f7,
  0x5ca19031, 0xe6d9293b, 0xf0a9f391, 0x5d2e980b,
  0xfc411073, 0xc3749363, 0xb892d829, 0x3549366b,
  0x629750ad, 0xb98294e5, 0x892d9483, 0xc235baf3,
  0x3d2402a3, 0x6bdef3c9, 0xbec333cd, 0x40c9520f
\}
\end{DoxyCode}


Definition at line 3443 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-init\-\_\-random().

\hypertarget{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag@{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag}}
\index{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag@{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag}]{\setlength{\rightskip}{0pt plus 5cm}long \-\_\-\-\_\-kmp\-\_\-registration\-\_\-flag = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a2dfa02c059556fe05a36b14ee13f6f4d}


Definition at line 6154 of file kmp\-\_\-runtime.\-c.

\hypertarget{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str@{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str}}
\index{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str@{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-registration\-\_\-str}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ \-\_\-\-\_\-kmp\-\_\-registration\-\_\-str = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_a9f6aeb4191ea0883cad013ae92eb5d13}


Definition at line 6156 of file kmp\-\_\-runtime.\-c.

\hypertarget{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt@{\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt}}
\index{\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt@{\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt}]{\setlength{\rightskip}{0pt plus 5cm}{\bf kmp\-\_\-info\-\_\-t}$\ast$ \-\_\-\-\_\-kmp\-\_\-thread\-\_\-pool\-\_\-insert\-\_\-pt = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{kmp__runtime_8c_ab07e22ea339166954fd9ce3c5c61a449}


Definition at line 91 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-allocate\-\_\-thread(), \-\_\-\-\_\-kmp\-\_\-do\-\_\-serial\-\_\-initialize(), \-\_\-\-\_\-kmp\-\_\-free\-\_\-thread(), and \-\_\-\-\_\-kmp\-\_\-internal\-\_\-end().

\hypertarget{kmp__runtime_8c_a9f29a3c30ec5aea75f571d33682a5d5a}{\index{kmp\-\_\-runtime.\-c@{kmp\-\_\-runtime.\-c}!\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api@{\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api}}
\index{\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api@{\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api}!kmp_runtime.c@{kmp\-\_\-runtime.\-c}}
\subsubsection[{\-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api}]{\setlength{\rightskip}{0pt plus 5cm}char const \-\_\-\-\_\-kmp\-\_\-version\-\_\-omp\-\_\-api\mbox{[}$\,$\mbox{]}}}\label{kmp__runtime_8c_a9f29a3c30ec5aea75f571d33682a5d5a}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \hyperlink{kmp__version_8h_a30a66c62ae0ce1687f332b91d22619b6}{KMP\_VERSION\_PREFIX} \textcolor{stringliteral}{"API version: "}

    \textcolor{stringliteral}{"4.0 (201307)"}
\end{DoxyCode}


Definition at line 46 of file kmp\-\_\-runtime.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-print\-\_\-version\-\_\-1().

