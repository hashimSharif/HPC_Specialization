\hypertarget{group__PARALLEL}{\section{Parallel (fork/join)}
\label{group__PARALLEL}\index{Parallel (fork/join)@{Parallel (fork/join)}}
}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef \hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void}($\ast$ \hyperlink{group__PARALLEL_gab49014fb4572e7d0f308fd9b1824daf7}{kmpc\-\_\-micro} )(kmp\-\_\-int32 $\ast$global\-\_\-tid, kmp\-\_\-int32 $\ast$bound\-\_\-tid,...)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_ga345b3a5866deefefc91ae1e8958f49f4}{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, kmp\-\_\-int32 num\-\_\-threads)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_gac2b7cc2fa78dde5381bcf00cfc48d124}{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 argc, \hyperlink{group__PARALLEL_gab49014fb4572e7d0f308fd9b1824daf7}{kmpc\-\_\-micro} microtask,...)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_gaae9462b03457d809faeb3e767a5b2283}{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid, kmp\-\_\-int32 num\-\_\-teams, kmp\-\_\-int32 num\-\_\-threads)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_ga1cab712d076ba1d2758b0c3bf5ffe38a}{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 argc, \hyperlink{group__PARALLEL_gab49014fb4572e7d0f308fd9b1824daf7}{kmpc\-\_\-micro} microtask,...)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_ga7b1ba1cc8d9d2fea8654bbb1e59f079e}{\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\item 
\hyperlink{ittnotify__static_8h_af941d56e55e3c5465135b60c4d6343ed}{void} \hyperlink{group__PARALLEL_gac341818e68b06d910111e4cf08bb54dd}{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel} (\hyperlink{group__BASIC__TYPES_ga690fda6b92f039a72db263c6b4394ddb}{ident\-\_\-t} $\ast$loc, kmp\-\_\-int32 global\-\_\-tid)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
These functions are used for implementing {\ttfamily \#pragma omp parallel}. 

\subsection{Typedef Documentation}
\hypertarget{group__PARALLEL_gab49014fb4572e7d0f308fd9b1824daf7}{\index{Parallel (fork/join)@{Parallel (fork/join)}!kmpc\-\_\-micro@{kmpc\-\_\-micro}}
\index{kmpc\-\_\-micro@{kmpc\-\_\-micro}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{kmpc\-\_\-micro}]{\setlength{\rightskip}{0pt plus 5cm}typedef {\bf void}($\ast$ kmpc\-\_\-micro)(kmp\-\_\-int32 $\ast$global\-\_\-tid, kmp\-\_\-int32 $\ast$bound\-\_\-tid,...)}}\label{group__PARALLEL_gab49014fb4572e7d0f308fd9b1824daf7}
The type for a microtask which gets passed to \hyperlink{group__PARALLEL_gac2b7cc2fa78dde5381bcf00cfc48d124}{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call()}. The arguments to the outlined function are 
\begin{DoxyParams}{Parameters}
{\em global\-\_\-tid} & the global thread identity of the thread executing the function. \\
\hline
{\em bound\-\_\-tid} & the local identitiy of the thread executing the function \\
\hline
{\em ...} & pointers to shared variables accessed by the function. \\
\hline
\end{DoxyParams}


Definition at line 1413 of file kmp.\-h.



\subsection{Function Documentation}
\hypertarget{group__PARALLEL_gac341818e68b06d910111e4cf08bb54dd}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel}}
\index{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-end\-\_\-serialized\-\_\-parallel (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_gac341818e68b06d910111e4cf08bb54dd}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number\\
\hline
\end{DoxyParams}
Leave a serialized parallel construct. 

Definition at line 489 of file kmp\-\_\-csupport.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-join\-\_\-call(), and K\-M\-P\-\_\-\-A\-P\-I\-\_\-\-N\-A\-M\-E\-\_\-\-G\-O\-M\-P\-\_\-\-P\-A\-R\-A\-L\-L\-E\-L\-\_\-\-E\-N\-D().


\begin{DoxyCode}
490 \{
491     \hyperlink{structkmp__internal__control}{kmp\_internal\_control\_t} *top;
492     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr;
493     \hyperlink{unionkmp__team}{kmp\_team\_t} *serial\_team;
494 
495     \hyperlink{kmp__debug_8h_ab49eefbf8c74cfe98a90ce7ec8864add}{KC\_TRACE}( 10, (\textcolor{stringliteral}{"\_\_kmpc\_end\_serialized\_parallel: called by T#%d\(\backslash\)n"}, global\_tid ) );
496 
497     \textcolor{comment}{/* skip all this code for autopar serialized loops since it results in}
498 \textcolor{comment}{       unacceptable overhead */}
499     \textcolor{keywordflow}{if}( loc != NULL && (loc->\hyperlink{structident_afa1ec17df36c4bf1e36e97eab63953b9}{flags} & \hyperlink{group__BASIC__TYPES_ga744ef043bd848d5e338b4c72ef247adc}{KMP\_IDENT\_AUTOPAR} ) )
500         \textcolor{keywordflow}{return};
501 
502     \textcolor{comment}{// Not autopar code}
503     \textcolor{keywordflow}{if}( ! \hyperlink{kmp__os_8h_acd6256e4afba32d90997235fc0a38a74}{TCR\_4}( \hyperlink{kmp_8h_aa23ece0d05f38387c8a8441aaad368df}{\_\_kmp\_init\_parallel} ) )
504         \hyperlink{kmp_8h_a9c18846c648d84276b9dd5a1d650ab04}{\_\_kmp\_parallel\_initialize}();
505 
506     this\_thr    = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ global\_tid ];
507     serial\_team = this\_thr->th.th\_serial\_team;
508 
509 \textcolor{preprocessor}{   #if OMP\_41\_ENABLED}
510 \textcolor{preprocessor}{}   \hyperlink{unionkmp__task__team}{kmp\_task\_team\_t} *   task\_team = this\_thr->th.th\_task\_team;
511 
512    \textcolor{comment}{// we need to wait for the proxy tasks before finishing the thread}
513    \textcolor{keywordflow}{if} ( task\_team != NULL && task\_team->\hyperlink{unionkmp__task__team_a18728e49ce76f29250a4be77cd7a2ff4}{tt}.tt\_found\_proxy\_tasks )
514         \hyperlink{kmp_8h_afd36f17a7257b41ac1c0ac640225e292}{\_\_kmp\_task\_team\_wait}(this\_thr, serial\_team, NULL ); \textcolor{comment}{// is an ITT object needed
       here?}
515 \textcolor{preprocessor}{   #endif}
516 \textcolor{preprocessor}{}
517     \hyperlink{kmp__os_8h_ab19ae0836bf2f1ac24e5cfc97c6d7d41}{KMP\_MB}();
518     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team );
519     \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}(       serial\_team -> t.t\_serialized );
520     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( this\_thr -> th.th\_team == serial\_team );
521     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team != this\_thr->th.th\_root->r.r\_root\_team );
522     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team -> t.t\_threads );
523     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}( serial\_team -> t.t\_threads[0] == this\_thr );
524 
525     \textcolor{comment}{/* If necessary, pop the internal control stack values and replace the team values */}
526     top = serial\_team -> t.t\_control\_stack\_top;
527     \textcolor{keywordflow}{if} ( top && top -> serial\_nesting\_level == serial\_team -> t.t\_serialized ) \{
528         \hyperlink{kmp_8h_a87574bd68566bdaab6ba1cd63223ab46}{copy\_icvs}( &serial\_team -> t.t\_threads[0] -> th.th\_current\_task -> td\_icvs, top );
529         serial\_team -> t.t\_control\_stack\_top = top -> next;
530         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}(top);
531     \}
532 
533     \textcolor{comment}{//if( serial\_team -> t.t\_serialized > 1 )}
534     serial\_team -> t.t\_level--;
535 
536     \textcolor{comment}{/* pop dispatch buffers stack */}
537     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer);
538     \{
539         \hyperlink{kmp_8h_a39b4260bfb46eb4f113a70e0a8ac26ea}{dispatch\_private\_info\_t} * disp\_buffer = serial\_team->
      \hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer;
540         serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer =
541             serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_dispatch->th\_disp\_buffer->next;
542         \hyperlink{kmp_8h_a052396231429341ba56a7c1ceacbaa2f}{\_\_kmp\_free}( disp\_buffer );
543     \}
544 
545     -- serial\_team -> t.t\_serialized;
546     \textcolor{keywordflow}{if} ( serial\_team -> t.t\_serialized == 0 ) \{
547 
548         \textcolor{comment}{/* return to the parallel section */}
549 
550 \textcolor{preprocessor}{#if KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64}
551 \textcolor{preprocessor}{}        \textcolor{keywordflow}{if} ( \_\_kmp\_inherit\_fp\_control && serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_fp\_control\_saved ) \{
552             \_\_kmp\_clear\_x87\_fpu\_status\_word();
553             \_\_kmp\_load\_x87\_fpu\_control\_word( &serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_x87\_fpu\_control\_word );
554             \_\_kmp\_load\_mxcsr( &serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_mxcsr );
555         \}
556 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* KMP\_ARCH\_X86 || KMP\_ARCH\_X86\_64 */}\textcolor{preprocessor}{}
557 \textcolor{preprocessor}{}
558         this\_thr -> th.th\_team           = serial\_team -> t.t\_parent;
559         this\_thr -> th.th\_info.ds.ds\_tid = serial\_team -> t.t\_master\_tid;
560 
561         \textcolor{comment}{/* restore values cached in the thread */}
562         this\_thr -> th.th\_team\_nproc     = serial\_team -> t.t\_parent -> t.t\_nproc;          \textcolor{comment}{/*  JPH */}
563         this\_thr -> th.th\_team\_master    = serial\_team -> t.t\_parent -> t.t\_threads[0];     \textcolor{comment}{/* JPH */}
564         this\_thr -> th.th\_team\_serialized = this\_thr -> th.th\_team -> t.t\_serialized;
565 
566         \textcolor{comment}{/* TODO the below shouldn't need to be adjusted for serialized teams */}
567         this\_thr -> th.th\_dispatch       = & this\_thr -> th.th\_team ->
568             t.t\_dispatch[ serial\_team -> t.t\_master\_tid ];
569 
570         \hyperlink{kmp_8h_ae3470280dc2ee8dde4f95debde6575e4}{\_\_kmp\_pop\_current\_task\_from\_thread}( this\_thr );
571 
572         \hyperlink{kmp__debug_8h_a5323a368e8ba273b17c46906dd9ec78c}{KMP\_ASSERT}( this\_thr -> th.th\_current\_task -> td\_flags.executing == 0 );
573         this\_thr -> th.th\_current\_task -> td\_flags.executing = 1;
574 
575         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
576             \textcolor{comment}{// Copy the task team from the new child / old parent team to the thread.}
577             this\_thr->th.th\_task\_team = this\_thr->th.th\_team->t.t\_task\_team[this\_thr->th.th\_task\_state];
578             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_serialized\_parallel: T#%d restoring task\_team %p / team %p
      \(\backslash\)n"},
579                             global\_tid, this\_thr -> th.th\_task\_team, this\_thr -> th.th\_team ) );
580         \}
581     \} \textcolor{keywordflow}{else} \{
582         \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_a39e87c52fb75a615c2564a822a013a5a}{\_\_kmp\_tasking\_mode} != \hyperlink{kmp_8h_aad1bdfbfac136cfd92611bcee79ca3f2af827998cf4eb3f61723edc4943b86c98}{tskm\_immediate\_exec} ) \{
583             \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, ( \textcolor{stringliteral}{"\_\_kmpc\_end\_serialized\_parallel: T#%d decreasing nesting depth of
       serial team %p to %d\(\backslash\)n"},
584                             global\_tid, serial\_team, serial\_team -> t.t\_serialized ) );
585         \}
586     \}
587 
588 \textcolor{preprocessor}{#if USE\_ITT\_BUILD}
589 \textcolor{preprocessor}{}    kmp\_uint64 cur\_time = 0;
590 \textcolor{preprocessor}{#if  USE\_ITT\_NOTIFY}
591 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( \_\_itt\_get\_timestamp\_ptr ) \{
592         cur\_time = \_\_itt\_get\_timestamp();
593     \}
594 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_NOTIFY */}\textcolor{preprocessor}{}
595 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} ( this\_thr->th.th\_team->t.t\_level == 0
596 #\textcolor{keywordflow}{if} OMP\_40\_ENABLED
597         && this\_thr->th.th\_teams\_microtask == NULL
598 #endif
599     ) \{
600         \textcolor{comment}{// Report the barrier}
601         this\_thr->th.th\_ident = loc;
602         \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_submit\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
603             ( \_\_kmp\_forkjoin\_frames\_mode == 3 || \_\_kmp\_forkjoin\_frames\_mode == 1 ) )
604         \{
605             \_\_kmp\_itt\_frame\_submit( global\_tid, this\_thr->th.th\_frame\_time\_serialized,
606                                     cur\_time, 0, loc, this\_thr->th.th\_team\_nproc, 0 );
607             \textcolor{keywordflow}{if} ( \_\_kmp\_forkjoin\_frames\_mode == 3 )
608                 \textcolor{comment}{// Since barrier frame for serialized region is equal to the region we use the same begin
       timestamp as for the barrier.}
609                 \_\_kmp\_itt\_frame\_submit( global\_tid, serial\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_region\_time,
610                                         cur\_time, 0, loc, this\_thr->th.th\_team\_nproc, 2 );
611         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( ( \_\_itt\_frame\_end\_v3\_ptr || KMP\_ITT\_DEBUG ) &&
612             ! \_\_kmp\_forkjoin\_frames\_mode && \_\_kmp\_forkjoin\_frames )
613             \textcolor{comment}{// Mark the end of the "parallel" region for VTune. Only use one of frame notification scheme
       at the moment.}
614             \_\_kmp\_itt\_region\_joined( global\_tid, 1 );
615     \}
616 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* USE\_ITT\_BUILD */}\textcolor{preprocessor}{}
617 \textcolor{preprocessor}{}
618     \textcolor{keywordflow}{if} ( \hyperlink{kmp_8h_ab4062d4f566c901230e51490a8819ba0}{\_\_kmp\_env\_consistency\_check} )
619         \hyperlink{kmp__error_8c_aef349dfa99115c3307bff95369f1a813}{\_\_kmp\_pop\_parallel}( global\_tid, NULL );
620 \}
\end{DoxyCode}
\hypertarget{group__PARALLEL_gac2b7cc2fa78dde5381bcf00cfc48d124}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call@{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call}}
\index{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call@{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-call (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{argc, }
\item[{{\bf kmpc\-\_\-micro}}]{microtask, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_gac2b7cc2fa78dde5381bcf00cfc48d124}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em argc} & total number of arguments in the ellipsis \\
\hline
{\em microtask} & pointer to callback routine consisting of outlined parallel construct \\
\hline
{\em ...} & pointers to shared variables that aren't global\\
\hline
\end{DoxyParams}
Do the actual fork and call the microtask in the relevant number of threads. 

Definition at line 281 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
282 \{
283   \textcolor{keywordtype}{int}         gtid = \hyperlink{kmp_8h_a5d1e6d7c35de87705193f11d65457229}{\_\_kmp\_entry\_gtid}();
284 
285 \textcolor{preprocessor}{#if (KMP\_STATS\_ENABLED)  }
286 \textcolor{preprocessor}{}  \textcolor{keywordtype}{int} inParallel = \hyperlink{group__THREAD__STATES_ga5c4aad6e2e289283e9c58031f7c4e228}{\_\_kmpc\_in\_parallel}(loc);
287   \textcolor{keywordflow}{if} (inParallel)
288   \{
289       \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(OMP\_NESTED\_PARALLEL);
290   \}
291   \textcolor{keywordflow}{else}
292   \{
293       \hyperlink{group__STATS__GATHERING_ga6e4f12c6bec4068d72ef9e84516ad01d}{KMP\_STOP\_EXPLICIT\_TIMER}(OMP\_serial);
294       \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(OMP\_PARALLEL);
295   \}
296 \textcolor{preprocessor}{#endif}
297 \textcolor{preprocessor}{}
298   \textcolor{comment}{// maybe to save thr\_state is enough here}
299   \{
300     va\_list     ap;
301     va\_start(   ap, microtask );
302 
303 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
304 \textcolor{preprocessor}{}    \textcolor{keywordtype}{int} tid = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid );
305     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *master\_th = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
306     \hyperlink{unionkmp__team}{kmp\_team\_t} *parent\_team = master\_th->th.th\_team;
307     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
308        parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].
309            ompt\_task\_info.frame.reenter\_runtime\_frame = \_\_builtin\_frame\_address(0);
310     \}
311 \textcolor{preprocessor}{#endif}
312 \textcolor{preprocessor}{}
313 \textcolor{preprocessor}{#if INCLUDE\_SSC\_MARKS}
314 \textcolor{preprocessor}{}    SSC\_MARK\_FORKING();
315 \textcolor{preprocessor}{#endif}
316 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_afa300d153a7fea1038d2cdc72db06498}{\_\_kmp\_fork\_call}( loc, gtid, \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel},
317             argc,
318 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
319             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\textcolor{keywordtype}{void} *) microtask,      \textcolor{comment}{// "unwrapped" task}
320 #endif
321             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t}) microtask, \textcolor{comment}{// "wrapped" task}
322             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\hyperlink{kmp_8h_a850b6d220ac7bc7284cfe27996d78e98}{launch\_t})    
      \hyperlink{kmp_8h_ac3c18dacc189c300ca06e4ab033fc211}{\_\_kmp\_invoke\_task\_func},
323 \textcolor{comment}{/* TODO: revert workaround for Intel(R) 64 tracker #96 */}
324 #\textcolor{keywordflow}{if} (\hyperlink{kmp__platform_8h_a4bbc822bf311c981aab5b1704c1566ab}{KMP\_ARCH\_X86\_64} || KMP\_ARCH\_ARM || \hyperlink{kmp__platform_8h_ac8a9f5686f72dd943400cd0e44eea79e}{KMP\_ARCH\_AARCH64}) && 
      \hyperlink{kmp__platform_8h_a08355ecda6b7d50d12e62476c0727cba}{KMP\_OS\_LINUX}
325             &ap
326 #\textcolor{keywordflow}{else}
327             ap
328 #endif
329             );
330 \textcolor{preprocessor}{#if INCLUDE\_SSC\_MARKS}
331 \textcolor{preprocessor}{}    SSC\_MARK\_JOINING();
332 \textcolor{preprocessor}{#endif}
333 \textcolor{preprocessor}{}    \hyperlink{kmp_8h_af45697be4d0911858cc91b3aa826d7bf}{\_\_kmp\_join\_call}( loc, gtid
334 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
335         , \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel}
336 #endif
337     );
338 
339     va\_end( ap );
340 
341 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
342 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
343         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].
344             ompt\_task\_info.frame.reenter\_runtime\_frame = 0;
345     \}
346 \textcolor{preprocessor}{#endif}
347 \textcolor{preprocessor}{}  \}
348 \textcolor{preprocessor}{#if (KMP\_STATS\_ENABLED)  }
349 \textcolor{preprocessor}{}  \textcolor{keywordflow}{if} (!inParallel)
350       \hyperlink{group__STATS__GATHERING_ga8b26485fe6ad4f74b63e54c42fcfd875}{KMP\_START\_EXPLICIT\_TIMER}(OMP\_serial);
351 \textcolor{preprocessor}{#endif}
352 \textcolor{preprocessor}{}\}
\end{DoxyCode}
\hypertarget{group__PARALLEL_ga1cab712d076ba1d2758b0c3bf5ffe38a}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams@{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams}}
\index{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams@{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-fork\-\_\-teams (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{argc, }
\item[{{\bf kmpc\-\_\-micro}}]{microtask, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_ga1cab712d076ba1d2758b0c3bf5ffe38a}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em argc} & total number of arguments in the ellipsis \\
\hline
{\em microtask} & pointer to callback routine consisting of outlined teams construct \\
\hline
{\em ...} & pointers to shared variables that aren't global\\
\hline
\end{DoxyParams}
Do the actual fork and call the microtask in the relevant number of threads. 

Definition at line 385 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
386 \{
387     \textcolor{keywordtype}{int}         gtid = \hyperlink{kmp_8h_a5d1e6d7c35de87705193f11d65457229}{\_\_kmp\_entry\_gtid}();
388     \hyperlink{kmp_8h_a194859801fe16b326efe34501a37c30a}{kmp\_info\_t} *this\_thr = \hyperlink{kmp_8h_a8ba907eb5a2568ff55a49a1504cd3624}{\_\_kmp\_threads}[ gtid ];
389     va\_list     ap;
390     va\_start(   ap, microtask );
391 
392     \hyperlink{group__STATS__GATHERING_ga7fa64ec62947bf0b97f3f4778dd22196}{KMP\_COUNT\_BLOCK}(OMP\_TEAMS);
393 
394     \textcolor{comment}{// remember teams entry point and nesting level}
395     this\_thr->th.th\_teams\_microtask = microtask;
396     this\_thr->th.th\_teams\_level = this\_thr->th.th\_team->t.t\_level; \textcolor{comment}{// AC: can be >0 on host}
397 
398 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
399 \textcolor{preprocessor}{}    \hyperlink{unionkmp__team}{kmp\_team\_t} *parent\_team = this\_thr->th.th\_team;
400     \textcolor{keywordtype}{int} tid = \hyperlink{kmp_8h_afb8f84fff9682417eb1c484ffbfdc6ee}{\_\_kmp\_tid\_from\_gtid}( gtid );
401     \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
402         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].
403            ompt\_task\_info.frame.reenter\_runtime\_frame = \_\_builtin\_frame\_address(0);
404     \}
405 \textcolor{preprocessor}{#endif}
406 \textcolor{preprocessor}{}
407     \textcolor{comment}{// check if \_\_kmpc\_push\_num\_teams called, set default number of teams otherwise}
408     \textcolor{keywordflow}{if} ( this\_thr->th.th\_teams\_size.nteams == 0 ) \{
409         \hyperlink{kmp_8h_aab10ed0eb17c15a67f56bff0d7ef1268}{\_\_kmp\_push\_num\_teams}( loc, gtid, 0, 0 );
410     \}
411     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr->th.th\_set\_nproc >= 1);
412     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr->th.th\_teams\_size.nteams >= 1);
413     \hyperlink{kmp__debug_8h_ad766efc30e33e28634691088e80cdf08}{KMP\_DEBUG\_ASSERT}(this\_thr->th.th\_teams\_size.nth >= 1);
414 
415     \hyperlink{kmp_8h_afa300d153a7fea1038d2cdc72db06498}{\_\_kmp\_fork\_call}( loc, gtid, \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel},
416             argc,
417 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
418             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\textcolor{keywordtype}{void} *) microtask,               \textcolor{comment}{// "unwrapped" task}
419 #endif
420             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\hyperlink{kmp__os_8h_a390eabec74d95ed005fb6979992598c8}{microtask\_t}) 
      \hyperlink{kmp_8h_a1693973bc1f13f7210d814c81815f602}{\_\_kmp\_teams\_master}, \textcolor{comment}{// "wrapped" task}
421             \hyperlink{kmp__os_8h_aaa9e2fb88f003bd3a22795aadf723e53}{VOLATILE\_CAST}(\hyperlink{kmp_8h_a850b6d220ac7bc7284cfe27996d78e98}{launch\_t})    
      \hyperlink{kmp_8h_ad176caa723133097e5ef49b4db44ea31}{\_\_kmp\_invoke\_teams\_master},
422 #\textcolor{keywordflow}{if} (\hyperlink{kmp__platform_8h_a4bbc822bf311c981aab5b1704c1566ab}{KMP\_ARCH\_X86\_64} || KMP\_ARCH\_ARM || \hyperlink{kmp__platform_8h_ac8a9f5686f72dd943400cd0e44eea79e}{KMP\_ARCH\_AARCH64}) && 
      \hyperlink{kmp__platform_8h_a08355ecda6b7d50d12e62476c0727cba}{KMP\_OS\_LINUX}
423             &ap
424 #\textcolor{keywordflow}{else}
425             ap
426 #endif
427             );
428     \hyperlink{kmp_8h_af45697be4d0911858cc91b3aa826d7bf}{\_\_kmp\_join\_call}( loc, gtid
429 #\textcolor{keywordflow}{if} OMPT\_SUPPORT
430         , \hyperlink{kmp_8h_a49ed6f7454c18058b488af399cadd8e0aae2ae74f371252ae8c8bb7ec81d6a38a}{fork\_context\_intel}
431 #endif
432     );
433 
434 \textcolor{preprocessor}{#if OMPT\_SUPPORT}
435 \textcolor{preprocessor}{}    \textcolor{keywordflow}{if} (\hyperlink{ompt-general_8c_a966b31b6d05f79f5495f8d8e71732f68}{ompt\_enabled}) \{
436         parent\_team->\hyperlink{unionkmp__team_a87cf4571108a61b446e809094f8c0362}{t}.t\_implicit\_task\_taskdata[tid].
437            ompt\_task\_info.frame.reenter\_runtime\_frame = NULL;
438     \}
439 \textcolor{preprocessor}{#endif}
440 \textcolor{preprocessor}{}
441     this\_thr->th.th\_teams\_microtask = NULL;
442     this\_thr->th.th\_teams\_level = 0;
443     *(kmp\_int64*)(&this\_thr->th.th\_teams\_size) = 0L;
444     va\_end( ap );
445 \}
\end{DoxyCode}
\hypertarget{group__PARALLEL_gaae9462b03457d809faeb3e767a5b2283}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams@{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams}}
\index{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams@{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-teams (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{kmp\-\_\-int32}]{num\-\_\-teams, }
\item[{kmp\-\_\-int32}]{num\-\_\-threads}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_gaae9462b03457d809faeb3e767a5b2283}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number \\
\hline
{\em num\-\_\-teams} & number of teams requested for the teams construct \\
\hline
{\em num\-\_\-threads} & number of threads per team requested for the teams construct\\
\hline
\end{DoxyParams}
Set the number of teams to be used by the teams construct. This call is only required if the teams construct has a {\ttfamily num\-\_\-teams} clause or a {\ttfamily thread\-\_\-limit} clause (or both). 

Definition at line 367 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
368 \{
369     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmpc\_push\_num\_teams: enter T#%d num\_teams=%d num\_threads=%d\(\backslash\)n"},
370       global\_tid, num\_teams, num\_threads ) );
371 
372     \hyperlink{kmp_8h_aab10ed0eb17c15a67f56bff0d7ef1268}{\_\_kmp\_push\_num\_teams}( loc, global\_tid, num\_teams, num\_threads );
373 \}
\end{DoxyCode}
\hypertarget{group__PARALLEL_ga345b3a5866deefefc91ae1e8958f49f4}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads}}
\index{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads@{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-push\-\_\-num\-\_\-threads (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid, }
\item[{kmp\-\_\-int32}]{num\-\_\-threads}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_ga345b3a5866deefefc91ae1e8958f49f4}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number \\
\hline
{\em num\-\_\-threads} & number of threads requested for this parallel construct\\
\hline
\end{DoxyParams}
Set the number of threads to be used by the next fork spawned by this thread. This call is only required if the parallel construct has a {\ttfamily num\-\_\-threads} clause. 

Definition at line 240 of file kmp\-\_\-csupport.\-c.


\begin{DoxyCode}
241 \{
242     \hyperlink{kmp__debug_8h_a21d51f37cb197aca5ffe737531678830}{KA\_TRACE}( 20, (\textcolor{stringliteral}{"\_\_kmpc\_push\_num\_threads: enter T#%d num\_threads=%d\(\backslash\)n"},
243       global\_tid, num\_threads ) );
244 
245     \hyperlink{kmp_8h_a5566c62260a489d12940e22f834ccda1}{\_\_kmp\_push\_num\_threads}( loc, global\_tid, num\_threads );
246 \}
\end{DoxyCode}
\hypertarget{group__PARALLEL_ga7b1ba1cc8d9d2fea8654bbb1e59f079e}{\index{Parallel (fork/join)@{Parallel (fork/join)}!\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel}}
\index{\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel@{\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel}!Parallel (fork/join)@{Parallel (fork/join)}}
\subsubsection[{\-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} \-\_\-\-\_\-kmpc\-\_\-serialized\-\_\-parallel (
\begin{DoxyParamCaption}
\item[{{\bf ident\-\_\-t} $\ast$}]{loc, }
\item[{kmp\-\_\-int32}]{global\-\_\-tid}
\end{DoxyParamCaption}
)}}\label{group__PARALLEL_ga7b1ba1cc8d9d2fea8654bbb1e59f079e}

\begin{DoxyParams}{Parameters}
{\em loc} & source location information \\
\hline
{\em global\-\_\-tid} & global thread number\\
\hline
\end{DoxyParams}
Enter a serialized parallel construct. This interface is used to handle a conditional parallel region, like this, 
\begin{DoxyCode}
\textcolor{preprocessor}{#pragma omp parallel if (condition)}
\end{DoxyCode}
 when the condition is false. 

Definition at line 474 of file kmp\-\_\-csupport.\-c.



Referenced by \-\_\-\-\_\-kmp\-\_\-fork\-\_\-call().


\begin{DoxyCode}
475 \{
476     \hyperlink{kmp_8h_ae2668589b9fe28c0a1e48b02a09c3c05}{\_\_kmp\_serialized\_parallel}(loc, global\_tid); \textcolor{comment}{/* The implementation is now in
       kmp\_runtime.c so that it can share static functions with}
477 \textcolor{comment}{                                                 * kmp\_fork\_call since the tasks to be done are similar in
       each case.}
478 \textcolor{comment}{                                                 */}
479 \}
\end{DoxyCode}
