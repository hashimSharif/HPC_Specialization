BEGIN_DEFAULT_CONFIG
Flags:
Files:          $TESTNAME$.upc
DynamicThreads: $DEFAULT$
StaticThreads:  $DEFAULT$
CompileResult:  pass
PassExpr:       ^done.
FailExpr:       ERROR
ExitCode:       0
BuildCmd:       upcc
AppArgs:        
TimeLimit:      $DEFAULT$
END_DEFAULT_CONFIG


# ------------------------------------------------------------
TestName: allocperf
AppArgs: 100

TestName: alloc_time
AppArgs: 100 1024
BenchmarkResult: All Alloc with \S+ THREADS, \S+ block size: (\S+) (us)

TestName: barrierperf
BenchmarkResult: Avg Anon. Barrier latency:\s+(\S+) (us)

TestName: bupc_ptradd
RequireFeature: upc_ptradd

TestName: bupc_thread_dist
RequireFeature: upc_thread_distance

TestName: bupc_memperf
RequireFeature: upc_tick,upc_nb
TimeLimit: 2 * $DEFAULT$
FileLimit: 6900 + 6700 * $THREADS$
#KnownFailure: compile-warning ; cc_pathscale ; bug1199 (pointer from integer warnings)
KnownFailure: run-crash; network_elan ; bug1756 (bupc_memperf crashes on elan)

TestName: bupc_semperf
AppArgs: 1000 100 65536
RequireFeature: upc_tick,upc_sem,upc_nb
KnownFailure:   run-match ; cpu_ia64 && cc_hp && nodebug ; bug2139 (bupc_semperf failure on HPUX/ia64)

TestName: gasp_test
RequireFeature: pupc

TestName: Edmiston
Flags: -lm
AppArgs: 1000 1000
KnownFailure:   run-all ; trans_opt ; bug1505 (--opt-specific runtime failures on stable translator)
RequireFeature: upc_tick

TestName: gups_pair
AppArgs: 10 1024

TestName: laplacian
Flags: -DROWS=16 -DCOLS=16
AppArgs: 10 
DynamicThreads: 0
BenchmarkResult: time: (\S+) (us/iter)
#KnownFailure: compile-warning ; cc_pgi && trans_opt ; bug2675 (Marginal code gen on heat_1 and laplacian)

TestName: ptrmath-volatile
AppArgs: 1000
#KnownFailure: bug469 (Bad codegen for ptrmath-volatile on 64-bit)
#KnownFailure: bug827 (codegen regression on 64-bit regarding pointer-int casts)

TestName: scale-poly
Flags: -lm
AppArgs: 100 1024 8
PassExpr: ^output
BenchmarkResult: 0: Performance of scale with 50 . of local accesses out of \S+ iterations: (\S+) (us/iter)
#KnownFailure: bug446 (bad codegen on benchmarks/scale-poly)

TestName: memcpy_remote
PassExpr: ^done.
FailExpr: ERROR

TestName: memcpy_async
RequireFeature: upc_memcpy_async,upc_nb
Flags: -DBUPC_USE_UPC_NAMESPACE=1
PassExpr: ^done.
FailExpr: ERROR

TestName: memcpy
RequireFeature: upc_memcpy_vis,upc_nb
Flags: -DBUPC_USE_UPC_NAMESPACE=1
PassExpr: ^done.
FailExpr: ERROR
#KnownFailure: bug575 
#KnownFailure: bug829 (32-bit codegen regression on memcpy and memcpy2)
#KnownFailure: run-all ; os_darwin && cc_xlc && nodebug && pthreads ; bug926 (Unstable runtime behavior on OSX/XLC/ndebug)
KnownFailure: compile-failure ; cpu_sparc && cc_gnu && nodebug ; bug1497 (benchmarks/memcpy causes gcc to die on Solaris/sparc)
#KnownFailure: compile-crash ; cpu_32 && trans_cpu_powerpc && trans_cpu_64 ; bug1464 (ppc64 translator crash on benchmarks/memcpy for 32bit targets)
# Clang doesn't like _UINT(32|64) in place of size_t, even though size is the same:
WarningFilter: cc_clang; .*? warning: incompatible pointer types passing '_UINT.. \[.\]' to parameter of type 'const size_t \*' .*?

TestName: memcpy2
RequireFeature: upc_memcpy_vis,upc_nb
Flags: -DBUPC_USE_UPC_NAMESPACE=1
PassExpr: ^done.
FailExpr: ERROR
#KnownFailure: bug829 (32-bit codegen regression on memcpy and memcpy2)
#KnownFailure: run-all ; os_darwin && cc_xlc && nodebug && pthreads ; bug926 (Unstable runtime behavior on OSX/XLC/ndebug)
# Clang doesn't like _UINT(32|64) in place of size_t, even though size is the same:
WarningFilter: cc_clang; .*? warning: incompatible pointer types passing '_UINT.. \[.\]' to parameter of type 'const size_t \*' .*?

TestName: stream-relaxed
Files: stream.c
Flags: -DELEM_T=double -DUSE_SHARED -DUSE_RELAXED -DARRAY_SIZE=100000 -lm
TimeLimit: 0.5 * $DEFAULT$ * $THREADS$
SaveOutput: 1
PassExpr: ^done.
#KnownFailure:   compile-warning ;; bug967 (Bad codegen for volatile qualifiers)

TestName: stream-strict
Files: stream.c
Flags: -DELEM_T=double -DUSE_SHARED -DUSE_STRICT -DARRAY_SIZE=100000 -lm
TimeLimit: 0.5 * $DEFAULT$ * $THREADS$
SaveOutput: 1
PassExpr: ^done.
#KnownFailure:   compile-warning ;; bug967 (Bad codegen for volatile qualifiers)

TestName: strided-comm
SaveOutput: 1
AppArgs: 1 100 1024 4096 100
RequireFeature: upc_memcpy_vis,upc_nb
Flags: -DBUPC_USE_UPC_NAMESPACE=1
PassExpr: ^done.

TestName: touchperf
AppArgs: A 4000000 100
PassExpr: ^done.
RequireFeature: upc_tick
#KnownFailure: run-all ; os_osf ; bug 1230 (Tru64 translator breaks toupper)

TestName: lockperf
Flags: -I.
BenchmarkResult: remote lock, uncontended\s*:\s*Total=\s*\S+\s+\S+\s+Avg/Min/Max=\s*(\S+)\s+\S+\s+\S+\s+(us)
RequireFeature: upc_collective
PassExpr: ^done.
#KnownFailure: compile-crash ; trans_g && trans_opt && trans_os_darwin && trans_cpu_64 ; bug2695 (osx/64-bit translator crash)

TestName: upc_io_test
RequireFeature: upc_io
PassExpr: ^SUCCESS
FailExpr: ERROR
TimeLimit: 2.5 * $DEFAULT$
CompileTimeLimit: 3.3 * $DEFAULT$
#KnownFailure: bug818 ( bogus translator warnings on upc_io_test)
#KnownFailure: run-all ; os_darwin && cc_xlc && nodebug && pthreads ; bug926 (Unstable runtime behavior on OSX/XLC/ndebug)
#KnownFailure: compile-warning ; cpu_64 ; bug819 (bogus warning on upc_io_test/64)
#KnownFailure: compile-failure ; cpu_64 ; bug930 (Regression on upc_io_test/64)
KnownFailure: run-all ; network_gm || network_vapi || network_ibv || network_lapi || network_portals ; bug955 (failures on upc_io_test - firehose mishandles free)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
#KnownFailure: compile-warning ; structsptr && debug ; Bug 2979 - warning on NULL initializer for PTS in struct with struct-PTS
KnownFailure: run-time ; cpu_64 && ( cpu_rs6000 || cpu_powerpc || cpu_powerpc64 || cpu_sparc ) ; Bug 2992 -  Bad translation of narrowing reference to struct member
WarningFilter: cc_pathscale; '.*?\bOlimit\b.*?' # for bug 2699
# Cray C and Clang warn about assert(unsigned >= 0)
WarningFilter:	cc_cray; CC-186 craycc: WARNING .*?
WarningFilter:	cc_clang || trans_cupc || trans_cupc2c; .*?-Wtautological-compare.*?

TestName: stream_mtu
Flags: os_solaris ; -D__EXTENSIONS__  # For random & srandom
SaveOutput: 1
PassExpr: ^done

TestName: thread-scale
Files:  $TESTNAME$.c
AppArgs: 1000000

TestName: natural_ring_mtu
Flags: os_solaris ; -D__EXTENSIONS__  # For random & srandom
SaveOutput: 1
PassExpr: ^done
TimeLimit: 5 * $DEFAULT$
KnownFailure: run-crash ; os_openbsd && pthreads ; Bug 3174 - srandom is not thread-safe
KnownFailure: run-limit ; thrille ; Thrille floods output with potential races

TestName: fetchadd_perf
SaveOutput: 1
PassExpr: ^done
RequireFeature: upc_tick,runtime_upcr # upcr for bupc_atomics

TestName: atomicperf
SaveOutput: 1
PassExpr: ^done
RequireFeature: upc_atomics

