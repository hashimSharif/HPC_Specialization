# Test harness configuration file

# All compilations and runs should pass.
# We compile for both static and dynamic threads.
# We try both the push and pull versions where applicable.

# On BG/P all job's stderr includes "boot failure: False"
# which requires to our use of a slighlty messy FailExpr

BEGIN_DEFAULT_CONFIG
Flags:          -D_UPC_COLL_CHECK_ARGS
DynamicThreads: $DEFAULT$
StaticThreads:  $DEFAULT$
CompileResult:  pass
TimeLimit:      2.0 * $DEFAULT$ + ( $THREADS$ ** 3 ) / 10
CompileTimeLimit: 2 * $DEFAULT$
PassExpr:       0
FailExpr:       (damaged|(?<!boot )failure:)
ExitCode:       0
BuildCmd:       upcc
SaveOutput:     0
END_DEFAULT_CONFIG

# ------------------------------------------------------------

TestName: 	try_all-push
Files:          try_all.c upc_collective.c
Flags:          -DPUSH
TimeLimit:      $DEFAULT$
#KnownFailure: run-crash ; cpu_ia64 && trans_opt ; bug2945 (ptr-coalesce fails to preserve alignment)
#KnownFailure: bug877 (Bad codegen on UPC-Coll-RefImp with x86 translator)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el ; pathcc backend crashes on SiCortex

TestName: 	try_all-pull
Files:          try_all.c upc_collective.c
Flags:          -DPULL
TimeLimit:      $DEFAULT$
#KnownFailure: bug877 (Bad codegen on UPC-Coll-RefImp with x86 translator)
#KnownFailure: run-crash; nodebug && (network_mpi || network_udp) && trans_opt ;  Bug 2662 (split-phase optimization mishandles multiple conditionals)
#KnownFailure: run-crash ; cpu_ia64 && trans_opt ; bug2945 (ptr-coalesce fails to preserve alignment)
#KnownFailure: run-all ; trans_opt ; bug1453 (Runtime -opt regression on UPC-Coll-RefImp/try_{reduce,all}-pull)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el ; pathcc backend crashes on SiCortex

TestName: 	try_reduce-push
Files:          try_reduce.c upc_collective.c
Flags:          -DPUSH
#KnownFailure: bug877 (Bad codegen on UPC-Coll-RefImp with x86 translator)
#KnownFailure:	bug685 (gasnet_local_membar() insufficient for spinlock constructs)
#KnownFailure:	Bug 647 (Runtime failure of UPC-Coll-RefImp/try_reduce-push on seaborg/smp/pthreads)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
#KnownFailure: run-crash; (network_mpi || network_udp || network_gemini || network_aries) && trans_opt ;  Bug 2662 (split-phase optimization mishandles multiple conditionals)
KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el ; pathcc backend crashes on SiCortex

TestName: 	try_reduce-pull
Files:          try_reduce.c upc_collective.c
Flags:          -DPULL
#KnownFailure: run-all ; trans_opt ; bug1453 (Runtime -opt regression on UPC-Coll-RefImp/try_{reduce,all}-pull)
#KnownFailure: bug877 (Bad codegen on UPC-Coll-RefImp with x86 translator)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el ; pathcc backend crashes on SiCortex

# There is no PUSH/PULL distinction in all_prefix_reduce
TestName: 	try_prefix
Files:          try_prefix.c upc_collective.c
#KnownFailure: run-crash ; cpu_ia64 && trans_opt ; bug2945 (ptr-coalesce fails to preserve alignment)
#KnownFailure: bug877 (Bad codegen on UPC-Coll-RefImp with x86 translator)
#KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el && debug ; pathcc backend crashes on SiCortex

# ------------------------------------------------------------
# Tests with flags to work-around bug 1453 and/or 2662
# If these fail, we know there is another/different problem.
# NOTE: split-phase is now disabled by default

#TestName:       try_all-pull-ALT
#RequireFeature: trans_bupc
#Files:          try_all.c upc_collective.c
#Flags:          -DPULL -opt-disable=split-phase
##KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
#KnownFailure: compile-failure ; os_linux && cc_pathscale && cpu_mips64el ; pathcc backend crashes on SiCortex
#
#TestName:       try_reduce-pull-ALT
#RequireFeature: trans_bupc
#Files:          try_reduce.c upc_collective.c
#Flags:          -DPULL -opt-disable=split-phase
##KnownFailure: compile-all ; trans_os_openbsd ; bug2703 (OpenBSD translator crashes)
#
#TestName: 	try_reduce-push-ALT
#RequireFeature: trans_bupc
#Files:          try_reduce.c upc_collective.c
#Flags:          -DPUSH -opt-disable=split-phase

# ------------------------------------------------------------
