# harness file

BEGIN_DEFAULT_CONFIG
Flags:
Files:          $TESTNAME$.upc
DynamicThreads: $DEFAULT$
StaticThreads:  $DEFAULT$
CompileResult:  pass
PassExpr:       passed
FailExpr:       rror
ExitCode:       0
BuildCmd:       upcc
AppArgs:        
TimeLimit:      $DEFAULT$
SaveOutput:     0
END_DEFAULT_CONFIG


# ------------------------------------------------------------
TestName: test00
#KnownFailure: compile-warning ; cpu_64 ; bug409 (types in translator-generated function prototypes mismatch reincluded headers)

TestName: test01

TestName: test02

TestName: test03
#KnownFailure: compile-warning ; cpu_x86_64 && cc_gnu ; bug409 (types in translator-generated function prototypes mismatch reincluded headers)

TestName: test04
#KnownFailure: compile-warning ; cpu_x86_64 && cc_gnu ; bug409 (types in translator-generated function prototypes mismatch reincluded headers)

TestName: test05
#KnownFailure: compile-warning ; cpu_x86_64 && cc_gnu ; bug409 (types in translator-generated function prototypes mismatch reincluded headers)
#KnownFailure: run-all ; cc_pgi && nodebug ; bug1402 (unexplained runtime failures on PGI/opt)

TestName: test06

TestName: test07
Files: test07.upc test07_sep.upc

TestName: test08
Files: test08.upc test08_sep.upc

TestName: test09

TestName: test10

TestName: test11

TestName: test12

TestName: test13

TestName: test14

TestName: test15

TestName: test16
#KnownFailure: bug237 (missing braces in nested initializers)

TestName: test17
#KnownFailure: compile-warning ; trans_g ; bug1160 (-tv causes lots of bad codegen)
#KnownFailure: bug876 (Bad codegen on intrepid/test17)

TestName: test18
#KnownFailure:   compile-failure ;; bug966 (Typecheck bug for array field in shared struct)
#KnownFailure:   compile-all ;; bug 2084 (intrepid/test18.upc compile failures)
#KnownFailure:   run-crash ;; bug 2306 (sizeof(A[0]) miscomputed as sizeof(A) in intrepid/test18)
#KnownFailure:   compile-failure ; trans_opt ; bug2502 (intrepid/test18.upc compile failures w/ -opt)
#KnownFailure:   compile-warning ; trans_opt && cc_sun ; bug2502 (intrepid/test18.upc compile failures w/ -opt)
#KnownFailure:   run-all ; trans_opt && trans_os_darwin ; bug 2679 (MacOS-build translator dropping function-scoped initializers)
#KnownFailure: compile-warning ; symmetricsptr ; bug2500 (incorrect (phased) type for pointer to FIRST field of shared struct)
#KnownFailure: run-crash ; symmetricsptr ; bug2500 (incorrect (phased) type for pointer to FIRST field of shared struct)

TestName: test19
Flags: os_solaris ; -D__EXTENSIONS__  # For random & srandom
#KnownFailure:   bug515 (Bad codegen for setting shared ptrs to null)
#KnownFailure:   bug874 (umalloc malfunctions under heavy load)
#KnownFailure: run-all ; network_gm ; bug1036 (runtime regression on pcp-i_gm-pthreads: bug515, bug874, test19)
KnownFailure: run-crash ; os_openbsd && pthreads ; Bug 3174 - srandom is not thread-safe
# Clang dislikes BUPC translator output:
WarningFilter: cc_clang; .*?warning: explicitly assigning (a|value of) variable of type .*? to itself .*?

TestName: test20

TestName: test21
#KnownFailure: compile-warning ; os_darwin && cc_gnu ; bug2387 (printf format warning for intrepid/test21.upc on MacOS)
KnownFailure:   compile-warning ; (os_darwin || os_aix || os_openbsd) && (cc_gnu || cc_clang) ; bug925 (gcc printf argument conversion warning for upc_addfield)
# Harness mistakes "Error" in format string appearing in a warning for an error message
WarningFilter: all; .*?"%d: Error: address compare for size %ld failed at index %d.*?

TestName: test22

TestName: test23

TestName: test24
AppEnv:   runtime_upcr; UPC_SHARED_HEAP_SIZE=115M UPC_REQUIRE_SHARED_SIZE=yes
# Thrille needs about 2M of extra memory per thread
AppEnv:   runtime_upcr && thrille ; UPC_SHARED_HEAP_SIZE=117M
# The GUPC Portals4-based runtime uses a buddy system allocator
# and needs more memory due to internal fragmentation.
AppEnv:   runtime_gupc && network_portals4; UPC_SHARED_HEAP_SIZE=256M
#KnownFailure:   compile-failure ; ; bug2375 (trans head regresion on test24: Unknown storage size)
KnownFailure:   run-crash ; malta ; MIPS Malta fails after over-committing memory

TestName: test25
#KnownFailure:   compile-failure ; ; bug2308 (intrepid/test25.upc compile failure)

TestName: test26
#KnownFailure: run-all ; ; bug2451 (bad codegen for all blocked pointer-to-shared inequality comparisons)

TestName: test27
#KnownFailure:   run-crash ; ; bug 2307 (intrepid/test27.upc failure)
#KnownFailure:   compile-warning ; ; bug 2340 (intrepid/test27.upc failure with HEAD translator - DEVFIXED)
#KnownFailure:   compile-warning ; ; bug 2364 (loosing track of typedefs on intrepid/test27.upc)
#KnownFailure:   run-crash ; ; bug 2340 (intrepid/test27.upc failure with HEAD translator - DEVFIXED)
#KnownFailure:   run-crash ; cc_mips && nodebug ; bug 2484 (SGI cc/opt runtime failure on intrepid/test27)

TestName: test28
Flags: os_solaris ; -D__EXTENSIONS__  # For random & srandom

TestName: test29
RequireFeature: trans_gupc # assumptions about rounding are potentially gcc-specific
# Harness mistakes "error" in format string appearing in a warning for an error message
WarningFilter: all; .*?is: %0.15Lf expected: %0.15Lf error: %0.2Le.*?

TestName: test30
RequireFeature: trans_gupc,structsptr

TestName: test31
RequireFeature: upc_tick

